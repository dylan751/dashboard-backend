(this["webpackJsonpherokudata-frontend"]=this["webpackJsonpherokudata-frontend"]||[]).push([[4],{1143:function(e,t,a){},1204:function(e,t,a){},1236:function(e){e.exports=JSON.parse('[{"link":"https://www.postgresql.org/docs/current/interactive/functions-comparisons.html#id-1.5.8.28.17","keyword":"ALL"},{"keyword":"AS","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-TABLE-ALIASES"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-order.html","keyword":"ASC"},{"keyword":"CASE","link":"https://www.postgresql.org/docs/current/interactive/functions-conditional.html#FUNCTIONS-CASE"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"CROSS JOIN"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-GROUPING-SETS","keyword":"CUBE"},{"keyword":"DESC","link":"https://www.postgresql.org/docs/current/interactive/queries-order.html"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-select-lists.html#QUERIES-DISTINCT","keyword":"DISTINCT ON"},{"keyword":"DISTINCT","link":"https://www.postgresql.org/docs/current/interactive/queries-select-lists.html#QUERIES-DISTINCT"},{"link":"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-CASE","keyword":"ELSE"},{"keyword":"FROM","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-FROM"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"FULL JOIN"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"FULL OUTER JOIN"},{"keyword":"GROUP BY","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-GROUP"},{"keyword":"GROUPING SETS","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-GROUPING-SETS"},{"link":"https://www.postgresql.org/docs/current/interactive/sql-select.html#SQL-HAVING","keyword":"HAVING"},{"keyword":"INNER JOIN","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN"},{"keyword":"JOIN","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-LATERAL","keyword":"LATERAL"},{"keyword":"LEFT JOIN","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN"},{"keyword":"LEFT OUTER JOIN","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN"},{"keyword":"LIKE","link":"https://www.postgresql.org/docs/current/interactive/functions-matching.html#FUNCTIONS-LIKE"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-limit.html","keyword":"LIMIT"},{"keyword":"NULLS FIRST","link":"https://www.postgresql.org/docs/current/interactive/queries-order.html"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-order.html","keyword":"NULLS LAST"},{"keyword":"OFFSET","link":"https://www.postgresql.org/docs/current/interactive/queries-limit.html"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"ON"},{"keyword":"ORDER BY","link":"https://www.postgresql.org/docs/current/interactive/queries-order.html"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"OUTER JOIN"},{"keyword":"RIGHT JOIN","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-JOIN","keyword":"RIGHT OUTER JOIN"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-GROUPING-SETS","keyword":"ROLLUP"},{"link":"https://www.postgresql.org/docs/current/interactive/sql-select.html","keyword":"SELECT"},{"keyword":"UNION","link":"https://www.postgresql.org/docs/current/interactive/typeconv-union-case.html"},{"keyword":"USING","link":"https://www.postgresql.org/docs/current/interactive/sql-select.html"},{"keyword":"WHEN","link":"https://www.postgresql.org/docs/9.1/static/functions-conditional.html#FUNCTIONS-CASE"},{"keyword":"WHERE","link":"https://www.postgresql.org/docs/current/interactive/queries-table-expressions.html#QUERIES-WHERE"},{"keyword":"WINDOW","link":"https://www.postgresql.org/docs/current/interactive/tutorial-window.html"},{"link":"https://www.postgresql.org/docs/current/interactive/queries-with.html","keyword":"WITH"}]')},1237:function(e){e.exports=JSON.parse('[{"documentation":"Number of bits in string.","snippet":"bit_length(${1:string})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Number of characters in string.","snippet":"char_length(${1:string})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"coalesce(${1:argument})","documentation":"The COALESCE function returns the first of its arguments that is not null. Null is returned only if all arguments are null.","link":"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-COALESCE-NVL-IFNULL"},{"snippet":"concat(${1:string})","documentation":"Concatenate the text representations of all the arguments. NULL arguments are ignored.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"decode(${1:binary}, ${2:format})","documentation":"Decode binary data from textual representation in string. Supported formats are: base64, hex, escape.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Encode binary data into a textual representation. Supported formats are: base64, hex, escape.","snippet":"encode(${1:binary}, ${2:format})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"format(${1:format string}, ${2:argument})","documentation":"Format arguments according to a format string. This function is similar to the C function `sprintf`.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"generate_series(${1:start}, ${2:stop})","documentation":"Generate a series of values, from start to stop with a step size of one.","link":"https://www.postgresql.org/docs/current/static/functions-srf.html#FUNCTIONS-SRF"},{"snippet":"greatest(${1:argument})","documentation":"The GREATEST function select the largest value from a list of any number of expressions.","link":"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-GREATEST-LEAST"},{"documentation":"Convert the first letter of each word to upper case and the rest to lower case. Words are sequences of alphanumeric characters separated by non-alphanumeric characters.","snippet":"initcap(${1:string})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"least(${1:argument})","documentation":"The LEAST function select the smallest value from a list of any number of expressions.","link":"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-GREATEST-LEAST"},{"snippet":"left(${1:string}, ${2:count})","documentation":"Return first `count` characters in the string. When `count` is negative, return all but last `count` characters.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"length(${1:string})","documentation":"Number of characters in string.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"lower(${1:string})","documentation":"Convert string to lower case.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Fill up the `string` to `length` by prepending the characters `fill` (a space by default). If the string is already longer than length then it is truncated (on the right).","snippet":"lpad(${1:string}, ${2:length}${3:, ${4:fill}})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"md5(${1:string})","documentation":"Calculates the MD5 hash of string, returning the result in hexadecimal.","link":"https://www.postgresql.org/docs/current/static/functions-binarystring.html#FUNCTIONS-BINARYSTRING-OTHER"},{"snippet":"now()","documentation":"Return current date and time.","link":"https://www.postgresql.org/docs/current/static/functions-datetime.html#FUNCTIONS-DATETIME-TABLE"},{"documentation":"The NULLIF function returns a null value if value1 equals value2; otherwise it returns value1. This can be used to perform the inverse operation of the COALESCE.","snippet":"nullif(${1:expression})","link":"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-NULLIF"},{"snippet":"octet_length(${1:string})","documentation":"Number of bytes in string.","link":"https://www.postgresql.org/docs/current/static/functions-binarystring.html#FUNCTIONS-BINARYSTRING-SQL"},{"documentation":"Location of specified substring.","snippet":"position(${1:substring} in ${2:string})","link":"https://www.postgresql.org/docs/current/static/functions-binarystring.html#FUNCTIONS-BINARYSTRING-SQL"},{"snippet":"regexp_match(${1:text}, ${2:pattern}${3:, ${4:flags}})","documentation":"Return captured substring(s) resulting from the first match of a POSIX regular expression to the string.","link":"https://www.postgresql.org/docs/current/static/functions-matching.html#FUNCTIONS-POSIX-TABLE"},{"documentation":"Replace substring(s) matching a POSIX regular expression.","snippet":"regexp_replace(${1:text}, ${2:pattern}, ${3:replacement}${4:, ${5:flags}})","link":"https://www.postgresql.org/docs/current/static/functions-matching.html#FUNCTIONS-POSIX-TABLE"},{"snippet":"regexp_split_to_array(${1:text}, ${2:pattern}${3:, ${4:flags}})","documentation":"Split string using a POSIX regular expression as the delimiter.","link":"https://www.postgresql.org/docs/current/static/functions-matching.html#FUNCTIONS-POSIX-TABLE"},{"documentation":"Split string using a POSIX regular expression as the delimiter.","snippet":"regexp_split_to_table(${1:text}, ${2:pattern}${3:, ${4:flags}})","link":"https://www.postgresql.org/docs/current/static/functions-matching.html#FUNCTIONS-POSIX-TABLE"},{"documentation":"Repeat `string` the specified `count` of times","snippet":"repeat(${1:text}, ${2:count})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Return reversed string.","snippet":"reverse(${1:string})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Return last `count` characters in the string. When `count` is negative, return all but first `count` characters.","snippet":"right(${1:string}, ${2:count})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Split string on delimiter and return the given field (counting from one).","snippet":"split_part(${1:string}, ${2:delimiter}, ${3:field})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"strpos(${1:string}, ${2:substring})","documentation":"Location of specified substring (same as position(substring in string), but note the reversed argument order)","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"substring(${1:string} from ${2:pattern})","documentation":"Extract substring matching POSIX regular expression.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"snippet":"substring(${1:string} from ${2:start}${3: for ${4:size}})","documentation":"Extract substring.","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Convert number to its equivalent hexadecimal representation.","snippet":"to_hex(${1:number})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"},{"documentation":"Convert string to upper case.","snippet":"upper(${1:string})","link":"https://www.postgresql.org/docs/current/static/functions-string.html"}]')},1273:function(e,t){},1283:function(e,t,a){"use strict";a.r(t),a.d(t,"Root",(function(){return Qd}));var n=a(30),r=a(46),s=a(32),i=a(33),c=a(0),l=a.n(c),o=a(59),d=a(535),u=a(81),m=a(75),p=a(176),h=a.n(p),f=a(18),g=a.n(f),v=a(37),b=a(49),E=a(80),y=a.n(E),k=a(108),w={PENDING:"PENDING",FULFILLED:"FULFILLED",REJECTED:"REJECTED"},C=new Error("generator was canceled"),O=l.a.createContext({services:{}}),N=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement(O.Consumer,null,(function(t){var a=t.services;return l.a.createElement(_,Object.assign({},e.props,{services:a}))}))}}]),a}(l.a.PureComponent);N.defaultProps={autorun:!1};var I=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.services;return l.a.createElement(O.Provider,{value:{services:e}},this.props.children)}}]),a}(l.a.Component),_=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={},e.resolve=function(t){return t.fn.apply(t,[e.props.services].concat(Object(b.a)(t.args)))},e.trigger=function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];e.run(a)},e.clear=function(){e.setState((function(e){if(e.status===w.FULFILLED)return{status:void 0,state:void 0,error:void 0}}))},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.props.autorun&&this.run(this.props.arguments)}},{key:"componentDidUpdate",value:function(e,t){!this.props.autorun||e.autorun&&Object(E.isEqual)(this.props.arguments,e.arguments)&&Object(E.isEqual)(this.props.services,e.services)&&(this.state.status||!t.status)||this.run(this.props.arguments)}},{key:"componentWillUnmount",value:function(){this.unmounting=!0,clearTimeout(this.expireTimeout),this.cancelGenerator(this.state.currGen)}},{key:"resolveArgs",value:function(e){return Object(E.isArray)(e)?e:[]}},{key:"cancelGenerator",value:function(){var e=Object(v.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&!t.canceled&&!t.done){e.next=2;break}return e.abrupt("return");case 2:return t.canceled=!0,e.prev=3,e.next=6,t.throw(C);case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),e.t0!==C&&k.a.debug("canceled generator threw error",e.t0);case 12:return e.prev=12,a&&!a.done&&k.a.debug("canceled generator not done"),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[3,9,12,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(v.a)(g.a.mark((function e(t){var a,n,r,s,i,c=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this.expireTimeout),a=this.props.generator,n=this.resolveArgs(t),e.prev=3,this.cancelGenerator(this.state.currGen),r=a.apply(void 0,Object(b.a)(n)),this.setState({state:void 0,status:w.PENDING,currGen:r}),e.next=9,this.drive(r);case 9:s=e.sent,r.canceled||(r.done=!0,this.setState({state:s,status:w.FULFILLED,lastStatus:w.FULFILLED})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r.canceled||(k.a.debug("generator ".concat(a.name,"(").concat(n.join(", "),") failed:"),e.t0),this.setState({error:e.t0,state:void 0,status:w.REJECTED,lastStatus:w.REJECTED}));case 16:return e.prev=16,this.unmounting||r.canceled||((i=this.props.expireAfter)?this.expireTimeout=setTimeout((function(){c.setState((function(e){if(e.currGen===r)return{error:void 0,state:void 0,status:void 0,currGen:void 0}}))}),i):this.setState({currGen:void 0})),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"drive",value:function(){var e=Object(v.a)(g.a.mark((function e(t){var a,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.next();case 2:a=e.sent;case 3:if(a.done){e.next=12;break}return e.next=6,this.takeStep(a.value);case 6:return n=e.sent,e.next=9,t.next(n);case 9:a=e.sent,e.next=3;break;case 12:return e.abrupt("return",a.value);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"takeStep",value:function(){var e=Object(v.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolve(t);case 2:return(a=e.sent)&&a.state&&this.setState({state:a.state}),e.abrupt("return",a?a.result:void 0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.state,a=e.status,n=e.lastStatus,r=e.error,s=!this.props.autorun&&void 0===this.props.arguments&&a!==w.PENDING,i=a===w.FULFILLED;return this.props.children({state:t,status:a,lastStatus:n,error:r,trigger:s?this.trigger:void 0,clear:i?this.clear:void 0})}}]),a}(l.a.Component);_.defaultProps={autorun:!1};var x=a(88),T=function(e){var t=e.layout,a=e.component,n=Object(x.a)(e,["layout","component"]);return l.a.createElement(m.b,Object.assign({},n,{render:function(e){return l.a.createElement(t,e,l.a.createElement(a,e))}}))},D=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"h-100 w-100 flex flex-column items-center justify-center flex-auto pa3"},l.a.createElement(o.a,{name:"help-ring-28",size:48,fillClass:"dark-gray"}),l.a.createElement("div",{className:"mv3 tc"},l.a.createElement("p",{className:"f4 normal dark-gray"},"We couldn\u2019t find this page."),l.a.createElement("p",{className:"f5 fw1 mid-gray"},"Perhaps head back to the ",l.a.createElement(u.b,{to:"/"},"datastore list?"))))}}]),a}(l.a.Component),S=a(11),j=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isDismissed:!1},e.handleClick=function(t){e.props.onClick&&e.props.onClick(t)},e.handleDismissClick=function(t){e.setState({isDismissed:!0})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.mainText,a=e.secondaryText;return this.state.isDismissed?null:l.a.createElement("div",{className:"bg-dark-gray white flex w-100 ph2 pv3 items-center justify-between flex-shrink-0"},l.a.createElement("div",{className:"ml1 mr2 flex-none"},l.a.createElement(o.a,{name:"deploy-28",size:28,fillClass:"dark-gray",title:t})),l.a.createElement("div",{className:"flex flex-column flex-auto"},l.a.createElement("div",{className:"f4 white pb2"},t),l.a.createElement("div",{className:"f5 light-gray"},a)),l.a.createElement("div",{className:"flex flex-none justify-end"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleClick},"Upgrade"),l.a.createElement("div",null,l.a.createElement("button",{className:"b--transparent bg-transparent",onClick:this.handleDismissClick},l.a.createElement(o.a,{size:16,name:"delete-16",title:"Dismiss This Message",fillClass:"fill-white",extraClasses:"mh1 mt1"})))))}}]),a}(c.Component),A=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={versionChanged:!1},e.handleClick=function(e){return window.location.reload()},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.timerID=setInterval((function(){window.serverVersionHash&&window.clientVersionHash!==window.serverVersionHash&&e.setState({versionChanged:!0})}),5e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"render",value:function(){return this.state.versionChanged?l.a.createElement(j,{mainText:"An Upgrade to Your Data Dashboard Is Available",secondaryText:"Click \u201cUpgrade\u201d or refresh your browser to update",onClick:this.handleClick}):null}}]),a}(c.Component),R={WATCH_ALL:"WATCH_ALL",WATCH_ALL_SCHEMAS:"WATCH_ALL_SCHEMAS",WATCH_POSTGRES_SCHEMA:"WATCH_POSTGRES_SCHEMA",UNWATCH_POSTGRES_SCHEMA:"UNWATCH_POSTGRES_SCHEMA"},P=a(15),L=a(63),U=a.n(L);var H=a(167),F=a.n(H),M=a(19),G=a.n(M),$=a(109),q=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.baseSize,n=t.extraClasses,r=t.fillClass,s=t.displaySize,i=t.service,c=(e={},Object($.a)(e,window.service.postgres,"data-postgres"),Object($.a)(e,window.service.postgresInternal,"data-postgres"),Object($.a)(e,window.service.redis,"data-redis"),Object($.a)(e,window.service.kafka,"data-kafka"),e),d=i in c?"".concat(c[i],"-").concat(a):"datastore-".concat(a);return l.a.createElement(o.a,{name:d,size:s,fillClass:r,extraClasses:n})}}]),a}(l.a.Component);q.defaultProps={baseSize:16,displaySize:16,fillClass:"purple",extraClasses:""};var B=a(170),z=a(172),K=a.n(z),W=function(e){var t=e.clip;return l.a.createElement(u.b,{to:"/dataclips/".concat(t.slug),className:"flex-1 flex h-100 no-underline ph2 items-center"},l.a.createElement("div",{className:"flex items-center"},l.a.createElement(K.a,{email:t.creator.email,className:"gravatar br-100",size:25,rating:"pg",default:"mm"}),l.a.createElement("div",{className:"ml1 gray"},t.creator.email)))},J=function(e,t){return new Date(t)-new Date(e)},Y=function(e){return e.detached||e.datasource?e.detached?"detached dataclip":e.datasource.addon_name:"shared dataclip"},V=function(e,t){var a,n;return((a=Y(e))>(n=Y(t)))-(n>a)},Q=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleSortChange=function(t){var a=Object(P.a)(t,1)[0];e.props.onSortChange(a)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.filteredRows,a=e.hideDatastore,n=e.sort,r=e.initialClipCount,s=r>100&&t.size>100,i=s?100:void 0,c=[{Header:function(e){e.data;var t=e.column;return l.a.createElement(S.HKTableHeader,{label:"Title",id:t.id,sort:n})},className:"purple",accessor:"title",minWidth:250,maxWidth:350,style:{padding:0,alignItems:"start"},Cell:function(e){return l.a.createElement(u.b,{to:"/dataclips/".concat(e.original.slug),className:"flex-1 flex h-100 no-underline ph2 items-center"},l.a.createElement("p",{className:"truncate mv0 h1"},e.value))}},!a&&{Header:function(e){e.data;var t=e.column;return l.a.createElement(S.HKTableHeader,{label:"Datastore",id:t.id,sort:n})},id:"datastore",accessor:function(e){return e},sortMethod:V,minWidth:175,maxWidth:300,style:{padding:0,alignItems:"start"},Cell:function(e){var t=!e.original.detached&&!e.original.datasource,a=e.original.detached;return l.a.createElement(u.b,{to:"/dataclips/".concat(e.original.slug),className:"flex-1 flex h-100 no-underline ph2 items-center"},l.a.createElement("div",{className:"flex items-center"},a&&l.a.createElement(o.a,{name:"error-badge-16",size:16,fillClass:"red",extraClasses:"flex-none mr1 self-center"}),!a&&!t&&l.a.createElement(q,{baseSize:16,displaySize:16,service:"heroku-postgresql",fillClass:"purple",extraClasses:"flex-none mr1 nudge-down--2"}),l.a.createElement("div",{className:G()({purple:!t&&!a,gray:t,i:t,red:a})},a&&"detached dataclip",!a&&t&&"shared dataclip",!a&&!t&&e.original.datasource.addon_name)))}},{Header:function(e){e.data;var t=e.column;return l.a.createElement(S.HKTableHeader,{label:"Author",id:t.id,sort:n})},id:"author",minWidth:200,style:{padding:0,alignItems:"start"},accessor:function(e){return e.creator.email},Cell:function(e){var t=e.original;return l.a.createElement(W,{clip:t})}},{Header:function(e){e.data;var t=e.column;return l.a.createElement(S.HKTableHeader,{label:"Created",id:t.id,sort:n})},id:"created_at",accessor:"created_at",className:"gray",minWidth:120,style:{padding:0,alignItems:"start"},sortMethod:J,Cell:function(e){return l.a.createElement(u.b,{to:"/dataclips/".concat(e.original.slug),className:"flex-1 flex h-100 no-underline ph2 items-center"},l.a.createElement(B.a,{date:e.original.created_at}))}},{Header:function(e){e.data;var t=e.column;return l.a.createElement(S.HKTableHeader,{label:"Edited",id:t.id,sort:n})},id:"edited_at",accessor:"edited_at",className:"gray",minWidth:120,style:{padding:0,alignItems:"start"},sortMethod:J,Cell:function(e){return l.a.createElement(u.b,{to:"/dataclips/".concat(e.original.slug),className:"flex-1 flex h-100 no-underline ph2 pv4 items-center"},l.a.createElement(B.a,{date:e.original.edited_at}))}}].filter((function(e){return e}));return l.a.createElement("div",{className:"overflow-x-auto relative"},l.a.createElement(S.HKTable,{data:t.toJS(),multiSort:!1,resizable:!1,showPagination:s,defaultSorted:[n],defaultPageSize:r,minRows:0,pageSize:i,showPageSizeOptions:!1,showPageJump:!1,className:"-highlight",onSortedChange:this.handleSortChange,getTrGroupProps:function(){return{style:{cursor:"pointer"}}},columns:c}))}}]),a}(l.a.Component),X=function(e){var t=e.query;return l.a.createElement("div",{className:"hk-well flex flex-column items-center justify-center flex-auto"},l.a.createElement("div",{className:"pa4 pb6 b--light-gray flex flex-column items-center"},l.a.createElement("div",{className:"flex-none flex flex-row items-center gray mb2"},l.a.createElement(o.a,{name:"dataclip-28",size:28,fillClass:"purple",extraClasses:"mr1"})),l.a.createElement("h1",{className:"f4 b"},"No dataclips found for: ",t),l.a.createElement("p",{className:"gray mb5"},"Try changing your query")))};function Z(){return l.a.createElement("section",{className:"notfound flex h-100 w-100 flex-auto items-center justify-center tc bg-lightest-silver"},l.a.createElement("div",{className:"bg-white shadow-outer-1 br2 flex flex-column items-center pv6 ph3 ma3 w-100 mw9"},l.a.createElement("div",{className:"f2 lh-title pb3 purple normal v-mid items-center"},l.a.createElement(o.a,{name:"dataclip-28",size:28,fillClass:"purple",extraClasses:"v-mid nudge-up--2 mr2"}),"Heroku Dataclips: Get Answers From Your Postgres Data"),l.a.createElement("div",{className:""},l.a.createElement("div",{className:"gray tc lh-copy pb3 w-100 mw7 center"},"Data is a company's most valuable asset. With Dataclips, you can easily discover and gain insights from the data you have on the Heroku Platform.")),l.a.createElement("div",{className:"flex-ns mt4 mw8 center"},l.a.createElement("div",{className:"w-100 w-50-l ba b--silver br2 pt3 pb5 ph5"},l.a.createElement("h4",null,"Create your first Dataclip"),l.a.createElement("p",{className:"gray lh-copy"},"It's easy to write your SQL query in the Dataclips interface and share the results with your team."),l.a.createElement(u.b,{to:"/dataclips/create",className:"hk-button-sm--primary"},"Create Dataclip")),l.a.createElement("div",{className:"w1 h1"}),l.a.createElement("div",{className:"w-100 w-50-l ba b--silver br2 pt3 pb5 ph5"},l.a.createElement("h4",{className:"flex-none"},"Learn more about Heroku Dataclips"),l.a.createElement("p",{className:"gray lh-copy flex-none"},"Learn more about the power of Dataclips in the Heroku Dev Center."),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/dataclips",className:"blue link lh-copy",target:"_blank",rel:"noopener noreferrer"},l.a.createElement(o.a,{name:"docs-16",size:16,fillClass:"blue",extraClasses:"nudge-down--3 mr1"}),"Dev Center: Heroku Dataclips")))))}var ee=a(82),te=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("section",{className:"loading bg-lightest-silver tc h-100 w-100 flex flex-auto flex-column items-center justify-center"},this.props.title&&l.a.createElement("h1",{className:"normal dark-gray"},this.props.title),l.a.createElement(ee.a,{className:"mv1"}),this.props.children)}}]),a}(l.a.Component);function ae(e){return function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return{args:a,fn:e}}}te.defaultProps={title:"Loading"};var ne,re,se=ae(function(){var e=Object(v.a)(g.a.mark((function e(t,a){var n,r,s,i,c,l,o,d=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Object(P.a)(a,2),r=n[0],s=n[1],i=d.length,c=new Array(i>2?i-2:0),l=2;l<i;l++)c[l-2]=d[l];return e.next=4,s.apply(r,c);case 4:return o=e.sent,e.abrupt("return",{result:o});case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),ie=ae((function(e,t){e.dispatch?e.dispatch(t):k.a.error("no dispatch service available for",t)})),ce=(ae(function(){var e=Object(v.a)(g.a.mark((function e(t,a){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(a.map((function(e){return e.fn.apply(e,[t].concat(Object(b.a)(e.args)))})));case 2:return n=e.sent,e.abrupt("return",n.reduce((function(e,t){return e.state.push(t.state),e.result.push(t.result),e}),{state:[],result:[]}));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),ae((function(e,t){return new Promise((function(e,a){setTimeout(e,t)}))}))),le=(ae((function(e,t){return{state:t}})),a(1284)),oe="DATACLIPS_SET",de="DATACLIPS_MERGE",ue="DATACLIPS_DELETE",me="DATACLIPS_SYNC",pe="DATACLIPS_SHARE",he="DATACLIPS_UNSHARE",fe=function(e,t){return function(e){var a;return t.payload._change&&t.payload._change.id&&(a=t.payload._change.id===e.getIn(["_change","id"])),!a&&t.payload.id&&(a=t.payload.id===e.get("id")),!a&&t.payload.slug&&(a=t.payload.slug===e.get("slug")),a}},ge=Object(le.a)((ne={},Object($.a)(ne,oe,(function(e,t){var a=e.findIndex(fe(0,t));return e.update(-1===a?e.size:a,U.a.Map(),(function(e){return U.a.fromJS(t.payload)}))})),Object($.a)(ne,de,(function(e,t){var a=e.findIndex(fe(0,t));return e.update(-1===a?e.size:a,U.a.Map(),(function(e){return e.merge(U.a.fromJS(t.payload))}))})),Object($.a)(ne,ue,(function(e,t){var a=e.findIndex(fe(0,t));return-1===a?e:e.delete(a)})),Object($.a)(ne,me,(function(e,t){var a=t.payload.map((function(e){return e.id})),n=e.map((function(e){return e.get("id")})).toArray(),r=y.a.difference(n,a),s=y.a.difference(a,n),i=y.a.intersection(n,a);if(k.a.debug("sync dataclips: +".concat(s.length," / -").concat(r.length," / <>").concat(i.length)),0===r.length&&0===s.length&&0===i.length)return e;var c=U.a.fromJS(t.payload.reduce((function(e,t){return e[t.id]=t,e}),{})),l=U.a.fromJS(t.payload.filter((function(e){return s.includes(e.id)})));return e.filter((function(e){return a.includes(e.get("id"))})).map((function(e){return e.merge(c.get(e.get("id")))})).concat(l)})),Object($.a)(ne,pe,(function(e,t){var a=t.payload,n=a.clipShare,r=a.shareType,s=e.findIndex((function(e){return e.get("id")===n.clip_id}));return e.updateIn([s,"".concat(r,"_shares")],U.a.List(),(function(e){return e.push(U.a.fromJS(n))}))})),Object($.a)(ne,he,(function(e,t){var a=t.payload,n=a.clipId,r=a.clipShareId,s=a.shareType,i=e.findIndex((function(e){return e.get("id")===n}));return e.updateIn([i,"".concat(s,"_shares")],U.a.List(),(function(e){return e.filter((function(e){return e.get("id")!==r}))}))})),ne),U.a.List()),ve=a(4),be="SET_FETCHING",Ee="SET_LAST_SYNC",ye={dataclips:U.a.fromJS({fetching:!1,lastSync:null})},ke=Object(le.a)((re={},Object($.a)(re,be,(function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},Object($.a)({},t.payload.ui,e[t.payload.ui].set("fetching",t.payload.fetching)))})),Object($.a)(re,Ee,(function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},Object($.a)({},t.payload.ui,e[t.payload.ui].set("lastSync",t.payload.lastSync)))})),re),ye),we=a(17),Ce=a.n(we),Oe=a(732),Ne=a(52),Ie=a.n(Ne);function _e(e){var t=e.match(/(\d+)(ms|s|m|h|d)/);if(!t)throw new Error("Invalid interval: ".concat(e));return Ie.a.duration(parseInt(t[1],10),t[2]).asMilliseconds()}var xe=a(7);function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Errors in GraphQL response",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.name="GraphQLError",this.message=e,this.stack=(new Error).stack,this.query=t,this.errors=a}var De=function(){function e(){Object(n.a)(this,e)}return Object(r.a)(e,[{key:"handleError",value:function(e,t,a){e.response?(401!==e.response.status&&window.Rollbar.error(e.response,{query:t,variables:a}),401===e.response.status&&xe.a.getSessionItem("hk-preauth-data")&&xe.a.removeSessionItem("hk-preauth-data")):window.Rollbar.error(e)}},{key:"parseGraphQLResponse",value:function(e,t){var a=e.data,n=a.data,r=a.errors;if(r){k.a.error("GraphQL response included errors:",t,r);if(r.some((function(e){return"Request failed with status code 401"===e.message||/^Error during.*: 401$/.test(e.message)})))if(window.paused)k.a.debug("paused: ignoring GraphQL 401");else{k.a.debug("GraphQL 401 triggered!");var s=xe.a.getSessionItem("hk-sudo-data");if(xe.a.clear(),s)xe.a.clearSession();else{var i="".concat(window.location.pathname).concat(window.location.search).concat(window.location.hash);xe.a.setSessionItem("hk-return-to",i)}window.location.assign("/")}return Promise.reject(new Te("GraphQL query partially successful, with errors",t,r))}return n}},{key:"_get",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ce.a.get("/graphql",{params:{query:e,variables:t},headers:{"X-Background-Request":n,"X-Heroku-Data-Tab":sessionStorage.getItem("herokudataTabId")}}).then((function(t){return a.parseGraphQLResponse(t,e)})).catch((function(n){throw a.handleError(n,e,t),n}))}},{key:"_post",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ce.a.post("/graphql",{query:e,variables:t},{headers:{"X-Background-Request":n,"X-Heroku-Data-Tab":sessionStorage.getItem("herokudataTabId")}}).then((function(t){return a.parseGraphQLResponse(t,e)})).catch((function(n){throw a.handleError(n,e,t),n}))}},{key:"userQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._get(Oe.fetchUser,{},e).then((function(e){return e.user}))}},{key:"fetchDatastoreDetails",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=window.service;switch(t){case n.kafka:return this.fetchKafkaDetails(e,a);case n.redis:return this.fetchRedisDetails(e,a);case n.postgres:case n.postgresInternal:return this.fetchPostgresqlDetails(e,a);default:throw new Error("Unknown service: ".concat(t))}}},{key:"fetchKafkaDetails",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.fetchKafkaDetails,{addonUUID:e},t).then((function(e){return e.kafka}))}},{key:"fetchRedisDetails",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.fetchRedisDetails,{addonUUID:e},t).then((function(e){return e.redis}))}},{key:"fetchPostgresqlDetails",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.fetchPostgresqlDetails,{addonUUID:e},t).then((function(e){return e.postgres}))}},{key:"fetchPostgresqlCredentialStates",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.fetchPostgresqlCredentialStates,{addonUUID:e},t).then((function(e){return e.postgres}))}},{key:"createKafkaTopic",value:function(e,t){var a={addonUUID:e,topic:t.name,rf:t.replicationFactor,partitions:t.partitions,compaction:t.compactionEnabled,retentionTime:t.retentionTime};return this._post(Oe.createKafkaTopic,a)}},{key:"updateKafkaTopic",value:function(e,t){var a={addonUUID:e,topic:t.name,rf:t.replicationFactor,compaction:t.compactionEnabled,retentionTime:t.retentionTime};return this._post(Oe.updateKafkaTopic,a)}},{key:"deleteKafkaTopic",value:function(e,t){return this._post(Oe.deleteKafkaTopic,{addonUUID:e,topic:t})}},{key:"createPostgresBackup",value:function(e){return this._post(Oe.createPostgresBackup,{addonUUID:e})}},{key:"deletePostgresBackup",value:function(e,t){return this._post(Oe.deletePostgresBackup,{addonUUID:e,backupId:t})}},{key:"generatePostgresBackupUrl",value:function(e,t){return this._post(Oe.generatePostgresBackupUrl,{addonUUID:e,backupId:t})}},{key:"addPostgresFollower",value:function(e,t,a){return this._post(Oe.addPostgresFollower,{addonUUID:e,plan:t,region:a})}},{key:"unfollowPostgres",value:function(e){return this._post(Oe.unfollowPostgres,{addonUUID:e})}},{key:"removePostgres",value:function(e){return this._post(Oe.removePostgres,{addonUUID:e})}},{key:"resetPostgres",value:function(e){return this._post(Oe.resetPostgres,{addonUUID:e})}},{key:"rollbackPostgres",value:function(e,t,a,n){return this._post(Oe.rollbackPostgres,{addonUUID:e,plan:t,to:a,region:n}).then((function(e){return e.rollbackPostgres}))}},{key:"forkPostgres",value:function(e,t,a){return this._post(Oe.forkPostgres,{addonUUID:e,plan:t,region:a})}},{key:"configurePostgres",value:function(e,t){return this._post(Oe.configurePostgres,{addonUUID:e,settings:t}).then((function(e){return e.configurePostgres}))}},{key:"fetchPrivatelink",value:function(e){return this._get(Oe.fetchPrivatelink,{addonUUID:e}).then((function(e){return e.privatelink}))}},{key:"createPrivatelink",value:function(e,t){return this._post(Oe.createPrivatelink,{addonUUID:e,allowedAccounts:t}).then((function(e){return e.createPrivatelink}))}},{key:"destroyPrivatelink",value:function(e){return this._post(Oe.destroyPrivatelink,{addonUUID:e}).then((function(e){return e.destroyPrivatelink}))}},{key:"addPrivatelinkAllowed",value:function(e,t){return this._post(Oe.addPrivatelinkAllowed,{addonUUID:e,allowedAccounts:t}).then((function(e){return e.addPrivatelinkAllowed}))}},{key:"removePrivatelinkAllowed",value:function(e,t){return this._post(Oe.removePrivatelinkAllowed,{addonUUID:e,allowedAccounts:t}).then((function(e){return e.removePrivatelinkAllowed}))}},{key:"fetchDatastoreMetrics",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.addonUUID,n=e.service,r=e.start,s=e.end,i=e.resolution,c=e.filter;return this._get(Oe.fetchDatastoreMetrics,{addonUUID:a,service:n,start:r,end:s,resolution:i,filter:c},t).then((function(e){var t=Date.parse(r),a=_e(i);return e.metaas.map((function(e){return{name:e.name,measurements:e.measurements.map((function(e,n){return{time:new Date(t+(n+1)*a).toISOString(),value:e}}))}}))}))}},{key:"createDataclip",value:function(e,t,a,n){return this._post(Oe.createDataclip,{attachmentId:e,title:t,sql:a,teamId:n}).then((function(e){return e.createClip}))}},{key:"deleteDataclip",value:function(e){return this._post(Oe.deleteDataclip,{clipId:e}).then((function(e){return e.deleteClip}))}},{key:"updateDataclip",value:function(e,t,a,n){return this._post(Oe.updateDataclip,{clipId:e,attachmentId:t,title:a,sql:n}).then((function(e){return e.updateClip}))}},{key:"fetchDataclipDetails",value:function(e,t){return this._get(Oe.fetchClipDetails,{slug:e},t).then((function(e){return e.clip}))}},{key:"listClips",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._get(Oe.listClips,{},e).then((function(e){return e.listClips}))}},{key:"shareDataclipWithUser",value:function(e,t){return this._post(Oe.shareDataclipWithUser,{clipId:e,email:t}).then((function(e){return e.shareClipWithUser}))}},{key:"shareDataclipWithTeam",value:function(e,t){return this._post(Oe.shareDataclipWithTeam,{clipId:e,teamId:t}).then((function(e){return e.shareClipWithTeam}))}},{key:"unshareDataclipWithUser",value:function(e,t){return this._post(Oe.unshareDataclipWithUser,{clipId:e,clipShareId:t}).then((function(e){return e.unshareClipWithUser}))}},{key:"unshareDataclipWithTeam",value:function(e,t){return this._post(Oe.unshareDataclipWithTeam,{clipId:e,clipShareId:t}).then((function(e){return e.unshareClipWithTeam}))}},{key:"sharePublicDataclip",value:function(e){return this._post(Oe.sharePublicDataclip,{slug:e}).then((function(e){return e.togglePublicClipShare}))}},{key:"unsharePublicDataclip",value:function(e){return this._post(Oe.unsharePublicDataclip,{slug:e}).then((function(e){return e.togglePublicClipShare}))}},{key:"createCredential",value:function(e,t){return this._post(Oe.createCredential,{addonUUID:e,name:t}).then((function(e){return e.createCredential}))}},{key:"rotateCredential",value:function(e,t,a){return this._post(Oe.rotateCredential,{addonUUID:e,name:t,forced:a}).then((function(e){return e.rotateCredential}))}},{key:"destroyCredential",value:function(e,t){return this._post(Oe.destroyCredential,{addonUUID:e,name:t}).then((function(e){return e.destroyCredential}))}},{key:"rotateAllCredentials",value:function(e,t){return this._post(Oe.rotateAllCredentials,{addonUUID:e,forced:t}).then((function(e){return e.rotateAllCredentials}))}},{key:"attachCredential",value:function(e,t,a,n){return this._post(Oe.attachCredential,{addonUUID:e,credential:t,appID:a,attachment:n}).then((function(e){return e.attachCredential}))}},{key:"detachCredential",value:function(e){return this._post(Oe.detachCredential,{attachmentID:e}).then((function(e){return e.detachCredential}))}},{key:"listApps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._get(Oe.listApps,{},e).then((function(e){return e.listApps}))}},{key:"listTeams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._get(Oe.listTeams,{},e).then((function(e){return e.listTeams}))}},{key:"fetchPostgresSchema",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.fetchPostgresSchema,{addonUUID:e},t).then((function(e){return e.postgresSchema}))}},{key:"refreshPostgresSchema",value:function(e){return this._post(Oe.refreshPostgresSchema,{addonUUID:e}).then((function(e){return e.refreshSchema}))}},{key:"diagnosePostgres",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(Oe.diagnosePostgres,{addonUUID:e},t).then((function(e){return e.postgresDiagnose}))}},{key:"terminatePostgresConnection",value:function(e,t){return this._post(Oe.terminatePostgresConnection,{addonUUID:e,pid:t}).then((function(e){return e.postgresTerminate}))}},{key:"setPostgresPermissions",value:function(e,t,a){return this._post(Oe.setPostgresPermissions,{addonUUID:e,role:t,acls:a}).then((function(e){return e.setPostgresPermissions}))}},{key:"getMTLS",value:function(e){return this._get(Oe.getMTLS,{addonUUID:e}).then((function(e){return e.mtls}))}},{key:"enableMTLS",value:function(e){return this._post(Oe.enableMTLS,{addonUUID:e}).then((function(e){return e.enableMTLS}))}},{key:"deleteMTLS",value:function(e){return this._post(Oe.deleteMTLS,{addonUUID:e}).then((function(e){return e.deleteMTLS}))}},{key:"createMTLSIPRule",value:function(e){var t=e.addonUUID,a=e.cidr,n=e.description;return this._post(Oe.createMTLSIPRule,{addonUUID:t,cidr:a,description:n}).then((function(e){return e.createMTLSIpRule}))}},{key:"deleteMTLSIPRule",value:function(e){var t=e.addonUUID,a=e.id;return this._post(Oe.deleteMTLSIPRule,{addonUUID:t,id:a}).then((function(e){return e.deleteMTLSIpRule}))}},{key:"createMTLSCertificate",value:function(e){return this._post(Oe.createMTLSCertificate,{addonUUID:e}).then((function(e){return e.createMTLSCert}))}},{key:"deleteMTLSCertificate",value:function(e){var t=e.addonUUID,a=e.id;return this._post(Oe.deleteMTLSCertificate,{addonUUID:t,id:a}).then((function(e){return e.deleteMTLSCert}))}}]),e}(),Se=g.a.mark(Ae),je=new De;function Ae(){var e,t,a,n,r,s,i=arguments;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:{},t=e.background,a=void 0!==t&&t,c.next=3,se([je,je.listClips],a);case 3:return n=c.sent,r={type:me,payload:n},c.next=7,ie(r);case 7:return s={type:Ee,payload:{ui:"dataclips",lastSync:Date.now()}},c.next=10,ie(s);case 10:case"end":return c.stop()}}),Se)}var Re=function(e){return{dataclips:e.dataclips,lastSync:e.asyncUi.dataclips.get("lastSync")}};function Pe(e){return Object(d.b)(Re)(function(e){var t,a=function(t){return l.a.createElement(N,{generator:Ae,autorun:!0,expireAfter:12e4},(function(a){var n=a.status===w.PENDING;return l.a.createElement(e,Object.assign({},t,{fetching:n}))}))};return a.displayName="withDataclips(".concat((t=e).displayName||t.name||"Component",")"),a}(e))}var Le=a(60),Ue=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={sort:{desc:!1,id:"edited_at"}},e.initializeSort=function(t){var a=F.a.parse(t.replace(":","=")),n=Object.keys(a),r=Object(P.a)(n,1)[0],s=Object.values(a),i=Object(P.a)(s,1)[0];e.handleSortChange({id:r,desc:"desc"===i})},e.handleSortChange=function(t){e.setState({sort:t},e.updateQueryParams)},e.updateQueryParams=function(){var t=e.state.sort,a=e.props.history,n=e.props.location.search,r=F.a.parse(n);r.sort="".concat(t.id,":").concat(t.desc?"desc":"asc");var s=F.a.stringify(r);a.replace({search:s})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.location,t=F.a.parse(e.search);t.sort&&this.initializeSort(t.sort),Le.a.page("Dataclips List")}},{key:"render",value:function(){var e,t,a,n=this.props,r=n.dataclips,s=n.location,i=n.fetching,o=n.lastSync,d=n.history,u=F.a.parse(s.search).query,m=(t=r,a=["title","team_name",["creator","email"],["datasource","addon_name"]],(e=u)?(e=String(e).toLowerCase(),t.filter((function(t){return a.map((function(e){return t.getIn(Object(E.flattenDeep)([e]))})).filter((function(e){return void 0!==e})).map((function(e){return String(e).toLowerCase()})).some((function(t){return t.includes(e)}))}))):t),p=this.state.sort;return o?0===r.size?l.a.createElement(Z,null):0===m.size?l.a.createElement(X,{query:u}):l.a.createElement(c.Fragment,null,i&&l.a.createElement("div",{className:"fixed bottom-2 right-2"},l.a.createElement(ee.a,{className:"bg-transparent"})),l.a.createElement(Q,{history:d,sort:p,onSortChange:this.handleSortChange,initialClipCount:r.size,filteredRows:m})):l.a.createElement(te,{title:""},l.a.createElement("p",null,"Loading..."))}}]),a}(c.Component),He=Pe(Object(m.g)(Ue));function Fe(e){return U.a.Map.isMap(e)?{datastoreId:e.get("id","unknown"),datastoreType:e.getIn(["meta","service"],"unknown"),datastoreName:e.getIn(["meta","name"],"unknown"),datastoreBillingAppName:e.getIn(["meta","app_name"],"unknown"),datastoreBillingAppUUID:e.getIn(["meta","app_uuid"],"unknown"),datastorePlan:e.getIn(["meta","plan"],"unknown")}:{}}var Me=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"fullbleed__content w-100 pa0 flex flex-column flex-auto overflow-y-auto bg-lightest-silver"},this.props.children)}}]),a}(l.a.Component),Ge=a(656),$e=a(652),qe=a(44),Be=a(162),ze=a.n(Be),Ke=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.className,n=e.title,r=e.blurb;return l.a.createElement("section",{className:G()("".concat(a," bg-white bt bb b--light-silver mb3"),{pv3:!r,pb3:!!r})},r,l.a.createElement("div",{className:"ph3"},l.a.createElement("h3",{className:"f5 mv3 b dark-gray tracked ttu"},n),t))}}]),a}(l.a.Component),We=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.blurb,n=t.children,r=t.status;return e=y.a.isArray(n)?!y.a.chain(n).filter((function(e){return!y.a.isNil(e)})).isEmpty().value():!y.a.isNil(n),l.a.createElement(Ke,{title:"Health",className:"datastoreHealth",blurb:a},r,e&&l.a.createElement("div",{className:"mt2 bt b--silver"},n))}}]),a}(l.a.Component),Je={GREEN:"GREEN",YELLOW:"YELLOW",RED:"RED"},Ye=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).statusMap={GREEN:"success-badge-",YELLOW:"warning-badge-",RED:"error-badge-"},e.fillMap={GREEN:"green",YELLOW:"orange",RED:"red"},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.baseSize,a=e.className,n=e.displaySize,r=e.status,s=this.statusMap[r]+t;return l.a.createElement(o.a,{name:s,size:n,fillClass:this.fillMap[r],extraClasses:a})}}]),a}(l.a.Component);Ye.defaultProps={baseSize:16,className:"",displaySize:28,status:Je.GREEN};var Ve=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.message,a=e.waiting,n=e.healthy,r=this.props.status||(n?Je.GREEN:Je.RED),s=l.a.createElement(Ye,{baseSize:16,displaySize:20,status:r,className:"v-top"});return l.a.createElement("h3",{className:"f2 black normal mv4"},s," ",t," ",a&&l.a.createElement(ee.a,null))}}]),a}(l.a.Component);function Qe(e){var t=e.customer_encryption_key,a=e.datastore_type;return l.a.createElement("div",{className:"dib mr4"},l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/encrypting-heroku-".concat(a,"-with-your-key"),className:"link","aria-label":"More info on Dev Center",title:t,rel:"noopener noreferrer"},l.a.createElement(o.a,{name:"lock-locked-28",size:24,extraClasses:"pr2 v-tbtm"}),l.a.createElement("span",{className:"dark-gray"},"Encrypted with KMS")))}var Xe=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props.datastore,a=t.getIn(["details","state"]).toJS(),n=t.getIn(["details","limits"]).toJS(),r=t.getIn(["details","customer_encryption_key"]);a.message=y.a.capitalize(a.message);var s,i=a.degraded_brokers.length,c=a.degraded_topics.length;(!a.healthy||i||c)&&(e=l.a.createElement("p",null,"There ",Object(qe.pluralize)(i,"is","are")," ",i," ","recovering ",Object(qe.pluralize)(i,"broker")," and"," ",Object(qe.intComma)(c)," recovering"," ",Object(qe.pluralize)(c,"topic"),"."));var o=t.getIn(["details","topics"]).reduce((function(e,t){return e+t.get("partitions")*t.get("replication_factor")}),0);if(o>.8*n.max_partition_replica_count){var d=o/n.max_partition_replica_count;s=l.a.createElement("p",null,"You have used ",l.a.createElement("strong",null,ze()(d).format("0.0%"))," of the maximum number of partitions"," ",l.a.createElement("strong",null,"(",Object(qe.intComma)(o)," of"," ",Object(qe.intComma)(n.max_partition_replica_count),")"),"."),"GREEN"===a.status&&(a.status="YELLOW")}var u=l.a.createElement(Ve,{healthy:a.healthy,message:a.message,status:a.status,waiting:a.waiting});return l.a.createElement(We,{status:u},r&&l.a.createElement("div",{className:"pt3"},l.a.createElement(Qe,{customer_encryption_key:r,datastore_type:"kafka"})),e,s)}}]),a}(l.a.Component),Ze=(a(733),{PENDING:"PENDING",FULFILLED:"FULFILLED",REJECTED:"REJECTED"}),et=a(131),tt=(a(734),a(735),a(1281)),at=a(1285),nt=a(648),rt=a(649),st=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"shouldComponentUpdate",value:function(e,t){var a=this;return["data","width"].some((function(t){return a.props[t]!==e[t]}))}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.line,n=e.area;if(null===t)return null;var r=t.toJS(),s=a(r),i=n(r);return l.a.createElement("g",{className:"timeseriesLine"},l.a.createElement("path",{d:s,className:"topline"}),l.a.createElement("path",{d:i,className:"body"}))}}]),a}(l.a.Component);st.defaultProps={data:null};var it=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.cx,a=e.cy,n=e.direction,r=e.height,s=e.width,i=[];switch(n){case"up":i=[[t,a],[t+s/2,a+r],[t-s/2,a+r]];break;case"down":i=[[t,a],[t-s/2,a-r],[t+s/2,a-r]]}return l.a.createElement("polygon",{points:function(e){return e.map((function(e){return"".concat(e[0],",").concat(e[1])})).join(" ")}(i)})}}]),a}(l.a.Component);it.defaultProps={direction:"down",height:5,width:8};var ct=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e,r){var s;return Object(n.a)(this,a),(s=t.call(this,e,r)).handleMouseMove=function(e){var t=e.clientX-s.node.getBoundingClientRect().left-s.props.paddingX;if(t<0||t>=s.state.contentWidth)s.props.onHover(-1);else{var a=s.state.scaleX.invert(t),n=(0,tt.a((function(e){return e.time})).left)(s.state.measurements.toJS(),a);s.props.onHover(n)}},s.handleMouseLeave=function(e){s.props.onHover(-1)},s.state={scaleX:nt.b(),scaleY:nt.a(),contentWidth:e.width-2*e.paddingX,contentHeight:e.height-2*e.paddingY,line:rt.c().x((function(e){return s.state.scaleX(e.time)})).y((function(e){return s.state.scaleY(e.value)})).curve(rt.b),area:rt.a().x((function(e){return s.state.scaleX(e.time)})).y1((function(e){return s.state.scaleY(e.value)})).curve(rt.b),measurements:null},s}return Object(r.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.getMeasurements(this.props.data);this.setState(this.prepare(this.props,e))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this,a=this.props.data!==e.data,n=["width","height","paddingX","paddingY","maxValue","minValue"].some((function(a){return t.props[a]!==e[a]}));if(a||n){var r=this.state.measurements;a&&(r=this.getMeasurements(e.data)),this.setState(this.prepare(e,r))}}},{key:"shouldComponentUpdate",value:function(e,t){var a=this;return Object.keys(this.props).some((function(t){return a.props[t]!==e[t]}))}},{key:"prepare",value:function(e,t){if(null===t)return{};var a=e.width-2*e.paddingX,n=e.height-2*e.paddingY,r=t.indexOf(t.maxBy((function(e){return e.get("value")}))),s=t.indexOf(t.minBy((function(e){return e.get("value")}))),i=[t.first().get("time"),t.last().get("time")],c=this.state.scaleX.copy().range([0,a]).domain(i),l=t.toJS().map((function(e){return e.value})),o=at.a(l);void 0!==e.minValue&&(o[0]=e.minValue),void 0!==e.maxValue&&(o[1]=e.maxValue);var d=this.state.scaleY.copy().range([n,0]).domain(o),u=this.state.area.y0(d(o[0]));return{measurements:t,indexOfMax:r,indexOfMin:s,contentWidth:a,contentHeight:n,scaleX:c,scaleY:d,area:u}}},{key:"getMeasurements",value:function(e){return e?e.get("measurements").map((function(e){var t=e.get("value");return U.a.Map({time:Ie.a.utc(e.get("time")).toDate(),value:y.a.isFinite(t)?t:0})})):null}},{key:"render",value:function(){var e=this,t=this.props,a=t.height,n=t.hoverIndex,r=t.paddingX,s=t.paddingY,i=t.prettifier,c=t.width;if(!y.a.get(this.state,"measurements"))return l.a.createElement(ee.a,null);var o,d,u,m=this.state,p=m.measurements,h=m.line,f=m.area,g=m.scaleX,v=m.scaleY,b=m.indexOfMax,E=m.indexOfMin,k=m.contentWidth,w=p.last().toJS(),C=p.get(b).toJS(),O=p.get(E).toJS(),N=function(e){return g(e.time)},I=function(e){return v(e.value)};if(-1===n){u=l.a.createElement("g",null,l.a.createElement("circle",{className:"indicator__knockout",cx:N(w),cy:I(w),r:4}),l.a.createElement("circle",{className:"indicator",cx:N(w),cy:I(w),r:3}));var _=N(C),x=_>c/2,T=x?"end":"start",D=x?"-3px":"3px";o=l.a.createElement("g",{className:"upper",transform:"translate(".concat(r,", 0)")},l.a.createElement("text",{textAnchor:T,dx:D,x:_,y:s-10},l.a.createElement("tspan",null,i(C.value)[0]),l.a.createElement("tspan",{className:"deemphasized",dx:2},i(C.value)[1])),l.a.createElement("text",{textAnchor:T,dx:D,x:_,y:s-22},l.a.createElement("tspan",{className:"deemphasized small"},"MAX")),l.a.createElement(it,{cx:N(C),cy:s-2,direction:"down"}),l.a.createElement("line",{className:"minMaxLine",x1:N(C),y1:s-2,x2:N(C),y2:s-32}));var S=N(O),j=S>c/2,A=j?"end":"start",R=j?"-3px":"3px";d=l.a.createElement("g",{className:"lower",transform:"translate(".concat(r,", ").concat(s+this.state.contentHeight,")")},l.a.createElement("line",{className:"minMaxLine",x1:N(O),y1:2,x2:N(O),y2:32}),l.a.createElement(it,{cx:N(O),cy:2,height:4,direction:"up"}),l.a.createElement("text",{textAnchor:A,dx:R,x:S,y:8,dy:10},l.a.createElement("tspan",null,i(O.value)[0]),l.a.createElement("tspan",{className:"deemphasized",dx:2},i(O.value)[1])),l.a.createElement("text",{textAnchor:A,dx:R,x:S,y:20,dy:10},l.a.createElement("tspan",{className:"deemphasized small"},"MIN")))}else{var P=p.get(n).toJS(),L=Ie.a.utc(P.time),U=N(P),H=I(P);u=l.a.createElement("g",null,l.a.createElement("line",{className:"indicatorLine",x1:U,y1:H,x2:U,y2:this.state.contentHeight}),l.a.createElement("circle",{className:"indicator__knockout",cx:U,cy:H,r:4}),l.a.createElement("circle",{className:"indicator",cx:U,cy:H,r:3}));var F=U>k/2?"end":"start";o=l.a.createElement("g",{className:"upper",transform:"translate(".concat(r,", 0)")},l.a.createElement("text",{textAnchor:F,x:U,y:s-10},l.a.createElement("tspan",{className:"strong"},i(P.value)[0]),l.a.createElement("tspan",{className:"deemphasized",dx:2},i(P.value)[1]))),d=l.a.createElement("g",{className:"lower",transform:"translate(".concat(r,", ").concat(s+this.state.contentHeight,")")},l.a.createElement("text",{textAnchor:F,x:U,y:8,dy:10},l.a.createElement("tspan",null,L.format("HH:mm")),l.a.createElement("tspan",{className:"deemphasized",dx:2},"UTC")),l.a.createElement("text",{textAnchor:F,x:U,y:20,dy:10},l.a.createElement("tspan",{className:"deemphasized small"},L.format("ddd MMM Do"))))}return l.a.createElement("svg",{width:c,height:a,viewBox:"0 0 ".concat(c," ").concat(a),className:"timeseriesChart",onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,ref:function(t){return e.node=t}},o,l.a.createElement("g",{transform:"translate(".concat(r,",").concat(s,")")},l.a.createElement(st,{data:p,line:h,area:f,width:c}),u),d)}}]),a}(l.a.Component);ct.defaultProps={height:30,hoverIndex:-1,paddingX:5,paddingY:40,prettifier:function(e){return e},width:200};var lt=a(169),ot=a.n(lt),dt=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a=this,n=this.props,r=n.caption,s=n.className,i=n.currentValue,c=n.data,o=n.hoverIndex,d=n.style,u=n.captionClass,m="f1 fw4 ma0 nowrap black normal";if(c){e=l.a.createElement(ot.a,null,(function(e){var t=e.width;e.height;return l.a.createElement(ct,Object.assign({},a.props,{height:100,width:t}))}));var p=-1===o&&i?i:c.getIn(["measurements",o]).get("value"),h=this.props.prettifier(p),f=Object(P.a)(h,2),g=f[0],v=f[1];t=l.a.createElement("h3",{className:m},g,l.a.createElement("small",{className:"pl1 gray f3 fw3"},v))}else if(e=l.a.createElement("div",{className:"unknown flex justify-center items-center"},l.a.createElement(ee.a,null)),i){var b=this.props.prettifier(i),E=Object(P.a)(b,2),y=E[0],k=E[1];t=l.a.createElement("h3",{className:m},y,l.a.createElement("small",{className:"pl1 gray f3 fw3"},k))}else t=l.a.createElement("h3",{className:m+" silver"},"-");return l.a.createElement("div",{className:"sparklineMetric flex flex-column ".concat(s),style:d},l.a.createElement("div",{className:"metadata bb b--silver flex flex-column pb2 ".concat(u)},l.a.createElement("div",{className:"ttu normal f6 tracked dark-gray nowrap mv3"},r),l.a.createElement("div",null,t)),l.a.createElement("div",{className:"chart flex flex-auto w-100 justify-center items-center"},e))}}]),a}(l.a.Component);dt.defaultProps={className:"",prettifier:function(e){return["".concat(e),""]},hoverIndex:-1,onHover:function(){},style:{}};var ut=[{value:"Past2hrs",label:"Past 2hrs",resolution:"10m",hours:2},{value:"Past24hrs",label:"Past 24hrs",resolution:"10m",hours:24},{value:"Past72hrs",label:"Past 72hrs",resolution:"1h",hours:72},{value:"Past7days",label:"Past 7 days",resolution:"2h",hours:168}],mt=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={selectedOption:ut[0]},e.handleChange=function(t){var a=ut.find((function(e){return e.value===t.target.value}));e.setState({selectedOption:a}),e.props.onUpdateTimeframe(a)},e}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("select",{value:this.state.selectedOption.value,onChange:this.handleChange,className:"hk-select"},ut.map((function(e){return l.a.createElement("option",{key:e.value,value:e.value},e.label)}))))}}]),a}(l.a.Component),pt=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={hoverIndex:-1},e.handleHover=function(t){e.setState({hoverIndex:t})},e.messagesPrettifier=function(e){return Object(et.c)(e,0,1,1)},e.bytesPrettifier=function(e){return Object(et.a)(e,1)},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a,n,r,s,i,c,o,d=this.props.datastore;return d.getIn(["metrics","_change","state"])===Ze.FULFILLED&&(e=d.getIn(["details","messages_in_per_sec"]),t=d.getIn(["details","bytes_in_per_sec"]),a=d.getIn(["details","bytes_out_per_sec"]),n=d.getIn(["details","data_size"]),r=(c=d.getIn(["metrics","data"],new U.a.List)).find((function(e){return"__cluster_log_size"===e.get("name")})),s=c.find((function(e){return"__cluster_messages"===e.get("name")})),i=c.find((function(e){return"__cluster_bytes_in"===e.get("name")})),o=c.find((function(e){return"__cluster_bytes_out"===e.get("name")}))),l.a.createElement(Ke,{title:"I/O",className:"kafkaIO"},l.a.createElement(mt,{onUpdateTimeframe:this.props.onUpdateTimeframe}),l.a.createElement("div",{className:"flex flex-column flex-row-l w-100 pa0 justify-between"},l.a.createElement(dt,{key:"dataSize",caption:"Data Size",currentValue:n,prettifier:function(e){return Object(et.a)(e,2)},onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:r}),l.a.createElement(dt,{key:"messages",caption:"messages/sec",currentValue:e,prettifier:this.messagesPrettifier,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:s}),l.a.createElement(dt,{key:"bytesIn",caption:"in/second \u2b07",currentValue:t,prettifier:this.bytesPrettifier,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:i}),l.a.createElement(dt,{key:"bytesOut",caption:"out/second \u2b06",currentValue:a,prettifier:this.bytesPrettifier,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:o})))}}]),a}(l.a.Component),ht=a(580),ft=a.n(ht),gt=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleClick=function(t){e.props.onClick&&e.props.onClick()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.actionText,a=e.actionCollapseText,n=e.dangerous,r=e.description,s=e.expanded,i=e.title,c=!s&&n?"danger":"secondary",o=a||"Cancel";return l.a.createElement("div",{className:"flex items-center-l"},l.a.createElement("header",{className:"flex-auto"},l.a.createElement("h4",{className:"normal purple f3 mt0 mb0"},i),l.a.createElement("p",{className:"lh-copy dark-gray"},r)),l.a.createElement("div",{className:"flex-none pr1"},l.a.createElement(S.HKButton,{onClick:this.handleClick,type:c},s?o:t)))}}]),a}(l.a.Component);function vt(e){var t=e.children,a=e.dangerous,n=e.title,r=e.valid,s=e.hideActionButton,i=e.onCollapse,o=e.onConfirm,d=Object(c.useState)(!1),u=Object(P.a)(d,2),m=u[0],p=u[1];return l.a.createElement("div",{className:"adminAction flex flex-column pv4 ph0 ma0 bb b--light-silver"},l.a.createElement(ft.a,{isOpened:!0,springConfig:{stiffness:900,damping:50}},l.a.createElement(gt,Object.assign({},e,{onClick:function(){i&&m&&i(),p(!m)},expanded:m})),m&&t,m&&!s&&l.a.createElement("footer",{className:"mt3"},l.a.createElement(S.HKButton,{type:a?"danger":"primary",disabled:!r,onClick:function(e){o&&o(e)}},n))))}gt.defaultProps={dangerous:!1},vt.defaultProps={valid:!1};var bt,Et=function(e){return function(t){var a,n=function(a){return l.a.createElement(N,e,(function(e){return l.a.createElement(t,Object.assign({},a,{operation:e}))}))};return n.displayName="Operation(".concat((a=t).displayName||a.name||"Component",")"),n}},yt={FETCH_DATASTORES:"FETCH_DATASTORES",FETCH_DATASTORE_DETAILS:"FETCH_DATASTORE_DETAILS",FETCH_DATASTORE_METRICS:"FETCH_DATASTORE_METRICS",ADD_DATASTORES:"ADD_DATASTORE",SYNC_DATASTORES:"SYNC_DATASTORES",REMOVE_DATASTORES:"REMOVE_DATASTORE",CLEAR_DATASTORES:"CLEAR_DATASTORES",SOFT_UPDATE_DATASTORE:"SOFT_UPDATE_DATASTORE",HARD_UPDATE_DATASTORE:"HARD_UPDATE_DATASTORE",SET_DATASTORE_DETAILS:"SET_DATASTORE_DETAILS",SET_DATASTORE_METRICS:"SET_DATASTORE_METRICS",DELETE_POSTGRES_BACKUP:"DELETE_POSTGRES_BACKUP",SET_DATASTORE_SETTINGS:"SET_DATASTORE_SETTINGS",SET_DATASTORE_CHANGE:"SET_DATASTORE_CHANGE",DELETE_DATASTORE_CHANGE:"DELETE_DATASTORE_CHANGE",ADD_DATASTORE_ATTACHMENT:"ADD_DATASTORE_ATTACHMENT",DELETE_DATASTORE_ATTACHMENT:"DELETE_DATASTORE_ATTACHMENT"};function kt(e,t){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,n=arguments.length>1?arguments[1]:void 0;L.Map.isMap(a)||L.List.isList(a)||(a=U.a.fromJS(a));var r=t[n.type];if(!r)return a;if(a=r(a,n),!L.Map.isMap(a)&&!L.List.isList(a))throw new TypeError("Reducers must return Immutable objects.");return a}}var wt=U.a.Map(),Ct="DATASTORES_SET",Ot="DATASTORES_MERGE",Nt="DATASTORES_MERGE_METRICS",It="DATASTORES_MTLS_IP_RULES_DELETE",_t="DATASTORES_MTLS_CERTIFICATE_DELETE",xt=kt(wt,(bt={},Object($.a)(bt,It,(function(e,t){var a=t.payload,n=e.getIn([a.addonUUID,"mtls","ipRules"],[]),r=n.findIndex((function(e){return e.get("id")===a.id})),s=n.delete(r);return e.setIn([a.addonUUID,"mtls","ipRules"],s)})),Object($.a)(bt,_t,(function(e,t){var a=t.payload,n=e.getIn([a.addonUUID,"mtls","certificates"],[]),r=n.findIndex((function(e){return e.get("id")===a.id})),s=n.delete(r);return e.setIn([a.addonUUID,"mtls","certificates"],s)})),Object($.a)(bt,Ct,(function(e,t){return e.mergeIn([t.payload.id],U.a.fromJS(t.payload))})),Object($.a)(bt,Ot,(function(e,t){return e.mergeDeep(Object($.a)({},t.payload.id,t.payload))})),Object($.a)(bt,Nt,(function(e,t){return e.mergeIn([t.payload.id,"metrics"],U.a.fromJS(t.payload.metrics))})),Object($.a)(bt,yt.ADD_DATASTORE,(function(e,t){return e.merge(Object($.a)({},t.payload.id,t.payload))})),Object($.a)(bt,yt.SYNC_DATASTORES,(function(e,t){var a=t.payload.map((function(e){return e.id})),n=e.keySeq().toArray(),r=y.a.difference(n,a),s=y.a.difference(a,n),i=y.a.intersection(a,n);if(k.a.debug("sync datastores: +".concat(s.length," / ~").concat(i.length," / -").concat(r.length)),0===r.length&&0===a.length)return e;var c=y.a.fromPairs(t.payload.filter((function(e){return a.includes(e.id)})).map((function(e){return[e.id,{id:e.id,meta:e}]})));return e.withMutations((function(e){r.forEach((function(t){e.delete(t)})),e.mergeDeep(c)}))})),Object($.a)(bt,yt.SOFT_UPDATE_DATASTORE,(function(e,t){return e.mergeDeep(Object($.a)({},t.payload.id,t.payload))})),Object($.a)(bt,yt.REMOVE_DATASTORE,(function(e,t){return e.delete(t.payload.id)})),Object($.a)(bt,yt.CLEAR_DATASTORES,(function(e,t){return U.a.Map()})),Object($.a)(bt,yt.DESTROY_PRIVATELINK,(function(e,t){return e.setIn([t.payload.id,"privatelink"],{})})),Object($.a)(bt,yt.SET_DATASTORE_DETAILS,(function(e,t){return y.a.has(t.payload,"details")&&null!==t.payload.details?e.withMutations((function(e){e.setIn([t.payload.id,"frontend","detailsAsyncState"],t.payload.state).setIn([t.payload.id,"details"],U.a.fromJS(t.payload.details))})):e.setIn([t.payload.id,"frontend","detailsAsyncState"],t.payload.state)})),Object($.a)(bt,yt.ADD_DATASTORE_ATTACHMENT,(function(e,t){var a=t.payload,n=a.datastoreId,r=a.attachment,s=e.getIn([n,"meta","attachments"]);return e.setIn([n,"meta","attachments"],s.push(U.a.fromJS(r)))})),Object($.a)(bt,yt.DELETE_DATASTORE_ATTACHMENT,(function(e,t){var a=t.payload,n=a.datastoreId,r=a.attachmentId,s=e.getIn([n,"meta","attachments"]),i=s.findIndex((function(e){return e.get("id")===r}));return e.setIn([t.payload.datastoreId,"meta","attachments"],s.delete(i))})),Object($.a)(bt,yt.DELETE_POSTGRES_BACKUP,(function(e,t){var a=e.getIn([t.payload.datastoreId,"details","backups"]),n=a.find((function(e){return e.get("uuid")===t.payload.backupId})),r=a.indexOf(n);return e.setIn([t.payload.datastoreId,"details","backups"],a.delete(r))})),Object($.a)(bt,yt.SET_DATASTORE_SETTINGS,(function(e,t){var a=t.payload,n=a.datastoreId,r=a.settings;return e.setIn([n,"details","settings"],U.a.fromJS(r))})),Object($.a)(bt,yt.SET_DATASTORE_CHANGE,(function(e,t){var a=t.payload;return e.setIn([a.datastoreId,"changes",a.changeId],U.a.fromJS(a))})),Object($.a)(bt,yt.DELETE_DATASTORE_CHANGE,(function(e,t){var a=t.payload;return e.deleteIn([a.datastoreId,"changes",a.changeId])})),bt)),Tt=g.a.mark(St),Dt=new De;function St(e,t){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se([Dt,Dt.removePrivatelinkAllowed],e,t);case 2:return a=n.sent,n.next=5,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},a)}});case 5:case"end":return n.stop()}}),Tt)}var jt=Et({generator:St})((function(e){var t=e.arn,a=e.datastore,n=e.operation;return l.a.createElement("div",{className:"flex justify-between mb2"},l.a.createElement(S.HKTextField,{readOnly:!0,value:t,className:"w-70"}),l.a.createElement("div",{className:"flex-grow-0"},l.a.createElement(S.HKButton,{disabled:n.status===w.PENDING,type:"tertiary",className:"button-reset",onClick:function(){return n.trigger(a.get("id"),[t])}},n.status===w.PENDING?l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:12,fill:S.Fills.GradientDarkGray}):l.a.createElement(S.HKIcon,{name:S.ProductIcons.EditReject16,size:12,fill:S.Fills.GradientRed}))))})),At=g.a.mark(Pt),Rt=new De;function Pt(e,t){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se([Rt,Rt.addPrivatelinkAllowed],e,t);case 2:return a=n.sent,n.next=5,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},a)}});case 5:case"end":return n.stop()}}),At)}var Lt=Et({generator:Pt})((function(e){var t=e.datastore,a=e.operation,n=t.get("privatelink"),r=Object(c.useState)(""),s=Object(P.a)(r,2),i=s[0],o=s[1],d=a.status===w.PENDING,u=a.status===w.REJECTED&&a.error.errors[0].message;return Object(c.useEffect)((function(){a.status===w.FULFILLED&&(o(""),a.clear())}),[a]),l.a.createElement("div",{className:"mv4 bb bt b--silver"},l.a.createElement("div",{className:"mb3"},l.a.createElement("h4",{className:"mb1 dark-gray"},"Allowed AWS Account IDs"),l.a.createElement("span",{className:"lh-copy dark-gray"},"Add and manage AWS accounts allowed to securely connect to this database using the PrivateLink endpoint.")),n.get("allowed_accounts").map((function(e,a){return l.a.createElement(jt,{key:a,arn:e.get("arn"),datastore:t})})),l.a.createElement("div",{className:"mb4"},l.a.createElement("div",{className:"flex justify-between"},l.a.createElement(S.HKTextField,{placeholder:"e.g. account-id, account-id:user/username",className:"w-70",value:i,onChange:function(e){return o(e.target.value)}}),l.a.createElement(S.HKButton,{async:d,disabled:!i,type:"primary",onClick:function(){a.trigger(t.get("id"),i)}},d?l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:16,fill:S.Fills.GradientDarkGray}):"Add")),u&&l.a.createElement("div",{className:"red lh-copy mv1"},u)))}));function Ut(e){var t,a,n,r=e.endpointId,s=e.status,i=e.hostname,o=e.datastore,d=Object(c.useState)(!1),u=Object(P.a)(d,2),m=u[0],p=u[1],h=function(e,t){var a,n,r,s,i,c=e.getIn(["meta","service"]);return"heroku-postgresql"===c?(n=(a=e.getIn(["details","credentials_list"]).find((function(e){return"default"===e.get("name")}))).getIn(["credentials",0,"user"]),r=a.getIn(["credentials",0,"password"]),s=a.get("database"),i=a.get("port"),"psql://".concat(n,":").concat(r,"@").concat(t,":").concat(i,"/").concat(s)):"heroku-redis"===c?(n=(a=e.getIn(["details","credentials"])).get("user"),r=a.get("password"),i=a.get("port"),"redis://".concat(n,":").concat(r,"@").concat(t,":").concat(i)):"heroku-kafka"===c?"kafka+ssl://".concat(t):void 0}(o,i);return"Available"===s?(t=S.Fills.GradientGreen,n="green",a=S.ProductIcons.SuccessBadge16):"Failed"===s||"Expired"===s?(t=S.Fills.GradientRed,n="red",a=S.ProductIcons.ErrorBadge16):(t=S.Fills.GradientDarkGray,n="dark-gray",a=S.ProductIcons.InfoRing16),l.a.createElement("div",{className:"flex mv2"},l.a.createElement("div",{className:"flex items-center mr2 w-25"},l.a.createElement(S.HKIcon,{name:a,size:16,fill:t,className:"mr1"}),l.a.createElement("span",{className:n},s)),l.a.createElement("div",{className:"dark-gray flex items-center w-33 mr2"},r),l.a.createElement("div",{className:"dark-gray mr2 flex-grow-1"},m?l.a.createElement(S.HKTextField,{readOnly:!0,value:h,className:"w-100"}):l.a.createElement(S.HKButton,{small:!0,onClick:function(){return p(!0)}},"Reveal Credentials")))}function Ht(e){var t=e.datastore,a=t.get("privatelink");return l.a.createElement("div",null,l.a.createElement("div",{className:"mv2 flex"},l.a.createElement("div",{className:"w-25 mr2 dark-gray b"},"Status"),l.a.createElement("div",{className:"dark-gray b w-33 mr2"},"Endpoint ID"),l.a.createElement("div",{className:"dark-gray b"},"Endpoint URL")),a.get("connections").map((function(e){return l.a.createElement(Ut,{key:e.get("endpoint_id"),endpointId:e.get("endpoint_id"),hostname:e.get("hostname"),status:e.get("status"),datastore:t})})))}var Ft=g.a.mark(Gt),Mt=new De;function Gt(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,se([Mt,Mt.fetchPrivatelink],e);case 2:return t=a.sent,a.next=5,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},t)}});case 5:case"end":return a.stop()}}),Ft)}var $t=Et({generator:Gt})((function(e){var t=e.datastore,a=e.operation,n=t.get("privatelink");return l.a.createElement("div",null,l.a.createElement("div",{className:"mv4 dark-gray"},l.a.createElement("h4",{className:"mb1 dark-gray"},"Connections and connection status"),"View the connections to this database using the PrivateLink endpoint."),n.get("connections").size>0?l.a.createElement(Ht,{datastore:t}):l.a.createElement("div",null,l.a.createElement("div",{className:"flex items-center mb2"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.InfoRing16,size:16,fill:S.Fills.DarkGray,className:"mr2 flex-shrink-0"}),l.a.createElement("div",{className:"dark-gray"},"No connections have been created to this database for this Privatelink"))),l.a.createElement(S.HKButton,{className:"mv1",async:a.status===w.PENDING,onClick:function(){return a.trigger(t.get("id"))}},"Refresh Connection Information"))})),qt=g.a.mark(zt),Bt=new De;function zt(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,se([Bt,Bt.destroyPrivatelink],e);case 2:return a.next=5,se([Bt,Bt.fetchPrivatelink],e);case 5:return t=a.sent,a.next=8,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},t)}});case 8:if(!t){a.next=13;break}return a.next=11,ce(5e3);case 11:a.next=14;break;case 13:return a.abrupt("break",16);case 14:a.next=2;break;case 16:case"end":return a.stop()}}),qt)}function Kt(e){var t=e.handleDismiss,a=e.show;return l.a.createElement(S.HKModal,{show:a,header:l.a.createElement("div",null,"Disable PrivateLink"),onDismiss:t,buttons:[{text:"Cancel",type:"tertiary",value:"cancel"},{text:"OK",type:"danger",value:"ok"}]},l.a.createElement("div",{className:"pa4"},l.a.createElement("p",{className:"lh-copy"},"Are you sure you want to disable PrivateLink? This action will destroy any connections to your AWS VPC.")))}var Wt=Et({generator:zt})((function(e){var t,a=e.datastore,n=e.operation,r=e.onShowFlyout,s=a.get("privatelink"),i=l.a.useState(!1),c=Object(P.a)(i,2),o=c[0],d=c[1],u=S.Fills.GradientDarkGray,m=S.ProductIcons.Loading16,p="Provisioning";if(s&&!s.isEmpty()){var h=n.status===w.PENDING||"Deprovisioned"===s.get("status");"Operational"===s.get("status")?(u=S.Fills.GradientGreen,m=S.ProductIcons.SuccessRing16,p="Operational"):"Deprovisioned"===s.get("status")&&(p="Deprovisioning"),t=l.a.createElement("div",null,l.a.createElement("div",{className:"flex justify-between mb4 pt4 pb4 bt bb b--silver"},l.a.createElement("div",{className:"flex items-center w-70"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.SuccessBadge16,size:16,fill:S.Fills.GradientGreen,className:"mr2 flex-shrink-0"}),l.a.createElement("div",{className:"dark-gray lh-copy"},"Secure external database access via PrivateLink endpoint is"," ",l.a.createElement("span",{className:"b"},"enabled"))),l.a.createElement(S.HKButton,{type:"danger",disabled:h,async:n.status===w.PENDING,onClick:function(){return d(!0)}},"Disable...")),l.a.createElement("div",{className:"flex mt3"},l.a.createElement("div",{className:"dark-gray b w6 mr1"},"Endpoint status"),l.a.createElement("div",{className:"flex flex-auto items-center"},l.a.createElement(S.HKIcon,{name:m,size:16,fill:u,className:"mr1"}),l.a.createElement("div",{className:"dark-gray"},p))),"Provisioning"!==s.get("status")&&"Deprovisioned"!==s.get("status")?l.a.createElement("div",{className:"mt3 flex items-center"},l.a.createElement("div",{className:"dark-gray b w6 mr1"},"Service ID"),l.a.createElement("div",{className:"flex-auto"},l.a.createElement(S.HKTextField,{readOnly:!0,className:"w-100",value:s.get("service_name")}))):null)}else t=l.a.createElement("div",null,l.a.createElement("div",{className:"flex justify-between mb4 pt4 pb4 bt bb b--silver"},l.a.createElement("div",{className:"flex items-center w-70"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.ErrorBadge16,size:16,fill:S.Fills.GradientDarkGray,className:"mr2 flex-shrink-0"}),l.a.createElement("div",{className:"dark-gray lh-copy"},"External database access via PrivateLink endpoint is"," ",l.a.createElement("span",{className:"b"},"not enabled"))),l.a.createElement(S.HKButton,{type:"primary",async:n.status===w.PENDING,onClick:r},"Enable")),l.a.createElement("p",{className:"lh-copy dark-gray"},"Enabling External Database Access via PrivateLink will provision a database endpoint that"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-via-privatelink",target:"_blank",rel:"noopener noreferrer"},"can be used to configure connections with other services in your AWS VPC"),"."));return l.a.createElement("div",null,t,l.a.createElement(Kt,{show:o,handleDismiss:function(e){"ok"===e&&n.trigger(a.get("id")),d(!1)}}))}));function Jt(e){var t=e.account,a=e.onChange,n=e.onRemove,r=e.showRemove;return l.a.createElement("div",{className:"mb2"},l.a.createElement("h2",{className:"f5 b dark-gray"},"AWS account ID"),l.a.createElement("div",{className:"flex items-center justify-between"},l.a.createElement(S.HKTextField,{placeholder:"account-id",className:"flex-grow-1",value:t,onChange:a}),r?l.a.createElement(S.HKButton,{type:"tertiary",className:"button-reset",onClick:n},l.a.createElement(S.HKIcon,{name:S.ProductIcons.EditReject16,size:16,fill:S.Fills.GradientRed})):null))}var Yt=g.a.mark(Qt),Vt=new De;function Qt(e,t){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se([Vt,Vt.createPrivatelink],e,t);case 2:return a=n.sent,n.next=5,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},a)}});case 5:case"end":return n.stop()}}),Yt)}function Xt(e){var t=e.handleDismiss,a=e.show;return l.a.createElement(S.HKModal,{show:a,header:l.a.createElement("div",null,"Create PrivateLink"),onDismiss:t,buttons:[{text:"Cancel",type:"tertiary",value:"cancel"},{text:"OK",type:"primary",value:"ok"}]},l.a.createElement("div",{className:"pa4"},l.a.createElement("p",{className:"lh-copy"},"Enabling PrivateLink will allow external access to this data service. This action will be logged.")))}Xt.defaultProps={show:!1};var Zt=Et({generator:Qt})((function(e){var t=e.datastore,a=e.onToggleFlyout,n=e.operation,r=e.showFlyout,s=e.onCreate,i=Object(c.useState)(U.a.List([""])),o=Object(P.a)(i,2),d=o[0],u=o[1],m=Object(c.useState)(!1),p=Object(P.a)(m,2),h=p[0],f=p[1];Object(c.useEffect)((function(){n.status===w.FULFILLED&&(s(),n.clear())}),[n]);var g=n.status===w.PENDING,v=d.every((function(e){return 0===e.length}))||g,b=n.status===w.REJECTED&&n.error.errors[0].message,E=d.get(0);return l.a.createElement("div",null,l.a.createElement(S.HKModal,{isFlyout:!0,show:r,onDismiss:a,header:"Create PrivateLink Endpoint"},l.a.createElement("div",{className:"flex flex-column h-100 overflow-hidden"},l.a.createElement("div",{className:"flex-1 pa4 overflow-y-scroll"},l.a.createElement("h2",{className:"f5 b dark-gray"},"Provide a AWS account ID"),l.a.createElement("p",{className:"dark-gray lh-copy"},"The AWS account ID is used to allow the account to use this PrivateLink endpoint. A single PrivateLink endpoint can support multiple account IDs."),l.a.createElement("div",null,d.map((function(e,t){return l.a.createElement(Jt,{key:t,account:e,onChange:function(e){return function(e,t){u(d.set(e,t.target.value))}(t,e)},onRemove:function(){return e=t,void u(d.delete(e));var e},showRemove:d.size>1})})),E?l.a.createElement(S.HKButton,{type:"secondary",small:!0,onClick:function(){u(d.push(""))}},"Add another AWS Account ID"):null)),l.a.createElement("div",{className:"mt2 pa2 bt b--silver items-center"},b&&l.a.createElement("div",{className:"red lh-copy mv2"},l.a.createElement("div",{className:"b"},"PrivateLink Creation Failed"),l.a.createElement("div",null,b)),l.a.createElement(S.HKButton,{type:"primary",disabled:v,async:g,className:"w-100",onClick:function(){return f(!0)}},g?l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:16,fill:S.Fills.GradientDarkGray}):"Create PrivateLink")))),l.a.createElement(Xt,{show:h,handleDismiss:function(e){"ok"===e&&n.trigger(t.get("id"),d.toJS()),f(!1)}}))})),ea=g.a.mark(aa),ta=new De;function aa(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,se([ta,ta.fetchPrivatelink],e);case 3:return t=a.sent,a.next=6,ie({type:Ct,payload:{id:e,privatelink:Object(ve.a)({},t)}});case 6:if(!(null===t||t&&"Operational"===t.status)){a.next=10;break}return a.abrupt("break",14);case 10:return a.next=12,ce(5e3);case 12:a.next=0;break;case 14:case"end":return a.stop()}}),ea)}var na=Et({generator:aa})((function(e){var t=e.datastore,a=e.operation,n=t.get("privatelink"),r=Object(c.useState)(!1),s=Object(P.a)(r,2),i=s[0],o=s[1];Object(c.useEffect)((function(){var e=t.get("id");a.trigger(e)}),[]);var d=n&&!n.isEmpty()&&"Operational"===n.get("status");return n?l.a.createElement("div",null,l.a.createElement("div",{className:"mw8 ml-auto"},l.a.createElement(Wt,{datastore:t,onShowFlyout:function(){return o(!0)}}),d&&l.a.createElement(c.Fragment,null,l.a.createElement(Lt,{datastore:t}),l.a.createElement($t,{datastore:t})),l.a.createElement(Zt,{showFlyout:i,datastore:t,onToggleFlyout:function(){o(!i)},onCreate:function(){o(!1),a.trigger(t.get("id"))}}))):l.a.createElement("div",{className:"ml-auto w-60"},l.a.createElement("div",null,"Loading..."))}));function ra(e){var t=e.datastore;return l.a.createElement(Ke,{title:"Administration"},l.a.createElement(vt,{actionText:"Show Configuration...",actionCollapseText:"Hide Configuration...",dangerous:!1,description:"Generate and manage PrivateLink endpoints to secure database access from outside your Private Space.",title:"Heroku Kafka via PrivateLink",hideActionButton:!0,valid:!0},l.a.createElement(na,{datastore:t})))}a(746);var sa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.title,n=e.type,r="inprogress"===n?l.a.createElement(ee.a,null):l.a.createElement(Ye,{displaySize:28,baseSize:28,status:"success"===n?Je.GREEN:Je.YELLOW});return l.a.createElement("div",{className:"pa6 flex flex-column items-center tc"},r,l.a.createElement("h4",{className:"normal purple f3"},a),l.a.createElement("div",{className:"lh-copy"},t))}}]),a}(l.a.Component);sa.defaultProps={title:"Success!",type:"success"};var ia=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.children,n=t.error,r=t.help,s=t.label,i=t.labelForId,c=t.valid;y.a.isNil(c)||(e=l.a.createElement(Ye,{className:"mr1",baseSize:16,displaySize:16,status:c?Je.GREEN:Je.RED}));var o=!0===c,d=!!n;return l.a.createElement("div",{className:"pv2 flex-l items-center"},l.a.createElement("div",{className:"minw-6"},s.length>0&&l.a.createElement("label",{className:"f5 b mb2 mb0-l dark-gray dib mb0-l tr-l pr2 border-box",htmlFor:i},s)),l.a.createElement("div",{className:"w-100 w-30-l minw-7 flex-none flex flex-row"},a),l.a.createElement("small",{className:G()("mt2 mt0-l db lh-copy ml4-l f5",{red:d,green:o})},e," ",y.a.isNil(c)||!0===c?r:n))}}]),a}(l.a.Component),ca=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handlePeriodChange=function(t){t.preventDefault();var a=t.currentTarget.value;e.props.onChangeRetention(e.props.value,a)},e.handleValueChange=function(t){t.preventDefault();var a=Number(t.currentTarget.value.trim());e.props.onChangeRetention(a,e.props.period)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.disabled,a=e.period,n=e.value;return l.a.createElement("div",{className:"kafkaTopicRetentionField input-group"},l.a.createElement("input",{type:"number",min:"1",step:"1",name:"retentionTime",className:"hk-input br--left",id:"kafkaTopicForm__retentionTime",value:t||!y.a.isNumber(n)?"":n,title:"Enter a duration in days (numerals only)",onChange:this.handleValueChange,disabled:t}),l.a.createElement("select",{disabled:t,className:"hk-select br--right bl-0",defaultValue:a,onChange:this.handlePeriodChange},l.a.createElement("option",{value:"hour"},Object(qe.pluralize)(n,"Hour")),l.a.createElement("option",{value:"day"},Object(qe.pluralize)(n,"Day"))))}}]),a}(l.a.Component);function la(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["day","hour"],a=Ie.a.duration(e),n=0;n<t.length;n++){var r=t[n],s=a.as(r);if(y.a.isInteger(a.as(r)))return[s,r]}}ca.defaultProps={disabled:!1};var oa={ADD_TOPIC:"ADD_TOPIC",UPDATE_TOPIC:"UPDATE_TOPIC",DELETE_TOPIC:"DELETE_TOPIC"},da=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e,r){var s;Object(n.a)(this,a),(s=t.call(this,e,r)).handleChangeField=function(e){var t=e.currentTarget.name,a=(0,s.state[t].type)(e.currentTarget.value.trim()),n=Object($.a)({},t,{value:a});s.setState(s.validate(n))},s.handleChangeRetention=function(e,t){var a={retentionTime:{value:Ie.a.duration(e,t).asMilliseconds(),period:[e,t]}};s.setState(s.validate(a))},s.handleToggleRetention=function(e){var t={retentionTime:{enabled:"enabled"===e.currentTarget.value}};s.setState(s.validate(t))},s.handleChangeCompaction=function(e){var t="enabled"===e.currentTarget.value,a=s.props.datastore.getIn(["details","capabilities","supports_mixed_cleanup_policy"],!1),n={compactionEnabled:{value:t},retentionTime:{enabled:!t||a}};s.setState(s.validate(n))},s.handleExecute=function(e){e.preventDefault();var t=s.props,a=t.datastore,n=t.dispatch,r=t.editing,i=s.state,c=i.isValid,l=i.name,o=i.partitions,d=i.replication,u=i.compactionEnabled,m=i.retentionTime;if(c){var p={name:l.value,compactionEnabled:u.value,replicationFactor:d.value};m.enabled&&(p.retentionTime=m.value),r?(Le.a.track("Kafka Topic Update Dispatched",Fe(a)),n({type:oa.UPDATE_TOPIC,addonId:a.get("id"),topic:p,changeId:p.name})):(p.partitions=o.value,Le.a.track("Kafka Topic Add Dispatched",Fe(a)),n({type:oa.ADD_TOPIC,addonId:a.get("id"),topic:p,changeId:p.name}))}},s.handleExecuteComplete=function(e){var t=e.currentTarget.value,a=s.props.datastore.get("id");s.props.dispatch({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:a,changeId:t}}),s.props.onDone(e)},s.retentionToggleHelp=function(){var e=s.props.datastore;return e.getIn(["details","shared_cluster"])?l.a.createElement("span",null,l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/kafka-on-heroku#retention",target:"_blank",rel:"noopener noreferrer",onClick:function(e){Le.a.track("Kafka Topic Retention Help Clicked",Object(ve.a)({formType:s.props.editing?"editing":"creating"},Fe(s.props.datastore)))}},"Retention")," ","is required for this plan."):s.state.compactionEnabled.value?e.getIn(["details","capabilities","supports_mixed_cleanup_policy"],!1)?l.a.createElement("span",null,"Enable or disable"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/kafka-on-heroku#retention",target:"_blank",rel:"noopener noreferrer",onClick:function(e){Le.a.track("Kafka Topic Retention Help Clicked",Object(ve.a)({formType:s.props.editing?"editing":"creating"},Fe(s.props.datastore)))}},"retention")," ","time for this topic."):l.a.createElement("span",null,"This Kafka addon does not support"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/kafka-on-heroku#retention",target:"_blank",rel:"noopener noreferrer",onClick:function(e){Le.a.track("Kafka Topic Retention Help Clicked",Object(ve.a)({formType:s.props.editing?"editing":"creating"},Fe(s.props.datastore)))}},"retention")," ","time while compaction is enabled."):l.a.createElement("span",null,l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/kafka-on-heroku#retention",target:"_blank",rel:"noopener noreferrer",onClick:function(e){Le.a.track("Kafka Topic Retention Help Clicked",Object(ve.a)({formType:s.props.editing?"editing":"creating"},Fe(s.props.datastore)))}},"Retention")," ","is required when compaction is disabled.")};var i=e.datastore.getIn(["details","topics"],new U.a.List).map((function(e){return e.get("partitions")*e.get("replication_factor")})).reduce((function(e,t){return e+t})),c=e.datastore.getIn(["details","limits"]).toJS(),o=e.datastore.getIn(["details","defaults"]).toJS(),d=e.retentionTime||c.minimum_retention_ms,u=la(d),m=e.partitions||o.partitions,p=e.replication||c.minimum_replication,h=c.max_partition_replica_count-i;h<0&&(h=0);var f=p*m,g=m;!e.editing&&f>h&&(g=Math.floor(h/p));var v=l.a.createElement("span",null,"Alphanumeric characters, periods, underscores, and hyphens. Immutable after creation."),b="The replication factor of the topic.";return c.minimum_replication===c.maximum_replication&&(b+=" Must be ".concat(c.minimum_replication," for this plan.")),s.state={editing:!!e.editing,isValid:!1,name:{value:e.name||"",type:String,help:v,valid:null,error:""},partitions:{value:g,type:Number,help:"The number of partitions in the topic, immutable after creation.",valid:null,error:"",totalPartitions:i,availablePartitions:h,defaultPartitions:m},replication:{value:p,type:Number,help:b,valid:null,error:""},compactionEnabled:{value:!!e.compactionEnabled,type:Boolean,help:l.a.createElement("span",null,"Enable"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/kafka-on-heroku#compaction",target:"_blank",rel:"noopener noreferrer",onClick:function(t){Le.a.track("Kafka Topic Compaction Help Clicked",Object(ve.a)({formType:e.editing?"editing":"creating"},Fe(e.datastore)))}},"compaction")," ","for this topic.")},retentionTime:{enabled:!!e.retentionEnabled,value:d,period:u,type:Number,help:"The duration for which topic messages are retained.",valid:null,error:""}},e.name&&s.validate({name:{value:e.name}}),s}return Object(r.a)(a,[{key:"validate",value:function(e){var t=this.props.editing,a=Object.assign({},this.state);y.a.merge(a,e),a=y.a.assign(this.validateRetentionTime(a),this.validateReplication(a)),t||(a=y.a.assign(this.validateTopicName(a),this.validatePartitions(a)));var n=a.retentionTime.valid&&a.replication.valid&&(t||a.name.valid&&a.partitions.valid);return a.isValid=n,a}},{key:"validateTopicName",value:function(e){var t=this,a=this.props.datastore,n=[".",".."].concat(a.getIn(["details","admin_topic_names"]).toJS()),r=e.name,s=a.getIn(["details","topic_prefix"]);if(""===r.value){var i=s?"Topic name cannot consist of only the topic prefix.":"You must specify a topic name.";return y.a.merge(e,{name:{valid:!1,error:i}})}return(s?s.length:0)+r.value.length>254?y.a.merge(e,{name:{valid:!1,error:"Topic names have a maximum length of 254 characters."}}):n.some((function(e){return t.topicsConflict(e,r.value)}))?y.a.merge(e,{name:{valid:!1,error:"That is a reserved topic name."}}):/^[a-zA-Z0-9.\-_]+$/.test(r.value)?this.topicExists(r.value)?y.a.merge(e,{name:{valid:!1,error:"That topic already exists."}}):y.a.merge(e,{name:{valid:!0,error:""}}):y.a.merge(e,{name:{valid:!1,error:"Only alphanumeric characters, periods, underscores, and hyphens."}})}},{key:"topicExists",value:function(e){var t=this;return this.props.datastore.getIn(["details","topics"]).map((function(e){return e.get("topic")})).some((function(a){return t.topicsConflict(a,e)}))}},{key:"topicsConflict",value:function(e,t){return e.replace(/_/g,".")===t.replace(/_/g,".")}},{key:"validatePartitions",value:function(e){var t=e.partitions,a=e.replication,n=this.props.datastore.getIn(["details","limits"]).toJS();if(Math.floor(t.value)!==t.value)return y.a.merge(e,{partitions:{valid:!1,error:"Partition count must be a round number."}});var r=t.value*a.value,s=n.max_partition_replica_count-t.totalPartitions;return s<0&&(s=0),r>s?y.a.merge(e,{partitions:{valid:!1,error:"This topic will consume ".concat(Object(qe.intComma)(r)," ").concat(Object(qe.pluralize)(r,"partition")," (").concat(Object(qe.intComma)(t.value)," ").concat(Object(qe.pluralize)(t.value,"partition")," replicated ").concat(Object(qe.intComma)(a.value)," ").concat(Object(qe.pluralize)(a.value,"time"),"). You have ").concat(Object(qe.intComma)(s)," ").concat(Object(qe.pluralize)(s,"partition")," free.")}}):t.value<1||t.value>n.max_number_of_partitions_per_topic?y.a.merge(e,{partitions:{valid:!1,error:"Topics may have between 1 and ".concat(Object(qe.intComma)(n.max_number_of_partitions_per_topic)," partitions.")}}):y.a.merge(e,{partitions:{valid:!0,error:""}})}},{key:"validateReplication",value:function(e){var t=e.replication,a=this.props.datastore.getIn(["details","limits"]).toJS();return Math.floor(t.value)!==t.value?y.a.merge(e,{replication:{valid:!1,error:"Replication factor must be a round number."}}):t.value>a.maximum_replication?y.a.merge(e,{replication:{valid:!1,error:"Replication factor must be no more than ".concat(a.maximum_replication,".")}}):t.value<a.minimum_replication?y.a.merge(e,{replication:{valid:!1,error:"Replication factor must be a minimum of ".concat(a.minimum_replication,".")}}):y.a.merge(e,{replication:{valid:!0,error:""}})}},{key:"validateRetentionTime",value:function(e){var t=e.retentionTime;if(!t.enabled)return y.a.merge(e,{retentionTime:{valid:!0,error:""}});var a=this.props.datastore.getIn(["details","limits"]).toJS();if(!t.value||t.value<a.minimum_retention_ms||t.value>a.maximum_retention_ms){var n=la(a.minimum_retention_ms),r=la(a.maximum_retention_ms);return y.a.merge(e,{retentionTime:{valid:!1,error:"Specify a retention time between ".concat(n[0]," ").concat(qe.pluralize.apply(void 0,Object(b.a)(n))," and ").concat(r[0]," ").concat(qe.pluralize.apply(void 0,Object(b.a)(r)),".")}})}return y.a.merge(e,{retentionTime:{valid:!0,error:""}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.datastore,n=t.editing,r=t.children,s=a.getIn(["details","limits"]).toJS(),i=a.get("changes",new U.a.Map).find((function(t){var r=t.get("datastoreId")===a.get("id")&&t.get("type")===(n?oa.UPDATE_TOPIC:oa.ADD_TOPIC);return n&&(r&=t.get("changeId")===e.props.name),r}));if(i){var c,o=i.get("changeId");switch(i.get("state")){case Ze.PENDING:return c=n?l.a.createElement("p",null,"Once saved, topic updates take effect within a few minutes."):l.a.createElement("p",null,"Once created, topics are provisioned within a few minutes."),l.a.createElement(sa,{countdown:!1,title:"".concat(n?"Updating":"Creating"," your topic: \u201c").concat(o,"\u201d"),type:"inprogress"},c);case Ze.REJECTED:return l.a.createElement(sa,{countdown:!1,title:"Failed to ".concat(n?"update":"create"," your topic: \u201c").concat(o,"\u201d"),type:"warning"},l.a.createElement("p",null,"Yikes! The topic was not ",n?"updated":"created"," due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{type:"primary",value:o,onClick:this.handleExecuteComplete},"Got It")));case Ze.FULFILLED:return c=n?l.a.createElement("div",null,l.a.createElement("p",null,"Once saved, topic updates take effect within a few minutes."),l.a.createElement("p",null,"The updated topic configuration will be displayed when it has taken effect.")):l.a.createElement("div",null,l.a.createElement("p",null,"Once created, topics are provisioned within a few minutes."),l.a.createElement("p",null,"Your new topic will only be displayed when it is ready to be used.")),l.a.createElement(sa,{countdown:!1,title:"Topic ".concat(n?"updated":"created",": \u201c").concat(o,"\u201d"),type:"success"},c,l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{type:"primary",value:o,onClick:this.handleExecuteComplete},"Got It")))}}var d=this.state,u=d.isValid,m=d.name,p=d.partitions,h=d.replication,f=d.compactionEnabled,g=d.retentionTime,v=a.getIn(["details","capabilities","supports_mixed_cleanup_policy"],!1),b=a.getIn(["details","shared_cluster"]),E=v||!f.value,y=b||!f.value,k=E&&!y,w=g.enabled,C=l.a.createElement(ia,{help:this.retentionToggleHelp(),label:"Retention Time",labelForId:"kafkaTopicForm__retentionTime"},l.a.createElement("label",null,l.a.createElement("input",{type:"radio",className:"mr1",value:"enabled",name:"retentionEnabled",onChange:this.handleToggleRetention,checked:w,disabled:!k}),"Enabled"),l.a.createElement("label",{className:"ml4"},l.a.createElement("input",{type:"radio",className:"mr1",value:"disabled",name:"retentionEnabled",onChange:this.handleToggleRetention,checked:!w,disabled:!k}),"Disabled")),O=l.a.createElement(ia,{error:g.error,help:g.help,label:"",labelForId:"kafkaTopicForm__retentionTime",valid:w?g.valid:null},l.a.createElement(ca,{onChangeRetention:this.handleChangeRetention,valid:w?g.valid:null,period:g.period[1],value:g.period[0],disabled:!w})),N=a.getIn(["details","topic_prefix"]),I=l.a.createElement(ia,{error:m.error,help:m.help,label:"Topic Name",labelForId:"kafkaTopicForm__name",valid:m.valid},N&&l.a.createElement("input",{className:"hk-input--read-only br--left mr0 tr pl2 pr1 minw-5",disabled:!0,style:{borderRight:"none",flex:"1 1 0px"},value:N}),l.a.createElement("input",{type:"text",name:"name",className:G()("hk-input",{"br--right":N}),style:{flex:"1 0 auto"},id:"kafkaTopicForm__name",defaultValue:m.value,onChange:n?function(){}:this.handleChangeField,maxLength:254,disabled:n?"true":void 0})),_=Math.floor(p.availablePartitions/h.value);s.max_partition_replica_count<_&&(_=s.max_partition_replica_count);var x,T=l.a.createElement(ia,{error:p.error,help:p.help,label:"Partitions",labelForId:"kafkaTopicForm__partitions",valid:p.valid},l.a.createElement("input",{type:"number",name:"partitions",className:"hk-input flex-none w-100",id:"kafkaTopicForm__partitions",defaultValue:p.value,onChange:n?function(){}:this.handleChangeField,min:1,max:_,step:1,disabled:n?"true":void 0})),D=s.minimum_replication!==s.maximum_replication,j=l.a.createElement(ia,{error:h.error,help:h.help,label:"Replication",labelForId:"kafkaTopicForm__replication",valid:D?h.valid:null},l.a.createElement("input",{type:"number",name:"replication",className:"hk-input flex-none w-100",id:"kafkaTopicForm__replication",defaultValue:h.value,onChange:this.handleChangeField,min:s.minimum_replication,max:s.maximum_replication,disabled:!D,step:1})),A=f.value,R=l.a.createElement(ia,{help:f.help,label:"Compaction"},l.a.createElement("label",null,l.a.createElement("input",{type:"radio",className:"mr1",value:"enabled",name:"compactionEnabled",onChange:this.handleChangeCompaction,checked:!!A}),"Enabled"),l.a.createElement("label",{className:"ml4"},l.a.createElement("input",{type:"radio",className:"mr1",value:"disabled",name:"compactionEnabled",onChange:this.handleChangeCompaction,checked:!A}),"Disabled"));return r&&(x=l.a.createElement("div",{className:"pv2"},r)),l.a.createElement("div",null,l.a.createElement("h3",{className:"f3 normal purple mb2 pb2 bb b--light-silver"},n?"Editing topic":"Create a topic"),l.a.createElement("div",null,l.a.createElement("form",{role:"form"},I,T,j,R,C,O)),l.a.createElement("div",{className:"pv4 bb b--light-silver"},l.a.createElement(S.HKButton,{type:"primary",disabled:!u,className:"mr3",onClick:this.handleExecute},n?"Update":"Create"," Topic"),l.a.createElement(S.HKButton,{type:"tertiary",onClick:this.props.onCancel},"Cancel")),x)}}]),a}(l.a.Component);da.defaultProps={retentionEnabled:!0};var ua=Object(d.b)()(da),ma=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleClick=function(t){e.props.onClick(t)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.buttonEnabled,a=e.buttonLabel,n=e.topic,r=e.prefix,s=e.statusLabel,i=n.get("retention_enabled")?Ie.a.duration(n.get("retention_time_ms")).humanize():"automatic",c=n.get("compaction_enabled")?"enabled":"disabled";return l.a.createElement("header",{className:"kafkaTopicHeader flex-none flex flex-row items-baseline pb3"},l.a.createElement("h4",{className:"mt0 mb3 f3 black flex-none mr3 normal"},r&&l.a.createElement("span",{className:"gray"},r),n.get("topic")),l.a.createElement("p",{className:G()("f6 status gray ttu",{red:this.props.status===Je.RED})},l.a.createElement(Ye,{baseSize:16,displaySize:14,status:this.props.status,className:"v-tbtm"})," ",s),l.a.createElement("p",{className:"metadata flex-auto tr mr1 f5"},l.a.createElement("span",{className:"gray mr3"},"Retention: ",l.a.createElement("strong",{className:"dark-gray"},i)),l.a.createElement("span",{className:"gray mr3"},"Compaction: ",l.a.createElement("strong",{className:"dark-gray"},c)),l.a.createElement("span",{className:"gray mr3"},"Replication:"," ",l.a.createElement("strong",{className:"dark-gray"},n.get("replication_factor"))),l.a.createElement("span",{className:"gray mr3"},"Partitions:"," ",l.a.createElement("strong",{className:"dark-gray"},n.get("partitions")))),l.a.createElement("div",{className:"actions flex-none tr"},l.a.createElement(S.HKButton,{type:"secondary",className:"mr1",onClick:this.handleClick,disabled:!t},a)))}}]),a}(l.a.Component);ma.defaultProps={buttonEnabled:!0,onClick:function(){}};a(747);var pa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a=this.props,n=a.className,r=a.data,s=a.prettifier,i=a.title,c=a.onHover,o=a.hoverIndex;if(r){e=l.a.createElement(ot.a,null,(function(e){var t=e.width;e.height;return l.a.createElement(ct,{data:r,width:t,height:110,onHover:c,hoverIndex:o,prettifier:s})}));var d=this.props.prettifier(r.get("measurements").get(o||-1).get("value")),u=Object(P.a)(d,2),m=u[0],p=u[1];t=l.a.createElement("h3",{className:"f1 black ma0 normal"},m,l.a.createElement("small",{className:"pl1 gray f4"},p))}else e=l.a.createElement(ee.a,null),t=l.a.createElement("h3",{className:"f1 black ma0 normal"},"-");return l.a.createElement("div",{className:G()(n,"flex-auto","kafkaTopicMetricChart")},l.a.createElement("div",{className:"metadata mb1"},t,l.a.createElement("h6",{className:"f6 mt1 mb0 normal ttu"},i)),l.a.createElement("div",{className:"chart mr3"},e))}}]),a}(l.a.Component),ha=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={hoverIndex:-1},e.handleHover=function(t){e.setState({hoverIndex:t})},e.messagesPrettifier=function(e){return Object(et.c)(e,0,1,1)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.datastore,a=e.topic,n=t.getIn(["metrics","data"],new U.a.List);if(0===n.size)return l.a.createElement("div",{className:"kafkaTopicStats tc pa5"},l.a.createElement(ee.a,null),l.a.createElement("div",{className:"f5 gray"},"Loading metrics\u2026"));var r=n.find((function(e){return e.get("name")==="per_topic_replicated_log_size_".concat(a.get("topic"),"_max")})),s=n.find((function(e){return e.get("name")==="per_topic_messages_in_per_second_".concat(a.get("topic"),"_max")})),i=n.find((function(e){return e.get("name")==="per_topic_bytes_in_per_second_".concat(a.get("topic"),"_max")})),c=n.find((function(e){return e.get("name")==="per_topic_bytes_out_per_second_".concat(a.get("topic"),"_max")}));return l.a.createElement("div",{className:"kafkaTopicStats w-100 pa0 flex flex-row flex-none"},l.a.createElement(pa,{key:"streamSize",title:"data size",currentValue:0,prettifier:et.a,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:r}),l.a.createElement(pa,{key:"messages",title:"messages/sec",currentValue:0,prettifier:this.messagesPrettifier,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:s}),l.a.createElement(pa,{key:"bytesIn",title:"in/sec \u2b07",currentValue:0,prettifier:et.a,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:i}),l.a.createElement(pa,{key:"bytesOut",title:"out/sec \u2b06",currentValue:0,prettifier:et.a,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:c}))}}]),a}(l.a.Component),fa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isEditing:!1,confirmingDeletion:!1},e.handleEdit=function(){e.setState({isEditing:!0}),Le.a.track("Kafka Topic Edit Clicked",Object(ve.a)({topic:e.props.topic.get("topic")},Fe(e.props.datastore)))},e.resetEditing=function(){var t=e.props,a=t.datastore,n=t.dispatch,r=t.topic;e.setState({isEditing:!1,confirmingDeletion:!1}),n({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:a.get("id"),changeId:r.get("topic")}})},e.handleEditCancel=function(t){t.preventDefault(),e.resetEditing();var a=t.currentTarget.nodeName;Le.a.track("Kafka Topic Edit Canceled",Object(ve.a)({clickSource:a},Fe(e.props.datastore)))},e.handleEditDone=function(t){t.preventDefault(),e.resetEditing()},e.handleDelete=function(t){t.preventDefault(),e.setState({confirmingDeletion:!0}),Le.a.track("Kafka Topic Destroy Clicked",Object(ve.a)({topic:e.props.topic.get("topic")},Fe(e.props.datastore)))},e.handleDeleteConfirm=function(t){t.preventDefault();var a=e.props,n=a.datastore,r=a.topic,s=a.dispatch;Le.a.track("Kafka Topic Destroy Dispatched",Fe(n)),s({type:oa.DELETE_TOPIC,addonId:n.get("id"),topicName:r.get("topic"),changeId:r.get("topic")}),e.setState({confirmingDeletion:!1}),Le.a.track("Kafka Topic Destroy Confirmed",Object(ve.a)({topic:e.props.topic.get("topic")},Fe(e.props.datastore)))},e.handleDeleteCancel=function(t){t.preventDefault(),e.setState({confirmingDeletion:!1}),Le.a.track("Kafka Topic Destroy Canceled",Object(ve.a)({topic:e.props.topic.get("topic")},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.datastore,n=t.topic,r=this.state,s=r.isEditing,i=r.confirmingDeletion,c=n.get("topic"),o={topic:n,status:n.get("status"),statusLabel:n.get("status_label"),prefix:a.getIn(["details","topic_prefix"],null)};if(s){var d=a.getIn(["changes",c]);if(o.buttonLabel="cancel",o.onClick=this.handleEditCancel,d&&(o.buttonLabel="close",o.buttonEnabled=d.get("state")!==Ze.PENDING,d.get("type")===oa.DELETE_TOPIC))switch(d.get("state")){case Ze.PENDING:e=l.a.createElement(sa,{countdown:!1,title:"Destroying your topic: \u201c".concat(c,"\u201d"),type:"inprogress"},l.a.createElement("p",null,"Once destroyed, topics take a few minutes to disappear completely."));break;case Ze.REJECTED:e=l.a.createElement(sa,{countdown:!1,title:"Failed to destroy your topic: \u201c".concat(c,"\u201d"),type:"warning"},l.a.createElement("p",null,"Yikes! The topic was not destroyed due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleEditCancel},"Got It")));break;case Ze.FULFILLED:e=l.a.createElement(sa,{countdown:!1,title:"Topic destroyed: \u201c".concat(c,"\u201d"),type:"success"},l.a.createElement("p",null,"Once destroyed, topics take a few minutes to disappear completely."),l.a.createElement("p",null,"Your topic will still be visible until it is destroyed cluster-wide."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleEditCancel},"Got It")))}i&&(e=l.a.createElement("div",{className:"tc pa4"},l.a.createElement("h4",{className:"normal purple f3"},"Do you want to destroy this topic?"),l.a.createElement("p",null,"This will immediately discard all data in the topic, and is irreversible."),l.a.createElement("p",null,l.a.createElement(S.HKButton,{type:"danger",className:"mh2",onClick:this.handleDeleteConfirm},"Destroy"),"or",l.a.createElement(S.HKButton,{type:"primary",className:"mh2",onClick:this.handleDeleteCancel},"Cancel")))),e||(e=l.a.createElement(ua,{onCancel:this.handleEditCancel,onDone:this.handleEditDone,datastore:a,editing:!0,name:n.get("topic"),partitions:n.get("partitions"),replication:n.get("replication_factor"),retentionTime:n.get("retention_time_ms"),retentionEnabled:n.get("retention_enabled"),compactionEnabled:n.get("compaction_enabled")},l.a.createElement("p",{className:"gray f6"},"Partition count is not editable after creation."),l.a.createElement("p",{className:"gray f6"},"Topics are updated asynchronously. Changes will only appear in the dashboard when they have taken effect."),l.a.createElement(S.HKButton,{type:"danger",className:"mv4",onClick:this.handleDelete},"Destroy Topic")))}else o.buttonLabel="edit",o.onClick=this.handleEdit,e=l.a.createElement(ha,{topic:n,datastore:a});return l.a.createElement("section",{className:G()("kafkaTopic pt4 pb2 ma0 bb flex flex-column",s?"b--purple kafkaTopic--editing bt":"b--light-silver")},l.a.createElement(ft.a,{isOpened:!0,springConfig:{stiffness:500,damping:50}},l.a.createElement(ma,o),e))}}]),a}(l.a.Component),ga=Object(d.b)()(fa),va=a(58),ba=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).setupDebounce=Object(va.a)((function(e,t){r.emitFiltered=e>0?y.a.debounce(t,e):t})),r.handleChange=function(e){var t=e.target.value;r.setState({filterString:t}),r.emitFiltered(t.trim())},r.state={filterString:e.initialValue},r.setupDebounce(e.debounceMillis,e.onFilter),r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.props.onFilter(this.state.filterString)}},{key:"render",value:function(){var e=this.props,t=e.autofocus,a=e.className,n=e.debounceMillis,r=e.onFocus,s=e.onFilter,i=e.placeholder;return this.setupDebounce(n,s),l.a.createElement("input",{type:"text",autoCorrect:"off",spellCheck:"false",autoFocus:t,placeholder:i,onChange:this.handleChange,onFocus:r,className:"hk-input w-100 ".concat(a),value:this.state.filterString})}}]),a}(l.a.Component);ba.defaultProps={autofocus:!1,className:"",initialValue:"",debounceMillis:0};var Ea=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={tab:"log_size"},e.explanations={log_size:"\n      The disk space consumed by a topic, which is counted towards your overall plan consumption.",per_topic_messages_in_per_second:"\n      The number of messages currently produced to the topic, per second.",per_topic_bytes_in_per_second:"\n      The topic\u2019s current ingress bandwidth per second.",per_topic_bytes_out_per_second:"\n      The topic\u2019s current egress bandwidth per second."},e.handleFilter=function(t){var a=t.trim().toLowerCase();e.props.onFilter(a||null)},e.handleFilterFocus=function(){return e.props.onFilterFocus()},e.handleTabNavigation=function(t){var a=t.currentTarget.getAttribute("data-sort");e.setState({tab:a}),e.props.onSort(a)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.maxTopics,a=e.topicCount,n=this.state.tab,r=null!==t&&a>=t;return l.a.createElement("header",{className:"flex flex-column"},l.a.createElement("div",{className:"meta flex flex-row items-center mb3"},l.a.createElement("h3",{className:"flex-none w-auto ma0 dark-gray normal f1"},a," ",l.a.createElement("small",{className:"f4"},Object(qe.pluralize)(a,"topic"))),l.a.createElement("div",{className:"flex-none ml3 lh-solid"},l.a.createElement(S.HKButton,{disabled:r,onClick:this.props.onTopicAdd},"Add Topic"),r&&l.a.createElement("p",{className:"mv0 mh3 f5 fw1 dib gray"},"Your plan does not support more than ",t," topics.")),l.a.createElement("div",{className:"flex-auto tr self-end"},l.a.createElement(ba,{autofocus:!1,className:"mw7",placeholder:"filter topics",onFilter:this.handleFilter,onFocus:this.handleFilterFocus}))),l.a.createElement("div",{className:"hk-tabs bn"},l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"log_size"===n}),"data-sort":"log_size",onClick:this.handleTabNavigation},"Largest size"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"per_topic_messages_in_per_second"===n}),"data-sort":"per_topic_messages_in_per_second",onClick:this.handleTabNavigation},"Most messages"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"per_topic_bytes_in_per_second"===n}),"data-sort":"per_topic_bytes_in_per_second",onClick:this.handleTabNavigation},"Most bytes in"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"per_topic_bytes_out_per_second"===n}),"data-sort":"per_topic_bytes_out_per_second",onClick:this.handleTabNavigation},"Most bytes out"),l.a.createElement("div",{className:"spacer flex-auto bb b--light-silver"})),l.a.createElement("div",{className:"explanation mt4 dark-gray"},l.a.createElement("p",null,l.a.createElement(o.a,{name:"info-badge-16",size:20,fillClass:"dark-gray",extraClasses:"v-tbtm mr1"})," ",this.explanations[n]),l.a.createElement("p",null,l.a.createElement(o.a,{name:"metrics-16",size:20,fillClass:"dark-gray",extraClasses:"v-tbtm mr1"})," ","Displaying metrics for the last 24 hours.")))}}]),a}(l.a.Component),ya=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isAddingTopic:!1,sort:"log_size",addTopicSuccess:!1,filter:null},e.handleFilter=function(t){e.setState({filter:t})},e.handleFilterFocus=function(t){Le.a.track("Kafka Topics FilterInput Focused",Object(ve.a)({},Fe(e.props.datastore)))},e.handleSort=function(t){e.setState({sort:t}),Le.a.track("Kafka Topics Sorted",Object(ve.a)({sort:t},Fe(e.props.datastore)))},e.handleTopicAdd=function(t){t.preventDefault(),e.setState({isAddingTopic:!0}),Le.a.track("Kafka Topic Add Clicked",Object(ve.a)({},Fe(e.props.datastore)))},e.handleTopicAddDone=function(t){t.preventDefault(),e.setState({isAddingTopic:!1})},e.handleTopicAddCancel=function(t){t.preventDefault(),e.setState({isAddingTopic:!1}),Le.a.track("Kafka Topic Add Canceled",Object(ve.a)({},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props.datastore,a=this.state,n=a.filter,r=a.sort,s=t.getIn(["details","admin_topic_names"]),i=t.getIn(["details","topics"]).filter((function(e){return!s.includes(e.get("topic",""))&&(!n||e.get("topic").toLowerCase().includes(n))})).sortBy((function(e){var a=t.getIn(["metrics","data"],new U.a.List).find((function(t){return t.get("name")==="".concat(r,"_").concat(e.get("topic"),"_sum")}));return a?a.get("measurements").last().get("value"):0})).reverse(),c=0===i.size?this.state.filter:null;if(this.state.isAddingTopic)e=l.a.createElement(ua,{name:c,onCancel:this.handleTopicAddCancel,onDone:this.handleTopicAddDone,datastore:t},l.a.createElement("p",{className:"gray f6"},"Partition Count is not editable after creation."),l.a.createElement("p",{className:"gray f6"},"Topics are created asynchronously, and will only appear in the dashboard when they are ready to use."));else{var o=t.getIn(["details","topics"]).filter((function(e){return!s.includes(e.get("topic"))})).size,d=t.getIn(["details","limits","max_number_of_topics"]),u=null!==d&&o>=d,m=l.a.createElement("div",{className:"mv3 tc"},l.a.createElement("p",{className:"f4 normal dark-gray"},"No topics found."),!u&&l.a.createElement(S.HKButton,{onClick:this.handleTopicAdd},"Create this topic?"));e=l.a.createElement("div",null,l.a.createElement(Ea,{maxTopics:d,onFilter:this.handleFilter,onFilterFocus:this.handleFilterFocus,onSort:this.handleSort,onTopicAdd:this.handleTopicAdd,topicCount:o}),l.a.createElement("section",{className:"ma0 flex flex-column w-100"},0===i.size?m:i.valueSeq().map((function(e){return l.a.createElement(ga,{key:e.get("topic"),datastore:t,topic:e})}))))}return l.a.createElement(Ke,{title:"Topics",className:"kafkaTopicList"},e)}}]),a}(l.a.Component),ka=Object(d.b)()(ya),wa=a(1276);function Ca(e){return e.map((function(e){return{name:e.name,measurements:e.measurements.map((function(e){return{time:e.time,value:e.value>1e-9?e.value:0}}))}}))}function Oa(e){var t=wa.a("0.2f");return e.map((function(e){return e.name.endsWith("cache_hit_rate_max")?{name:e.name,measurements:e.measurements.map((function(e){return{time:e.time,value:Number(t(e.value))}}))}:"transaction_activity_commit_max"===e.name?{name:e.name,measurements:Ia(e.measurements)}:e}))}function Na(e){return e.map((function(e){return e.name.startsWith("cmd_")?{name:e.name,measurements:Ia(e.measurements)}:e}))}function Ia(e){var t=0;return e.map((function(a,n){var r,s,i;return 0===n?(s=e[1],r=e[0]):(s=a,r=e[n-1]),t=Math.max(t,r.value),i=0===r.value||0===s.value?0:s.value>=r.value?s.value-r.value:s.value+t-r.value,{time:s.time,value:i}}))}function _a(e){var t=Ie.a.utc();switch(e.resolution){case"10m":t.subtract(11,"minutes").startOf("minute").subtract(t.minutes()%10,"minutes");break;case"1h":t.subtract(11,"minutes").startOf("minute").subtract(t.minutes()%60,"minutes");break;case"2h":t.subtract(11,"minutes").startOf("minute").subtract(t.minutes()%60,"minutes").subtract(t.hours()%2,"hours")}return[t.clone().subtract(e.hours,"hours"),t]}function xa(){var e=Object(Ge.a)(["max$"]);return xa=function(){return e},e}var Ta=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={currentTabAnchor:null,selectedTimeframeOption:ut[0]},e.handleUpdateTimeframe=function(t){e.setState({selectedTimeframeOption:t})},e.handleTabChange=function(t,a){var n=a[t].anchor;window.location.hash=n,e.setState({currentTabAnchor:n})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.metricsFetchTimerId=window.setInterval((function(){window.paused?k.a.debug("paused: not fetching metrics"):window.navigator.onLine?e._fetchMetrics(!0):k.a.debug("Offline, not fetching metrics")}),Ie.a.duration(5,"minutes").asMilliseconds()),this._fetchMetrics(),Le.a.page("kafka",Object(ve.a)({},Fe(this.props.datastore)))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.props.datastore!==e.datastore){var t=this.props.datastore.getIn(["details","topics"],new U.a.List).map((function(e){return e.get("topic")})).sort().toJS(),a=e.datastore.getIn(["details","topics"],new U.a.List).map((function(e){return e.get("topic")})).sort().toJS(),n=y.a.xor(t,a);n.length>0&&(k.a.debug("KafkaDatastoreInfo cWRP topic delta is: ",n),this._fetchMetrics(!0))}}},{key:"componentDidUpdate",value:function(e,t){this.state.selectedTimeframeOption!==t.selectedTimeframeOption&&this._fetchMetrics()}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.metricsFetchTimerId)}},{key:"_fetchMetrics",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state.selectedTimeframeOption,a=_a(t),n=Object(P.a)(a,2),r=n[0],s=n[1];k.a.debug("Fetching metrics: ".concat(r.toISOString()," -> ").concat(s.toISOString()));var i=this.props.datastore;this.props.dispatch({type:yt.FETCH_DATASTORE_METRICS,id:i.get("id"),service:i.getIn(["meta","service"]),config:{start:r.toISOString(),end:s.toISOString(),resolution:t.resolution,filter:String.raw(xa()),postProcess:Ca},background:e})}},{key:"render",value:function(){var e=this,t=this.props.datastore,a=t.getIn(["meta","plan"]).startsWith("private")||t.getIn(["meta","plan"]).startsWith("shielded"),n=[l.a.createElement(Xe,{key:"kafka-health",datastore:t}),l.a.createElement(pt,{key:"kafka-io",datastore:t,onUpdateTimeframe:this.handleUpdateTimeframe}),l.a.createElement(ka,{key:"kafka-topic-list",datastore:t})],r=[l.a.createElement(ra,{key:"kafka-admin",datastore:t})],s=[{title:"Overview",node:n,anchor:""},{title:"Settings",node:r.length&&r,anchor:"settings"}].filter((function(e){return e.node})),i=Math.max(0,y.a.findIndex(s,(function(t){return t.anchor===e.state.currentTabAnchor})));return a?l.a.createElement($e.d,{selectedIndex:i,onSelect:function(t){return e.handleTabChange(t,s)},className:"f4"},l.a.createElement($e.b,{className:"pl0 react-tabs__tab-list overflow-x-auto",style:{whiteSpace:"nowrap"}},s.map((function(e){return l.a.createElement($e.a,{style:{transform:"translateY(0)"},key:"".concat(e.title," tab")},e.title)}))),s.map((function(e){return l.a.createElement($e.c,{key:"".concat(e.title," tabpanel")},e.node)}))):l.a.createElement("div",null,n)}}]),a}(l.a.Component),Da=Object(d.b)()(Ta),Sa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("section",{className:"notfound flex h-100 w-100 flex-auto items-center justify-center tc bg-light-silver"},l.a.createElement("div",null,this.props.title&&l.a.createElement("h1",{className:"normal"},this.props.title),this.props.children))}}]),a}(l.a.Component);Sa.defaultProps={title:"Not Found"};var ja=a(748),Aa=a.n(ja);function Ra(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.credential,r=void 0===n?"default":n,s=a.shield,i=void 0!==s&&s,c=a.attachment,l=void 0===c?"DATABASE":c;if(i)return"heroku run 'psql $".concat(l,"_URL' --app ").concat(t);var o="default"===r?"":" --credential ".concat(r);return"heroku pg:psql ".concat(e).concat(o," --app ").concat(t)}var Pa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=e.getIn(["details","credentials"]),a=e.getIn(["meta","name"]),n=e.getIn(["meta","attachments",0]),r=Ra(a,n.get("app_name"),{shield:e.getIn(["details","shielded"],!1),attachment:n.get("name")});return l.a.createElement(vt,{actionText:"View Credentials\u2026",dangerous:!1,description:"Get credentials for manual connections to this database.",hideActionButton:!0,title:"Database Credentials"},l.a.createElement("div",{className:"postgresCredentialsAction"},l.a.createElement("p",{className:"u-margin-Ts"},"Please note that"," ",l.a.createElement("strong",null,"these credentials are not permanent"),"."),l.a.createElement("p",null,"Heroku rotates credentials periodically and updates applications where this database is attached."),l.a.createElement("dl",{className:"push-3"},l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"Host"),l.a.createElement("dd",{className:"flex-auto"},t.get("hostname"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"Database"),l.a.createElement("dd",{className:"flex-auto"},t.get("database"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"User"),l.a.createElement("dd",{className:"flex-auto"},t.get("user"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"Port"),l.a.createElement("dd",{className:"flex-auto"},t.get("port"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"Password"),l.a.createElement("dd",{className:"flex-auto nowrap overflow-x-auto "},t.get("password"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"URI"),l.a.createElement("dd",{className:"flex-auto nowrap overflow-x-auto"},"postgres://",t.get("user"),":",t.get("password"),"@",t.get("hostname"),":",t.get("port"),"/",t.get("database"))),l.a.createElement("div",{className:"flex pv2 items-center"},l.a.createElement("dt",{className:"w5 flex-none b"},"Heroku CLI"),l.a.createElement("dd",{className:"flex-auto"},r)))))}}]),a}(l.a.Component),La=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={valid:!1},e.handleChange=function(t){var a=t.target.value,n=a===e.props.target;e.setState({valid:n,value:a}),e.props.onChange(n)},e.handleEnterKey=function(t){13===t.keyCode&&e.state.valid&&e.props.onEnter&&e.props.onEnter(t)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.target,t=this.state,a=t.valid,n=t.value;return l.a.createElement("div",{className:"matchExactlyInput"},l.a.createElement("input",{type:"text",autoCorrect:"off",spellCheck:!1,autoFocus:!0,onChange:this.handleChange,onKeyUp:this.handleEnterKey,className:G()("hk-input db w-100",{"b--red":n&&!a,"hk-focus-ring--red":n&&!a,"b--green":n&&a,"hk-focus-ring--green":n&&a})}),l.a.createElement("label",{className:G()("db mt2",{red:n&&!a,green:n&&a})},"To confirm, please type the name of your app (",l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1 dark-gray"},e),")."))}}]),a}(l.a.Component);function Ua(e,t){var a=e.get("changes",new U.a.Map),n=e.get("id");if(a)return a.find((function(e,a){return e.get("datastoreId")===n&&e.get("changeId")===t}))}function Ha(e,t){return{type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:e.get("id"),changeId:t}}}var Fa={ADD_FOLLOWER:"ADD_FOLLOWER",REMOVE_FOLLOWER:"REMOVE_FOLLOWER",UNFOLLOW:"UNFOLLOW",DESTROY:"DESTROY",ROLLBACK:"ROLLBACK",FORK:"FORK",CONFIGURE:"CONFIGURE",ADD_CREDENTIAL:"ADD_CREDENTIAL",DESTROY_CREDENTIAL:"DESTROY_CREDENTIAL",ROTATE_CREDENTIAL:"ROTATE_CREDENTIAL",ROTATE_ALL_CREDENTIALS:"ROTATE_ALL_CREDENTIALS",ATTACH_CREDENTIAL:"ATTACH_CREDENTIAL",DETACH_CREDENTIAL:"DETACH_CREDENTIAL",SET_PERMISSIONS:"SET_PERMISSIONS",DESTROY_BACKUP:"DESTROY_BACKUP",CREATE_BACKUP:"CREATE_BACKUP",FETCH_SCHEMA:"FETCH_SCHEMA",DIAGNOSE:"DIAGNOSE",TERMINATE_CONNECTION:"TERMINATE_CONNECTION"},Ma=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={valid:!1},e.handleConfirmationChange=function(t){e.setState({valid:t})},e.handleCollapse=function(){e.setState({valid:!1})},e.handleConfirm=function(){var t=e.props,a=t.dispatch,n=t.datastore;Le.a.track("Postgres Database Destroy Dispatched",Fe(n)),a({type:Fa.DESTROY,addonId:n.get("id")})},e.handleGotIt=function(){var t=e.props,a=t.datastore;(0,t.dispatch)(Ha(a,Fa.DESTROY))},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=e.getIn(["meta","app_name"]),a=this.state.valid,n=Ua(e,Fa.DESTROY);if(!n)return l.a.createElement(vt,{actionText:"Destroy Database\u2026",dangerous:!0,description:"Destroys the database and all of the data inside it.",title:"Destroy Database",valid:a,onCollapse:this.handleCollapse,onConfirm:this.handleConfirm},l.a.createElement("p",null,"This action will"," ",l.a.createElement("strong",null,"permanently destroy all of your data"),"."),l.a.createElement(La,{target:t,onChange:this.handleConfirmationChange}));switch(n.get("state")){case Ze.PENDING:return l.a.createElement(sa,{countdown:!1,title:"Destroying your database",type:"inprogress"},l.a.createElement("p",null,"Enqueueing your database for destruction\u2026"));case Ze.REJECTED:var r=null;try{var s,i,c,o,d,u,m=null!==(s=null===(i=JSON.parse(null===(c=n.get("error"))||void 0===c||null===(o=c.toJS())||void 0===o||null===(d=o.errors)||void 0===d||null===(u=d[0])||void 0===u?void 0:u.message))||void 0===i?void 0:i[0])&&void 0!==s?s:n.get("error");r=l.a.createElement("p",null,m)}catch(p){r=l.a.createElement("div",null,l.a.createElement("p",null,"Yikes! The database was not destroyed due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."))}return l.a.createElement(sa,{countdown:!1,title:"Failed to destroy your database",type:"warning"},r,l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{onClick:this.handleGotIt},"Got It")))}}}]),a}(l.a.Component),Ga=Object(d.b)()(Ma),$a=[{name:"hobby-dev",human_name:"Hobby Dev",price:"Free",retentionPeriod:null},{name:"hobby-basic",human_name:"Hobby Basic",price:"$7/mo",retentionPeriod:null},{name:"standard-0",human_name:"Standard 0",price:"$50/mo",retentionPeriod:"4 days"},{name:"standard-2",human_name:"Standard 2",price:"$200/mo",retentionPeriod:"4 days"},{name:"standard-3",human_name:"Standard 3",price:"$400/mo",retentionPeriod:"4 days"},{name:"standard-4",human_name:"Standard 4",price:"$750/mo",retentionPeriod:"4 days"},{name:"standard-5",human_name:"Standard 5",price:"$1400/mo",retentionPeriod:"4 days"},{name:"standard-6",human_name:"Standard 6",price:"$2000/mo",retentionPeriod:"4 days"},{name:"standard-7",human_name:"Standard 7",price:"$3500/mo",retentionPeriod:"4 days"},{name:"standard-8",human_name:"Standard 8",price:"$4500/mo",retentionPeriod:"4 days"},{name:"standard-9",human_name:"Standard 9",price:"$5800/mo",retentionPeriod:"4 days"},{name:"premium-0",human_name:"Premium 0",price:"$200/mo",retentionPeriod:"7 days"},{name:"premium-2",human_name:"Premium 2",price:"$350/mo",retentionPeriod:"7 days"},{name:"premium-3",human_name:"Premium 3",price:"$750/mo",retentionPeriod:"7 days"},{name:"premium-4",human_name:"Premium 4",price:"$1200/mo",retentionPeriod:"7 days"},{name:"premium-5",human_name:"Premium 5",price:"$2500/mo",retentionPeriod:"7 days"},{name:"premium-6",human_name:"Premium 6",price:"$3500/mo",retentionPeriod:"7 days"},{name:"premium-7",human_name:"Premium 7",price:"$6000/mo",retentionPeriod:"7 days"},{name:"premium-8",human_name:"Premium 8",price:"$8500/mo",retentionPeriod:"7 days"},{name:"premium-9",human_name:"Premium 9",price:"$11000/mo",retentionPeriod:"7 days"},{name:"private-0",human_name:"Private 0",price:"$300/mo",retentionPeriod:"7 days"},{name:"private-2",human_name:"Private 2",price:"$600/mo",retentionPeriod:"7 days"},{name:"private-3",human_name:"Private 3",price:"$1000/mo",retentionPeriod:"7 days"},{name:"private-4",human_name:"Private 4",price:"$1500/mo",retentionPeriod:"7 days"},{name:"private-5",human_name:"Private 5",price:"$2800/mo",retentionPeriod:"7 days"},{name:"private-6",human_name:"Private 6",price:"$3600/mo",retentionPeriod:"7 days"},{name:"private-7",human_name:"Private 7",price:"$7000/mo",retentionPeriod:"7 days"},{name:"private-8",human_name:"Private 8",price:"$10000/mo",retentionPeriod:"7 days"},{name:"private-9",human_name:"Private 9",price:"$13000/mo",retentionPeriod:"7 days"},{name:"shield-0",human_name:"Shield 0",price:"$350/mo",retentionPeriod:"7 days"},{name:"shield-2",human_name:"Shield 2",price:"$750/mo",retentionPeriod:"7 days"},{name:"shield-3",human_name:"Shield 3",price:"$1200/mo",retentionPeriod:"7 days"},{name:"shield-4",human_name:"Shield 4",price:"$1800/mo",retentionPeriod:"7 days"},{name:"shield-5",human_name:"Shield 5",price:"$3400/mo",retentionPeriod:"7 days"},{name:"shield-6",human_name:"Shield 6",price:"$4400/mo",retentionPeriod:"7 days"},{name:"shield-7",human_name:"Shield 7",price:"$8400/mo",retentionPeriod:"7 days"},{name:"shield-8",human_name:"Shield 8",price:"$12500/mo",retentionPeriod:"7 days"},{name:"shield-9",human_name:"Shield 9",price:"$16000/mo",retentionPeriod:"7 days"}];function qa(e){return $a.filter((function(t){if(t.name.startsWith(e))return!0})).map((function(e){return[e.human_name,e.price,e.name]}))}var Ba=[["Standard Tier",qa("standard")],["Premium Tier",qa("premium")]],za=[["Private Tier",qa("private")]],Ka=[["Shield Tier",qa("shield")]],Wa=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={plan:e.props.datastore.getIn(["meta","plan"])},e.handleChange=function(t){if(void 0!==t){var a=t.target.value,n=e.props.onChange;n&&n(a),e.setState({plan:a})}},e.getPlanLevel=function(e){return Number.parseInt(e.split("-")[1],10)},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.handleChange()}},{key:"plans",value:function(){return this.props.datastore.getIn(["details","shielded"])?Ka:this.props.datastore.getIn(["details","spaces"])?za:Ba}},{key:"planOptions",value:function(){return this.plans().map((function(e){var t=Object(P.a)(e,2),a=t[0],n=t[1].map((function(e){var t=Object(P.a)(e,3),a=t[0],n=t[1],r=t[2];return l.a.createElement("option",{value:r,key:r},a," (",n,")")}));return l.a.createElement("optgroup",{key:a,label:a},n)}))}},{key:"render",value:function(){var e=this.state.plan,t=this.props.datastore.getIn(["meta","plan"]),a=this.getPlanLevel(e)<this.getPlanLevel(t);return l.a.createElement("div",{className:"createPostgresForm"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{className:"hk-label dib",htmlFor:"plan"},"Plan"),l.a.createElement("select",{id:"plan",className:"hk-select w-100 db",value:e,onChange:this.handleChange},this.planOptions()),a&&l.a.createElement("p",{className:"red"},"The plan you have selected is smaller than the original plan. This may have adverse effects on database performance, and is not recommended.")))}}]),a}(l.a.Component),Ja=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={plan:e.props.datastore.getIn(["meta","plan"])},e.handleForkChange=function(t){e.setState({plan:t})},e.handleCollapse=function(){e.setState({plan:e.props.datastore.getIn(["meta","plan"])})},e.handleConfirm=function(){var t=e.props,a=t.dispatch,n=t.datastore,r=e.state.plan,s=n.getIn(["details","region"]),i="".concat(window.service.postgres,":").concat(r);Le.a.track("Postgres Database Fork Dispatched",Object(ve.a)({plan:i,region:s},Fe(n))),a({type:Fa.FORK,addonId:n.get("id"),plan:i,region:s})},e.handleGotIt=function(){var t=e.props,a=t.datastore;(0,t.dispatch)(Ha(a,Fa.FORK)),e.handleCollapse()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=Ua(e,Fa.FORK);if(t){var a;switch(t.get("state")){case Ze.PENDING:a=l.a.createElement(sa,{countdown:!1,title:"Creating a fork of your database",type:"inprogress"},l.a.createElement("p",null,"Once created, the fork may take a minute or two to be visible in your list of datastores."));break;case Ze.REJECTED:a=l.a.createElement(sa,{countdown:!1,title:"Failed to create a fork of your database",type:"warning"},l.a.createElement("p",null,"Yikes! The fork was not created due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{onClick:this.handleGotIt},"Got It")));break;case Ze.FULFILLED:a=l.a.createElement(sa,{countdown:!1,title:"Created a fork of your database",type:"success"},l.a.createElement("p",null,"Once created, the fork may take a minute or two to be visible in your list of datastores."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{onClick:this.handleGotIt},"Got It")))}return a}return l.a.createElement(vt,{actionText:"Fork Database\u2026",dangerous:!1,description:"Clone this database, creating an independent, unrelated copy.",title:"Fork Database",valid:!0,onCollapse:this.handleCollapse,onConfirm:this.handleConfirm},l.a.createElement(Wa,{datastore:e,onChange:this.handleForkChange}))}}]),a}(l.a.Component),Ya=Object(d.b)()(Ja),Va=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.forbidden,t=e.slice(0,e.length-1),a=e[e.length-1];return l.a.createElement("div",{className:"flex justify-center"},l.a.createElement("div",{className:"w-100 w-60-l bg-lightest-orange ba b--orange br1 pa2 tc orange"},l.a.createElement("p",{className:"f4 b"},"You do not have permission to ",t.join(", "),t.length>1&&",",t.length>0&&" or ",a," this database."),l.a.createElement("p",{className:"f5"},"For more details, please check the Dev Center articles on"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/collaborating#collaborator-permissions"},"collaborator")," or"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/org-users-access"},"organization")," ","permissions.")))}}]),a}(l.a.Component),Qa=g.a.mark(Za),Xa=new De;function Za(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.addonId,a.next=3,se([Xa,Xa.resetPostgres],t);case 3:case"end":return a.stop()}}),Qa)}var en=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={valid:!1},e.handleConfirmationChange=function(t){e.setState({valid:t})},e.handleCollapse=function(){e.setState({valid:!1})},e.handleConfirm=function(){var t=e.props.datastore;Le.a.track("Postgres Database Reset",Fe(t)),e.props.operation.trigger({addonId:t.get("id")})},e.handleGotIt=function(){e.setState({valid:!1}),e.props.operation.clear()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.datastore,a=e.operation,n=t.getIn(["meta","app_name"]),r=this.state.valid;switch(a.status){case void 0:return l.a.createElement(vt,{actionText:"Reset Database\u2026",dangerous:!0,description:"Reset the database to its originally-provisioned state, deleting all data inside it.",title:"Reset Database",valid:r,onCollapse:this.handleCollapse,onConfirm:this.handleConfirm},l.a.createElement("p",null,"This action will"," ",l.a.createElement("strong",null,"permanently destroy all of your data"),"."),l.a.createElement(La,{target:n,onChange:this.handleConfirmationChange,onEnter:this.handleConfirm}));case Ze.PENDING:return l.a.createElement(sa,{countdown:!1,title:"Resetting your database",type:"inprogress"},l.a.createElement("p",null,"Once reset, the reported utilization statistics may take a minute or two to update."));case Ze.REJECTED:return l.a.createElement(sa,{countdown:!1,title:"Failed to reset your database",type:"warning"},l.a.createElement("p",null,"Yikes! The database was not reset due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{onClick:this.handleGotIt},"Got It")));case Ze.FULFILLED:return l.a.createElement(sa,{countdown:!1,title:"Database was reset",type:"success"},l.a.createElement("p",null,"Once reset, the reported utilization statistics may take a minute or two to update."),l.a.createElement("div",{className:"actions"},l.a.createElement(S.HKButton,{onClick:this.handleGotIt},"Got It")))}}}]),a}(l.a.Component),tn=Et({generator:Za})(en);function an(e){var t=e.datastore;return l.a.createElement(vt,{actionText:"Show Configuration...",actionCollapseText:"Hide Configuration...",dangerous:!1,description:"Generate and manage PrivateLink endpoints to secure database access from outside your Private Space.",title:"Heroku Postgres via PrivateLink",hideActionButton:!0,valid:!0},l.a.createElement(na,{datastore:t}))}var nn=g.a.mark(sn),rn=new De;function sn(e,t){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se([rn,t?rn.deleteMTLS:rn.enableMTLS],e);case 2:return n.next=5,se([rn,rn.getMTLS],e);case 5:return a=n.sent,n.next=8,ie({type:Ct,payload:{id:e,mtls:Object(ve.a)({},a)}});case 8:if(!(t&&a||!t&&"Operational"!==a.status)){n.next=13;break}return n.next=11,ce(5e3);case 11:n.next=14;break;case 13:return n.abrupt("break",16);case 14:n.next=2;break;case 16:case"end":return n.stop()}}),nn)}var cn="Deprovisioning",ln="Provisioning",on="Operational",dn="Authorizing",un="Authorized",mn="pending",pn="ready",hn="disabled",fn="expired";function gn(e){var t=e.enabled,a=e.handleDismiss,n=e.show;return l.a.createElement(S.HKModal,{show:n,header:l.a.createElement("div",null,t?"Disable Mutual TLS":"Enable Mutual TLS"),onDismiss:a,buttons:[{text:"Cancel",type:"tertiary",value:"cancel"},{text:"OK",type:"primary",value:"ok"}]},!t&&l.a.createElement("p",{className:"pa4"},"Enabling Mutual TLS will allow external access to this data service. This action will be logged."),t&&l.a.createElement("p",{className:"pa4"},"Are you sure you want to disable mTLS?"))}gn.defaultProps={show:!1};var vn=Et({generator:sn})((function(e){var t=e.datastore,a=e.operation,n=Object(c.useState)(!1),r=Object(P.a)(n,2),s=r[0],i=r[1],o=t.get("mtls").get("status"),d=o===on;return l.a.createElement("div",null,l.a.createElement("div",{className:"flex justify-between pv4 bt b--silver"},l.a.createElement("div",{className:"flex flex-column"},l.a.createElement("div",{className:"flex items-center w-70"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.ErrorBadge16,size:16,fill:d?S.Fills.GradientGreen:S.Fills.GradientDarkGray,className:"mr2 flex-shrink-0"}),l.a.createElement("div",{className:"dark-gray lh-copy"},"Secure database access is"," ",l.a.createElement("span",{className:"b"},function(e,t){return t===ln?"provisioning":t===cn?"deprovisioning":e?"enabled":"not enabled"}(d,o))),(o===ln||o===cn)&&l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:16,fill:S.Fills.GradientDarkGray,className:"ml2 flex-shrink-0"})),l.a.createElement("p",{className:"lh-copy dark-gray"},"When enabled, generate and download client certificates to allow access to this database from outside your Shield Space.")),l.a.createElement(S.HKButton,{className:"ml4",type:d?"danger":"primary",onClick:function(){i(!0)},async:a.status===w.PENDING||o===ln||o===cn},d?"Disable":"Enable"),l.a.createElement(gn,{enabled:d,show:s,handleDismiss:function(e){if("ok"===e){var n=t.get("id");a.trigger(n,d)}i(!1)}})))})),bn=a(578),En=a(834),yn=function(){var e=Object(v.a)(g.a.mark((function e(t){var a,n,r,s,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.addonUUID,n=t.accessToken,r=t.certificateId,e.next=3,fetch("".concat(xe.b.REACT_APP_SHOGUN_API_URL,"/postgres/v0/databases/").concat(a,"/tls-endpoint/certificates/").concat(r,"/bundle.zip"),{headers:{Authorization:"Basic ".concat(btoa(":".concat(n)))}});case 3:return s=e.sent,e.next=6,s.blob();case 6:i=e.sent,Object(En.saveAs)(i,"bundle.zip");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kn=a(104),wn=g.a.mark(On),Cn=new De;function On(e){var t,a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se([Cn,Cn.createMTLSCertificate],e);case 2:t=n.sent;case 3:return n.next=6,se([Cn,Cn.getMTLS],e);case 6:return a=n.sent,n.next=9,ie({type:Ct,payload:{id:e,mtls:Object(ve.a)({},a)}});case 9:if(y.a.find(a.certificates,(function(e){return e.id===t.id})).status===pn){n.next=15;break}return n.next=13,ce(5e3);case 13:n.next=16;break;case 15:return n.abrupt("break",18);case 16:n.next=3;break;case 18:case"end":return n.stop()}}),wn)}var Nn=g.a.mark(_n),In=new De;function _n(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.addonUUID,a=e.id,r.next=3,se([In,In.deleteMTLSCertificate],{addonUUID:t,id:a});case 3:return n=r.sent,r.next=6,ie({type:_t,payload:{addonUUID:t,id:n.id}});case 6:case"end":return r.stop()}}),Nn)}var xn=Et({generator:_n})((function(e){var t=e.certificate,a=e.addonUUID,n=e.operation,r=Object(kn.c)().user,s=t.get("status");return l.a.createElement("div",{className:"flex justify-between items-center pb2"},l.a.createElement("div",{className:"flex items-center flex-1"},s===mn&&l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:16,fill:S.Fills.GradientGray,className:"mr1"}),s===pn&&l.a.createElement(S.HKIcon,{name:S.ProductIcons.SuccessRing16,size:16,fill:S.Fills.GradientGreen,className:"mr1"}),l.a.createElement("span",{className:"dark-gray"},t.get("id"))),s===mn&&l.a.createElement("div",{className:"dark-gray flex-1"},"Certificate is provisioning"),s===pn&&l.a.createElement("div",{className:"dark-gray flex-1"},"Expires ",Ie()(t.get("expires_at")).format("MMMM Do YYYY")),l.a.createElement("div",null,l.a.createElement(S.HKDropdown,{name:"cert-dropdown",align:"right"},l.a.createElement("li",{className:G()("hk-dropdown-item",{"cursor-not-allowed":s===mn})},l.a.createElement("div",{className:"flex items-center",onClick:function(){return"ready"===s?yn({addonUUID:a,certificateId:t.get("id"),accessToken:r.access_token}):null}},l.a.createElement(S.HKIcon,{name:S.ProductIcons.DirectionDown16,size:16,fill:S.Fills.GradientDarkGray,className:"mr1"}),l.a.createElement("span",{className:"dark-gray"},"Download certificate bundle"))),l.a.createElement("li",{className:"hk-dropdown-divider"}),l.a.createElement("li",{className:"hk-dropdown-item--danger"},l.a.createElement("div",{className:"flex items-center",onClick:function(){n.trigger({addonUUID:a,id:t.get("id")})}},l.a.createElement(S.HKIcon,{name:S.ProductIcons.ErrorRing16,size:16,fill:S.Fills.GradientRed,className:"mr1"}),l.a.createElement("span",null,"Revoke certificate"))))))}));var Tn=Object(bn.d)(m.g,Et({generator:On}))((function(e){var t=e.certificates,a=e.match,n=e.operation,r=a.params.id;return l.a.createElement("div",{className:"bb bt b--silver pb4"},l.a.createElement("div",{className:"f5 b pv4 dark-gray"},"Client Certificate Bundles"),!!t&&0===t.size&&l.a.createElement("div",{className:"f5 i flex items-center dark-gray pb4"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.InfoRing16,size:16,fill:S.Fills.GradientDarkGray,className:"mr1"}),l.a.createElement("span",null,"No active client certificates")),t.size>0&&l.a.createElement("div",{className:"pb4"},t.map((function(e){return l.a.createElement(xn,{addonUUID:r,key:e.get("id"),certificate:e})}))),l.a.createElement(S.HKButton,{type:"primary",onClick:function(){return n.trigger(r)},async:n.status===w.PENDING},"Generate New Certificate"))})),Dn=g.a.mark(jn),Sn=new De;function jn(e){var t,a,n,r,s,i;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.id,a=e.cidr,n=e.description,c.next=3,se([Sn,Sn.createMTLSIPRule],{addonUUID:t,cidr:a,description:n});case 3:r=c.sent;case 4:return c.next=7,se([Sn,Sn.getMTLS],t);case 7:return s=c.sent,c.next=10,ie({type:Ct,payload:{id:t,mtls:Object(ve.a)({},s)}});case 10:if(!(i=y.a.find(s.ipRules,(function(e){return e.id===r.id})))||i.status===un){c.next=16;break}return c.next=14,ce(5e3);case 14:c.next=17;break;case 16:return c.abrupt("break",19);case 17:c.next=4;break;case 19:case"end":return c.stop()}}),Dn)}var An=g.a.mark(Pn),Rn=new De;function Pn(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.addonUUID,a=e.id,r.next=3,se([Rn,Rn.deleteMTLSIPRule],{addonUUID:t,id:a});case 3:return n=r.sent,r.next=6,ie({type:It,payload:{addonUUID:t,id:n.id}});case 6:case"end":return r.stop()}}),An)}var Ln=Et({generator:Pn})((function(e){var t=e.addonUUID,a=e.ipRule,n=e.operation,r=a.get("status");return l.a.createElement("div",{className:"flex justify-between pb2"},l.a.createElement("div",{className:"w-80 flex"},l.a.createElement(S.HKTextField,{className:"flex-1",value:a.get("cidr"),disabled:!0}),l.a.createElement(S.HKTextField,{className:"flex-1 ml2",value:a.get("description",""),disabled:!0})),r===dn&&l.a.createElement("div",{className:"h-100 v-mid"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,size:12,fill:S.Fills.GradientGray,className:"pr3"})),r===un&&l.a.createElement(S.HKButton,{type:"tertiary",className:"button-reset",async:n.status===w.PENDING,onClick:function(){n.trigger({addonUUID:t,id:a.get("id")})}},l.a.createElement(S.HKIcon,{name:S.ProductIcons.EditReject16,size:12,fill:S.Fills.GradientRed})))}));var Un=Et({generator:jn})((function(e){var t=e.addonUUID,a=e.ipRules,n=e.operation,r=Object(c.useState)(""),s=Object(P.a)(r,2),i=s[0],o=s[1],d=Object(c.useState)(""),u=Object(P.a)(d,2),m=u[0],p=u[1],h=Object(c.useState)(!1),f=Object(P.a)(h,2),g=f[0],v=f[1],b=Object(c.useState)(null),E=Object(P.a)(b,2),y=E[0],k=E[1],C=function(e){return/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/gim.exec(e)?(v(!1),!1):(v(!0),!0)};return Object(c.useEffect)((function(){(n.status===w.FULFILLED&&(o(""),n.clear()),n.error)&&(n.error.errors&&-1!==n.error.errors[0].message.indexOf("422")?k("Your IP address range is not properly formatted or is a duplicate"):k("Something went wrong, please try again"));n.status||k(null)}),[n]),l.a.createElement("div",null,l.a.createElement("div",{className:"f5 b pt4 dark-gray"},"Allowed IPs"),l.a.createElement("p",{className:"dark-gray"},"Add the external IP address and IP ranges allowed to securily connect to this database using client certificates."),a.size>0&&a.map((function(e){return l.a.createElement(Ln,{key:e.get("id"),addonUUID:t,ipRule:e})})),l.a.createElement("div",{className:"flex justify-between"},l.a.createElement("div",{className:"w-80 flex"},l.a.createElement(S.HKTextField,{className:G()("flex-1",{"b--red":g}),placeholder:"172.16.1.180/72",value:i,onChange:function(e){o(e.target.value),g&&C(e.target.value)}}),l.a.createElement(S.HKTextField,{className:"flex-1 ml2",placeholder:"description",value:m,onChange:function(e){return p(e.target.value)}})),l.a.createElement(S.HKButton,{type:"primary",onClick:function(){C(i)||(k(null),n.trigger({id:t,cidr:i,description:m}))},async:n.status===w.PENDING},"Add")),g&&l.a.createElement("div",{className:"red b pt1"},"Your IP address range is not properly formatted"),y&&l.a.createElement("div",{className:"red b pt1"},y))}));function Hn(e){var t=e.certificate,a="expired"===t.get("status");return l.a.createElement("div",{className:"flex items-center pb2"},l.a.createElement("div",{className:"flex items-center pr3 flex-1"},l.a.createElement(S.HKIcon,{name:a?S.ProductIcons.Time16:S.ProductIcons.ErrorRing16,size:16,fill:S.Fills.GradientDarkGray,className:"mr1"}),l.a.createElement("span",null,t.get("id"))),l.a.createElement("div",{className:"flex-1"},a?"Expired":"Revoked"," ",Ie()(t.get("expires_at")).format("MMMM Do YYYY")))}var Fn=function(e){var t=e.certificates;return 0===t.size?null:l.a.createElement("div",{className:"bt b--silver mt4"},l.a.createElement("div",{className:"f5 b pb2 pt4 dark-gray"},"Revoked & Expired Certificates"),t.map((function(e){return l.a.createElement(Hn,{key:e.get("id"),certificate:e})})))},Mn=g.a.mark(qn),Gn=new De,$n=function(e){return!(!e||e.status===on)||(!!(e&&e.certificates&&e.certificates.some((function(e){return e.status===mn})))||!!(e&&e.ipRules&&e.ipRules.some((function(e){return e.status===dn}))))};function qn(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,se([Gn,Gn.getMTLS],e);case 3:return t=a.sent,a.next=6,ie({type:Ct,payload:{id:e,mtls:Object(ve.a)({},t)}});case 6:if(!$n(t)){a.next=11;break}return a.next=9,ce(5e3);case 9:a.next=12;break;case 11:return a.abrupt("break",14);case 12:a.next=0;break;case 14:case"end":return a.stop()}}),Mn)}function Bn(){return l.a.createElement("section",{className:"loading flex flex-column justify-center items-center pt7 pb7"},l.a.createElement("h1",{className:"normal dark-gray"},"Loading"),l.a.createElement(ee.a,{className:"mv1"}))}var zn=Et({generator:qn})((function(e){var t=e.datastore,a=e.operation,n=t.get("mtls"),r=t.get("id");if(Object(c.useEffect)((function(){a.trigger(r)}),[]),!n)return l.a.createElement(Bn,null);var s=n.get("status")===on,i=n.get("certificates",[]),o=i.filter((function(e){var t=e.get("status");return t===pn||t===mn})),d=i.filter((function(e){var t=e.get("status");return t===fn||t===hn})),u=n.get("ipRules",[]);return l.a.createElement("div",null,l.a.createElement("div",{className:"mw8 ml-auto"},l.a.createElement(vn,{datastore:t}),s&&l.a.createElement(Tn,{certificates:o}),s&&l.a.createElement(Un,{addonUUID:r,ipRules:u}),s&&l.a.createElement(Fn,{certificates:d})))}));function Kn(e){var t=e.datastore;return l.a.createElement(vt,{actionText:"Show Configuration...",actionCollapseText:"Hide Configuration...",description:"Configure and manage secure database access from outside of your Private Space.",title:"Secure External Database Access",hideActionButton:!0,valid:!0},l.a.createElement(zn,{datastore:t}))}var Wn=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.datastore,a=e.hideLegacyCredentials,n=t.getIn(["details","hobby"]),r=t.getIn(["details","shielded"]),s=t.getIn(["details","following"]),i=t.getIn(["meta","plan"]).startsWith("private"),c=t.getIn(["details","canManageAddons"]),o=c&&(i||r),d=!n&&!s,u=!s,m=c&&(i||r),p=[],h=[];return!r&&!a&&p.push(l.a.createElement(Pa,{key:"creds",datastore:t})),d&&(c?p.push(l.a.createElement(Ya,{key:"fork",datastore:t})):h.push("create forks of")),u&&p.push(l.a.createElement(tn,{key:"reset",datastore:t})),m&&p.push(l.a.createElement(an,{key:"privatelink",datastore:t})),o&&p.push(l.a.createElement(Kn,{key:"mtls",datastore:t})),c?p.push(l.a.createElement(Ga,{key:"destroy",datastore:t})):h.push("destroy"),l.a.createElement(Ke,{title:"Administration",className:"postgresAdminSection"},!c&&l.a.createElement(Va,{forbidden:h}),l.a.createElement("div",{className:"hk-hide-bb-last-row"},p))}}]),a}(l.a.Component);Wn.defaultProps={hideLegacyCredentials:!1};var Jn=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleCaptureBackup=function(){e.props.captureBackup()},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.isCapturing;t.datastore.getIn(["details","num_bytes"],0)>21474836480&&(e=l.a.createElement("p",{className:"f5 mt0 gray lh-copy mw6 center mb5"},"Manual and scheduled backups on datastores larger than 20GB may not successfully complete. However, your data is still safe with"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-data-safety-and-continuous-protection",target:"_blank",rel:"noopener noreferrer"},"Continuous Protection and Heroku Rollbacks"),"."));var n=l.a.createElement(S.HKButton,{type:"primary",disabled:a,onClick:this.handleCaptureBackup},a?l.a.createElement(ee.a,{button:!0}):"Create Manual Backup");return l.a.createElement("div",{className:"tc"},l.a.createElement("h3",{className:"normal f1 purple mb1"},"Manual Backups & Data Exports"),l.a.createElement("div",{className:"flex justify-center"},l.a.createElement("p",{className:"mw7 lh-copy"},l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-backups",target:"_blank",rel:"noopener noreferrer"},"Learn more")," ","about creating exportable copies of your data to use for testing or development, or as additional backups, with pg:backups.")),l.a.createElement("p",null,n),e)}}]),a}(l.a.Component),Yn=a(544),Vn=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isDeleting:!1},e.handleDownloadBackup=function(){var t=e.props,a=t.backup,n=t.datastore;Le.a.track("Postgres Backup Downloaded",Object(ve.a)({size:a.get("processed_bytes"),created:a.get("created_at"),name:a.get("readable_name")},Fe(n)));var r=new De,s=a.get("addon_uuid"),i=a.get("uuid");r.generatePostgresBackupUrl(s,i).then((function(e){window.location.href=e.generatePostgresBackupUrl.url})).catch((function(e){k.a.error("Unable to generate a backup download URL for '".concat(s,"/").concat(i,": ").concat(Object(Yn.inspect)(e,{depth:null})))}))},e.handleRemoveBackup=function(){var t=e.props,a=t.backup,n=t.datastore,r=t.dispatch;Le.a.track("Postgres Backup Deleted",Object(ve.a)({size:a.get("processed_bytes"),created:a.get("created_at"),name:a.get("readable_name")},Fe(n))),e.setState({isDeleting:!0}),r({type:Fa.DESTROY_BACKUP,addonId:n.get("id"),backupId:a.get("uuid")})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.backup,t=this.state.isDeleting,a=e.get("finished_at"),n=e.get("succeeded"),r=e.get("processed_bytes"),s=r?ze()(r).format("0.0 b"):"N/A",i=a&&n,c=t?l.a.createElement("td",{className:"tr pa3 f4 bb b--light-silver"},l.a.createElement(S.HKButton,{type:"danger",small:!0,disabled:!0},l.a.createElement(ee.a,{button:!0}))):l.a.createElement("td",{className:"tr pa3 f4 bb b--light-silver"},l.a.createElement(S.HKButton,{type:"secondary",small:!0,onClick:this.handleDownloadBackup,value:"Download"},"Download"),l.a.createElement(S.HKButton,{type:"danger",small:!0,onClick:this.handleRemoveBackup,className:"ml2",value:"Delete"},"Delete")),o=a&&!n&&l.a.createElement("span",{className:"ml1 hk-badge--alpha"},"Failed");return l.a.createElement("tr",{className:G()("hover-bg-near-white",{"o-05":t})},l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},e.get("readable_name")),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},s),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},e.get("from_name")),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},l.a.createElement(B.a,{date:e.get("created_at")})),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver",colSpan:a?"1":"2"},l.a.createElement(B.a,{placeholder:"processing",date:e.get("finished_at")}),o),i?c:null)}}]),a}(l.a.Component),Qn=Object(d.b)()(Vn);function Xn(e){return e.getIn(["details","backups"]).filterNot((function(e){return/^[cr]/i.test(e.get("readable_name"))}))}var Zn=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isExpanded:!1},e.handleCaptureBackup=function(){e.props.captureBackup()},e.handleExpandResults=function(){e.setState({isExpanded:!0})},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this,a=this.state.isExpanded,n=this.props,r=n.numberOfItems,s=n.isCapturing,i=this.props.datastore,c=Xn(i),o=a?c:c.slice(0,r),d=c.size>r,u=o.map((function(e){return l.a.createElement(Qn,{key:e.get("uuid"),datastore:t.props.datastore,backup:e})})),m=l.a.createElement(S.HKButton,{type:"primary",small:!0,disabled:s,onClick:this.handleCaptureBackup,className:"mt1 absolute top-0 right-0"},s?l.a.createElement(ee.a,{button:!0}):"Create Manual Backup"),p=!a&&d&&l.a.createElement("tr",null,l.a.createElement("td",{colSpan:"5",className:"tc"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleExpandResults,className:"mt4"},"View All Backups")),l.a.createElement("td",null));return i.getIn(["details","num_bytes"],0)>21474836480&&(e=l.a.createElement("span",null,"Manual or scheduled backups on datastores larger than 20GB may not successfully complete. However, your data is still safe with"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-data-safety-and-continuous-protection",target:"_blank",rel:"noopener noreferrer"},"Continuous Protection and Heroku Rollbacks"),".")),l.a.createElement("div",{className:"postgresBackupsTable flex flex-row flex-wrap w-100"},l.a.createElement("div",{className:"mb2 lh-copy f5 mw8"},l.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://devcenter.heroku.com/articles/heroku-postgres-backups"},"Learn more")," ","about data exports and backups.",e),l.a.createElement("div",{className:"mr3 w-100 relative"},m),l.a.createElement("div",{className:"flex-auto mb0"},l.a.createElement("table",{className:"w-100 collapse"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Name"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Size"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Database"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Created"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Finished"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tr"}))),l.a.createElement("tbody",null,u,p))))}}]),a}(l.a.Component);Zn.defaultProps={numberOfItems:10};var er=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isCapturing:!1},e.captureBackup=function(){e.setState({isCapturing:!0});var t=e.props,a=t.datastore,n=t.dispatch,r=0===Xn(a).size;window.setTimeout((function(){e.setState({isCapturing:!1})}),Ie.a.duration(5,"seconds").asMilliseconds()),n({type:Fa.CREATE_BACKUP,addonId:a.get("id")}),Le.a.track("Postgres Backup Captured",Object(ve.a)({fromBlankSlate:r},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.datastore;"capture_backup"===Object(H.parse)(t.search).heroku_action&&(this.captureBackup(),this.props.history.replace("/datastores/".concat(a.get("id"))),this.node&&this.node.scrollIntoView&&this.node.scrollIntoView())}},{key:"content",value:function(e){var t=this.props.datastore,a=this.state.isCapturing,n={captureBackup:this.captureBackup,datastore:t,isCapturing:a};return t.getIn(["details","shielded"])?l.a.createElement("div",{className:"tc"},l.a.createElement("h3",{className:"f1 purple normal"},"Data Exports Unavailable"),l.a.createElement("div",{className:"flex justify-center"},l.a.createElement("p",{className:"mw7 lh-copy"},l.a.createElement("p",null,"Shield plans are kept safe by continuous protection. Logical backups are not allowed on Shield plans in accordance with our compliance policies."),l.a.createElement("p",null,l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgresql#shielded_plans",target:"_blank",rel:"noopener noreferrer"},"Learn more"))))):e.size>0?l.a.createElement(Zn,n):l.a.createElement(Jn,n)}},{key:"render",value:function(){var e=Xn(this.props.datastore),t=e.size>0?"Manual Backups & Data Exports":"";return l.a.createElement(Ke,{title:t,className:"postgresBackupsSection"},this.content(e))}}]),a}(l.a.Component),tr=Object(d.b)()(Object(m.g)(er)),ar=a(166),nr=a.n(ar),rr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"flex br2 pa2 ma2 ba bg-lightest-blue blue b--light-blue blue f4 lh-title"},l.a.createElement(o.a,{name:"info-badge-16",size:16,fillClass:"blue",extraClasses:"mr1 flex-none"}),this.props.children)}}]),a}(l.a.Component),sr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={name:{valid:null,error:""}},e.handleNameChange=function(t){e.setState({name:e.checkCredentialName(t.target.value)})},e.handleCancel=function(t){e.props.onCancel()},e.handleCreate=function(t){var a=e.state.name;if(a.valid){e.purgeChange();var n=nr.a.v4();e.setState({changeId:n}),e.props.dispatch({type:Fa.ADD_CREDENTIAL,addonId:e.props.datastore.get("id"),name:a.value,changeId:n})}},e.purgeChange=function(){var t=e.state.changeId;if(t){var a=e.props.datastore.get("id");e.props.dispatch({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:a,changeId:t}}),e.setState({changeId:void 0})}},e.handleDone=function(){e.purgeChange(),e.props.onDone()},e.checkCredentialName=function(t){var a;return t&&0!==t.length?t.length>50?a="Credential names have a maximum length of 50 characters.":t.endsWith("-rotating")?a="Credential name must not end with '-rotating'.":/^[\w-]+$/.test(t)?e.props.datastore.getIn(["details","credentials_list"]).some((function(e){return e.get("name")===t}))?a="Credential '".concat(t,"' already exists."):["none","public"].includes(t)&&(a="Credential name '".concat(t,"' is reserved.")):a="Credential name must consist only of ASCII letters, numbers, underscores, and dashes.":a="Credential name must not be empty.",Object.assign({},e.state.name,{value:t,error:a,valid:void 0===a})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=this.state,a=t.name,n=t.changeId,r="https://devcenter.heroku.com/articles/heroku-postgresql-credentials",s=e.get("changes",new U.a.Map).find((function(e){return e.get("changeId")===n}));if(!s)return l.a.createElement("div",null,l.a.createElement("h3",{className:"f3 normal purple mb2 pb2 bb b--light-silver"},"New Postgres Credential"),l.a.createElement("div",{className:"pv2"},l.a.createElement("label",{className:"f5 b dark-gray mb0 flex-none tr pr2 border-box",htmlFor:"createCredentialName"},"Credential Name"),l.a.createElement("div",{className:"mv1 flex-auto"},l.a.createElement("input",{id:"createCredentialName",autoCorrect:"off",onChange:this.handleNameChange,className:G()("hk-input","flex-none",{"b--red":!1===a.valid,"b--green":!0===a.valid})}),a.error&&l.a.createElement("div",{className:G()("mt2",{red:!1===a.valid})},a.error))),l.a.createElement("div",{className:"pv2"},l.a.createElement(S.HKButton,{disabled:!a.valid||!1,type:"primary",onClick:this.handleCreate},"Create"),l.a.createElement(S.HKButton,{type:"tertiary",className:"ml1",onClick:this.handleCancel},"Cancel"),l.a.createElement("div",{className:"gray f5 mt3 pt3 bt b--light-silver"},l.a.createElement("p",null,"Credentials permit fine-grained access control to your database."," ",l.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},"Learn More")))));switch(s.get("state")){case Ze.PENDING:return l.a.createElement(sa,{countdown:!1,title:"Initiating credential creation: \u201c".concat(a.value,"\u201d"),type:"inprogress"});case Ze.FULFILLED:return l.a.createElement(sa,{countdown:!1,title:"Credential is being created: \u201c".concat(a.value,"\u201d"),type:"success"},l.a.createElement("p",null,"This can take a few minutes. After creation, attach it to some apps or set permissions."),l.a.createElement("p",null,"Learn how to configure your new credential in"," ",l.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},"Dev Center"),"."),l.a.createElement("div",{className:"actions tc"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleDone},"Got It")));case Ze.REJECTED:return l.a.createElement(sa,{countdown:!1,title:"Unable to create your credential: \u201c".concat(a.value,"\u201d"),type:"warning"},l.a.createElement("p",null,"Could not create the credential due to an internal error. Sorry about that!"),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"actions tc"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleDone},"Got It")))}}}]),a}(l.a.Component),ir=Object(d.b)()(sr),cr=a(837),lr=a.n(cr),or=a(841),dr={control:function(e,t){var a=t.isFocused;return Object(ve.a)(Object(ve.a)({},e),{},{borderRadius:"4px",padding:"1px",minHeight:"auto",borderWidth:"1px",borderStyle:"solid",borderColor:a?"#79589f":"#cfd7e6",boxShadow:a?"0 0 0 2px rgba(157,112,208,0.4)":"inset 0 1px 2px 0 rgba(207,215,230,0.4)","&:hover":{borderColor:a?"#79589f":"#cfd7e6"}})},option:function(e,t){var a=t.isFocused,n=t.isSelected;return Object(ve.a)(Object(ve.a)({},e),{},{backgroundColor:a?"#f7f8fb":"white",color:n?"black":"#596981",fontWeight:n?"bold":"normal","&:hover":{backgroundColor:"#f7f8fb",color:n?"black":"#4e535a"}})},clearIndicator:function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},{padding:"2px 4px"})},dropdownIndicator:function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},{padding:"2px 4px"})},singleValue:function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},{overflow:"visible",width:"100%"})},placeholder:function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},{color:"#CFD7E6"})},valueContainer:function(e,t){return Object(ve.a)(Object(ve.a)({},e),{},{minHeight:"28px"})}},ur=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).prepareOptions=Object(va.a)((function(e){return e.toJS().map((function(e){return{value:e.id,label:e.name}}))})),e.handleChange=function(t){e.props.onChange(t)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.apps,a=e.disabled,n=e.className,r=e.value,s=this.prepareOptions(t);return l.a.createElement("div",{className:G()("appChooser","reactSelect",n)},l.a.createElement(or.a,{styles:dr,value:s.find((function(e){return e.value===r})),placeholder:"Select an app",options:s,onChange:this.handleChange,isDisabled:a,isClearable:!0,instanceId:"appChooser-select"}))}}]),a}(l.a.Component);ur.defaultProps={onChange:function(){}};var mr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={app:null},e.handleAttachChoiceChange=function(t){e.clearLastFailure(),e.setState({app:t})},e.clearLastFailure=function(){var t=e.props.datastore,a=e.state.changeId;if(a){var n=t.get("changes",new U.a.Map).find((function(e){return e.get("changeId")===a&&e.get("state")===Ze.REJECTED&&[Fa.ATTACH_CREDENTIAL,Fa.DETACH_CREDENTIAL].includes(e.get("type"))}));n&&e.props.dispatch({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:t.get("id"),changeId:a,type:n.get("type")}})}e.setState({changeId:void 0})},e.handleAttach=function(){e.clearLastFailure();var t=e.props.credential.toUpperCase().replace(/-/g,"_").replace(/^([0-9])/,"X$1"),a=nr.a.v4(),n=e.state.app.value;e.setState({changeId:a,app:null}),e.props.dispatch({type:Fa.ATTACH_CREDENTIAL,addonId:e.props.datastore.get("id"),name:e.props.credential,appId:n,attachment:t,changeId:a})},e.handleDetach=function(t){e.clearLastFailure();var a=nr.a.v4();e.setState({changeId:a,detachingId:t}),e.props.dispatch({type:Fa.DETACH_CREDENTIAL,addonId:e.props.datastore.get("id"),attachment:t,changeId:a})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.datastore,n=t.attachments,r=t.credential,s=t.apps,i=this.state,c=i.changeId,o=i.detachingId,d=a.get("changes",new U.a.Map).find((function(e){return e.get("changeId")===c})),u=d&&d.get("type")===Fa.ATTACH_CREDENTIAL,m=d&&d.get("type")===Fa.DETACH_CREDENTIAL,p=d&&d.get("state")===Ze.PENDING,h=d&&d.get("state")===Ze.REJECTED,f=a.getIn(["meta","app_uuid"]),g=n.filter((function(e){return e.get("app_uuid")===f})).size,v=n.map((function(t){var a="default"===r&&1===g&&t.get("app_uuid")===f,n=a?"Cannot remove last attachment to the billing app for the default credential":"",s=m&&p&&o===t.get("id");return l.a.createElement("div",{className:"attachment mb1",key:t.get("id")},l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1"},t.get("name"))," ","on ",t.get("app_name")," ",l.a.createElement(S.HKButton,{type:"danger",small:!0,async:s,className:"ml2",disabled:p||a,title:n,onClick:function(){e.handleDetach(t.get("id"))}},"Detach"))}));return l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Attachments"),l.a.createElement("dd",{className:"ml0 mt3"},v,l.a.createElement("div",{className:"flex flex-row items-center"},l.a.createElement(ur,{disabled:d&&p,value:this.state.app,className:"flex-auto mw6 mr2",onChange:this.handleAttachChoiceChange,apps:s.filter((function(e){return n.every((function(t){return t.get("app_uuid")!==e.get("id")}))}))}),l.a.createElement(S.HKButton,{type:"primary",async:u&&p,disabled:!this.state.app||d&&p,onClick:this.handleAttach},"Add Attachment")),h&&l.a.createElement("div",{className:"red ml2 mt2"},l.a.createElement("p",null,"Could not ",u?"attach":"detach"," credentials due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."))))}}]),a}(l.a.Component),pr=Object(d.b)((function(e){return{apps:e.apps.get("all")}}))(mr),hr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleClick=function(t){if(t.preventDefault(),!["revoking","rotating","wait_for_provisioning","provisioning"].includes(e.props.credential.get("state"))){var a=e.props,n=a.isExpanded,r=a.onCollapse,s=a.onExpand;n?r():s()}},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.attachments,n=t.credential,r=t.isExpanded,s=y.a.uniq(a.toJS().map((function(e){return e.app_name}))).length,i=n.get("name"),c=!["revoking","rotating","wait_for_provisioning","provisioning"].includes(n.get("state"));switch(n.get("state")){case"rotating":e=l.a.createElement("div",{className:"hk-badge bg-orange ttu b"},"Rotating"," ",l.a.createElement(o.a,{name:"loading-16",size:12,fillClass:"fill-white",extraClasses:"v-tbtm ml1 mv0"}));break;case"revoking":e=l.a.createElement("div",{className:"hk-badge bg-red ttu b"},"Destroying"," ",l.a.createElement(o.a,{name:"loading-16",size:12,fillClass:"fill-white",extraClasses:"v-tbtm ml1 mv0"}));break;case"wait_for_provisioning":case"provisioning":e=l.a.createElement("div",{className:"hk-badge bg-purple ttu b"},"Creating"," ",l.a.createElement(o.a,{name:"loading-16",size:12,fillClass:"fill-white",extraClasses:"v-tbtm ml1 mv0"}))}var d=l.a.createElement(o.a,{name:"nav-forward-16",size:16,fillClass:"purple",extraClasses:G()("v-tbtm accordionIndicator",{isExpanded:r})}),u={pointer:c,"hover-bg-near-white":c,"cursor-not-allowed":!c};return l.a.createElement("header",{className:G()("postgresCredentialHeader flex items-center pv2",u),onClick:this.handleClick},l.a.createElement("div",{className:"nowrap flex-none w6 pv1"},l.a.createElement("h4",{className:"normal black truncate ma0 pa0 mr3"},l.a.createElement("span",{className:"dib w3"},d),i)),l.a.createElement("div",{className:"truncate flex-auto pv1"},l.a.createElement(o.a,{name:"app-16",size:16,fillClass:"purple",extraClasses:"v-ttop"}),l.a.createElement("span",{className:"pl1"},s," ",Object(qe.pluralize)(s,"app"))),l.a.createElement("div",{className:"flex-none"},l.a.createElement("div",{className:"flex flex-row pt1 items-center mr2"},e)))}}]),a}(l.a.Component);hr.defaultProps={isDisabled:!1,isExpanded:!1};var fr,gr=function(e){var t=e.message;return l.a.createElement("div",{className:"f5"},l.a.createElement(o.a,{name:"warning-badge-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ",t," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgresql-credentials#managing-permissions",target:"_blank",rel:"noopener noreferrer"},"Learn more about managing permissions with the Heroku CLI."))},vr={NONE:"No permissions",READONLY:"Read-only permissions",READWRITE:"Read and write permissions",FULL:"Full permissions",CUSTOM:"Custom permissions"},br=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).isSelectable=function(e){return!["CUSTOM","FULL"].includes(e)},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentPermission,n=t.disabled,r=t.id,s=t.onChange,i=t.onlyUserSelectable,c=Object.keys(vr).filter((function(t){return i?e.isSelectable(t):t})).map((function(t){return l.a.createElement("option",{value:t,key:t,disabled:!e.isSelectable(t)},vr[t])}));return l.a.createElement("select",{id:r,onChange:s,disabled:n,className:G()("hk-select",{"hk-select--disabled":n}),value:a},c)}}]),a}(l.a.Component);br.defaultProps={disabled:!1,onlyUserSelectable:!1};var Er={NONE:"NONE",READONLY:"READONLY",READWRITE:"READWRITE",FULL:"FULL",CUSTOM:"CUSTOM"},yr="relation",kr="sequence",wr=function(){function e(t){Object(n.a)(this,e),this.database=t,this.schemasByOid=t.get("schemas").reduce((function(e,t){return e[t.get("oid")]=t,e}),{}),this.relsByOid=t.get("schemas").reduce((function(e,t){return t.get("relations").reduce((function(e,t){return e[t.get("oid")]=t,e}),e)}),{}),this.seqsByOid=t.get("schemas").reduce((function(e,t){return t.get("sequences").reduce((function(e,t){return e[t.get("oid")]=t,e}),e)}),{}),this.relToSchema=t.get("schemas").reduce((function(e,t){return t.get("relations").reduce((function(e,a){return e[a.get("oid")]=t,e}),e)}),{}),this.seqToSchema=t.get("schemas").reduce((function(e,t){return t.get("sequences").reduce((function(e,a){return e[a.get("oid")]=t,e}),e)}),{}),this.rolesByName=t.get("roles").reduce((function(e,t){return e[t.get("name")]=t,e}),{})}return Object(r.a)(e,[{key:"hasRole",value:function(e,t){var a=this;if(e===t)return!0;var n=this.rolesByName[e];if(!n)return!1;var r=n.get("memberships").reduce((function(e,t){return e[t]=void 0,e}),{});do{Object.entries(r).filter((function(e){var t=Object(P.a)(e,2);t[0];return void 0===t[1]})).forEach((function(e){var n=Object(P.a)(e,2),s=n[0];n[1];if(s===t)r[s]=!0;else{r[s]=!1;var i=a.rolesByName[s];i&&i.get("memberships").forEach((function(e){e in r||(r[e]=void 0)}))}}))}while(Object.values(r).some((function(e){return void 0===e})));return Object.values(r).some((function(e){return e}))}},{key:"owns",value:function(e,t){return this.hasRole(t,e.get("owner"))}},{key:"ownsEverything",value:function(e){var t=this;return this.owns(this.database,e)&&this.relations.every((function(a){return t.owns(a,e)}))&&this.sequences.every((function(a){return t.owns(a,e)}))&&this.userSchemas.every((function(a){return t.owns(a,e)}))}},{key:"ownsNothing",value:function(e){var t=this;return!this.owns(this.database,e)&&this.relations.every((function(a){return!t.owns(a,e)}))&&this.sequences.every((function(a){return!t.owns(a,e)}))&&this.userSchemas.every((function(a){return!t.owns(a,e)}))}},{key:"getPrivileges",value:function(e,t){var a=e.get("acls").find((function(e){return e.get("role")===t}));return a?a.get("privileges"):new U.a.List}},{key:"getDefaultPrivileges",value:function(e,t,a,n){var r=e.get("default_acls").find((function(e){return e.get("role")===t&&e.get("creator")===n&&e.get("object_type")===a}));return r?r.get("privileges"):new U.a.List}},{key:"hasPrivilege",value:function(e,t,a){return this.getPrivileges(e,t).includes(a)}},{key:"hasExactPrivileges",value:function(e,t,a){var n=this.getPrivileges(e,t);return U.a.is(new U.a.Set(n),new U.a.Set(a))}},{key:"hasExactDefaultPrivileges",value:function(e,t,a){var n=this.database.get("owner"),r=this.getDefaultPrivileges(this.database,t,e,n);return U.a.is(new U.a.Set(r),new U.a.Set(a))}},{key:"canCreateObjects",value:function(e){var t=this;return this.owns(this.database,e)||this.hasPrivilege(this.database,e,"CREATE")||this.schemas.some((function(a){return t.owns(a,e)||t.hasPrivilege(a,e,"CREATE")}))}},{key:"canDropOrAlterObjects",value:function(e){return!this.ownsNothing(e)}},{key:"checkAccess",value:function(e){var t=this;return y.a.findKey(this.constructor.accessPermissions,(function(a,n){return(a.owner?t.ownsEverything(e):t.ownsNothing(e))&&t.hasExactPrivileges(t.database,e,a.database)&&t.relations.every((function(n){return t.hasExactPrivileges(n,e,a.relations)}))&&(a.owner||t.hasExactDefaultPrivileges(yr,e,a.relations))&&t.sequences.every((function(n){return t.hasExactPrivileges(n,e,a.sequences)}))&&(a.owner||t.hasExactDefaultPrivileges(kr,e,a.sequences))&&t.userSchemas.every((function(n){return t.hasExactPrivileges(n,e,a.schemas)}))}))||Er.CUSTOM}},{key:"isRolePresent",value:function(e){return!!this.rolesByName[e]}},{key:"getACLsForAccess",value:function(e){if(![Er.NONE,Er.READONLY,Er.READWRITE].includes(e))throw new Error("Unsupported access level: ".concat(e));var t=this.constructor.accessPermissions[e];return[{kind:"database",name:this.database.get("name"),privileges:t.database},{kind:"table",default:!0,privileges:t.relations},{kind:"sequence",default:!0,privileges:t.sequences}].concat(this.userSchemas.flatMap((function(e){return[{kind:"schema",name:e.get("name"),privileges:t.schemas},{kind:"table",schema:e.get("name"),privileges:t.relations},{kind:"sequence",schema:e.get("name"),privileges:t.sequences}]})).toJS())}},{key:"superusers",get:function(){return this.database.get("roles").filter((function(e){return e.get("superuser")})).map((function(e){return e.get("name")}))}},{key:"schemas",get:function(){return this.database.get("schemas")}},{key:"searchPath",get:function(){var e=this;return this.database.get("search_path").map((function(t){return e.schemasByOid[t]})).filter((function(e){return!!e})).map((function(e){return e.get("name")}))}},{key:"userSchemas",get:function(){var e=this;return this.schemas.filter((function(t){return!e.superusers.includes(t.get("owner"))}))}},{key:"relations",get:function(){return Object.values(this.relsByOid)}},{key:"sequences",get:function(){return Object.values(this.seqsByOid)}}]),e}();wr.accessPermissions=(fr={},Object($.a)(fr,Er.NONE,{owner:!1,database:["CONNECT"],relations:[],sequences:[],schemas:[]}),Object($.a)(fr,Er.READONLY,{owner:!1,database:["CONNECT"],relations:["SELECT"],sequences:["SELECT"],schemas:["USAGE"]}),Object($.a)(fr,Er.READWRITE,{owner:!1,database:["CONNECT","TEMPORARY"],relations:["SELECT","INSERT","UPDATE","DELETE","TRUNCATE"],sequences:["SELECT","USAGE"],schemas:["USAGE"]}),Object($.a)(fr,Er.FULL,{owner:!0,database:["CREATE","CONNECT","TEMPORARY"],relations:["SELECT","INSERT","UPDATE","DELETE","TRUNCATE","REFERENCES","TRIGGER"],sequences:["SELECT","USAGE","UPDATE"],schemas:["USAGE","CREATE"]}),fr);var Cr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={pendingPermission:null,changeId:null,changePermission:null},e.handlePermissionChange=function(t){var a=e.props,n=a.access,r=a.datastore.get("schema",new U.a.Map),s=new wr(r),i=n.get("user"),c=s.checkAccess(i),l=t.target.value;e.setState({pendingPermission:l===c?null:l,changePermission:l===c?null:l,changeId:null})},e.handlePermissionCommit=function(){var t=e.props,a=t.access,n=t.datastore,r=e.state.pendingPermission,s=n.get("schema",new U.a.Map),i=new wr(s),c=nr.a.v4();e.props.dispatch({type:Fa.SET_PERMISSIONS,addonId:n.get("id"),role:a.get("user"),permissions:i.getACLsForAccess(r),changeId:c}),e.setState({changeId:c,pendingPermission:null})},e.handlePermissionReset=function(){e.setState({pendingPermission:null,changePermission:null,changeId:null})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.access,a=e.datastore,n=e.isDefault,r=this.state,s=r.pendingPermission,i=r.changePermission,c=r.changeId;if(a.getIn(["details","shielded"]))return l.a.createElement("div",{className:"ml2 f5"},l.a.createElement(o.a,{name:"warning-badge-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ","Permissions information is not available on Shield plans");var d=a.get("schema",new U.a.Map);if(d.getIn(["_change","state"])===Ze.REJECTED){var u=/Schema is too large/.test(d.getIn(["_change","message"]))?"The schema is too large for permission management on this site.":"There was an error loading the schema needed for permission management.";return l.a.createElement(gr,{message:u})}if(!d.has("schemas"))return l.a.createElement(ee.a,null);var m=new wr(d),p=t.get("user");if(!m.isRolePresent(p))return l.a.createElement("div",{className:"ml3"},l.a.createElement(ee.a,null)," Fetching current permissions from schema...");var h,f,g=m.canCreateObjects(p),v=m.canDropOrAlterObjects(p);(g||v)&&(f=g&&v?"create, drop, or alter":g?"create":"drop or alter",h=l.a.createElement("div",{className:"red mt3"},l.a.createElement(o.a,{name:"warning-badge-16",size:16,fillClass:"red",extraClasses:"v-ttop"})," ","Role can ",f," relations"));var b,E,y=s||m.checkAccess(p);s&&(b=l.a.createElement("div",{className:"mh3"},l.a.createElement(S.HKButton,{onClick:this.handlePermissionCommit},"Save")," or"," ",l.a.createElement("a",{className:"pointer",onClick:this.handlePermissionReset},"revert")));var k=n;n&&(h=l.a.createElement("div",{className:"f5 dark-gray mt3"},"You cannot change the permissions of the default credential."));var w=c&&Ua(a,c);if(w&&!n)switch(w.get("state")){case Ze.PENDING:E=l.a.createElement("div",{className:"ml3"},l.a.createElement(ee.a,null)," Updating permissions\u2026"),k=!0,y=i;break;case Ze.REJECTED:E=l.a.createElement("div",{className:"red ml3"},l.a.createElement(o.a,{name:"warning-badge-16",size:16,fillClass:"red",extraClasses:"v-ttop"})," ","There was a problem setting the permission. Try again?")}var C,O=a.getIn(["details","leader"]),N="CUSTOM"===y;N&&(C=l.a.createElement(gr,{message:"Credential has custom permissions. These often exist in the form of table specific permission grants."}));var I=l.a.createElement(br,{currentPermission:y,disabled:k||!!O||N,onChange:this.handlePermissionChange});return l.a.createElement("div",null,l.a.createElement("div",{className:"mb2"},I,E,b,h),C,O?l.a.createElement("div",{className:"f5 dark-gray bt b--light-silver pt3"},"Permissions cannot be configured on a follower; configure them on the leader instead. Learn more in"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgresql-credentials",target:"_blank",rel:"noopener noreferrer"},"Dev Center")):l.a.createElement("div",{className:"f5 dark-gray bt b--light-silver pt3"},"Learn more about managing credential permissions in"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgresql-credentials",target:"_blank",rel:"noopener noreferrer"},"Dev Center")))}}]),a}(l.a.Component),Or=Object(d.b)()(Cr),Nr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleSelectRotate=function(){return e.props.onCredentialRotate({isRotationForced:!1})},e.handleSelectForceRotate=function(){return e.props.onCredentialRotate({isRotationForced:!0})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.isFollower,a=e.title;return l.a.createElement(S.HKDropdown,{name:"credential-rotate",align:"right",disabled:t,title:a},l.a.createElement("li",{name:"rotate",className:"hk-dropdown-item b--silver cursor-pointer",onClick:this.handleSelectRotate},l.a.createElement(o.a,{name:"restart-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ",a),l.a.createElement("li",null,l.a.createElement("a",{className:"hk-dropdown-item",href:"https://devcenter.heroku.com/articles/heroku-postgresql-credentials"},l.a.createElement(o.a,{name:"docs-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ","View Documentation"," ")),l.a.createElement("li",{className:"hk-dropdown-divider"}),l.a.createElement("li",{name:"forceRotate",className:"hk-dropdown-item--danger",onClick:this.handleSelectForceRotate},l.a.createElement(o.a,{name:"restart-16",size:16,fillClass:"red",extraClasses:"v-ttop"})," ","Force ",a))}}]),a}(l.a.Component),Ir=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={valid:!1},e.handleOnChange=function(t){var a=t.target.value,n=a===e.props.databaseName;e.setState({valid:n,value:a})},e.handleModalDismiss=function(t){var a=e.props,n=a.onRotateCanceled,r=a.onRotateConfirmed;switch(t){case"rotate":r&&r();break;case"cancel":default:n&&n()}},e}return Object(r.a)(a,[{key:"render",value:function(){var e="https://devcenter.heroku.com/articles/heroku-postgresql-credentials",t=this.props,a=t.credentialName,n=t.databaseName,r=t.forced,s=t.rotateAll,i=t.showModal,c=this.state.valid,o={props:{type:"destructive",show:i,onDismiss:this.handleModalDismiss,header:l.a.createElement("div",null," ","Force ",s&&"All"," Rotate Credential",s&&"s"),buttons:[{disabled:!1,text:"Cancel",type:"tertiary",value:"cancel"},{disabled:!c,text:"Force Rotate ".concat(s?"All Credentials":"Credential"),type:"danger",value:"rotate"}]},children:l.a.createElement("div",{className:"pa6 f9 lh-title"},l.a.createElement("p",null,"Force rotating"," ",s?"all credentials for":"the ".concat(a," credential for")," ",n," will immediately stop all connections to the database that use this credential."," "),l.a.createElement("p",null,"You can also rotate ",s?"credentials":"a credential"," ",l.a.createElement("strong",null,"without")," immediately dropping all connections; it's recommended that you read the"," ",l.a.createElement("a",{href:e},"Credential Rotation documentation")," before performing any force rotations on credentials."," "),l.a.createElement("li",{className:"list bt mv1 b--silver"}),l.a.createElement("p",null,"To force rotate"," ",s?"all database credentials":"the ".concat(a," credential"),", enter the database name (",n,") below:"," "),l.a.createElement("div",{className:"flex items-center"},l.a.createElement("input",{id:"verifyForceRotateCredential",className:"hk-input w-100",autoCorrect:"off",spellCheck:!1,autoFocus:!0,onChange:this.handleOnChange})))},d={props:{type:"default",show:i,onDismiss:this.handleModalDismiss,header:l.a.createElement("div",null,"Rotate ",s&&"All"," Credentials"),buttons:[{disabled:!1,text:"Cancel",type:"tertiary",value:"cancel"},{disabled:!1,text:"Rotate ".concat(s?"All Credentials":"Credential"),type:"primary",value:"rotate"}]},children:l.a.createElement("div",{className:"pa6 f9 lh-title"},l.a.createElement("p",null,"Rotating"," ",s?"all credentials for":"the ".concat(a," credential")," ","for ",n," will allow open connections to complete before automatically refreshing and configuring the credential for any new connections to the database."," "),l.a.createElement("p",null,"For immediate credential rotation \u2014 i.e. rotating the credential"," ",l.a.createElement("strong",null,"and")," dropping all open and exisiting connections \u2014 you'll want to perform a forced credential rotation. Before rotating credentials, we recommend reading the \xa0",l.a.createElement("a",{href:e},"Credential Rotation documentation.")))},u=r?o:d;return l.a.createElement("div",{className:"flex-auto"},l.a.createElement(S.HKModal,u.props,u.children))}}]),a}(l.a.Component);Ir.defaultProps={forced:!1,rotateAll:!1};var _r=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={isExpanded:!1,isCopied:!1,isConfirmingRotate:!1,isConfirmingDestroy:!1,passwordUnmasked:!1,uriUnmasked:!1,isRotationForced:!1,showCredentialRotateModal:!1},e.handleExpand=function(){e.setState({isExpanded:!0,isCopied:!1})},e.handleCollapse=function(){e.setState({isExpanded:!1,isCopied:!1,passwordUnmasked:!1,uriUnmasked:!1}),e.handleCancel()},e.handleTogglePasswordMask=function(){e.setState({passwordUnmasked:!e.state.passwordUnmasked})},e.handleToggleURIMask=function(){e.setState({uriUnmasked:!e.state.uriUnmasked})},e.handleDestroy=function(){e.setState({isExpanded:!0,isConfirmingDestroy:!0})},e.handleDestroyConfirm=function(){var t=nr.a.v4();e.setState({changeId:t}),e.props.dispatch({type:Fa.DESTROY_CREDENTIAL,addonId:e.props.datastore.get("id"),name:e.props.credential.get("name"),changeId:t})},e.handleRotate=function(t){var a=t.isRotationForced;e.setState({isRotationForced:a,showCredentialRotateModal:!0,isExpanded:!0,isConfirmingRotate:!0})},e.handleRotateConfirm=function(){var t=nr.a.v4();e.setState({changeId:t,showCredentialRotateModal:!1}),e.props.dispatch({type:Fa.ROTATE_CREDENTIAL,addonId:e.props.datastore.get("id"),name:e.props.credential.get("name"),forced:e.state.isRotationForced,changeId:t})},e.handleCancel=function(){e.setState({isConfirmingRotate:!1,isConfirmingDestroy:!1,showCredentialRotateModal:!1})},e.handleDone=function(){e.setState({isConfirmingRotate:!1}),e.handleCollapse(),e.purgeChange()},e.handleCopy=function(){e.setState({isCopied:!0}),window.setTimeout((function(){return e.setState({isCopied:!1})}),1e4)},e.getChange=function(t){return e.props.datastore.get("changes",new U.a.Map).find((function(e){var a=[Fa.ROTATE_CREDENTIAL,Fa.DESTROY_CREDENTIAL].includes(e.get("type"));return e.get("changeId")===t&&a}))},e.purgeChange=function(){var t=e.state.changeId;if(t){var a=e.props.datastore.get("id");e.props.dispatch({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:a,changeId:t}}),e.setState({changeId:void 0})}},e}return Object(r.a)(a,[{key:"componentDidUpdate",value:function(){var e=this.state,t=e.changeId,a=e.isConfirmingRotate;if(!t)return null;var n=this.getChange(t),r=n.get("type")===Fa.ROTATE_CREDENTIAL,s=n.get("state")===Ze.FULFILLED;r&&s&&a&&this.handleDone()}},{key:"render",value:function(){var e,t="https://devcenter.heroku.com/articles/heroku-postgresql-credentials",a=this.props,n=a.addon,r=a.credential,s=a.attachments,i=a.datastore,c=this.state,d=c.isCopied,u=c.isConfirmingDestroy,m=c.changeId,p=c.isExpanded,h=c.isRotationForced,f=c.showCredentialRotateModal,g=s.get(0),v=r.get("credentials").sortBy((function(e){return"active"!==e.get("state")})).get(0),b=v?"postgres://".concat(v.get("user"),":").concat(v.get("password"),"@").concat(r.get("host"),":").concat(r.get("port"),"/").concat(r.get("database")):"",E=this.getChange(m);if(E){var k,w,C=E.get("type")===Fa.ROTATE_CREDENTIAL;switch(E.get("state")){case Ze.PENDING:w=C?"Initiating credential rotation\u2026":"Initiating credential destruction\u2026",e=l.a.createElement(sa,{title:"".concat(w),type:"inprogress"});break;case Ze.FULFILLED:C||(e=l.a.createElement(sa,{title:"Credential is being destroyed",type:"success"},l.a.createElement("div",{className:"mw6"},l.a.createElement("p",null,"This can take a few minutes. When fully revoked, the credential will disappear from this listing."),l.a.createElement("div",{className:"tc mt4"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleDone},"Got It")))));break;case Ze.REJECTED:k=C?"rotate":"destroy",e=l.a.createElement(sa,{title:"Failed to ".concat(k,": \u201c").concat(r.get("name"),"\u201d"),type:"warning"},l.a.createElement("div",{className:"mw6"},l.a.createElement("p",null,"Could not ",k," the credential due to an internal error. Sorry about that!"),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"tc mt4"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleDone},"Got It"))))}}else if(u)e=l.a.createElement(sa,{title:"Are you sure you want to destroy the credential \u201c".concat(r.get("name"),"\u201d?"),type:"warning"},l.a.createElement("div",{className:"mw6"},l.a.createElement("p",null,"This operation cannot be undone."),l.a.createElement("div",{className:"tc mt4"},l.a.createElement(S.HKButton,{type:"danger",onClick:this.handleDestroyConfirm},"Yes, destroy it")," ",l.a.createElement(S.HKButton,{type:"tertiary",onClick:this.handleCancel},"Cancel"))));else{var O=y.a.uniq(s.toJS().map((function(e){return e.app_name}))).length,N="default"===r.get("name"),I=0!==O,_=this.state,x=_.passwordUnmasked,T=_.uriUnmasked,D=i.getIn(["details","leader"]),j=g&&Ra(n,g.get("app_name"),{shield:i.getIn(["details","shielded"],!1),credential:r.get("name"),attachment:g.get("name")});e=l.a.createElement("dl",{className:"ma0 pb3 push-3"},v&&l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"User"),l.a.createElement("dd",{className:"ml0 mt3"},v.get("user"))),v&&l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Password"),l.a.createElement("dd",{className:"ml0 mt3"},l.a.createElement("div",{className:"w-100 nowrap overflow-x-auto pb2"},x?v.get("password"):"\u2022".repeat(32)),l.a.createElement("div",{className:"mt2"},l.a.createElement(S.HKButton,{type:"secondary",className:"minw-5 mr1",onClick:this.handleTogglePasswordMask},x?"Hide":"Show"),l.a.createElement(Nr,{title:"Rotate Credential",isFollower:!!D,onCredentialRotate:this.handleRotate}),l.a.createElement(Ir,{forced:h,credentialName:r.get("name"),databaseName:n,onRotateCanceled:this.handleCancel,onRotateConfirmed:this.handleRotateConfirm,showModal:f})))),l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Host"),l.a.createElement("dd",{className:"ml0 mt3"},r.get("host"))),l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Database"),l.a.createElement("dd",{className:"ml0 mt3"},r.get("database"))),l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Port"),l.a.createElement("dd",{className:"ml0 mt3"},r.get("port"))),v&&l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"URI"),l.a.createElement("dd",{className:"ml0 mt3"},l.a.createElement("div",{className:"w-100 nowrap overflow-x-auto pb2"},T?b:"\u2022".repeat(32)),l.a.createElement("div",{className:"mt2 flex"},l.a.createElement(S.HKButton,{type:"secondary",className:"minw-5 mr1",onClick:this.handleToggleURIMask},T?"Hide":"Show"),l.a.createElement(lr.a,{text:b,onCopy:this.handleCopy},l.a.createElement(S.HKButton,{type:"secondary",className:"minw-5"},l.a.createElement(o.a,{name:"check-16",size:16,extraClasses:"v-ttop"})," ","Copy")),l.a.createElement("div",{className:"flex-none self-center"},d&&l.a.createElement("span",{className:"flex-none hk-badge bg-blue ttu b ml2"},"Copied!"))))),g&&l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Heroku CLI"),l.a.createElement("dd",{className:"ml0 mt3"},l.a.createElement("code",{className:"hk-badge--code pa1"},j))),l.a.createElement(pr,{credential:r.get("name"),attachments:s,datastore:i}),l.a.createElement("div",{className:"pv2 destroy"},l.a.createElement("dt",{className:"b dark-gray"},"Destroy"),l.a.createElement("dd",{className:"ml0 mt3"},l.a.createElement(S.HKButton,{type:"danger",disabled:!!D||N||I,onClick:this.handleDestroy},"Destroy Credential"),N?l.a.createElement("p",{className:"f5 dark-gray mt3 mb0"},"You cannot destroy the default credential."):I?l.a.createElement("p",{className:"f5 dark-gray mt3 mb0"},"You cannot destroy a credential that is currently attached to an app."):D?l.a.createElement("div",{className:"f5 dark-gray bt b--light-silver pt3"},"You cannot destroy credential on a follower; destroy it on the leader instead. ",l.a.createElement("a",{href:t},"Learn More")):l.a.createElement("div",{className:"f5 dark-gray bt b--light-silver pt3"},"Heroku may automatically rotate credentials and update the apps that they're attached to."," ",l.a.createElement("a",{href:t},"Learn More")))),l.a.createElement("div",{className:"pv2"},l.a.createElement("dt",{className:"b dark-gray"},"Permissions"),l.a.createElement("dd",{className:"ml0 mt3"},l.a.createElement(Or,{access:v,datastore:i,isDefault:N}))))}return l.a.createElement("div",{className:"bb b--light-silver"},l.a.createElement(hr,{isExpanded:p,onExpand:this.handleExpand,onCollapse:this.handleCollapse,attachments:s,credential:r}),e&&l.a.createElement(ft.a,{isOpened:p,springConfig:{stiffness:900,damping:50},hasNestedCollapse:!0}," ",e," "))}}]),a}(l.a.Component),xr=Object(d.b)()(_r),Tr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleNew=function(t){t.preventDefault(),e.props.onCredentialAdd&&e.props.onCredentialAdd()},e}return Object(r.a)(a,[{key:"render",value:function(){var e="https://devcenter.heroku.com/articles/heroku-postgresql-credentials",t=this.props,a=t.isFollower,n=t.onCredentialRotate;return l.a.createElement("div",{className:"postgresCredentialsListHeader flex-l justify-between pb3 bb b--light-silver"},a?l.a.createElement("div",null,"Attach and detach credentials for this database."," ",l.a.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer"},"Learn more"),"."):l.a.createElement("div",null,"Create and manage credentials for connections to this database."," ",l.a.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer"},"Learn more"),"."),l.a.createElement("div",{className:"mt3 mt0-l"},l.a.createElement(S.HKButton,{disabled:a,type:"primary",onClick:this.handleNew,className:"minw-5 mr1"},"Create Credential"),l.a.createElement(Nr,{isFollower:a,title:"Rotate All Credentials",onCredentialRotate:n})))}}]),a}(l.a.Component),Dr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={mode:"default",watching:null,showCredentialsRotateAllModal:!1,isRotationForced:!1},e.watchDatastore=function(t,a){e.setState({watching:t}),a({type:R.WATCH_POSTGRES_SCHEMA,addonId:t})},e.unwatchDatastore=function(t,a){e.setState({watching:null}),a({type:R.UNWATCH_POSTGRES_SCHEMA,addonId:t})},e.handleCredentialAdd=function(){e.setState({mode:"adding-credential"})},e.handleCredentialAddDone=function(){e.setState({mode:"default"})},e.handleCredentialAddCancel=function(){e.setState({mode:"default"})},e.handleCredentialRotate=function(t){var a=t.isRotationForced;e.setState({isRotationForced:a,showCredentialsRotateAllModal:!0})},e.handleRotateConfirm=function(){var t=e.state.isRotationForced,a=nr.a.v4();e.setState({changeId:a,mode:"rotating",showCredentialsRotateAllModal:!1}),e.props.dispatch({type:Fa.ROTATE_ALL_CREDENTIALS,addonId:e.props.datastore.get("id"),forced:t,changeId:a})},e.handleRotateConfirmCancel=function(){e.setState({mode:"default",showCredentialsRotateAllModal:!1})},e.handleRotateDone=function(){var t=e.state.changeId;if(t){var a=e.props.datastore.get("id");e.props.dispatch({type:yt.DELETE_DATASTORE_CHANGE,payload:{datastoreId:a,changeId:t}})}e.setState({mode:"default",changeId:void 0})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.setupWatching(this.props)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setupWatching(e)}},{key:"componentDidUpdate",value:function(){var e=this;if(!this.state.changeId||!this.props.datastore)return null;var t=this.props.datastore.get("changes",new U.a.Map).find((function(t){return t.get("changeId")===e.state.changeId}));if(!t)return null;t.get("state")===Ze.FULFILLED&&this.handleRotateDone()}},{key:"componentWillUnmount",value:function(){var e=this.state.watching;e&&this.unwatchDatastore(e,this.props.dispatch)}},{key:"setupWatching",value:function(e){var t=this.state.watching,a=this.props.datastore,n=a.get("id");t&&t!==n&&(this.unwatchDatastore(t,e.dispatch),t=null);var r=a.getIn(["details","shielded"]);t||r||this.watchDatastore(n,e.dispatch)}},{key:"render",value:function(){var e=this.props.datastore,t=e.getIn(["meta","attachments"]);if(!t)return l.a.createElement(te,null,l.a.createElement("p",null,"Loading credentials\u2026"));var a,n,r=this.state,s=r.mode,i=r.showCredentialsRotateAllModal,c=r.isRotationForced;if("adding-credential"===s)a=l.a.createElement(ir,{datastore:e,onDone:this.handleCredentialAddDone,onCancel:this.handleCredentialAddCancel});else if("rotating"===s){var o=this.state.changeId,d=e.get("changes",new U.a.Map).find((function(e){return e.get("changeId")===o}));switch(d&&d.get("state")){case void 0:case Ze.PENDING:a=l.a.createElement(sa,{title:"Rotating all credentials\u2026",type:"inprogress"},l.a.createElement("div",{className:"mw6"},l.a.createElement("p",null,"Requesting rotation of all credentials\u2026")));break;case Ze.REJECTED:a=l.a.createElement(sa,{title:"Rotating credentials failed",type:"warning"},l.a.createElement("div",{className:"mw6"},l.a.createElement("p",null,"Could not rotate credentials due to an internal error. Sorry about that!"),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified."),l.a.createElement("div",{className:"tc mt4"},l.a.createElement(S.HKButton,{type:"secondary",onClick:this.handleRotateDone},"Got It"))))}}else{"default"!==s&&window.Rollbar.warn("Unknown PostgresCredentialsSection mode",{mode:s});var m=t.reduce((function(e,t){var a=t.get("namespace"),n=a?a.replace("credential:",""):"default";return n in e||(e[n]=[]),e[n].push(t),e}),{}),p=e.getIn(["details","credentials_list"]),h=e.getIn(["details","leader"]);a=l.a.createElement("div",null,l.a.createElement(Tr,{isFollower:!!h,databaseName:e.getIn(["meta","name"]),onCredentialAdd:this.handleCredentialAdd,onCredentialRotate:this.handleCredentialRotate}),l.a.createElement("section",{className:"ma0 flex flex-column w-100"},l.a.createElement("div",{className:"w-100"},p.toSeq().map((function(t){var a=t.get("name"),n=m[a];return l.a.createElement(xr,{key:a,addon:e.getIn(["meta","name"]),attachments:U.a.fromJS(n||[]),credential:t,datastore:e})})))),l.a.createElement(Ir,{rotateAll:!0,databaseName:e.getIn(["meta","name"]),forced:c,onRotateCanceled:this.handleRotateConfirmCancel,onRotateConfirmed:this.handleRotateConfirm,showModal:i}));n=h&&l.a.createElement(rr,null,l.a.createElement("span",null,"Configure credentials on"," ",l.a.createElement(u.b,{className:"blue",to:"/datastores/".concat(h.get("addon_id"),"#credentials")},h.get("name")),". Credentials can be used on followers, but must be configured on the leader."," ",l.a.createElement("a",{className:"blue",href:"https://devcenter.heroku.com/articles/heroku-postgresql-credentials",target:"_blank",rel:"noopener noreferrer"},"Learn more"),"."))}return l.a.createElement(Ke,{title:"Database Credentials",blurb:n},a)}}]),a}(l.a.Component),Sr=Object(d.b)()(Dr),jr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleTerminateClick=function(t){var a=t.currentTarget.dataset.pid;e.props.onTerminate&&e.props.onTerminate(a)},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.name,r=a.status,s=a.details;if(s.length>0){var i=Object.keys(s[0]);e=l.a.createElement("table",{className:"ml5 w-100 collapse"},l.a.createElement("thead",null,l.a.createElement("tr",null,i.map((function(e){return l.a.createElement("th",{key:e,className:"pa3 b bb b--light-silver dark-gray f5 tl"},e)})))),l.a.createElement("tbody",{className:"hk-hide-bb-last-row"},s.map((function(e,a){return l.a.createElement("tr",{key:a,className:"bb b--light-silver"},i.map((function(a){var n=e[a],r="pid"===a&&l.a.createElement("span",{"data-pid":n,onClick:t.handleTerminateClick},l.a.createElement(o.a,{name:"delete-16",size:16,fillClass:"red",extraClasses:"pointer dim pl1 v-btm"}));return l.a.createElement("td",{key:a,className:"pa3 f4"},n,r)})))}))))}var c=l.a.createElement(Ye,{baseSize:16,displaySize:20,status:r,className:"v-top"});return l.a.createElement("div",{className:"bb b--light-silver pv2"},c," ",l.a.createElement("span",{className:"f3 pl1"},n),e)}}]),a}(l.a.Component),Ar=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleRunDiagnose=function(){var t=e.props,a=t.datastore;(0,t.dispatch)({type:Fa.DIAGNOSE,addonId:a.get("id"),background:!1})},e.handleTerminateConnection=function(t){var a=e.props,n=a.datastore,r=a.dispatch,s=nr.a.v4();r({type:Fa.TERMINATE_CONNECTION,changeId:s,addonId:n.get("id"),pid:t})},e}return Object(r.a)(a,[{key:"buildDiagnosticsTable",value:function(e){var t=this;return e&&0!==e.length?e.map((function(e){return l.a.createElement(jr,{key:e.name,name:e.name,details:e.details,onTerminate:t.handleTerminateConnection,status:e.status})})):l.a.createElement("div",null,"no diagnostic checks found")}},{key:"render",value:function(){var e=this.props.datastore,t=e.getIn(["diagnose","_change"]),a=e.getIn(["diagnose","result"]),n=t&&t.get("state")===Ze.PENDING,r=t&&t.get("state")===Ze.REJECTED&&l.a.createElement("div",{className:"red ml2 mt2"},l.a.createElement("p",null,"Could not run diagnostics due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified.")),s=a?"Refresh":"Run Diagnostics",i=l.a.createElement(S.HKButton,{type:"primary",disabled:n,async:n,onClick:this.handleRunDiagnose},n?l.a.createElement(ee.a,{button:!0}):s),c=a&&Ie.a.utc(e.getIn(["diagnose","refreshed_at"])).toISOString(),o=a?l.a.createElement("div",{className:"hk-hide-bb-last-row"},l.a.createElement("p",null,l.a.createElement("a",{href:"https://devcenter.heroku.com/",target:"_blank",rel:"noopener noreferrer"},"Learn more")," ","about our diagnostic checks."),l.a.createElement("div",{className:"f5 flex justify-end"},l.a.createElement("span",{className:"pt2 pr2"},"as of ",l.a.createElement(B.a,{date:c})),i),r,this.buildDiagnosticsTable(a.toJS())):l.a.createElement("div",{className:"tc"},l.a.createElement("h3",{className:"normal f1 purple"},"Heroku Postgres Diagnostics"),l.a.createElement("p",null,"Our suite of simple automated diagnostic checks can help surface common problems with your database."," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/",target:"_blank",rel:"noopener noreferrer"},"Learn more"),"."),l.a.createElement("p",null,i),r),d=a?"Diagnostics":"";return l.a.createElement(Ke,{title:d},o)}}]),a}(l.a.Component),Rr=Object(d.b)()(Ar),Pr=a(1282),Lr=a(736),Ur=a(851),Hr=a.n(Ur),Fr=a(1063),Mr=a(1142),Gr=a.n(Mr),$r=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.className,a=e.data,n=e.onHover,r=e.hoverIndex,s=e.prettifier,i=e.title;return l.a.createElement("div",{className:t},l.a.createElement("div",{className:"gray ttu tracked f6 bg-lightest-silver pv3 pl3"},i),l.a.createElement("div",{className:"overflow-hidden bg-white"},l.a.createElement(ot.a,null,(function(e){var t=e.width;e.height;return l.a.createElement(ct,{data:a,width:t,height:110,minValue:0,prettifier:s,hoverIndex:r,onHover:n})}))))}}]),a}(l.a.Component),qr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={hoverIndex:-1},e.handleHover=function(t){e.setState({hoverIndex:t})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.text,a=e.data,n=a.get("metrics").find((function(e){return"calls"===e.get("name")})),r=a.get("metrics").find((function(e){return"average_time"===e.get("name")})),s=Gr()(t,{method:"sql"});return l.a.createElement("div",{className:"flex flex-wrap mb3"},l.a.createElement("div",{className:"metrics w-100 w-50-l br1 br--left ba b--light-silver flex flex-column"},l.a.createElement($r,{title:"Number of invocations",key:"calls",data:n,prettifier:et.c,hoverIndex:this.state.hoverIndex,onHover:this.handleHover,className:"flex-auto"}),l.a.createElement($r,{title:"Average time per invocation",key:"average_time",data:r,prettifier:et.b,hoverIndex:this.state.hoverIndex,onHover:this.handleHover,className:"flex-auto"})),l.a.createElement("div",{className:"w-100 w-50-l f5 code lh-title br1 br--right ma0"},l.a.createElement(Hr.a,{className:"expensive-query-code-block",language:"sql",style:Fr.paraisoDark},s)))}}]),a}(l.a.Component),Br=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={tab:"time_consumed",period:"72"},e.explanations={time_consumed:"\n      This measures the aggregate time spent on a query type.\n      It is reported as the percentage of time the database spends on a type of query.\n      Queries ranking high on this list are good candidates for optimization as they tend to be both slow and high volume.",average_time:"\n      This shows queries with the slowest average execution time.\n      Addressing the slowest ones can significantly improve your database and application response times.\n      You should aim to have common queries execute in under 10 ms, and less common queries to execute in under 100 ms.",calls:"\n      This shows queries ranked by their frequency (throughput).\n      These queries are the most important to optimize, as they occur frequently.\n      You should aim to have frequent queries execute in under 10 ms.",io_time:"\n      This ranks queries that spend the most time reading and writing to disk.\n      Queries ranking high in this risk are likely missing indexes, or not taking advantage of the databases cache."},e.periods={168:"Last week",72:"Last three days",24:"Last day"},e.handleTabNavigation=function(t){var a=t.currentTarget.getAttribute("data-sort");e.setState({tab:a}),Le.a.track("Postgres Expensive Queries Sorted",Object(ve.a)({tab:a},Fe(e.props.datastore)))},e.handlePeriodSelection=function(t){var a=t.currentTarget.value;e.setState({period:a}),Le.a.track("Postgres Expensive Queries Duration Changed",Object(ve.a)({period:a},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.datastore;"view_expensive_queries"===Object(H.parse)(t.search).heroku_action&&(this.props.history.replace("/datastores/".concat(a.get("id"))),this.node&&this.node.scrollIntoView&&this.node.scrollIntoView())}},{key:"sortComparator",value:function(e){switch(e){case"time_consumed":return function(e,t){return Object(Pr.a)(y.a.sumBy(e.observations,"time_spent"),y.a.sumBy(t.observations,"time_spent"))};case"average_time":return function(e,t){var a=function(e){var t=e.observations.filter((function(e){return 0!==e.average_time})),a=y.a.sumBy(t,"average_time")||0;return t.length?a/t.length:0};return Object(Pr.a)(a(e),a(t))};case"calls":return function(e,t){return Object(Pr.a)(y.a.sumBy(e.observations,"calls"),y.a.sumBy(t.observations,"calls"))};case"io_time":var t=function(e){return e.read_time+e.write_time};return function(e,a){return Object(Pr.a)(y.a.sumBy(e.observations,t),y.a.sumBy(a.observations,t))}}}},{key:"render",value:function(){var e,t=this,a=this.props.datastore,n=this.state,r=n.tab,s=n.period,i=Ie()().subtract(s,"hours"),c=l.a.createElement("div",{className:"f5 mv4 lh-copy measure-wide"},this.explanations[r]," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/expensive-queries",target:"_blank",rel:"noopener noreferrer"},"Read more about how.")),o=a.getIn(["details","expensiveQueries"],new U.a.List);if(0===o.size)e=l.a.createElement("div",{className:"tc"},l.a.createElement("h3",{className:"f1 purple normal"},"No expensive queries recorded"),l.a.createElement("p",null,"We monitor your database and surface queries that take a long time to execute here."," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/expensive-queries",target:"_blank",rel:"noopener noreferrer"},"Learn more")));else{var d=o.toJS().map((function(e){return Object.assign({},e,{observations:e.observations.filter((function(e){return i.isSameOrBefore(e.time)}))})})).filter((function(e){return e.observations.some((function(e){return Boolean(e.calls)}))})).sort(this.sortComparator(r)).map((function(e){var t=e.observations.sort((function(e,t){return Object(Lr.a)(e.time,t.time)})),a={state:Ze.FULFILLED,start:t[0].time,end:t[t.length-1].time,metrics:[{name:"calls",measurements:t.map((function(e){return{time:e.time,value:e.calls}}))},{name:"average_time",measurements:t.map((function(e){return{time:e.time,value:e.average_time}}))}]};return l.a.createElement(qr,{key:e.query_id,text:e.text,data:U.a.fromJS(a)})}));e=l.a.createElement("div",null,l.a.createElement("div",{className:"hk-tabs w-100"},l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"time_consumed"===r}),"data-sort":"time_consumed",onClick:this.handleTabNavigation},"Most time consuming"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"calls"===r}),"data-sort":"calls",onClick:this.handleTabNavigation},"Most frequently invoked"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"average_time"===r}),"data-sort":"average_time",onClick:this.handleTabNavigation},"Slowest execution time"),l.a.createElement("a",{className:G()("hk-tabs__tab pointer",{"hk-tabs__tab--active":"io_time"===r}),"data-sort":"io_time",onClick:this.handleTabNavigation},"Slowest I/O"),l.a.createElement("div",{className:"bb b--light-silver items-center justify-end flex-auto flex"}),l.a.createElement("div",{className:"absolute right-1 top-1"},l.a.createElement("select",{defaultValue:s,className:"hk-select",onChange:this.handlePeriodSelection},l.a.createElement("option",{value:"24"},this.periods[24]),l.a.createElement("option",{value:"72"},this.periods[72]),l.a.createElement("option",{value:"168"},this.periods[168])))),c,d)}return l.a.createElement("div",{ref:function(e){return t.node=e}},l.a.createElement(Ke,{title:"Expensive Queries",className:"postgresExpensiveQueriesSection",id:"expensive-queries"},e))}}]),a}(l.a.Component),zr=Object(m.g)(Br),Kr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={view:"form",plan:e.props.datastore.getIn(["meta","plan"])},e.handleSubmit=function(t){t.preventDefault();var a=e.state.plan,n=e.props,r=n.datastore,s=n.dispatch,i=r.getIn(["details","region"]);Le.a.track("Postgres Create Follower Confirmed",Object(ve.a)({plan:a,region:i},Fe(r)));var c="".concat(window.service.postgres,":").concat(a);s({type:Fa.ADD_FOLLOWER,addonId:r.get("id"),plan:c,region:i})},e.handlePlanChange=function(t){e.setState({plan:t})},e.handleCancel=function(){var t=e.props.datastore;Le.a.track("Postgres Create Follower Canceled",Object(ve.a)({},Fe(t))),e.props.dispatch(Ha(t,Fa.ADD_FOLLOWER)),e.props.onSectionChange("followers")},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(e,t){this.node&&this.node.scrollIntoView()}},{key:"content",value:function(){var e=Ua(this.props.datastore,Fa.ADD_FOLLOWER);if(!e)return this.form();switch(e.get("state")){case Ze.PENDING:return this.processing();case Ze.FULFILLED:return this.success();default:return this.failure()}}},{key:"processing",value:function(){return l.a.createElement("div",{className:"tc pb4"},l.a.createElement("h4",{className:"f1 purple normal"},"Adding your follower"),l.a.createElement(ee.a,null))}},{key:"success",value:function(){return l.a.createElement("div",{className:"tc pb4"},l.a.createElement("h4",{className:"f1 purple normal"},"Follower created successfully"),l.a.createElement("p",null,"The follower is provisioning and will be available in a few minutes."),l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleCancel},"Got It"))}},{key:"failure",value:function(){var e=this.props.datastore;return l.a.createElement("div",{className:"tc pb4"},l.a.createElement("h4",{className:"f1 purple normal"},"Something went wrong"),l.a.createElement("p",null,"Couldn\u2019t add a follower database to"," ",l.a.createElement("strong",null,e.getIn(["meta","name"]))),l.a.createElement("p",null,"Sorry about that! Our engineers have been notified."),l.a.createElement("p",null,l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleCancel},"Got It")))}},{key:"form",value:function(){return l.a.createElement("div",null,l.a.createElement("h2",{className:"f2 normal purple"},"Add new follower"),l.a.createElement(Wa,{datastore:this.props.datastore,onChange:this.handlePlanChange}),l.a.createElement("div",{className:"mt4 mb3 pb3 bb b--light-silver"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleSubmit},"Add Follower"),l.a.createElement(S.HKButton,{type:"tertiary",onClick:this.handleCancel},"Cancel")),l.a.createElement("p",{className:"gray f6"},"View all of our available"," ",l.a.createElement("a",{href:"https://www.heroku.com/pricing#databases",target:"_blank",rel:"noopener noreferrer"},"database plans and their pricing"),"."))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"postgresAddFollowerSection",ref:function(t){return e.node=t}},this.content())}}]),a}(l.a.Component),Wr=Object(d.b)()(Kr),Jr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleAddFollowerClicked=function(){Le.a.track("Postgres Create Follower Clicked",Object(ve.a)({fromBlankSlate:!0},Fe(e.props.datastore))),e.props.onSectionChange("add-follower")},e.handleFollowersHelpClicked=function(){Le.a.track("Postgres Followers Help Clicked",Object(ve.a)({},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore.getIn(["details","canManageAddons"]),t=e?null:"You do not have permission to create followers";return l.a.createElement("div",{className:"postgresFollowersBlankSlate tc"},l.a.createElement("h3",{className:"normal f1 purple"},"Create your first follower database"),l.a.createElement("p",null,"Follower replicas are useful for reducing query load on your primary, or as a hot standby."," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-follower-databases",target:"_blank",rel:"noopener noreferrer",onClick:this.handleFollowersHelpClicked},"Learn more"),"."),l.a.createElement("p",null,l.a.createElement(S.HKButton,{type:"primary",disabled:!e,title:t,onClick:this.handleAddFollowerClicked},"Add a Follower")))}}]),a}(l.a.Component),Yr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a=this.props,n=a.badge,r=a.badgeText,s=a.caption,i=a.className,c=a.prettifier,o=a.suffix,d=a.value;if(s){var u,m=G()("ml3",{gray:"ok"===n,red:"error"===n});n&&(u=l.a.createElement(Ye,{baseSize:16,displaySize:12,status:"ok"===n?Je.GREEEN:Je.RED,className:"v-btm"})),e=l.a.createElement("div",{className:"f6 tracked dark-gray ttu bt b--light-silver pt2 mt1"},s,l.a.createElement("span",{className:m},u," ",r))}if(y.a.isFinite(d)){var p=c(d),h=Object(P.a)(p,2),f=h[0],g=h[1];o&&(g+=o),t=l.a.createElement("div",{className:"f1 black"},f," ",l.a.createElement("small",{className:"gray fw3 f3"},g))}else t=l.a.createElement("div",{className:"f1 black"},l.a.createElement(ee.a,null));return l.a.createElement("div",{className:G()("numericMetric",i)},t,e)}}]),a}(l.a.Component);Yr.defaultProps={className:"",prettifier:function(e){return["".concat(e),""]}};var Vr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleUnfollow=function(){var t=e.props,a=t.follower,n=t.datastore;Le.a.track("Postgres Follower Unfollow Clicked",Object(ve.a)({followerName:a.get("name"),followerAddonUUID:a.get("addon_id"),followerPlan:a.get("plan"),followerCreatedAt:a.get("created_at")},Fe(n))),e.props.onSectionChange("unfollow",{follower:a})},e.handleRemove=function(){var t=e.props,a=t.follower,n=t.datastore;Le.a.track("Postgres Follower Destroy Clicked",Object(ve.a)({followerName:a.get("name"),followerAddonUUID:a.get("addon_id"),followerPlan:a.get("plan"),followerCreatedAt:a.get("created_at")},Fe(n))),e.props.onSectionChange("remove-follower",{follower:a})},e}return Object(r.a)(a,[{key:"name",value:function(){var e=this.props.follower;return e.get("name")?l.a.createElement(u.b,{to:"/datastores/".concat(e.get("addon_id"))},e.get("name")):l.a.createElement(ee.a,null)}},{key:"pgVersion",value:function(){var e=this.props.follower;return e.get("pg_version")?e.get("pg_version"):l.a.createElement("span",{className:"text-muted"},"Fetching\u2026")}},{key:"buttons",value:function(){var e=this.props.follower,t=e.get("isAvailable")&&e.get("name"),a=this.props.datastore.getIn(["details","canManageAddons"]),n=a?null:"You do not have permission to destroy this follower";if(t)return l.a.createElement("span",null,l.a.createElement(S.HKButton,{type:"primary",small:!0,onClick:this.handleUnfollow,value:"Unfollow"},"Unfollow"),l.a.createElement(S.HKButton,{type:"danger",small:!0,disabled:!a,title:n,onClick:this.handleRemove,className:"ml3",value:"Destroy"},"Destroy"))}},{key:"render",value:function(){var e=this.props.follower;return l.a.createElement("tr",{className:"hover-bg-near-white"},l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},this.name()),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},this.pgVersion()),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},l.a.createElement(B.a,{date:e.get("created_at")})),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver"},e.get("status")),l.a.createElement("td",{className:"pa3 f4 bb b--light-silver tr"},this.buttons()))}}]),a}(l.a.Component),Qr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleAddFollower=function(){Le.a.track("Postgres Create Follower Clicked",Object(ve.a)({fromBlankSlate:!1},Fe(e.props.datastore))),e.props.onSectionChange("add-follower")},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this,t=this.props.datastore.getIn(["details","followers"]),a=t.map((function(t){return l.a.createElement(Vr,{key:t.get("name")||nr.a.v4(),datastore:e.props.datastore,onSectionChange:e.props.onSectionChange,follower:t})})),n=this.props.datastore.getIn(["details","primary"]),r=this.props.datastore.getIn(["details","canManageAddons"]),s=r?null:"You do not have permission to create followers",i=n?l.a.createElement(S.HKButton,{type:"primary",className:"mt4",title:s,disabled:!r,onClick:this.handleAddFollower},"Create Follower"):null;return l.a.createElement("div",{className:"postgresFollowersTable flex w-100"},l.a.createElement("div",{className:"flexHeader mr5 no-wrap"},l.a.createElement(Yr,{value:t.size,caption:"follower ".concat(Object(qe.pluralize)(t.size,"database"))}),i),l.a.createElement("div",{className:"flexTable flex-auto"},l.a.createElement("table",{className:"w-100 collapse"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Name"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"PostgreSQL version"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Created"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tl"},"Status"),l.a.createElement("th",{className:"pa3 b bb b--light-silver dark-gray f5 tr"}))),l.a.createElement("tbody",null,a))))}}]),a}(l.a.Component),Xr=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={disabled:!0},e.handleSubmit=function(t){t.preventDefault();var a=e.props,n=a.follower,r=a.datastore,s=a.dispatch;Le.a.track("Postgres Follower Destroy Confirmed",Object(ve.a)({followerName:n.get("name"),followerAddonUUID:n.get("addon_id"),followerPlan:n.get("plan"),followerCreatedAt:n.get("created_at")},Fe(r))),s({type:Fa.REMOVE_FOLLOWER,addonId:r.get("id"),followerId:n.get("addon_id")})},e.handleChange=function(t){var a=e.props.datastore.getIn(["meta","app_name"])!==e.app.value;e.setState({disabled:a})},e.handleCancel=function(){var t=e.props,a=t.follower,n=t.datastore;Le.a.track("Postgres Follower Destroy Canceled",Object(ve.a)({followerName:a.get("name"),followerAddonUUID:a.get("addon_id"),followerPlan:a.get("plan"),followerCreatedAt:a.get("created_at")},Fe(n))),e.props.dispatch(Ha(e.props.datastore,Fa.REMOVE_FOLLOWER)),e.props.onSectionChange("followers")},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(e,t){this.node&&this.node.scrollIntoView()}},{key:"content",value:function(){var e=Ua(this.props.datastore,Fa.REMOVE_FOLLOWER);if(!e)return this.form();switch(e.get("state")){case Ze.PENDING:return this.processing();case Ze.FULFILLED:return this.success();default:return this.failure()}}},{key:"failure",value:function(){return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"purple f2 normal"},"Something went wrong"),l.a.createElement("p",null,"Couldn\u2019t remove ",l.a.createElement("strong",null,this.props.follower.get("name"))," ","follower."),l.a.createElement("p",null,"Sorry about that! Our engineers have been notified."),l.a.createElement("p",null,l.a.createElement(S.HKButton,{onClick:this.handleCancel,type:"primary"},"Got It")))}},{key:"processing",value:function(){return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"purple f2 normal"},"Removing your follower"),l.a.createElement(ee.a,null))}},{key:"success",value:function(){return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"purple f2 normal"},"Follower destroyed successfully"),l.a.createElement("p",null,"The follower is deprovisioning, and will disappear from listings in a few minutes."),l.a.createElement(S.HKButton,{onClick:this.handleCancel,type:"primary"},"Got It"))}},{key:"form",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement("h2",{className:"f2 normal purple"},"Destroy ",this.props.follower.get("name"),"?"),l.a.createElement("div",null,l.a.createElement("p",null,"Destroying a follower is permanent and cannot be undone."),l.a.createElement("p",null,"Please type your app\u2019s name (",l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1"},this.props.datastore.getIn(["meta","app_name"])),") below to confirm:"),l.a.createElement("input",{type:"text",ref:function(t){return e.app=t},onChange:this.handleChange,className:"hk-input w-100 db mb4",autoFocus:!0,spellCheck:!1})),l.a.createElement("div",null,l.a.createElement(S.HKButton,{type:"danger",disabled:this.state.disabled,onClick:this.handleSubmit},"Remove follower database"),l.a.createElement(S.HKButton,{type:"tertiary",onClick:this.handleCancel},"Cancel")))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"postgresRemoveFollowerSection flex flex-column pv4 ph0 ma0 bb b--light-silver bb-except-last",ref:function(t){return e.node=t}},this.content())}}]),a}(l.a.Component),Zr=Object(d.b)()(Xr),es=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={disabled:!0},e.handleSubmit=function(t){t.preventDefault();var a=e.props,n=a.follower,r=a.datastore,s=a.dispatch;Le.a.track("Postgres Follower Unfollow Confirmed",Object(ve.a)({followerName:n.get("name"),followerAddonUUID:n.get("addon_id"),followerPlan:n.get("plan"),followerCreatedAt:n.get("created_at")},Fe(r))),s({type:Fa.UNFOLLOW,addonId:r.get("id"),followerId:n.get("addon_id")})},e.handleChange=function(t){var a=e.props.datastore.getIn(["meta","app_name"])!==e.app.value;e.setState({disabled:a})},e.handleCancel=function(){var t=e.props,a=t.follower,n=t.datastore;Le.a.track("Postgres Follower Unfollow Canceled",Object(ve.a)({followerName:a.get("name"),followerAddonUUID:a.get("addon_id"),followerPlan:a.get("plan"),followerCreatedAt:a.get("created_at")},Fe(n))),e.props.dispatch(Ha(n,Fa.UNFOLLOW)),e.props.onSectionChange("followers")},e.content=function(){var t=Ua(e.props.datastore,Fa.UNFOLLOW);if(!t)return e.form();switch(t.get("state")){case Ze.PENDING:return e.processing();case Ze.FULFILLED:return e.success();default:return e.failure()}},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(e,t){this.node&&this.node.scrollIntoView()}},{key:"success",value:function(){return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"normal f1 purple"},"Follower converted to fork"),l.a.createElement("p",null,"The change should be visible in a few minutes."),l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleCancel},"Got It"))}},{key:"failure",value:function(){var e=this.props.datastore;return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"purple f1 normal"},"Something went wrong"),l.a.createElement("p",null,"Couldn\u2019t unfollow ",l.a.createElement("strong",null,e.getIn(["meta","name"]))),l.a.createElement("p",null,"Sorry about that! Our engineers have been notified."),l.a.createElement("p",null,l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleCancel},"Got It")))}},{key:"processing",value:function(){return l.a.createElement("div",{className:"tc"},l.a.createElement("h4",{className:"purple f1 normal"},"Converting follower to fork"),l.a.createElement(ee.a,null))}},{key:"form",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement("h2",{className:"f2 normal purple"},"Unfollow ",this.props.datastore.getIn(["meta","name"])),l.a.createElement("div",null,l.a.createElement("p",null,"Unfollowing a database is permanent and cannot be undone. This follower will be changed into a fork."),l.a.createElement("p",null,"Please type your app\u2019s name (",l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1"},this.props.datastore.getIn(["meta","app_name"])),") below to confirm:"),l.a.createElement("input",{type:"text",ref:function(t){return e.app=t},onChange:this.handleChange,className:"hk-input w-100 db mb4",autoFocus:!0,spellCheck:!1})),l.a.createElement("div",null,l.a.createElement(S.HKButton,{type:"danger",disabled:this.state.disabled,onClick:this.handleSubmit},"Unfollow database"),l.a.createElement(S.HKButton,{type:"tertiary",onClick:this.handleCancel},"Cancel")))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"postgresUnfollowSection",ref:function(t){return e.node=t}},this.content())}}]),a}(l.a.Component),ts=Object(d.b)()(es),as=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={section:"followers",data:{}},e.handleSectionChange=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.setState({section:t,data:a})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.datastore;"create_follower"===Object(H.parse)(t.search).heroku_action&&(this.props.history.replace("/datastores/".concat(a.get("id"))),this.handleSectionChange("add-follower"))}},{key:"render",value:function(){var e,t=this.props.datastore,a=t.getIn(["details","followers"]),n=this.state.section;if(t.getIn(["details","following"]))return null;switch(n){case"followers":e=0===a.size?l.a.createElement(Jr,{onSectionChange:this.handleSectionChange,datastore:t}):l.a.createElement(Qr,{onSectionChange:this.handleSectionChange,datastore:t});break;case"add-follower":e=l.a.createElement(Wr,{onSectionChange:this.handleSectionChange,datastore:t});break;case"remove-follower":e=l.a.createElement(Zr,{onSectionChange:this.handleSectionChange,datastore:t,follower:this.state.data.follower});break;case"unfollow":e=l.a.createElement(ts,{onSectionChange:this.handleSectionChange,datastore:t,follower:this.state.data.follower})}return l.a.createElement(Ke,{title:"Followers",className:"postgresFollowersSection"},e)}}]),a}(l.a.Component),ns=Object(m.g)(as),rs=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return this.props.url?l.a.createElement("a",{href:this.props.url,className:"help-link ml1",title:"More info in Dev Center",target:"_blank",rel:"noopener noreferrer"},l.a.createElement(o.a,{name:"info-ring-16",extraClasses:"v-ttop",size:16})):null}}]),a}(l.a.Component),ss=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"dib mr4 pt3"},l.a.createElement("span",{className:"gray ttu tracked f6 pr2"},this.props.label),!this.props.url&&l.a.createElement("span",{className:"dark-gray"},this.props.value),this.props.url&&l.a.createElement(u.b,{to:this.props.url},this.props.value),this.props.help&&l.a.createElement(rs,{url:this.props.help}))}}]),a}(l.a.Component),is=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore.get("details").toJS(),t=e.region;["us","eu"].includes(t)&&(t=t.toUpperCase());var a=l.a.createElement(Ve,{healthy:["available","preparing","upgrading"].includes(e.status.toLowerCase()),message:e.status,waiting:e.waiting});return l.a.createElement(We,{status:a},e.customer_encryption_key&&l.a.createElement(Qe,{customer_encryption_key:e.customer_encryption_key,datastore_type:"postgres"}),e.region&&l.a.createElement(ss,{label:"Region",value:t}),e.shielded&&l.a.createElement(ss,{label:"Shielded",value:"".concat(e.shielded),help:"https://devcenter.heroku.com/articles/private-spaces#shield-private-spaces"}),l.a.createElement(ss,{label:"Primary",value:e.primary?"Yes":"No"}),e.leader&&l.a.createElement(ss,{label:"Leader",value:e.leader.name,url:"/datastores/".concat(e.leader.addon_id)}),l.a.createElement(ss,{label:"Version",value:e.pg_version}),l.a.createElement(ss,{label:"Created",value:Ie.a.utc(e.created_at).fromNow()}),l.a.createElement(ss,{label:"Maintenance",value:e.maintenance||"Unsupported",help:"https://devcenter.heroku.com/articles/heroku-postgres-maintenance"}),l.a.createElement(ss,{label:"Rollback",value:e.rollback,help:"https://devcenter.heroku.com/articles/heroku-postgres-rollback"}))}}]),a}(l.a.Component),cs=(a(1143),function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={hoverIndex:-1},e.handleHover=function(t){e.setState({hoverIndex:t})},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a,n,r,s=this.props.datastore;if(s.getIn(["metrics","_change","state"])===Ze.FULFILLED){var i=s.getIn(["metrics","data"],new U.a.List),c=function(e){return function(t){return t.get("name")===e}};e=i.find(c("num_connections_max")),t=i.find(c("transaction_activity_commit_max")),a=i.find(c("index_cache_hit_rate_max")),n=i.find(c("table_cache_hit_rate_max"))}var o=s.getIn(["details","connections"]);return o&&(r=Number.parseInt(o.split("/").pop(),10)),l.a.createElement(Ke,{title:"I/O",className:"postgresIO"},l.a.createElement(mt,{onUpdateTimeframe:this.props.onUpdateTimeframe}),l.a.createElement("div",{className:"flex flex-column flex-row-l w-100 pa0 justify-between"},l.a.createElement(dt,{key:"connections",caption:"connections",prettifier:et.c,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:e,maxValue:r,minValue:0}),l.a.createElement(dt,{key:"commits",caption:"Commits",prettifier:et.c,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:t}),l.a.createElement(dt,{key:"indexCacheHitRate",caption:"Index Cache Hit Rate",prettifier:et.d,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:a,minValue:0,maxValue:1}),l.a.createElement(dt,{key:"tableCacheHitRate",caption:"Table Cache Hit Rate",prettifier:et.d,onHover:this.handleHover,hoverIndex:this.state.hoverIndex,data:n,minValue:0,maxValue:1})))}}]),a}(l.a.Component)),ls=a(1144),os=a.n(ls),ds=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={value:null},e.handleChange=function(t){var a=t.target.value,n=e.props.onChange,r=a?a.trim():"";e.setState({value:a}),n&&n(os.a.parseDate(r))},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.valid,n=this.state.value;return l.a.createElement("div",{className:"textTimestampInput"},l.a.createElement("input",{type:"text",autoCorrect:"off",onChange:this.handleChange,className:G()("hk-input db w-100",{"b--red":n&&!a,"hk-focus-ring--red":n&&!a,"b--green":n&&a,"hk-focus-ring--green":n&&a})}),l.a.createElement("label",{className:"hk-label db"},t))}}]),a}(l.a.Component),us=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={opened:!1,valid:null,rollbackTo:null,plan:e.props.datastore.getIn(["meta","plan"]),guidance:[]},e.handleTimestampChange=function(t){var a={rollbackTo:t,valid:!1,guidance:[]};if(null===t)a.guidance.push("That doesn't look like a valid timestamp.");else{var n=Ie.a.utc(t),r=Ie.a.utc(t).startOf("minute");n.isSame(r)||a.guidance.push("Your specified date has been rounded down to the nearest minute.");var s=Ie.a.utc(e.props.datastore.getIn(["details","rollbackDate"]));r.isSameOrAfter(s)?(a.guidance.push("OK! Using ".concat(r.format("dddd, MMMM Do YYYY, HH:mm")," (UTC)")),a.valid=!0):a.guidance.push("You must specify a rollback target that is after ".concat(s.format("dddd, MMMM Do YYYY, HH:mm")," (UTC)")),a.rollbackTo=r}e.setState(a)},e.handleForkChange=function(t){e.setState({plan:t})},e.handleCollapse=function(){e.setState({opened:!e.state.opened,valid:null,rollbackTo:null,plan:e.props.datastore.getIn(["meta","plan"]),guidance:[]})},e.handleClick=function(){e.setState({opened:!e.state.opened})},e.handleConfirm=function(){var t=e.props,a=t.dispatch,n=t.datastore,r=e.state,s=r.rollbackTo,i=r.plan,c=n.getIn(["details","region"]),l=s.format(),o="".concat(window.service.postgres,":").concat(i);Le.a.track("Postgres Database Rollback Dispatched",Object(ve.a)({plan:o,to:l,region:c},Fe(n))),a({type:Fa.ROLLBACK,addonId:n.get("id"),plan:o,to:l,region:c})},e.handleGotIt=function(){var t=e.props,a=t.datastore;(0,t.dispatch)(Ha(a,Fa.ROLLBACK)),e.handleCollapse()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=this.state,a=t.valid,n=t.guidance,r=Ua(e,Fa.ROLLBACK),s=e.getIn(["details","rollbackDate"]),i=Ie.a.utc(s),c=s&&!/in progress/.test(e.getIn(["details","maintenance"])),d=e.getIn(["details","hobby"]),u=e.getIn(["meta","plan"]),m=$a.find((function(e){return e.name===u})),p=m?m.retentionPeriod:"4 days";if(d)return l.a.createElement(Ke,{title:""},l.a.createElement("div",{className:"mw8 mb6 center tc"},l.a.createElement("h3",{className:"normal f1 purple"},"Continuous Protection & Postgres Rollbacks"),l.a.createElement("p",{className:"lh-copy"},"Continuous Protection and Postgres Rollbacks are"," ",l.a.createElement(o.a,{name:"error-badge-16",size:16,fillClass:"red",extraClasses:"nudge-down--1"})," ",l.a.createElement("b",null,"Not Available")," on Hobby databases"),l.a.createElement("p",{className:"lh-copy"},"Upgrade to a Standard or Premium database to enable continuous and automated backups of your data. With Heroku Postgres Rollbacks, you're able to safely roll a database back to a specific point in time when things go awry."),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-rollback"},"Learn More: Heroku Postgres Rollbacks")));if(r){var h;switch(r.get("state")){case Ze.PENDING:h=l.a.createElement("div",{className:"mb6 db mw8"},l.a.createElement("h3",{className:"normal f5 b mt4"},"Perform a Database Rollback"),l.a.createElement("p",{className:"lh-copy f5"},"Input a date & time"," ",l.a.createElement("strong",null,"newer than"," ",i.format("dddd, MMMM Do YYYY, HH:mm")," (UTC)"),". You may supply an"," ",l.a.createElement("a",{href:"https://en.wikipedia.org/wiki/ISO_8601",target:"_blank",rel:"noopener noreferrer"},"ISO8601-formatted timestamp")," ","or use natural language, like Last Tuesday at noon UTC or June 14th at 21:45."),l.a.createElement("div",{className:"mw6"},l.a.createElement(ds,{onChange:this.handleTimestampChange,valid:a},l.a.createElement("div",null,n.map((function(e,t){return l.a.createElement("p",{key:t},l.a.createElement("strong",null,e))}))))),l.a.createElement("div",{className:"mt3 mw6"},l.a.createElement(Wa,{datastore:e,onChange:this.handleForkChange})),l.a.createElement("div",{className:"mt5"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleConfirm,disabled:!0,className:"mr2"},"Creating Rollback ",l.a.createElement(ee.a,{button:!0,className:"mr1"})),l.a.createElement(S.HKButton,{disabled:!0,onClick:this.handleCollapse},"Cancel")));break;case Ze.REJECTED:h=l.a.createElement("div",{className:"mw8 mb6"},l.a.createElement("p",{className:"mv0 f5 lh-copy"},"Yikes! The forked Rollback database was not created due to an internal error. Our engineers have been notified. Check your network connection, and try again shortly."),l.a.createElement("div",{className:"mt5"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleGotIt},"Got It")));break;case Ze.FULFILLED:h=l.a.createElement("div",{className:"mw8 mb4 pt1"},l.a.createElement("p",{className:"pv2 mv0"},l.a.createElement(o.a,{name:"success-badge-16",size:16,fillClass:"green",extraClasses:"nudge-down--2"})," ","Success: Rollback Database Created"),l.a.createElement("div",{className:"dt f5"},l.a.createElement("div",{className:"dt-row"},l.a.createElement("div",{className:"dtc pv2 pr3 b"},"Rollback Date & Time"),l.a.createElement("div",{className:"dtc pv2"},Ie()(r.get("to")).format("dddd, MMMM Do YYYY, HH:mm")," ","(UTC)")),l.a.createElement("div",{className:"dt-row"},l.a.createElement("div",{className:"dtc pv2 pr3 b"},"Database Name"),l.a.createElement("div",{className:"dtc pv2"},l.a.createElement("a",{href:"/datastores/".concat(r.get("id"))},r.get("name")))),l.a.createElement("div",{className:"dt-row"},l.a.createElement("div",{className:"dtc pv2 pr3 b"},"Database Plan"),l.a.createElement("div",{className:"dtc pv2"},function(e){var t=$a.find((function(t){return t.name===e}));return t?"".concat(t.human_name," (").concat(t.price,")"):null}(r.get("plan").split(":")[1])))),l.a.createElement("div",{className:"mt3"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleGotIt},"Got It")))}return l.a.createElement(Ke,{title:"Continuous Protection & Rollbacks"},h)}return l.a.createElement(Ke,{title:this.state.opened?"Continuous Protection & Rollbacks":""},l.a.createElement("div",{className:"mw8 mb5 center tc "+(this.state.opened?"dn":"db")},l.a.createElement("h3",{className:"normal f1 purple lh-title"},"Your Data, Protected: Continuous Protection & Postgres Rollbacks"),l.a.createElement("p",{className:"lh-copy"},"Continuous Protection is"," ",l.a.createElement(o.a,{name:"success-badge-16",size:16,fillClass:"green",extraClasses:"nudge-down--2"})," ",l.a.createElement("strong",null,"Enabled"),". Postgres Rollbacks are"," ",c?"available from\n                  ".concat(i.format("dddd, MMMM Do YYYY, HH:mm")," (UTC)."):"temporarily unavailable. Please check back soon."),l.a.createElement("p",{className:"lh-copy gray f5"},"For ",l.a.createElement("strong",{className:"ttc"},u)," Postgres databases, your data \u2014 and any changes made to the database \u2014 are continuously and automatically backed up over the last ",p,". This allows you to create a clone of your database and roll back to a specific point in time."),l.a.createElement("p",{className:"lh-copy mb5 gray f5"}," ","Learn more about"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgres-rollback",target:"_blank",rel:"noopener noreferrer"},"Heroku Postgres Rollbacks"),"."),c&&l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleClick},"Rollback Database")),l.a.createElement("div",{className:"mw8 mb6 "+(this.state.opened?"db":"dn")},l.a.createElement("h3",{className:"normal f5 b mt4"},"Perform a Database Rollback"),l.a.createElement("p",{className:"lh-copy f5"},"Input a date & time"," ",l.a.createElement("strong",null,"newer than ",i.format("dddd, MMMM Do YYYY, HH:mm")," ","(UTC)"),". You may supply an"," ",l.a.createElement("a",{href:"https://en.wikipedia.org/wiki/ISO_8601",target:"_blank",rel:"noopener noreferrer"},"ISO8601-formatted timestamp")," ","or use natural language, like Last Tuesday at noon UTC or June 14th at 21:45."),l.a.createElement("div",{className:"mw6"},l.a.createElement(ds,{onChange:this.handleTimestampChange,valid:a},l.a.createElement("div",null,n.map((function(e,t){return l.a.createElement("p",{key:t},l.a.createElement("strong",null,e))}))))),l.a.createElement("div",{className:"mt3 mw6"},l.a.createElement(Wa,{datastore:e,onChange:this.handleForkChange})),l.a.createElement("div",{className:"mt5"},l.a.createElement(S.HKButton,{type:"primary",onClick:this.handleConfirm,className:"mr2"},"Create Rollback"),l.a.createElement(S.HKButton,{onClick:this.handleCollapse},"Cancel"))))}}]),a}(l.a.Component),ms=Object(d.b)()(us),ps=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleChange=function(t){var a=e.props,n=a.setting,r=a.onChange,s=a.control,i=t.target.value,c=s.parse(i),l=void 0===s.valid||s.valid(i);r(n,l?c:i,l)},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.setting,n=t.value,r=t.control,s=t.description,i=t.disabled,c=t.valid;switch(r.type){case"boolean":e=l.a.createElement("select",{className:"w-100 hk-select",disabled:i,value:n,onChange:this.handleChange},l.a.createElement("option",{value:"true"},"true"),l.a.createElement("option",{value:"false"},"false"));break;case"integer":var o=void 0!==r.unit,d={"w-80":o,"w-100":!o,"br--left":o,"b--red":!c,"hk-focus-ring--red":!c},u=l.a.createElement("input",{className:G()("hk-input",d),type:"number",value:n,required:!0,disabled:i,min:r.min,max:r.max,onChange:this.handleChange});e=r.unit?l.a.createElement("div",{className:"flex"},u,l.a.createElement("div",{className:"bg-light-silver br1 br--right bt br bb b--light-gray ph2 dark-gray flex-auto w-20 flex items-center"},r.unit)):u;break;case"enum":e=l.a.createElement("select",{className:"w-100 hk-select",disabled:i,value:n,onChange:this.handleChange},y.a.map(r.values,(function(e,t){return l.a.createElement("option",{key:t,value:t},e)})));break;default:e=l.a.createElement("input",{className:"w-100 hk-input",disabled:i,type:"text",onChange:this.handleChange})}return l.a.createElement("div",{className:"flex-l justify-between items-center mb4-l"},l.a.createElement("div",{className:"flex-auto f4 pv3 tr-l minw-7 purple"},a),l.a.createElement("div",{className:"flex-auto minw-7 tr ph2-l"},e),l.a.createElement("div",{className:"flex-auto mv3 mv0-l lh-copy mt0-l ml2-l w-100 dark-gray"},s))}}]),a}(l.a.Component);ps.defaultProps={disabled:!1};var hs=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={changeId:void 0,dirty:{},valid:{}},e.handleSettingChange=function(t,a,n){var r=e.props,s=r.datastore,i=r.dispatch;e.state.changeId&&(i(Ha(s,e.state.changeId)),e.setState({changeId:void 0}));var c=s.getIn(["details","settings"],new U.a.List).find((function(e){return e.get("name")===t})),l=Object.assign({},e.state.dirty),o=Object.assign({},e.state.valid);c&&c.get("value")===a?(delete l[t],delete o[t]):(l[t]=a,o[t]=n),e.setState({dirty:l,valid:o})},e.handleSubmit=function(t){var a=e.props,n=a.datastore,r=a.dispatch,s=e.state.dirty,i=nr.a.v4();r({type:Fa.CONFIGURE,addonId:n.get("id"),settings:s,changeId:i}),e.setState({changeId:i,dirty:{}})},e.handleCancel=function(t){t.preventDefault(),e.setState({dirty:{},valid:{}})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this,t=this.props.datastore,a=t.getIn(["details","settings"],new U.a.List).toJS().map((function(t){if(e.constructor.settings[t.name])return Object.assign(t,e.constructor.settings[t.name])})).filter(Boolean),n=this.state,r=n.changeId,s=n.dirty,i=n.valid,c=Ua(t,r),o=!(!c||c.get("state")!==Ze.PENDING),d=!(!c||c.get("state")!==Ze.REJECTED),u=Object.keys(s).length>0,m=Object.values(i).every((function(e){return e}));return l.a.createElement(Ke,{title:"Settings"},l.a.createElement("div",{className:"pl4-l mw8 pb4"},a.map((function(t){var a=t.name in s?s[t.name]:t.value,n=!(t.name in i)||i[t.name];return l.a.createElement(ps,{key:t.name,description:t.description,onChange:e.handleSettingChange,disabled:o,setting:t.name,control:t.control,value:a,valid:n})})),l.a.createElement("div",{className:"mt4 flex"},l.a.createElement("div",{className:"minw-7-l"}),l.a.createElement("div",{className:"flex items-center pl2-l"},l.a.createElement(S.HKButton,{className:"mr1",type:"primary",async:o,disabled:!o&&(!u||!m),onClick:this.handleSubmit},"Save Changes")," or ",l.a.createElement("a",{className:"ml1",href:"#",onClick:this.handleCancel},"cancel")),d&&l.a.createElement("div",{className:"ph2 pv2 red"},l.a.createElement("p",null,"Could not update settings due to an internal error."),l.a.createElement("p",null,"Try again shortly? Our engineers have been notified.")))))}}]),a}(l.a.Component);hs.settings={log_lock_waits:{description:"Log when a session waits longer than 1 second to acquire a lock.",control:{type:"boolean",parse:function(e){return"true"===e}}},log_connections:{description:"Controls whether a log message is produced when a login attempt is made.",control:{type:"boolean",parse:function(e){return"true"===e}}},log_min_duration_statement:{description:l.a.createElement("div",null,"Slow query logging threshold. ",l.a.createElement("span",{className:"hk-badge-code"},"0")," ","logs all queries; ",l.a.createElement("span",{className:"hk-badge-code"},"-1")," disables logging."),control:{type:"integer",valid:function(e){var t=parseInt(e,10);return!isNaN(t)&&t>=-1&&t<2147483648},parse:function(e){return parseInt(e,10)},unit:"ms",max:2147483648,min:-1}},log_statement:{description:"Which statements are logged.",control:{type:"enum",parse:function(e){return e},values:{none:"no statements",ddl:"schema changes",mod:"schema or data changes",all:"all statements"}}},track_functions:{description:"Controls tracking of function call counts and time used.",control:{type:"enum",parse:function(e){return e},values:{none:"no function tracking",pl:"procedural-language function tracking",all:"track all functions"}}}};var fs=Object(d.b)()(hs),gs=(a(1204),function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e,t,a=this.props.datastore,n=a.get("details").toJS();if(n.connections){var r=n.connections.split("/"),s=Object(P.a)(r,2);e=s[0],t=s[1]}return l.a.createElement(Ke,{title:"Utilization",className:"postgresUtilization"},l.a.createElement("div",{className:"flex flex-row flex-wrap"},n.hobby&&l.a.createElement(Yr,{className:"flex-auto mr4 mb4",value:Number.parseInt(e,10),suffix:t&&"of ".concat(t),caption:Object(qe.pluralize)(e||0,"Connection")}),n.hobby&&l.a.createElement(Yr,{className:"flex-auto mr4 mb4",value:n.rows,caption:Object(qe.pluralize)(n.rows||0,"Row"),suffix:"of ".concat(Object(qe.intComma)(n.rowsLimit)),prettifier:function(e){return[Object(qe.intComma)(e),""]},badge:n.rows<=n.rowsLimit?"ok":"error",badgeText:n.rowsLimitComplianceMessage}),l.a.createElement(Yr,{className:"flex-auto mr4 mb4",value:Number.parseInt(n.num_bytes,10),caption:"Data Size",prettifier:function(e){return Object(et.a)(e,1)}}),l.a.createElement(Yr,{className:"flex-auto mr4 mb4",value:Number.parseInt(n.tables,10),caption:Object(qe.pluralize)(n.tables||0,"Table")})),!n.hobby&&l.a.createElement("div",{className:"logs"},l.a.createElement("p",null,"Use the"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-command-line"},"Heroku CLI")," ","to access your logs from the command line:"," ",l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1"},"heroku logs --tail --ps postgres --app"," ",a.getIn(["meta","app_name"])))))}}]),a}(l.a.Component));var vs=function(e){var t=e.name,a=e.attachmentId,n="/dataclips/create?attachmentId=".concat(a);return l.a.createElement("div",{className:"bg-white flex flex-column items-center pv6 ph3 ma3 w-100 mw9"},l.a.createElement("div",{className:"f2 lh-title pb3 purple normal v-mid items-center"},l.a.createElement(o.a,{name:"dataclip-28",size:28,fillClass:"purple",extraClasses:"v-mid nudge-up--2 mr2"}),"Heroku Dataclips: Get Answers From Your Postgres Data"),l.a.createElement("div",{className:""},l.a.createElement("div",{className:"gray tc lh-copy pb3 w-100 mw7 center"},"Data is a company's most valuable asset. With Dataclips, you can easily discover and gain insights from the data you have on the Heroku Platform.")),l.a.createElement("div",{className:"flex-ns mt4 mw8 center"},l.a.createElement("div",{className:"w-100 w-50-l ba b--silver br2 pt3 pb5 ph5"},l.a.createElement("h4",null,"Create your first Dataclip ",t&&"on ".concat(t)),l.a.createElement("p",{className:"gray lh-copy"},"It's easy to write your SQL query in the Dataclips interface and share the results with your team."),l.a.createElement(u.b,{to:n,className:"hk-button-sm--primary"},"Create Dataclip")),l.a.createElement("div",{className:"w1 h1"}),l.a.createElement("div",{className:"w-100 w-50-l ba b--silver br2 pt3 pb5 ph5"},l.a.createElement("h4",{className:"flex-none"},"Learn more about Heroku Dataclips"),l.a.createElement("p",{className:"gray lh-copy flex-none"},"Learn more about the power of Dataclips in the Heroku Dev Center."),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/dataclips",className:"blue link lh-copy",target:"_blank",rel:"noopener noreferrer"},l.a.createElement(o.a,{name:"docs-16",size:16,fillClass:"blue",extraClasses:"nudge-down--3 mr1"}),"Dev Center: Heroku Dataclips"))))},bs=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={sort:{desc:!1,id:"edited_at"}},e.initializeSort=function(t){var a=F.a.parse(t.replace(":","=")),n=Object.keys(a),r=Object(P.a)(n,1)[0],s=Object.values(a),i=Object(P.a)(s,1)[0];e.handleSortChange({id:r,desc:"desc"===i})},e.handleSortChange=function(t){e.setState({sort:t},e.updateQueryParams)},e.updateQueryParams=function(){var t=e.state.sort,a=e.props,n=a.history,r=a.location.search,s=F.a.parse(r);s.sort="".concat(t.id,":").concat(t.desc?"desc":"asc");var i=F.a.stringify(s);n.replace({search:i})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.location,t=F.a.parse(e.search);t.sort&&this.initializeSort(t.sort)}},{key:"render",value:function(){var e,t,a=this.props,n=a.dataclips,r=a.datastore,s=a.fetching,i=a.lastSync,c=a.history;if(i){var o=r.getIn(["meta","attachments"],[]).map((function(e){return e.get("id")})).toJS(),d=o[0];if(0===(e=n.filter((function(e){return o.includes(e.getIn(["datasource","attachment_id"]))}))).size)t=l.a.createElement(vs,{name:r.getIn(["meta","name"]),attachmentId:d});else{var m=this.state.sort;t=l.a.createElement("div",{className:"flex"},l.a.createElement("div",{className:"mr5 flex-none"},l.a.createElement(Yr,{value:e.size,caption:Object(qe.pluralize)(e.size,"dataclip")}),l.a.createElement("div",{className:"pt3"},l.a.createElement(u.b,{className:"hk-button--primary",to:"/dataclips/create?attachmentId=".concat(d)},"Create Dataclip"))),l.a.createElement("div",{className:"flex-auto"},s&&l.a.createElement("div",{className:"fixed bottom-2 right-2"},l.a.createElement(ee.a,{className:"bg-transparent"})),l.a.createElement(Q,{hideDatastore:!0,history:c,sort:m,onSortChange:this.handleSortChange,initialClipCount:n.size,filteredRows:e})))}}else t=l.a.createElement(te,{title:""},l.a.createElement("p",null,"Loading..."));return l.a.createElement(Ke,{title:!e||e.size>0?"Dataclips":""},t)}}]),a}(c.Component),Es=Pe(Object(m.g)(bs));function ys(){var e=Object(Ge.a)(["max$"]);return ys=function(){return e},e}var ks=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={currentTabName:null,selectedTimeframeOption:ut[0]},e.handleTabChange=function(t,a){var n=a[t].anchor;window.location.hash=n,e.setState({currentTabName:n})},e.handleUpdateTimeframe=function(t){e.setState({selectedTimeframeOption:t})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.datastore.getIn(["details","hobby"])||(this.metricsFetchTimerId=window.setInterval((function(){window.paused?k.a.debug("paused: not fetching metrics"):window.navigator.onLine?e._fetchMetrics(!0):k.a.debug("Offline, not fetching metrics")}),Ie.a.duration(5,"minutes").asMilliseconds()),this._fetchMetrics()),Le.a.page("postgres",Object(ve.a)({},Fe(this.props.datastore))),window.location.hash&&this.setState({currentTabName:window.location.hash.split("#").pop()})}},{key:"componentDidUpdate",value:function(e,t){this.state.selectedTimeframeOption!==t.selectedTimeframeOption&&this._fetchMetrics()}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.metricsFetchTimerId)}},{key:"_fetchMetrics",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state.selectedTimeframeOption,a=_a(t),n=Object(P.a)(a,2),r=n[0],s=n[1];k.a.debug("Fetching metrics: ".concat(r.toISOString()," -> ").concat(s.toISOString()));var i=this.props.datastore;this.props.dispatch({type:yt.FETCH_DATASTORE_METRICS,id:i.get("id"),service:i.getIn(["meta","service"]),config:{start:r.toISOString(),end:s.toISOString(),resolution:t.resolution,filter:String.raw(ys()),postProcess:Oa},background:e})}},{key:"render",value:function(){var e=this,t=this.props,a=t.datastore,n=t.user,r=Ua(a,Fa.DESTROY);if(r&&r.get("state")===Ze.FULFILLED)return l.a.createElement("section",{className:"postgresDatastoreInfo flex-auto flex flex-column"},l.a.createElement(Sa,{title:"This database is currently being destroyed"},l.a.createElement("p",null,"Return to the ",l.a.createElement(u.b,{to:"/"},"datastore list"),".")));var s=a.getIn(["details","hobby"]),i=a.getIn(["details","shielded"]),c=a.getIn(["details","usesLegacyInfrastructure"]),o=parseFloat(a.getIn(["details","pg_version"]))>=9.6,d=!i&&n.get("feature_flags").includes("diagnose"),m=!i,p=!(s||i),h=!s,f=!s,g=!s&&!c&&o,v=!s&&!c&&o,b=[l.a.createElement(ms,{key:"rollback",datastore:a}),l.a.createElement(tr,{key:"backups-section",datastore:a})];f&&b.push(l.a.createElement(ns,{key:"followers-section",datastore:a}));var E=[l.a.createElement(is,{key:"postgres-health",datastore:a}),l.a.createElement(gs,{key:"postgres-utilization",datastore:a})];h&&E.splice(1,0,l.a.createElement(cs,{key:"postgresio",datastore:a,onUpdateTimeframe:this.handleUpdateTimeframe}));var y=[];d&&y.push(l.a.createElement(Rr,{key:"postgres-diagnose",datastore:a})),p&&y.push(l.a.createElement(zr,{key:"postgres-expensive-queries",datastore:a}));var k=[l.a.createElement(Wn,{key:"admin-section",hideLegacyCredentials:g,datastore:a})];v&&k.push(l.a.createElement(fs,{key:"settings-section",datastore:a}));var w=[{title:"Overview",node:E,anchor:""},{title:"Credentials",node:g&&l.a.createElement(Sr,{datastore:a}),anchor:"credentials"},{title:"Diagnose",node:y.length&&y,anchor:"diagnose"},{title:"Durability",node:b,anchor:"durability"},{title:"Settings",node:k,anchor:"administration"},{title:"Dataclips",node:m&&l.a.createElement(Es,{datastore:a}),anchor:"dataclips"}].filter((function(e){return e.node})),C=Math.max(0,Aa()(w,(function(t){return t.anchor===e.state.currentTabName})));return l.a.createElement($e.d,{selectedIndex:C,onSelect:function(t){return e.handleTabChange(t,w)},className:"f4"},l.a.createElement($e.b,{className:"pl0 react-tabs__tab-list overflow-x-auto",style:{whiteSpace:"nowrap"}},w.map((function(e){return l.a.createElement($e.a,{style:{transform:"translateY(0)"},key:"".concat(e.title," tab")},e.title)}))),w.map((function(e){return l.a.createElement($e.c,{key:"".concat(e.title," tabpanel")},e.node)})))}}]),a}(l.a.Component),ws=Object(d.b)((function(e){return{user:e.user}}))(ks);function Cs(e){var t=e.datastore;return l.a.createElement(vt,{actionText:"Show Configuration...",actionCollapseText:"Hide Configuration...",dangerous:!1,description:"Generate and manage PrivateLink endpoints to secure database access from outside your Private Space.",title:"Heroku Redis via PrivateLink",hideActionButton:!0,valid:!0},l.a.createElement(na,{datastore:t}))}var Os=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore.getIn(["details","credentials"]);return l.a.createElement(vt,{actionText:"View Credentials\u2026",dangerous:!1,description:"Get credentials for manual connections to this datastore.",hideActionButton:!0,title:"Datastore Credentials"},l.a.createElement("div",{className:"redisCredentialsAction"},l.a.createElement("p",null,"Please note that"," ",l.a.createElement("strong",null,"these credentials are not permanent"),"."),l.a.createElement("p",null,"Heroku rotates credentials periodically and updates applications where this datastore is attached."),l.a.createElement("dl",{className:"mt6 mb0 cf"},l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"Host"),l.a.createElement("dd",{className:"fl mt3 ml0"},e.get("hostname")),l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"User"),l.a.createElement("dd",{className:"fl mt3 ml0"},e.get("user")),l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"Port"),l.a.createElement("dd",{className:"fl mt3 ml0"},e.get("port")),l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"Password"),l.a.createElement("dd",{className:"fl mt3 ml0"},e.get("password")),l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"URI"),l.a.createElement("dd",{className:"fl mt3 ml0"},"redis://",e.get("user"),":",e.get("password"),"@",e.get("hostname"),":",e.get("port")),l.a.createElement("dt",{className:"fl mt3 gray cl w6"},"Heroku CLI"),l.a.createElement("dd",{className:"fl mt3 ml0"},"Please"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-redis#using-the-cli",target:"_blank",rel:"noopener noreferrer"},"read the official documentation")))))}}]),a}(l.a.Component),Ns=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore,t=e.getIn(["meta","plan"]).startsWith("private"),a=[l.a.createElement(Os,{key:"creds",datastore:e})];return t&&a.push(l.a.createElement(Cs,{key:"redis-privatelink",datastore:e})),l.a.createElement(Ke,{title:"Administration",className:"redisAdminSection"},a)}}]),a}(l.a.Component);Ns.defaultProps={};var Is=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props.datastore.get("details").toJS(),t={message:y.a.capitalize(e.status)};switch(e.status){case"preparing (fork in progress)":case"preparing (upgrade in progress)":case"preparing":t.waiting=!0,t.healthy=!0;break;case"available":t.waiting=!1,t.healthy=!0;break;case"deprovisioned":case"unavailable":t.waiting=!1,t.healthy=!1;break;case"unknown":default:t.waiting=!0,t.healthy=!1}var a=l.a.createElement(Ve,{healthy:t.healthy,message:t.message,waiting:t.waiting});return l.a.createElement(We,{status:a},e.customer_encryption_key&&l.a.createElement(Qe,{customer_encryption_key:e.customer_encryption_key,datastore_type:"redis"}),l.a.createElement(ss,{label:"Version",value:e.version}),l.a.createElement(ss,{label:"Maintenance",value:e.maintenance,help:"https://devcenter.heroku.com/articles/heroku-redis-maintenance"}),l.a.createElement(ss,{label:"Maintenance Window",value:e.maintenanceWindow,help:"https://devcenter.heroku.com/articles/heroku-redis-maintenance"}),l.a.createElement(ss,{label:"Eviction Policy",value:e.maxMemory,help:"https://devcenter.heroku.com/articles/heroku-redis#maxmemory-policy"}))}}]),a}(l.a.Component),_s={test:{memory:20971520,clients:20},dev:{memory:20971520,clients:20},"standard-0":{memory:536870912,clients:820},"standard-2":{memory:3221225472,clients:4096},"standard-4":{memory:7516192768,clients:8192},"standard-6":{memory:32212254720,clients:8192},"hobby-dev":{memory:26214400,clients:20},"premium-0":{memory:52428800,clients:40},"premium-1":{memory:104857600,clients:80},"premium-2":{memory:262144e3,clients:200},"premium-3":{memory:524288e3,clients:400},"premium-4":{memory:786432e3,clients:700},"premium-5":{memory:1073741824,clients:1e3},"premium-7":{memory:7516192768,clients:1e4},"premium-9":{memory:10737418240,clients:25e3},"premium-10":{memory:26843545600,clients:4e4},"premium-12":{memory:53687091200,clients:65e3},"premium-14":{memory:107374182400,clients:65e3},"private-7":{memory:7516192768,clients:1e4},"private-9":{memory:10737418240,clients:25e3},"private-10":{memory:26843545600,clients:4e4},"private-12":{memory:53687091200,clients:65e3},"private-14":{memory:107374182400,clients:65e3}},xs=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onHover,n=e.hoverIndex,r=e.maxValue,s=e.metric,i=e.prettifier,c=e.title,o=t.find((function(e){return e.get("name")===s})),d=r?l.a.createElement("small",{className:"gray"},"plan limit: ",i(r)):null;return l.a.createElement("div",{className:"redisUtilizationChart flex flex-auto flex-column",style:{minWidth:"24rem"}},l.a.createElement("h4",{className:"purple normal f3"},c," ",d),l.a.createElement(ot.a,null,(function(e){var t=e.width;e.height;return l.a.createElement(ct,{key:s,data:o,width:t,height:110,prettifier:i,hoverIndex:n,onHover:a,maxValue:r,minValue:0})})))}}]),a}(l.a.Component),Ts=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={hoverIndex:-1},e.handleHover=function(t){e.setState({hoverIndex:t})},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this,t=this.props.datastore,a=this.state.hoverIndex,n=_s[t.getIn(["meta","plan"])],r=t.getIn(["metrics","data"],new U.a.List),s=["append","asking","auth","bgrewriteaof","bgsave","bitcount","bitop","bitpos","blpop","brpop","brpoplpush","client","cluster","command","config","dbsize","debug","decr","decrby","del","discard","dump","echo","eval","evalsha","exec","exists","expire","expireat","flushall","flushdb","get","getbit","getrange","getset","hdel","hexists","hget","hgetall","hincrby","hincrbyfloat","hkeys","hlen","hmget","hmset","hscan","hset","hsetnx","hvals","incr","incrby","incrbyfloat","info","keys","lastsave","latency","lindex","linsert","llen","lpop","lpush","lpushx","lrange","lrem","lset","ltrim","mget","migrate","monitor","move","mset","msetnx","multi","object","persist","pexpire","pexpireat","pfadd","pfcount","pfdebug","pfmerge","pfselftest","ping","psetex","psubscribe","psync","pttl","publish","pubsub","punsubscribe","randomkey","readonly","readwrite","rename","renamenx","replconf","restore","role","rpop","rpoplpush","rpush","rpushx","sadd","save","scan","scard","script","sdiff","sdiffstore","select","set","setbit","setex","setnx","setrange","shutdown","sinter","sinterstore","sismember","slaveof","slowlog","smembers","smove","sort","spop","srandmember","srem","sscan","strlen","subscribe","substr","sunion","sunionstore","sync","time","ttl","type","unsubscribe","unwatch","wait","watch","zadd","zcard","zcount","zincrby","zinterstore","zlexcount","zrange","zrangebylex","zrangebyscore","zrank","zrem","zremrangebylex","zremrangebyrank","zremrangebyscore","zrevrange","zrevrangebylex","zrevrangebyscore","zrevrank","zscan","zscore","zunionstore"].filter((function(e){return r.find((function(t){return y.a.includes(["cmd_".concat(e,"_calls_max"),"cmd_".concat(e,"_time_spent_max")],t.get("name"))}))})).map((function(t){var n="".concat(t.toUpperCase()," Stats");return l.a.createElement(Ke,{key:t,title:n,className:"redisUtilization"},l.a.createElement("div",{className:"chartBlock"},l.a.createElement(xs,{data:r,onHover:e.handleHover,hoverIndex:a,metric:"cmd_".concat(t,"_calls_max"),prettifier:et.c,title:"Calls"}),l.a.createElement(xs,{data:r,onHover:e.handleHover,hoverIndex:a,metric:"cmd_".concat(t,"_time_spent_max"),prettifier:function(e){var t=e/1e6,a=Object(et.c)(t,5e4);return[a[0],"".concat(a[1],"s")]},title:"Time spent"})))}));return l.a.createElement("div",null,l.a.createElement(Ke,{title:"Utilization",className:"redisUtilization"},l.a.createElement("div",{className:"chartBlock flex flex-column flex-row-l"},l.a.createElement(xs,{data:r,onHover:this.handleHover,hoverIndex:a,metric:"total_keys_max",prettifier:et.c,title:"Keys"}),l.a.createElement(xs,{data:r,onHover:this.handleHover,hoverIndex:a,maxValue:n&&n.clients,metric:"connected_clients_max",prettifier:et.c,title:"Clients"}),l.a.createElement(xs,{data:r,onHover:this.handleHover,hoverIndex:a,maxValue:n&&n.memory,metric:"used_memory_max",prettifier:et.a,title:"Memory"}))),s)}}]),a}(l.a.Component),Ds=Object(d.b)()(Ts),Ss=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={currentTabAnchor:null},e.handleTabChange=function(t,a){var n=a[t].anchor;window.location.hash=n,e.setState({currentTabAnchor:n})},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.metricsFetchTimerId=window.setInterval((function(){window.paused?k.a.debug("paused: not fetching metrics"):window.navigator.onLine?e._fetchMetrics(!0):k.a.debug("Offline, not fetching metrics")}),Ie.a.duration(5,"minutes").asMilliseconds()),this._fetchMetrics(),Le.a.page("redis",Object(ve.a)({},Fe(this.props.datastore)))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.metricsFetchTimerId)}},{key:"_fetchMetrics",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ut.find((function(e){return"Past24hrs"===e.value})),a=_a(t),n=Object(P.a)(a,2),r=n[0],s=n[1];k.a.debug("Fetching metrics: ".concat(r.toISOString()," -> ").concat(s.toISOString()));var i=this.props.datastore;this.props.dispatch({type:yt.FETCH_DATASTORE_METRICS,id:i.get("id"),service:i.getIn(["meta","service"]),config:{start:r.toISOString(),end:s.toISOString(),resolution:"10m",filter:"_max$",postProcess:Na},background:e})}},{key:"render",value:function(){var e=this,t=this.props.datastore,a=[l.a.createElement(Is,{key:"redis-health",datastore:t}),l.a.createElement(Ds,{key:"redis-utilization",datastore:t})],n=[l.a.createElement(Ns,{key:"redis-admin",datastore:t})],r=[{title:"Overview",node:a,anchor:""},{title:"Settings",node:n.length&&n,anchor:"settings"}].filter((function(e){return e.node})),s=Math.max(0,y.a.findIndex(r,(function(t){return t.anchor===e.state.currentTabAnchor})));return l.a.createElement($e.d,{selectedIndex:s,onSelect:function(t){return e.handleTabChange(t,r)},className:"f4"},l.a.createElement($e.b,{className:"pl0 react-tabs__tab-list overflow-x-auto",style:{whiteSpace:"nowrap"}},r.map((function(e){return l.a.createElement($e.a,{style:{transform:"translateY(0)"},key:"".concat(e.title," tab")},e.title)}))),r.map((function(e){return l.a.createElement($e.c,{key:"".concat(e.title," tabpanel")},e.node)})))}}]),a}(l.a.Component),js=Object(d.b)()(Ss),As=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleOpenInDashboard=function(){Le.a.track("Open In Dashboard",Object(ve.a)({},Fe(e.props.datastore)))},e.handleBacklinkClicked=function(){Le.a.track("All Datastores Clicked",Object(ve.a)({},Fe(e.props.datastore)))},e}return Object(r.a)(a,[{key:"renderDatastoreContent",value:function(e){var t,a=window.service;switch(e.getIn(["meta","service"])){case a.kafka:t=l.a.createElement(Da,{datastore:e});break;case a.redis:t=l.a.createElement(js,{datastore:e});break;case a.postgres:case a.postgresInternal:t=l.a.createElement(ws,{datastore:e});break;default:t=l.a.createElement("p",null,"Only Kafka datastores are currently supported.")}return l.a.createElement(Me,null,t)}},{key:"render",value:function(){var e,t=this.props.datastore,a="Enabled"===t.getIn(["details","mutual_tls"]),n=t.get("meta"),r=t.getIn(["details","_change","state"],null),s=t.hasIn(["details","name"]);switch(r){case Ze.PENDING:case null:e=s?this.renderDatastoreContent(t):l.a.createElement(te,null,l.a.createElement("p",null,"Fetching details about ",l.a.createElement("strong",null,n.get("name"))));break;case Ze.REJECTED:s?(k.a.debug("details sync failed; reusing previous details"),e=this.renderDatastoreContent(t)):e=l.a.createElement(Sa,{title:"Internal Error"},l.a.createElement("p",null,"Couldn\u2019t fetch details about ",l.a.createElement("strong",null,n.get("name"))),l.a.createElement("p",null,"Sorry about that! Our engineers have been notified."),l.a.createElement("p",null,"Perhaps return to the ",l.a.createElement(u.b,{to:"/"},"datastore list"),"?"));break;case Ze.FULFILLED:e=this.renderDatastoreContent(t);break;default:e=l.a.createElement(te,null,l.a.createElement("p",null,"Fetching details about ",l.a.createElement("strong",null,n.get("name"))))}return l.a.createElement(h.a,{title:n.get("name")+" | Heroku Data"},l.a.createElement("section",{className:"datastoredetailpage"},l.a.createElement("div",{className:"bg-lightest-silver pa3"},l.a.createElement("header",{className:"flex flex-row items-center f3 dark-gray"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.Datastore28,size:28,fill:S.Fills.DarkGray}),l.a.createElement(u.b,{to:"/",className:"link gray normal ph1",onClick:this.handleBacklinkClicked},"Datastores"),l.a.createElement(S.HKIcon,{name:S.ProductIcons.NavForward16,size:20,fill:S.Fills.DarkGray}),l.a.createElement(q,{service:n.get("service"),baseSize:28,displaySize:28,extraClasses:"ph1"}),l.a.createElement("h3",{className:"ma0 pa0 f3 dark-gray normal flex-auto"},n.get("name"))),l.a.createElement("div",{className:"f5 gray"},l.a.createElement("div",{className:"flex flex-wrap nh3-ns"},l.a.createElement("div",{className:"w-100 w-auto-ns ph3-ns mt3"},l.a.createElement("span",{className:"ttu f6 tracked pr2"},"Service"),l.a.createElement("span",{className:"dark-gray"},n.get("service"))),l.a.createElement("div",{className:"w-100 w-auto-ns ph3-ns mt3"},l.a.createElement("span",{className:"ttu f6 tracked pr2"},"Plan"),l.a.createElement("span",{className:"dark-gray"},n.get("plan"))),l.a.createElement("div",{className:"w-100 w-auto-ns ph3-ns mt3"},l.a.createElement("span",{className:"ttu f6 tracked pr2"},"Billing App"),l.a.createElement("span",{className:"purple"},l.a.createElement("a",{href:"https://dashboard.heroku.com/apps/".concat(n.get("app_name")),target:"_blank",rel:"noopener noreferrer",onClick:this.handleOpenInDashboard,className:"link normal"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.App16,fill:S.Fills.GradientPurple,size:16,className:"v-tbtm"})," ",n.get("app_name")))),a?l.a.createElement("div",{className:"w-100 w-auto-ns ph3-ns mt3 red"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.WarningBadge16,size:16,fill:S.Fills.Red,className:"v-tbtm"})," ","Secure External Access is enabled"):null))),e))}}]),a}(l.a.PureComponent),Rs=function(e){var t=e.datastore,a=t.get("meta"),n=a.getIn(["attachments",0]),r=Ra(a.get("name"),n.get("app_name"),{shield:t.getIn(["details","shielded"],!1),attachment:n.get("name")});return l.a.createElement("div",{className:"pa6"},"You have limited access to this database. You cannot manage backups, forks, or followers, or view metrics. You can connect directly via psql console through the heroku CLI:",l.a.createElement("div",{className:"pt2"},l.a.createElement("code",{className:"bg-light-silver dib pa1 f5 ba b--silver br1"},r)))},Ps=g.a.mark(Ls);function Ls(e,t){var a,n=arguments;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.length>2&&void 0!==n[2]&&n[2],r.next=3,ie({type:yt.FETCH_DATASTORE_DETAILS,id:e,service:t,background:a});case 3:case"end":return r.stop()}}),Ps)}var Us=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).firstLoad=!0,r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.firstLoad=!1}},{key:"getDatastoreFromLocation",value:function(){var e=this.props,t=e.match,a=e.datastores,n=t.params.id;return a.find((function(e){return n===e.get("id")||n===e.getIn(["meta","id"])||n===e.getIn(["meta","name"])}))}},{key:"render",value:function(){var e=this.props.loaded,t=this.getDatastoreFromLocation();if(!t)return e?l.a.createElement(Sa,null,l.a.createElement("p",null,"Perhaps return to the ",l.a.createElement(u.b,{to:"/"},"datastore list"),"?")):l.a.createElement(te,null,l.a.createElement("p",null,"Loading datastores\u2026"));var a=this.props,n=a.location,r=a.match.params.id,s=t.get("id"),i=t.getIn(["meta","attachments"]).some((function(e){return null===e.get("namespace")}));return s!==r?l.a.createElement(m.a,{to:"/datastores/".concat(s).concat(n.search).concat(n.hash)}):i?"heroku-kafka"===t.getIn(["meta","service"])&&"true"===xe.b.REACT_APP_DATA_REDIRECT_TO_DASHBOARD?(window.location.assign("".concat(xe.b.REACT_APP_DASHBOARD_APP_URL,"/apps/").concat(t.getIn(["meta","app_name"]),"/datastores/").concat(s)),null):l.a.createElement(N,{arguments:[t.get("id"),t.getIn(["meta","service"]),!this.firstLoad],generator:Ls,autorun:!0,expireAfter:6e4},(function(){return l.a.createElement(As,{datastore:t})})):l.a.createElement(Rs,{datastore:t})}}]),a}(c.Component),Hs=Object(d.b)((function(e){return{loaded:e.user&&!!e.user.get("id"),featureFlags:e.user.get("feature_flags"),datastores:e.datastores}}))(Object(m.g)(Us)),Fs=a(105),Ms=a(621),Gs=a.n(Ms),$s=function(e){var t=e.rowData,a=e.column;return l.a.createElement("div",{className:"flex items-center"},l.a.createElement(q,{baseSize:16,displaySize:16,service:t.meta.service,fillClass:"purple",extraClasses:"flex-none pr2"}),l.a.createElement(Gs.a,{className:"near-black",highlightClassName:"token-highlight",searchWords:[a.query],textToHighlight:t.meta.name}))},qs=function(e){var t=e.rowData,a=e.column;return l.a.createElement(Gs.a,{className:"near-black",highlightClassName:"token-highlight",searchWords:[a.query],textToHighlight:t.meta.plan})},Bs=function(e){var t=e.rowData,a=e.column;return l.a.createElement("div",{className:"flex items-center"},l.a.createElement(S.HKIcon,{className:"flex-shrink-0",name:S.ProductIcons.App16,size:16,fill:S.Fills.Purple}),l.a.createElement("span",{className:"gray ml1 inline-block"},l.a.createElement(Gs.a,{className:"near-black",highlightClassName:"token-highlight",searchWords:[a.query],textToHighlight:t.meta.app_name})))},zs=function(e){var t=e.rowData,a=e.column;return l.a.createElement(Gs.a,{className:"near-black",highlightClassName:"token-highlight",searchWords:[a.query],textToHighlight:t.meta.team_name})},Ks=function(e){e.columns;var t=e.rowData;e.rowIndex;return{tagName:u.b,"aria-label":t.meta.name,rowKey:t.id,to:"/datastores/".concat(t.id)}},Ws=function(e){var t=e.query,a=e.sort,n=e.onSort,r=e.data;return l.a.createElement(Fs.a,null,(function(e){var s=e.height,i=e.width;return l.a.createElement(Fs.d,{onColumnSort:n,className:"hk-table",rowHeight:50,rowProps:Ks,rowKey:"id",fixed:!0,headerHeight:40,data:r,width:i,sortBy:a,cellProps:{query:t},height:s},l.a.createElement(Fs.b,{headerClassName:"hk-table-header",key:"name",dataKey:"meta.name",dataGetter:$s,sortable:!0,resizable:!0,title:"Name",query:t,width:250,minWidth:180}),l.a.createElement(Fs.b,{headerClassName:"hk-table-header",key:"plan",dataKey:"meta.plan",dataGetter:qs,sortable:!0,resizable:!0,title:"Plan",query:t,width:140,minWidth:100}),l.a.createElement(Fs.b,{headerClassName:"hk-table-header",key:"app_name",dataKey:"meta.app_name",dataGetter:Bs,sortable:!0,resizable:!0,title:"Application",query:t,width:300,minWidth:180}),l.a.createElement(Fs.b,{headerClassName:"hk-table-header",key:"team_name",dataKey:"meta.team_name",dataGetter:zs,sortable:!0,resizable:!0,title:"Team",query:t,width:300,minWidth:180}))}))},Js=function(e){var t=e.query;return l.a.createElement("div",{className:"hk-well flex flex-column items-center justify-center flex-auto"},l.a.createElement("div",{className:"pa4 pb6 b--light-gray flex flex-column items-center"},l.a.createElement("div",{className:"flex-none flex flex-row items-center gray mb2"},l.a.createElement(o.a,{name:"datastore-28",size:28,fillClass:"purple",extraClasses:"mr1"})),l.a.createElement("h1",{className:"f4 b"},"No datastores found for: ",t),l.a.createElement("p",{className:"gray mb5"},"Try changing your query")))};function Ys(){return l.a.createElement("section",{className:"notfound flex h-100 w-100 flex-auto items-center justify-center tc bg-lightest-silver"},l.a.createElement("div",{className:"bg-white ph4 pt4 pb7 br3 ba b--light-gray shadow-4 mt4 mh7 flex flex-column items-center"},l.a.createElement("h2",{className:"purple normal v-mid"},"Welcome!"),l.a.createElement("div",{className:"w-50"},l.a.createElement("p",{className:"mid-gray text-center tc lh-copy"},"It looks like you don't have any datastores yet.")),l.a.createElement("div",{className:"flex flex-row justify-center mt4 justify-between w-80"},l.a.createElement("section",{className:"w-90 ba b--silver br3 pt3 pb5 ph5 mr3 flex flex-column items-center"},l.a.createElement(q,{service:window.service.postgres,baseSize:28,displaySize:32}),l.a.createElement("h4",{className:"bb b--silver pb4 dib v-mid ml2"},"Heroku Postgres"),l.a.createElement("p",{className:"mb4 lh-copy"},"A relational SQL database.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-postgresql",target:"_blank",rel:"noopener noreferrer"},"Learn more")),l.a.createElement(S.HKButton,{type:"primary",onClick:function(e){return window.open("https://elements.heroku.com/addons/heroku-postgresql","_blank")}},"Create one")),l.a.createElement("section",{className:"w-90 ba b--silver br3 pt3 pb5 ph5 mr3 flex flex-column items-center"},l.a.createElement(q,{service:window.service.redis,baseSize:28,displaySize:32}),l.a.createElement("h4",{className:"bb b--silver pb4 dib v-mid ml2"},"Heroku Redis"),l.a.createElement("p",{className:"mb4 lh-copy"},"A widely used key/value store.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-redis",target:"_blank",rel:"noopener noreferrer"},"Learn more")),l.a.createElement(S.HKButton,{type:"primary",onClick:function(e){return window.open("https://elements.heroku.com/addons/heroku-redis","_blank")}},"Create one")),l.a.createElement("section",{className:"w-90 ba b--silver br3 pt3 pb5 ph5 mr3 flex flex-column items-center"},l.a.createElement(q,{service:window.service.kafka,baseSize:28,displaySize:32}),l.a.createElement("h4",{className:"bb b--silver pb4 dib v-mid ml2"},"Heroku Kafka"),l.a.createElement("p",{className:"mb4 lh-copy"},"A distributed streaming platform.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/heroku-kafka",target:"_blank",rel:"noopener noreferrer"},"Learn more")),l.a.createElement(S.HKButton,{type:"primary",onClick:function(e){return window.open("https://elements.heroku.com/addons/heroku-kafka","_blank")}},"Create one")))))}var Vs=Object(d.b)((function(e){return{datastores:e.datastores&&e.datastores.toList().toJS()}}))((function(e){var t=e.datastores,a=e.location,n=e.history,r=F.a.parse(a.search),s=r.query,i=r.key,c=r.order;l.a.useEffect((function(){Le.a.page("Datastores List")}),[]);var o=l.a.useState({key:i||"name",order:c||"desc"}),d=Object(P.a)(o,2),u=d[0],m=d[1],p=l.a.useCallback((function(e){var t=e.key,a=e.order;m({key:t,order:a}),r.query=s,r.key=t,r.order=a;var i=F.a.stringify(r);n.replace({search:i})}),[m,r]),h=l.a.useMemo((function(){return a=t,n=[["meta","app_name"],["meta","name"],["meta","plan"],["meta","team_name"]],(e=s)?(e=String(e).toLowerCase(),a.filter((function(t){return n.map((function(e){return Object(E.get)(t,e)})).filter((function(e){return void 0!==e})).map((function(e){return String(e).toLowerCase()})).some((function(t){return t.includes(e)}))}))):a;var e,a,n}),[t,s]),f=l.a.useMemo((function(){return Object(E.orderBy)(h,(function(e){return e.meta[u.key]}),[u.order])}),[h,u]);return 0===t.length?l.a.createElement(Ys,null):0===h.length?l.a.createElement(Js,{query:s}):l.a.createElement(Ws,{onSort:p,query:s,sort:u,data:f})})),Qs=a(687),Xs=function(e){var t=e.history,a=e.location,n=e.tabs,r=a.pathname.includes("/dataclips"),s="/"===a.pathname?a.pathname:a.pathname.replace(/\/+$/,""),i=n.find((function(e){return s===e.path})),c=a.search?F.a.parse(a.search).query:"";return!!i&&l.a.createElement("div",null,l.a.createElement("div",{className:"flex-ns items-center"},l.a.createElement("nav",{className:"flex-auto bb bn-ns b--silver"},l.a.createElement("header",{className:"f3 flex-row items-center dark-gray"},l.a.createElement("div",{className:"hk-tabs bn justify-center justify-start-ns"},n.map((function(e){return l.a.createElement(u.c,{exact:!0,key:e.title,to:e.path,className:"hk-tabs__tab pv3 pv4-ns mh2 mh0-ns ph0 ph2-ns nudge-down--1",activeClassName:"hk-tabs__tab--active bb b--purple"},l.a.createElement(o.a,{name:e.icon,size:24,extraClasses:"db dn-l color-inherit"}),l.a.createElement("span",{className:"dn db-l"},e.title))}))))),l.a.createElement("div",{className:"pa3 pv0-ns pr3-ns flex-auto-ns mw7-ns bg-lightest-silver bg-white-ns"},l.a.createElement("div",{className:"flex items-center"},l.a.createElement(Qs.DebounceInput,{className:"hk-input w-100",key:a.pathname,placeholder:"Filter ".concat(i.title," by ").concat(i.placeholder),onChange:function(e){var n=e.target.value,r=a.search,s=F.a.parse(r);s.query=n||void 0;var i=F.a.stringify(s);t.replace({search:i})},value:c,debounceTimeout:200}),r&&l.a.createElement("div",{className:"ml2"},l.a.createElement(S.HKButton,{type:"primary",onClick:function(){t.push("/dataclips/create")}},"New Dataclip"))))),l.a.createElement("div",{className:"spacer flex-auto bb b--light-silver"}))},Zs=Object(d.b)((function(e){return{user:e.user}}))(Object(m.g)((function(e){var t=e.children,a=e.history,n=e.location,r=e.user,s=[{title:"Datastores",path:"/",placeholder:"name, plan, application, or team",icon:"datastore-28"},{title:"Dataclips",path:"/dataclips",placeholder:"name, application, team, etc",icon:"dataclip-28"}].filter(Boolean);return 0===r.size?l.a.createElement(te,{title:""},l.a.createElement("p",null,"Loading...")):null===r.get("last_sync",null)?l.a.createElement(te,{title:"Welcome!"},l.a.createElement("p",null,"Sit tight while we find your datastores! This process only happens during your first visit, and can take a minute or two."),l.a.createElement("p",null,"This page will automatically refresh when we're done.")):l.a.createElement("div",{className:"flex flex-column flex-1"},l.a.createElement("div",{className:"flex-shrink-0"},l.a.createElement(Xs,{tabs:s,history:a,location:n})),l.a.createElement("div",{className:"flex flex-column flex-1"},t))}))),ei=a(653),ti=a(647),ai=a(178),ni=function(e){var t=e.values,a=e.errors,n=e.handleChange,r=e.handleSubmit,s=e.isSubmitting;return l.a.createElement("form",{onSubmit:r},l.a.createElement("div",null,l.a.createElement("label",{htmlFor:"email",className:"db pt4 pb2"},"Email Address"),l.a.createElement("input",{onChange:n,name:"email",id:"email",type:"email",className:"hk-input w-100 ".concat(a.email&&"b--red"),value:t.email}),a.email?l.a.createElement("p",{id:"email-error",className:"f6 red mt1 mb0 fw6"},a.email):null),l.a.createElement("div",null,l.a.createElement("label",{htmlFor:"reason",className:"db pt4 pb2"},"Reason"),l.a.createElement("input",{onChange:n,name:"reason",id:"reason",type:"text",className:"hk-input w-100 ".concat(a.reason&&"b--red"),value:t.reason}),a.reason?l.a.createElement("p",{id:"reason-error",className:"f6 red mt1 mb0 fw6"},a.reason):null),l.a.createElement("div",{className:"mb4"},l.a.createElement("label",{htmlFor:"code",className:"db pt4 pb2"},"Code"),l.a.createElement("input",{onChange:n,name:"code",id:"code",type:"text",className:"hk-input w-100 ".concat(a.code&&"b--red"),value:t.code}),a.code?l.a.createElement("p",{id:"code-error",className:"f6 red mt1 mb0 fw6"},a.code):null),l.a.createElement("button",{disabled:s,className:"hk-button--primary w-100",type:"submit"},s?"Submitting...":"Submit"))},ri=ti.a().shape({email:ti.b().required("You must enter an email address"),reason:ti.b().required("You must enter a reason"),code:ti.b().required("You must enter a 2FA code")}),si=function(e){var t=e.user,a=l.a.useState(null),n=Object(P.a)(a,2),r=n[0],s=n[1],i=function(){var e=Object(v.a)(g.a.mark((function e(a,n){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.setSubmitting,i=n.setFieldError,s(null),e.prev=2,e.next=5,ai.a.impersonateUser(a,t.access_token);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),e.t0.response&&401===e.t0.response.status?i("code","Invalid code provided."):s(e.t0);case 10:return e.prev=10,r(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,7,10,13]])})));return function(t,a){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:"flex items-center justify-center pt4"},l.a.createElement("div",{className:"mw6 w-100"},l.a.createElement("h1",{className:"f1 purple"},"Impersonate"),r&&l.a.createElement("div",{id:"unexpected-form-error",className:"flex items-center hk-message--danger"},l.a.createElement("div",{className:"flex-auto"},l.a.createElement("div",{className:"f4 b lh-title"},"An unknown error occurred."),l.a.createElement("div",{className:"lh-copy"},"Please try again."))),l.a.createElement(ei.a,{validateOnBlur:!1,validateOnChange:!1,validationSchema:ri,initialValues:{email:"",reason:"",code:""},onSubmit:i,render:ni})))},ii=function(){return l.a.useEffect((function(){xe.a.clear(),window.location.assign(xe.b.REACT_APP_LOGOUT_URL)})),null},ci=function(){xe.a.clearSession(),window.location.assign("/")},li=function(e){var t=e.linkText;return l.a.createElement(u.b,{className:"tc no-underline impersonation-fab bg-red white fw7 ttu f6",to:"/release"},t)};var oi=function(e,t){var a,o;return o=a=function(a){Object(s.a)(o,a);var c=Object(i.a)(o);function o(){return Object(n.a)(this,o),c.apply(this,arguments)}return Object(r.a)(o,[{key:"componentDidMount",value:function(){document.body.classList.add(t)}},{key:"componentWillUnmount",value:function(){document.body.classList.remove(t)}},{key:"render",value:function(){return l.a.createElement(e,this.props)}}]),o}(c.Component),a.displayName="withBodyClass",o},di=a(132),ui=a(699),mi=a.n(ui),pi=a(633),hi=function(e,t){if(""===t)return e;var a,n=Object(pi.match)(e,t),r=[],s=!1;return e.split("").forEach((function(e,t){!n.includes(t)&&s&&(s=!1,r.push(l.a.createElement("mark",{className:"bg-light-yellow black",key:t},a))),n.includes(t)&&!s&&(s=!0,a=[]),s?a.push(e):r.push(e)})),s&&(s=!1,r.push(l.a.createElement("mark",{className:"bg-light-yellow black",key:e.length},a))),l.a.createElement("span",null,r)};var fi=function(e){var t=e.innerRef,a=e.innerProps,n=e.data,r=e.getStyles,s=e.selectProps.inputValue,i=n.isSpace?n.isShielded?"space-shielded-16":"space-16":"datastore-16",d=n.isSpace?"blue":"dark-gray",u=n.isSpace?"blue":"gray",m=function(e,t){return Object(E.sortBy)(e,(function(e){var a=e.app_name===t,n="DATABASE"===e.name;return"".concat(a&&"  ").concat(n&&" ").concat(e.app_name).concat(e.name)}))}(n.attachments,n.app_name).map((function(e,t,a){return l.a.createElement("div",{key:e.id,className:"mb1 nowrap flex-none flex flex-row items-center"},l.a.createElement("code",{className:"bg-lightest-silver pa1 f6 ba b--silver br1"},hi(e.name,s))," ",l.a.createElement("span",{className:"mh1 gray"},"on")," ",l.a.createElement(o.a,{name:"app-16",size:14,fillClass:"purple",extraClasses:"v-mid"}),"\u2009",hi(e.app_name,s),t<a.length-1&&l.a.createElement("span",{className:"light-gray mh2"},"\u2022"))}));return l.a.createElement("div",Object.assign({ref:t,style:r("option",e)},a),l.a.createElement("div",{className:"flex flex-row mv1"},l.a.createElement(o.a,{name:"data-postgres-16",size:16,fillClass:"purple",extraClasses:"v-mid flex-none mr1"}),l.a.createElement("div",{className:"flex flex-column w-100"},l.a.createElement("div",{className:"flex flex-row items-baseline mb2 w-100"},l.a.createElement("div",{className:"flex-auto mh1 f4"},hi(n.name,s)),l.a.createElement("div",{className:"flex flex-row f6 gray"},l.a.createElement(o.a,{name:i,size:14,fillClass:d,extraClasses:"v-mid mr1"}),l.a.createElement("span",{className:u},n.plan),n.role&&l.a.createElement(c.Fragment,null,l.a.createElement(o.a,{name:"info-ring-16",size:14,fillClass:d,extraClasses:"v-mid mr1 ml2"}),l.a.createElement("span",{className:u},n.role)))),l.a.createElement("div",{className:"flex flex-row flex-wrap w-100"},m))))},gi=function(e){var t=e.innerRef,a=e.innerProps,n=e.data,r=e.getStyles,s=n.isSpace?n.isShielded?"space-shielded-16":"space-16":"datastore-16";return l.a.createElement("div",Object.assign({ref:t,style:r("singleValue",e)},a),l.a.createElement("div",{className:"flex items-center justify-between"},l.a.createElement("div",{className:"flex items-center"},l.a.createElement(o.a,{name:"data-postgres-16",size:16,fillClass:"purple",extraClasses:"mr1 dib flex-none"}),l.a.createElement("div",{className:"mr2 flex-auto"},n.name)),l.a.createElement("div",{className:"flex items-center truncate pr1"},l.a.createElement("span",{className:"inline-flex items-center truncate overflow-hidden mr2"},l.a.createElement(o.a,{name:"app-16",size:16,fillClass:"dark-gray",extraClasses:"flex-none mr1"}),l.a.createElement("span",{className:"truncate h1 nudge-down--1"},n.app_name)),l.a.createElement("span",{className:"inline-flex items-center truncate overflow-hidden"},l.a.createElement(o.a,{name:s,size:14,fillClass:n.isSpace?"blue":"dark-gray",extraClasses:"flex-none mr1"}),l.a.createElement("span",{className:"truncate h1 nudge-down--1 ".concat(n.isSpace?"blue":"gray")},n.plan)))))},vi=a(635),bi=Object(vi.a)((function(e){return e.datastores}),(function(e){return e.filter((function(e){return!e.getIn(["meta","plan"]).startsWith("shield")})).valueSeq().filter((function(e){return e.getIn(["meta","service"])===window.service.postgres||e.getIn(["meta","service"])===window.service.postgresInternal})).toJS().map((function(e){return{id:e.id,app_name:e.meta.app_name,app_uuid:e.meta.app_uuid,name:e.meta.name,plan:e.meta.plan,role:e.meta.role,isSpace:e.meta.plan.startsWith("private")||e.meta.plan.startsWith("shield"),isShielded:e.meta.plan.startsWith("shield"),value:e.id,label:"".concat(e.meta.name," ").concat(e.meta.plan),attachments:e.meta.attachments.filter((function(e){return null===e.namespace}))}}))})),Ei=Object(vi.a)((function(e){return e.datastores}),(function(e,t){return t}),(function(e,t){return e.find((function(e){return e.getIn(["meta","attachments"],U.a.List()).find((function(e){return e.get("id")===t}))}))})),yi={Option:fi,SingleValue:gi},ki=l.a.memo((function(e){var t,a,n=e.className,r=e.disabled,s=e.innerProps,i=e.onChange,c=e.value,o=Object(d.d)(bi),u=function(e,t){if(""===e)return t;var a=t.map((function(t){var a=Object(pi.score)(t.app_name,e),n=Object(pi.score)(t.name,e),r=t.attachments.map((function(t){return Object(pi.score)(t.name,e)+Object(pi.score)(t.app_name,e)})).reduce((function(e,t){return e+t}),0);return Object(ve.a)(Object(ve.a)({},t),{},{score:a+n+r})}));return Object(E.sortBy)(a.filter((function(e){return e.score})),["score"]).reverse().slice(0,50)};return l.a.createElement("div",{className:G()("reactSelect",n)},l.a.createElement(mi.a,Object.assign({className:"postgres-chooser",classNamePrefix:"postgres-chooser",name:"postgres-chooser",placeholder:"Select a datastore",loadOptions:function(e,t){var a=o,n=e.trim();a.length<=50?t(u(n,a)):n.length<3?t([]):t(u(n,a))},defaultOptions:o.length<=50?o:[],value:(t=o,a=c,t.find((function(e){return e.attachments.find((function(e){return e.id===a}))}))),components:yi,styles:dr,id:"clip-pg-chooser",instanceId:"clip-pg-chooser",menuPosition:"fixed",isMulti:!1,isClearable:!0,isDisabled:r,onChange:function(e){i(function(e){var t=!e,a=Object(E.isArray)(e)&&0===e.length;if(t||a)return null;var n=e.app_uuid,r=e.attachments.filter((function(e){return e.app_uuid===n})),s=r.find((function(e){return"DATABASE"===e.name}));if(s)return s.id;var i=r.find((function(e){return e.app_uuid===n}));if(i)return i.id;var c=e.attachments,l=c.find((function(e){return"DATABASE"===e.name}));return l?l.id:c[0].id}(e))},noOptionsMessage:function(e){return e.inputValue.length<3&&o.length>50?"Type at least three characters to filter your datastores\u2026":"No matching datastores found"}},s)))})),wi=a(1279),Ci=a(1233),Oi=a.n(Ci),Ni={foreground:"586E75"},Ii={foreground:"8b2ed9"},_i={foreground:"93a1a1"},xi={foreground:"3072d5"},Ti={base:"vs",inherit:!0,colors:{"editor.foreground":"#".concat(Ni.foreground),"editor.background":"#fff","editor.lineHighlightBackground":"#f2f4f7","editor.selectionBackground":"#e8e1fd","editor.inactiveSelectionBackground":"#e8e1fd","editorLineNumber.foreground":"#ccc"},rules:[Object(ve.a)({token:"keyword.sql"},Ii),Object(ve.a)({token:"operator.sql"},Ii),Object(ve.a)({token:"predefined.sql"},Ii),Object(ve.a)({token:"comment.sql"},_i),Object(ve.a)({token:"comment.quote.sql"},_i),Object(ve.a)({token:"numeric.sql"},{foreground:"d33682"}),Object(ve.a)({token:"identifier.sql"},xi),Object(ve.a)({token:"identifier.quote.sql"},xi),Object(ve.a)({token:"delimiter.sql"},Ni),Object(ve.a)({token:"delimiter.parenthesis.sql"},Ni),Object(ve.a)({token:"string.sql"},{foreground:"d47200",background:"ffe7c1"})]},Di=a(1236),Si=a(1237);function ji(e,t){var a=t.split("."),n={schema:null,relation:null};return n.schema=function(e,t){return Ai(e,t)||Ai(e,"public")}(e,a[0]),n.relation=function(e,t){if(!e)return;var a=e.get("name")===t[0]?t[1]:t[0];if(!a)return;return function(e,t){return e.get("relations").find((function(e){return e.get("name")===t}))}(e,a)}(n.schema,a.slice(0,2)),n}function Ai(e,t){return e.get("schemas").find((function(e){return e.get("name")===t}))}var Ri=["FROM","JOIN","WHERE","ON","AND","OR"],Pi=function(){function e(t){var a,r,s=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(n.a)(this,e),this.handleAutocomplete=function(e,t){var a=s.getDatastoreSchema(),n=s.getWordsFromCurrentLine(e,t),r=s.getAllPreviousWords(e,t),i=n[n.length-2]||"",c=n[n.length-1],l=c.endsWith("."),o=[];if(l||o.push.apply(o,Object(b.a)(s.baseCompletion)),!a)return o;if(Ri.includes(i.toUpperCase())||""===i&&r.includes("SELECT")){var d=ji(a,c),u=!d.relation&&!l,m=d.relation;u&&o.push.apply(o,Object(b.a)(s.getSchemasCompletion(a))),d.relation&&l||o.push.apply(o,Object(b.a)(s.getRelationsCompletion(a,d))),m&&o.push.apply(o,Object(b.a)(s.getColumnsCompletion(a,d)))}return y.a.uniqBy(o,(function(e){return e.label}))},this.datastore=i,this.monaco=t,this.disposable={},this.classCompletionKind=this.monaco.languages.CompletionItemKind.Class,this.propertyCompletionKind=this.monaco.languages.CompletionItemKind.Property,this.keywordCompletionKind=this.monaco.languages.CompletionItemKind.Keyword,this.functionCompletionKind=this.monaco.languages.CompletionItemKind.Function,this.baseCompletion=[],(a=this.baseCompletion).push.apply(a,Object(b.a)(Di.map((function(e){var t=e.keyword,a=e.link;return{label:t,detail:"keyword",insertText:t,kind:s.keywordCompletionKind,documentation:{value:"[Go to documentation](".concat(a,").")}}})))),(r=this.baseCompletion).push.apply(r,Object(b.a)(Si.map((function(e){var t=e.snippet,a=e.documentation,n=e.link;return{label:s.normalizeSnippetLabel(t),detail:"function",insertText:{value:t},kind:s.functionCompletionKind,documentation:{value:"".concat(a," [Go to documentation](").concat(n,").")}}}))))}return Object(r.a)(e,[{key:"init",value:function(){var e=this.monaco.languages.registerCompletionItemProvider("sql",{triggerCharacters:["."],provideCompletionItems:this.handleAutocomplete});this.disposable=e}},{key:"getDatastoreSchema",value:function(){return this.datastore&&this.datastore.get("schema")}},{key:"setDatastore",value:function(e){this.datastore=e}},{key:"getSchemasCompletion",value:function(e){var t=this;return e.get("schemas").toJS().map((function(e){return{label:e.name,insertText:e.name,kind:t.classCompletionKind,detail:"schema"}}))}},{key:"getRelationsCompletion",value:function(e,t){var a=this,n=t.schema;if(n)return n.get("relations").toJS().map((function(e){return{label:e.name,kind:a.classCompletionKind,detail:e.kind,insertText:e.name}}))}},{key:"getColumnsCompletion",value:function(e,t){var a=this,n=t.relation;if(n)return n.get("columns").toJS().map((function(e){return{label:e.name,kind:a.propertyCompletionKind,detail:"column",insertText:e.name}}))}},{key:"getAllPreviousWords",value:function(e,t){return e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}).split(/\s+/)}},{key:"getWordsFromCurrentLine",value:function(e,t){return e.getValueInRange({startLineNumber:t.lineNumber,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}).split(/\s+/)}},{key:"normalizeSnippetLabel",value:function(e){for(var t=/\$\{\d+:(.*?)\}/;e.match(t);)e=e.replace(t,"$1");return e}}]),e}(),Li=xe.b.REACT_APP_PUBLIC_URL?xe.b.REACT_APP_PUBLIC_URL:"",Ui=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={editor:void 0,monaco:void 0,autocomplete:void 0,shortcutFired:!1},e.monacoRequireConfig={url:"".concat(Li,"/vs/loader.js"),paths:{vs:"".concat(Li,"/vs")}},e.handleEditorWillMount=function(e){e.editor.defineTheme("heroku",Ti)},e.handleKeyboardShortcut=function(){e.props.onCommandEnter&&e.props.onCommandEnter()},e.handleEscape=function(){e.props.onEscape&&e.props.onEscape()},e.handleKeyUp=function(){e.state.shortcutFired&&e.setState({shortcutFired:!1})},e.handleMonacoChord=function(){e.state.shortcutFired||(e.handleKeyboardShortcut(),e.setState({shortcutFired:!0}))},e.handleEditorDidMount=function(t,a){t.onKeyUp(e.handleKeyUp),t.addCommand(a.KeyMod.CtrlCmd|a.KeyCode.Enter,e.handleMonacoChord),t.addCommand(a.KeyMod.WinCtrl|a.KeyCode.Enter,e.handleMonacoChord),t.addCommand(a.KeyCode.Escape,(function(){e.handleEscape()})),t.getModel().updateOptions(e.monacoModelOptions);var n=new Pi(a);e.props.datastore&&e.props.datastore.getIn(["schema","_change","state"])===Ze.FULFILLED&&n.setDatastore(e.props.datastore),n.init(),e.setState({editor:t,monaco:a,autocomplete:n})},e.handleEditorChange=function(t,a){e.props.onChange(t)},e.monacoModelOptions={detectIndentation:!0,insertSpaces:!0,tabSize:2,trimAutoWhitespace:!0,useTabStops:!0},e.monacoOptions={contextmenu:!1,fontFamily:"monaco, Hack, Fira Code, consolas, monospace",fontLigatures:!1,fontSize:13,lineHeight:22,renderIndentGuides:!1,renderLineHighlight:"line",scrollBeyondLastLine:!1,overviewRulerBorder:!1,minimap:{enabled:!1}},e}return Object(r.a)(a,[{key:"componentDidUpdate",value:function(e){if(this.state.editor){var t=e.datastore&&!this.props.datastore,a=e.width!==this.props.width,n=this.props.datastore&&this.props.datastore.getIn(["schema","_change","state"])===Ze.FULFILLED,r=e.datastore!==this.props.datastore;t&&this.state.autocomplete.setDatastore(null),a&&this.state.editor.layout(),n&&r&&this.state.autocomplete.setDatastore(this.props.datastore)}}},{key:"componentWillUnmount",value:function(){this.state.autocomplete&&this.state.autocomplete.disposable&&this.state.autocomplete.disposable.dispose()}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.defaultValue,n=e.width,r=e.height,s=e.language,i=e.readOnly,c=e.value;return l.a.createElement("div",{className:"".concat(t)},l.a.createElement(Oi.a,{height:r,language:s,requireConfig:this.monacoRequireConfig,options:Object(ve.a)(Object(ve.a)({},this.monacoOptions),{},{readOnly:i}),theme:"heroku",width:n,defaultValue:a,value:c,editorWillMount:this.handleEditorWillMount,editorDidMount:this.handleEditorDidMount,onChange:this.handleEditorChange}))}}]),a}(l.a.Component);Ui.defaultProps={className:"DataclipCellEditor",height:160,language:"sql",onChange:function(){},readOnly:!1,value:""};var Hi=function(e){var t=e.onSqlChange,a=e.onSave,n=e.datastore,r=e.sql,s=e.handleCollapse;return l.a.createElement("div",{className:"absolute h-100 w-100 top-0 flex flex-column z-5"},l.a.createElement("div",{className:"bg-white flex-1 relative"},l.a.createElement(ot.a,null,(function(e){var i=e.width,c=e.height;return l.a.createElement(Ui,{onEscape:s,onChange:t,onCommandEnter:a,datastore:n,height:c,width:i,value:r,readOnly:!1})})),l.a.createElement("div",{className:"absolute top-0 right-0 pa3"},l.a.createElement(S.HKButton,{small:!0,type:"tertiary",onClick:s},l.a.createElement("div",{className:"flex items-center"},l.a.createElement(S.HKIcon,{className:"mr1",name:S.ProductIcons.Minimize28,fill:S.Fills.Purple}),"Collapse")))))},Fi=l.a.memo((function(e){var t=e.datastore,a=e.sql,n=e.onSqlChange,r=e.onSave,s=e.updating,i=l.a.useState(!1),c=Object(P.a)(i,2),o=c[0],d=c[1],u=function(){return d(!0)};return Object(wi.a)("esc",(function(){o&&d(!1)}),[o]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{style:{height:160}},l.a.createElement(ot.a,null,(function(e){var i=e.width;return l.a.createElement("div",{className:"absolute w-full left-0 right-0 relative"},s&&l.a.createElement("div",{className:"absolute z-5 top-0 right-0 pa2"},l.a.createElement(S.HKIcon,{name:S.ProductIcons.Loading16,fill:S.Fills.LightGray,size:14})),l.a.createElement(Ui,{onChange:n,onCommandEnter:r,datastore:t,height:160,width:i,value:a,readOnly:!1}),l.a.createElement("div",{className:"absolute right-1 bottom-1"},l.a.createElement(S.HKButton,{onClick:u,small:!0,type:"tertiary"},l.a.createElement(S.HKIcon,{className:"mr1",fill:S.Fills.Purple,name:S.ProductIcons.Maximize28}),"Expand")))}))),o&&l.a.createElement(Hi,{onSqlChange:n,onSave:r,datastore:t,sql:a,handleCollapse:function(){return d(!1)}}))})),Mi=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleCreateClip=function(){return e.props.onHandleCreateClip()},e.handleDeleteClip=function(){return e.props.onHandleDeleteClip()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.newDataclipDisabled,a=e.showDelete,n=t?"cursor-not-allowed o-70 bg-white":"cursor-pointer",r=t?void 0:this.handleCreateClip;return l.a.createElement(S.HKDropdown,{name:"dataclip-options",closeOnClick:!t,align:"right",className:"ml3",contentClassName:"z-1"},l.a.createElement("li",{name:"new-dataclip",className:G()("hk-dropdown-item",n),onClick:r},l.a.createElement(o.a,{name:"add-ring-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ","New Dataclip from Datastore"),l.a.createElement("li",null,l.a.createElement("a",{className:"hk-dropdown-item",href:"https://devcenter.heroku.com/articles/dataclips",target:"_blank",rel:"noopener noreferrer"},l.a.createElement(o.a,{name:"docs-16",size:16,fillClass:"dark-gray",extraClasses:"v-ttop"})," ","View Documentation"," ")),a&&l.a.createElement(c.Fragment,null,l.a.createElement("li",{className:"hk-dropdown-divider"}),l.a.createElement("li",{className:"hk-dropdown-item--danger pa0"},l.a.createElement("button",{className:"cursor-pointer bg-transparent bn pv1 pl2 pr3 db w-100 tl red",onClick:this.handleDeleteClip},l.a.createElement(o.a,{name:"delete-16",size:16,fillClass:"red",extraClasses:"v-ttop mr2"}),"Delete Dataclip"))))}}]),a}(l.a.Component);Mi.defaultProps={newDataclipDisabled:!1,onHandleCreateClip:function(){}};a(173);var Gi="DATACLIPS_UI_QUERY_UPDATE",$i=Object(le.a)(Object($.a)({},Gi,(function(e,t){var a=t.payload;return e.set("query",a)})),U.a.fromJS({query:""})),qi=function(e){return{type:Gi,payload:e}},Bi=function(e){var t=e.datastore,a=e.newClipButtonDisabled,n=e.values,r=e.errors,s=e.touched,i=e.handleChange,c=e.handleSubmit,o=e.isValid,u=e.isSubmitting,m=e.updating,p=e.setFieldValue,h=e.onCreateClip,f=e.onDeleteClip,g=Object(d.c)(),v=m||u,b=v?l.a.createElement(ee.a,{button:!0}):"Save & Run",E=l.a.useCallback((function(e){p("attachmentId",e),g(qi(""))}),[p]);return l.a.createElement("form",{className:"flex-1",onSubmit:c},l.a.createElement("div",{className:"flex-l items-center pa3 bb b--silver"},l.a.createElement("div",{className:"w-20-l mr2-l mb2 mb0-l"},l.a.createElement("label",{className:"sr-only",htmlFor:"title"},"Title"),l.a.createElement("input",{className:G()("hk-input w-100",{"b--red":r.title&&s.title}),placeholder:"Enter dataclip title",name:"title",value:n.title,onChange:i})),l.a.createElement("div",{className:"flex-1 mr2-l mb2 mb0-l"},l.a.createElement("label",{className:"sr-only",htmlFor:"postgres-chooser"},"Title"),l.a.createElement(ki,{className:G()("",{"datastore-picker-error":r.attachmentId&&s.attachmentId}),onChange:E,disabled:!1,value:n.attachmentId})),l.a.createElement("div",{className:"flex items-center"},l.a.createElement("button",{className:"hk-button--primary",disabled:v||!o,type:"submit"},b),l.a.createElement(Mi,{showDelete:!!f,newDataclipDisabled:a,onHandleCreateClip:h,onHandleDeleteClip:f}))),l.a.createElement("div",null,l.a.createElement(Fi,{sql:n.sql,datastore:t,hasError:r.sql,onSave:function(){o&&c()},onSqlChange:function(e){p("sql",e)},updating:m})))},zi=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"flex flex-column flex-auto h-100"},l.a.createElement("div",{className:"hk-well pa3 flex flex-auto flex-column items-center justify-center tc ma3"},l.a.createElement("div",{className:"w-80"},l.a.createElement(o.a,{name:"data-28",size:28,extraClasses:"malibu-fill-gradient-dark-gray"}),l.a.createElement("h1",{className:"f3 normal"},"No datastore selected"),l.a.createElement("p",{className:"lh-copy mb0"},"Choose from your available datastores to view and explore a schema."),l.a.createElement("div",{className:"bb b--light-gray pb5 mb5"}),l.a.createElement(o.a,{name:"docs-28",size:28,extraClasses:"malibu-fill-gradient-dark-gray"}),l.a.createElement("p",{className:"lh-copy"},"Looking for help? Learn more through the Dataclips documentation in"," ",l.a.createElement("a",{href:"https://devcenter.heroku.com/articles/dataclips",target:"_blank",rel:"noopener noreferrer",className:"purple nowrap dib"},"Heroku Dev Center"),"."))))}}]),a}(l.a.Component);var Ki=Object(vi.a)((function(e){return e.dataclipsUi}),(function(e){return e.get("query")}));var Wi=function(e){var t=Object(d.d)(Ki),a=l.a.useState(t),n=Object(P.a)(a,2),r=n[0],s=n[1];l.a.useEffect((function(){""===t&&r&&s("")}),[t]);var i=Object(d.c)(),c=l.a.useCallback((function(e){var t=e.target.value;s(t),i(qi(t))}),[e]),o=l.a.useMemo((function(){return e.toJS()}),[e]),u=o.search_path,m=l.a.useMemo((function(){return Object(E.filter)(o.schemas,(function(e){return e.relations.length>0}))}),[e]),p=l.a.useMemo((function(){return e=o.schemas,Object(E.flatten)(e.map((function(e){return e.types}))).reduce((function(e,t){var a=t.oid,n=t.name;return Object.assign(Object($.a)({},a,n),e)}),{});var e}),[e]),h=l.a.useMemo((function(){return Object(E.flatMap)(m,(function(e){return e.relations.map((function(t){return Object(ve.a)(Object(ve.a)({},t),{},{columnNames:t.columns.map((function(e){return e.name})),expandedHeight:40*t.columns.length,compoundName:1===u.length&&u.includes(e.oid)?t.name:"".concat(e.name,".").concat(t.name)})}))}))}),[e]),f=l.a.useMemo((function(){return r.length?Object(E.filter)(h,(function(e){return e.compoundName.includes(r)||e.columnNames.some((function(e){return e.includes(r)}))})):h}),[r,e]),g=l.a.useMemo((function(){return h.reduce((function(e,t){return e[t.oid]={expanded:!1},e}),{})}),[e]),v=l.a.useState(g),b=Object(P.a)(v,2),y=b[0],k=b[1];return{query:r,handleFilter:c,schemasWithRelations:m,filtered:f,typeNames:p,setVisibilityMap:k,visibilityMap:y}},Ji=function(){return l.a.createElement("div",{className:"flex h-100 items-center justify-center pv7 pv0-l"},l.a.createElement("p",{className:"mid-gray mv0"},"No columns or tables found"))},Yi=function(e){var t=e.filter,a=e.column,n=e.typeNames,r=a.name,s=n[String(a.type_oid)];return l.a.createElement("li",{className:"pa2 hover-bg-black-05 f6"},l.a.createElement("div",{className:"code flex items-center justify-between"},l.a.createElement("span",{title:r,className:"pl2 gray truncate lh-copy"},l.a.createElement(Gs.a,{highlightClassName:"token-highlight",searchWords:[t],textToHighlight:r})),l.a.createElement("span",{title:s,className:"gray truncate lh-copy"},s)))},Vi=function(e){var t=e.index,a=e.filter,n=e.relation,r=e.name,s=e.typeNames,i=e.expanded,c=e.onExpand,d=Object(E.sortBy)(n.columns,"name");return l.a.createElement("div",{className:"bb b--silver"},l.a.createElement("button",{onClick:function(){c(t,!i)},className:"bn pa2 pointer f5 black b outline-0 flex items-center bg-transparent w-100"},l.a.createElement(o.a,{name:"nav-forward-16",size:16,fillClass:"fill-gray",extraClasses:G()("flex-shrink-0",{"rotate-90":i})}),l.a.createElement("span",{className:"ml1 lh-copy code truncate db f6 dark-gray normal"},l.a.createElement(Gs.a,{highlightClassName:"token-highlight",searchWords:[a],textToHighlight:r}))),i&&l.a.createElement("ul",{className:"ma0 pa0 list"},d.map((function(e){return l.a.createElement(Yi,{filter:a,key:e.number,column:e,typeNames:s})}))))},Qi=a(1277),Xi=function(e){var t=e.schema,a=e.onCloseSchemaExplorer,n=l.a.useRef(),r=Wi(t),s=r.query,i=r.handleFilter,c=r.schemasWithRelations,o=r.filtered,d=r.typeNames,u=r.visibilityMap,m=r.setVisibilityMap,p=c.length>0,h=s&&0===o.length,f=function(e,t){var a=String(o[e].oid),r=u[a];m(Object(ve.a)(Object(ve.a)({},u),{},Object($.a)({},a,Object(ve.a)(Object(ve.a)({},r),{},{expanded:!r.expanded})))),n.current.recomputeRowHeights(e),n.current.forceUpdateGrid()},g=function(e){var t=e.index,a=String(o[t].oid);return u[a].expanded?o[t].expandedHeight+38:38},v=function(e){var t=e.key,a=e.index,n=e.style,r=o[a],i=u[r.oid].expanded,c=l.a.createElement(Vi,{expanded:i,index:a,filter:s,relation:r,typeNames:d,onExpand:f,name:r.compoundName,key:r.compoundName});return l.a.createElement("div",{key:t,style:n},c)};return l.a.createElement("div",{className:"flex flex-column h-100"},l.a.createElement("div",{className:"pa3 bb b--silver"},l.a.createElement("div",{className:"flex items-center justify-between mb2"},l.a.createElement("h1",{className:"purple f5 normal mv0"},"Schema Explorer"),l.a.createElement(S.HKButton,{small:!0,onClick:a},"Close Explorer")),p&&l.a.createElement(Qs.DebounceInput,{className:"hk-input w-100",debounceTimeout:400,placeholder:"Filter by tables, schema or columns...",value:s,onChange:i})),l.a.createElement("div",{className:"relative flex-1"},!p&&l.a.createElement(Ji,null),p&&(h?l.a.createElement("div",{className:"pa3 tc"},"Your search returned no results."):l.a.createElement("div",{className:"absolute top-0 right-0 bottom-0 left-0 h-100 w-100"},l.a.createElement(Qi.a,null,(function(e){var t=e.width,a=e.height;return l.a.createElement(Qi.b,{ref:n,height:a,width:t,rowCount:o.length,rowHeight:g,rowRenderer:v})}))))))},Zi=function(e){var t=e.fetchSchema,a=e.errorMessage;return l.a.createElement("div",{className:"pa3 flex flex-column flex-auto h-100"},l.a.createElement("div",{className:"pv5 flex flex-column flex-auto justify-center items-center bg-lightest-red ba b--light-red h-100"},l.a.createElement(o.a,{name:"data-postgres-28",size:28,fillClass:"red"}),l.a.createElement("div",{className:"mw5 tc center red"},l.a.createElement("p",null,"Unable to fetch schema!"),a&&l.a.createElement("p",{className:"lh-copy"},a)),l.a.createElement(S.HKButton,{type:"danger",onClick:t},"Try again")))},ec=function(){return l.a.createElement("div",{className:"h-100"},l.a.createElement("div",{className:"bw2 tc pa3 w-100 flex justify-center items-center h-100"},l.a.createElement("div",null,l.a.createElement(ee.a,null),l.a.createElement("p",{className:"mid-gray"},"Fetching schema..."))))};ec.displayName="LoadingState";var tc=Object(d.b)(null,(function(e){return{fetchSchema:function(t){return e({type:Fa.FETCH_SCHEMA,addonId:t})}}}))((function(e){var t=e.datastore,a=e.fetchSchema,n=e.onClose;l.a.useEffect((function(){t&&(t.hasIn(["schema","_change"])||a(t.get("id")))}),[t]);if(!t)return l.a.createElement(zi,null);var r=t.get("schema"),s=r&&r.getIn(["_change","state"])===Ze.PENDING,i=r&&r.getIn(["_change","state"])===Ze.FULFILLED,c=r&&r.getIn(["_change","state"])===Ze.REJECTED;return l.a.createElement(l.a.Fragment,null,(!r||s)&&l.a.createElement(ec,null),i&&l.a.createElement(Xi,{schema:r,onCloseSchemaExplorer:n}),c&&l.a.createElement(Zi,{fetchSchema:function(){t&&a(t.get("id"))},errorMessage:r.getIn(["_change","message"])||"An error occurred while fetching schema."}))})),ac=function(e){var t=e.clip,a=e.children,n=e.onCreateClip,r=e.onDeleteClip,s=e.newClipButtonDisabled,i=Object(x.a)(e,["clip","children","onCreateClip","onDeleteClip","newClipButtonDisabled"]),c=l.a.useState(!0),o=Object(P.a)(c,2),u=o[0],m=o[1],p=i.values.attachmentId,h=Object(d.d)((function(e){return Ei(e,p)})),f=l.a.useCallback((function(){return m(!1)}),[]),g=l.a.useCallback((function(){return m(!0)}),[]);return t&&!t.get("editable")?a:l.a.createElement("div",{className:G()("dataclip-grid",{"with-explorer":u})},l.a.createElement("section",{className:"relative flex flex-column overflow-auto"},l.a.createElement("div",{className:"bb b--silver"},l.a.createElement(Bi,Object.assign({datastore:h,onCreateClip:n,onDeleteClip:r,newClipButtonDisabled:s},i))),l.a.createElement("div",{className:"flex-1 relative overflow-auto"},l.a.createElement("div",{className:"absolute-l top-0 left-0 right-0 bottom-0 w-100 h-100"},a))),l.a.createElement("aside",{className:"schema-explorer bg-white bt bl-l bt-0-l b--silver relative"},u?l.a.createElement(tc,{onClose:f,datastore:h}):l.a.createElement("div",{className:"flex justify-center items-center h-100-l pa4 pa0-l"},l.a.createElement(S.HKButton,{onClick:g,className:"btn-schema-explorer"},"Show Schema Explorer"))))},nc=a(255),rc=ti.a().shape({title:ti.b().required(),attachmentId:ti.b().required(),sql:ti.b().max(nc.b).required()}),sc=function(e){return Object(ei.b)({enableReinitialize:!0,validationSchema:rc,validateOnBlur:!1,validateOnChange:!0,mapPropsToValues:function(e){var t=e.initialValues;return Object(ve.a)({},t)},handleSubmit:function(e,t){var a=t.props.onSubmit;a&&a(e,t)}})(e)};function ic(e){var t=e.check,a=e.children,n=e.error,r=a,s="dark-gray",i=t?"green":"dark-gray",c=t?"success-badge-16":"pending-16";return n&&(r=n,s="red",i="red",c="error-badge-16"),l.a.createElement("div",{className:"flex items-center ".concat(s," normal f2 mb3")},l.a.createElement(o.a,{name:c,size:16,fillClass:i,extraClasses:"mr2"})," ",r)}var cc=function(e){var t=e.title,a=e.sql,n=e.sqlError,r=e.disabled,s=e.attachmentId,i=e.saving,c=e.onSave;return l.a.createElement("div",{className:"flex flex-column items-center mt3"},l.a.createElement("h1",{className:"dark-gray f1 mb2"},"Create a new Dataclip"),l.a.createElement("div",{className:"w-100 pa2 flex flex-auto items-stretch justify-center"},l.a.createElement("div",{className:"pr5 mr5 br b--light-gray"},l.a.createElement("div",{className:"flex-column items-center mv3"},l.a.createElement(ic,{check:t},"Give your clip a title"),l.a.createElement(ic,{check:s},"Choose a database"),l.a.createElement(ic,{check:a,error:n},"Write your query"))),l.a.createElement("div",{className:"w-34 flex-none"},l.a.createElement("div",{className:"pt2 pb1 flex"},l.a.createElement(S.HKButton,{type:"primary",onClick:c,disabled:r,className:"minw-5 ml2"},i?l.a.createElement(ee.a,{button:!0}):"Save & Run")),l.a.createElement("div",null,l.a.createElement("h1",{className:"gray normal f4 lh-copy "},"Dataclips are visible to anyone who can see the clip\u2019s datastore."),l.a.createElement("h1",{className:"gray normal f4"},"Save this clip to view results.")))))},lc=sc((function(e){e.onCreateClip;var t=Object(x.a)(e,["onCreateClip"]);return l.a.createElement(ac,Object.assign({},t,{newClipButtonDisabled:!0}),l.a.createElement(cc,{title:t.values.title,sql:t.values.sql,sqlError:t.errors.sql&&t.touched.sql,disabled:t.isSubmitting||!t.isValid,attachmentId:t.values.attachmentId,saving:t.isSubmitting,onSave:function(){return t.handleSubmit()}}))})),oc=g.a.mark(uc),dc=new De;function uc(e){var t,a,n,r,s,i,c,l;return g.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.attachmentId,a=e.title,n=e.sql,r=nr.a.v4(),o.prev=2,s={type:oe,payload:{_change:{id:r,state:Ze.PENDING}}},o.next=6,ie(s);case 6:return o.next=8,se([dc,dc.createDataclip],t,a,n,void 0);case 8:return i=o.sent,c={type:de,payload:Object(ve.a)({_change:{id:r,state:Ze.FULFILLED}},i)},o.next=12,ie(c);case 12:return o.abrupt("return",i.slug);case 15:return o.prev=15,o.t0=o.catch(2),k.a.error("Unable to create clip",o.t0),l={type:de,payload:{_change:{id:r,state:Ze.REJECTED,error:o.t0}}},o.next=21,ie(l);case 21:case"end":return o.stop()}}),oc,null,[[2,15]])}var mc=Et({generator:uc})((function(e){var t=e.history,a=e.location,n=e.operation;l.a.useEffect((function(){Le.a.page("New Dataclip Page Viewed")}),[]),l.a.useEffect((function(){n.status===Ze.FULFILLED&&t.push("/dataclips/".concat(n.state))}),[n]);var r={title:"",sql:"",attachmentId:Object(H.parse)(a.search).attachmentId||""};return l.a.createElement("div",{className:"outer-dc-grip-wrap"},l.a.createElement(di.a,{title:"Create a new dataclip"}),l.a.createElement(lc,{onSubmit:function(e,t){n.trigger(e)},initialValues:r}))})),pc=g.a.mark(hc);function hc(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,se([Ce.a,Ce.a.get],"".concat(xe.b.REACT_APP_HEROKUDATA_BACKEND,"/dataclips/slug-finder/").concat(e),{headers:{Accept:"application/json","X-Heroku-Data-Tab":xe.a.getSessionItem("herokudataTabId")}});case 2:return t=a.sent,a.abrupt("return",t.data);case 4:case"end":return a.stop()}}),pc)}var fc=hc,gc=function(){return l.a.createElement(Sa,{title:"An error occurred"},l.a.createElement("div",{className:"flex flex-column items-center"},l.a.createElement(o.a,{name:"error-ring-28",size:48,fillClass:"fill-red"}),l.a.createElement("p",{className:"mt3"},"Something unexpected happened while fetching this dataclip! We have logged the error for engineers to investigate."),l.a.createElement("p",null,l.a.createElement(u.b,{to:"/dataclips",className:"link normal"},"Return to your Dataclips"))))},vc=g.a.mark(Ec),bc=new De;function Ec(e){var t,a,n=arguments;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.length>1&&void 0!==n[1]&&n[1],r.next=3,se([bc,bc.fetchDataclipDetails],e,t);case 3:return a=r.sent,r.next=6,ie({type:de,payload:a});case 6:case"end":return r.stop()}}),vc)}var yc=a(177),kc=sc((function(e){var t=e.clip,a=e.onCreateClip,n=e.onDeleteClip,r=Object(x.a)(e,["clip","onCreateClip","onDeleteClip"]);return l.a.createElement(ac,Object.assign({clip:t,onCreateClip:a,onDeleteClip:n},r),l.a.createElement(yc.a,{clip:t}))})),wc=g.a.mark(Oc),Cc=new De;function Oc(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,se([Cc,Cc.deleteDataclip],e);case 2:return t={type:ue,payload:{id:e}},a.next=5,ie(t);case 5:case"end":return a.stop()}}),wc)}var Nc=Et({generator:Oc})((function(e){var t=e.id,a=e.showModal,n=e.onCancel,r=e.operation,s=r.status,i=!s===Ze.PENDING,c=s===Ze.REJECTED,o={props:{type:"destructive",show:a,onDismiss:function(e){"confirm"===e?r.trigger(t):"cancel"===e&&n()},header:l.a.createElement("div",null,"Warning!"),buttons:[{disabled:i,text:"Cancel",type:"tertiary",value:"cancel"},{disabled:i,text:i?"Deleting...":"Delete",type:"danger",value:"confirm"}]},children:l.a.createElement("div",{className:"pa3"},l.a.createElement("p",{className:"f8 lh-copy mv0"},"Are you sure you want to delete this dataclip?"),c&&l.a.createElement("p",{className:"red f6"},"Something went wrong when trying to delete this clip. Please try again."))};return l.a.createElement(S.HKModal,o.props,o.children)})),Ic=a(1248),_c=a.n(Ic);function xc(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}var Tc={CREATE_CLIP:"CREATE_CLIP",DELETE_CLIP:"DELETE_CLIP",FETCH_CLIP_DETAILS:"FETCH_CLIP_DETAILS",FETCH_CLIP_RESULT:"FETCH_CLIP_RESULT",FETCH_DATACLIPS:"FETCH_DATACLIPS",RUN_CLIP:"RUN_CLIP",SET_CLIP:"SET_CLIP",SET_CLIP_DATA:"SET_CLIP_DATA",SYNC_DATACLIPS:"SYNC_DATACLIPS",UPDATE_CLIP:"UPDATE_CLIP",SHARE_CLIP_WITH_USER:"SHARE_CLIP_WITH_USER",SHARE_CLIP_WITH_TEAM:"SHARE_CLIP_WITH_TEAM",UNSHARE_CLIP_WITH_USER:"UNSHARE_CLIP_WITH_USER",UNSHARE_CLIP_WITH_TEAM:"UNSHARE_CLIP_WITH_TEAM"},Dc=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.name,a=e.type,n=e.className,r=y.a.capitalize(t.substr(0,2));return l.a.createElement("div",{title:t,className:G()("x-identicon x-identicon-- inline-flex flex-shrink-0 items-center justify-center w2 h2",n,{"br1 bg-gradient-primary":"primary"===a,"ba br-100 b--light-purple":"secondary"===a})},l.a.createElement("span",{className:G()("f5 fw6",{white:"primary"===a,purple:"secondary"===a})},r))}}]),a}(l.a.Component),Sc=function(e){var t=e.disabled,a=void 0!==t&&t,n=e.email,r=e.id,s=e.name,i=e.onDestroy,c=void 0===i?function(){}:i,d=e.pending,u=void 0!==d&&d,m=n?l.a.createElement(K.a,{email:n,className:"gravatar br-100 flex-none mr2",size:24,rating:"pg",default:"mm"}):l.a.createElement(Dc,{name:s,type:"secondary",className:"mr2"});return l.a.createElement("div",{className:G()("flex items-center bt b--light-silver pa3 hover-bg-near-white hide-child",{"o-50":u})},m,l.a.createElement("div",{className:"flex-auto"},l.a.createElement("div",{className:"dark-gray f4 ma0"},n||s)),u&&l.a.createElement(o.a,{name:"loading-16",size:16,fillClass:"dark-gray",extraClasses:"ml2 flex-none"}),!u&&l.a.createElement("div",{className:"child flex-none"},l.a.createElement(S.HKButton,{disabled:a,type:"danger",small:!0,onClick:function(){c({clipShareId:r,email:n,name:s})}},"Delete")))},jc=function(e){var t=e.innerRef,a=e.innerProps,n=e.data,r=e.getStyles,s=e.selectProps,i=n.label.trim(),c=xc(i),o=c?l.a.createElement(K.a,{email:i,className:"gravatar br-100 flex-none mr1",size:24,rating:"pg",default:"mm"}):l.a.createElement(Dc,{name:i,type:"secondary",className:"mr1"}),d=c?i.toLowerCase():hi(i,s.inputValue);return l.a.createElement("div",Object.assign({ref:t,style:r("option",e)},a),l.a.createElement("div",{className:"flex items-center pv1"},o,l.a.createElement("div",{className:"truncate lh-copy"},d)))},Ac=function(e){var t=e.innerRef,a=e.innerProps,n=e.data,r=e.getStyles,s=e.selectProps,i=n.label.trim(),c=xc(i),o=c?l.a.createElement(K.a,{email:i,className:"gravatar br-100 flex-none mr1",size:24,rating:"pg",default:"mm"}):l.a.createElement(Dc,{name:i,type:"secondary",className:"mr1"}),d=c?i.toLowerCase():hi(i,s.inputValue);return l.a.createElement("div",Object.assign({ref:t,style:r("singleValue",e)},a),l.a.createElement("div",{className:"flex items-center pv1"},o,l.a.createElement("div",{className:"truncate lh-copy"},d)))},Rc=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={adding:!1,shareTarget:null,pendingAdd:null,pendingDestroy:null,changeId:null},e.handleAddDisplayed=function(){e.setState({adding:!0})},e.handleAddHidden=function(){e.setState({adding:!1,shareTarget:null,pendingAdd:null})},e.handleShareTargetChanged=function(t){e.setState({shareTarget:t})},e.handleShareAdded=function(){var t=e.props.clip,a=e.state.shareTarget,n=nr.a.v4(),r=a.label.trim(),s=xc(r),i={};s?i.email=r.toLowerCase():i.name=r;var c={clipId:t.get("id"),changeId:n};s?c.email=r.toLowerCase():c.teamId=a.id,e.props.dispatch(Object(ve.a)({type:s?Tc.SHARE_CLIP_WITH_USER:Tc.SHARE_CLIP_WITH_TEAM},c)),e.setState({adding:!1,shareTarget:null,pendingAdd:i,changeId:n})},e.handleShareDestroy=function(t){var a=t.clipShareId,n=t.email,r=(t.name,nr.a.v4());e.setState({changeId:r,pendingDestroy:a});var s={changeId:r,clipShareId:a,clipId:e.props.clip.get("id")};e.props.dispatch(Object(ve.a)({type:n?Tc.UNSHARE_CLIP_WITH_USER:Tc.UNSHARE_CLIP_WITH_TEAM},s))},e.prepareTeamOptions=Object(va.a)((function(e,t){var a=t.get("team_shares").map((function(e){return e.getIn(["shared_with","id"])})).toJS();return e.toJS().filter((function(e){return!a.includes(e.id)})).map((function(e){return Object(ve.a)(Object(ve.a)({},e),{},{value:e.id,label:e.name})}))})),e.loadTargetOptions=function(t,a){var n=e.prepareTeamOptions(e.props.teams,e.props.clip),r=t.trim();""===r&&a(n);var s=n.map((function(e){return Object(ve.a)(Object(ve.a)({},e),{},{score:Object(pi.score)(e.label,r)})}));a(Object(E.sortBy)(s.filter((function(e){return e.score})),["score"]).reverse())},e}return Object(r.a)(a,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.clip,r=a.teams,s=this.state,i=s.pendingAdd,c=s.pendingDestroy,o=s.changeId,d=s.shareTarget,u=this.prepareTeamOptions(r,n),m=n.get("user_shares").map((function(e){return e.getIn(["shared_with","email"])})).toJS();e=this.state.adding?l.a.createElement("div",null,l.a.createElement("h3",{className:"f5 dark-gray fw6 flex-auto ma0 pv3"},"Share Results"),l.a.createElement("div",{className:"pb2"},l.a.createElement(_c.a,{placeholder:"Email address or team name",styles:dr,components:{DropdownIndicator:function(){return null},IndicatorSeparator:function(){return null},Option:jc,SingleValue:Ac},className:"mb1",onChange:this.handleShareTargetChanged,defaultOptions:u,loadOptions:this.loadTargetOptions,isMulti:!1,isClearable:!0,allowCreateWhileLoading:!0,isValidNewOption:function(e){return xc(e.trim())&&!m.includes(e.trim().toLowerCase())},formatCreateLabel:function(e){return e.trim()},noOptionsMessage:function(e){var t=e.inputValue.trim().toLowerCase();return m.includes(t)?"".concat(t," already has access!"):"Type a team name or a valid email address"}})),l.a.createElement("div",{className:"flex"},l.a.createElement(S.HKButton,{type:"primary",disabled:!d,small:!0,className:"flex-none mr1",onClick:this.handleShareAdded},"Add"),l.a.createElement(S.HKButton,{type:"tertiary",small:!0,className:"flex-none",onClick:this.handleAddHidden},"Cancel"))):l.a.createElement("div",{className:"flex items-center"},l.a.createElement("h3",{className:"f5 dark-gray fw6 flex-auto"},"People & Teams"),l.a.createElement(S.HKButton,{type:"primary",disabled:!!i||!!o,small:!0,className:"flex-none",onClick:this.handleAddDisplayed},"Add"));var p=n.get("user_shares").map((function(e){return l.a.createElement(Sc,{key:e.get("id"),id:e.get("id"),email:e.getIn(["shared_with","email"]),disabled:!!i||!!o,onDestroy:t.handleShareDestroy,pending:e.get("id")===c&&n.getIn(["_change","id"])===o})})),h=n.get("team_shares").map((function(e){return l.a.createElement(Sc,{key:e.get("id"),id:e.get("id"),name:e.getIn(["shared_with","name"]),disabled:!!i||!!o,onDestroy:t.handleShareDestroy,pending:e.get("id")===c&&n.getIn(["_change","id"])===o})}));return l.a.createElement("div",{className:"flex-shrink-0 ma3 pt2 shadow-outer-1 br2"},l.a.createElement("div",{className:"pb2 ph3"},l.a.createElement(ft.a,{isOpened:!0,springConfig:{stiffness:900,damping:50}},e)),i&&l.a.createElement(Sc,Object.assign({pending:!0},i)),p,h)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(!t.changeId)return null;var a=e.clip,n=a.getIn(["_change","state"]);return a.getIn(["_change","id"])===t.changeId&&n!==Ze.PENDING?{changeId:null,pendingAdd:null}:null}}]),a}(c.Component),Pc=Object(d.b)((function(e){return{teams:e.teams.get("all",new U.a.List)}}))(Rc),Lc={PUBLIC:"PUBLIC",PENDING:"PENDING",PRIVATE:"PRIVATE"},Uc=a(163),Hc=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).handleSelectContents=function(t){t.target.select(),e.props.onSelect()},e}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.className,a=e.value;return l.a.createElement("input",{onClick:this.handleSelectContents,type:"text",className:G()("hk-input db w-100",t),readOnly:!0,value:a})}}]),a}(c.Component);Hc.defaultProps={onSelect:function(){}};var Fc=function(e){var t=e.label,a=e.inputValue,n=e.onSelect,r=e.children;return l.a.createElement(l.a.Fragment,null,l.a.createElement("dt",{className:"dark-gray normal hk-label pt2"},t),l.a.createElement("dd",{className:"ml0"},l.a.createElement(Hc,{value:a,className:"mb2",onSelect:n}),r))},Mc=function(e){var t=e.clipSlug,a=e.editable,n=Object(Uc.a)(t,"csv"),r=Object(Uc.a)(t,"json"),s=Object(Uc.a)(t,"csv"),i='=IMPORTDATA("'.concat(s,'")');return l.a.createElement("dl",null,l.a.createElement(Fc,{label:"CSV URL",inputValue:n}),l.a.createElement(Fc,{label:"JSON URL",inputValue:r}),l.a.createElement(Fc,{label:"Google Sheets Integration",inputValue:i,onSelect:function(){Le.a.track("Dataclip Google Sheets Link Copied")}},l.a.createElement("p",{className:"gray"},"Use this macro to import the Dataclip result data into"," ",l.a.createElement("a",{href:"http://sheets.google.com/",target:"_blank",rel:"noopener noreferrer",className:"gray"},"Google Sheets"),"."),l.a.createElement("p",{className:"purple mv0"},"Visit"," ",l.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:"purple",href:"https://support.google.com/docs/answer/3093335?hl=en"},"Google's documentation")," ","for more info about this feature.")),a&&l.a.createElement("div",{className:"mt2 bt b--silver"},l.a.createElement("p",{className:"gray ws-normal lh-copy"},l.a.createElement("strong",null,"Keep these URLs secret.")," Anyone who has these URLs can access the results of this dataclip.")))},Gc=a(164),$c=g.a.mark(Bc),qc=new De;function Bc(e,t){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e!==Lc.PUBLIC){n.next=6;break}return n.next=3,se([qc,qc.sharePublicDataclip],t);case 3:a=n.sent,n.next=10;break;case 6:if(e!==Lc.PRIVATE){n.next=10;break}return n.next=9,se([qc,qc.unsharePublicDataclip],t);case 9:a=n.sent;case 10:return n.next=12,ie({type:de,payload:Object(ve.a)({},a)});case 12:case"end":return n.stop()}}),$c)}var zc=Object(d.b)((function(e){var t;return{userEmail:null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.get("email")}}))(Et({generator:Bc})((function(e){var t=e.clip,a=e.operation,n=e.userEmail,r=t.get("public_slug"),s=t.get("editable"),i=a.status===Ze.REJECTED,c=null===n||void 0===n?void 0:n.endsWith("@heroku.com"),d=r||!c;return l.a.createElement("div",{className:"flex-shrink-0 ma3 ph3 pt2 pb3 shadow-outer-1 br2"},l.a.createElement("div",{className:"flex items-center"},l.a.createElement("h3",{className:"f5 dark-gray fw6 mb1 flex-auto"},"Shareable Links"),d&&function(){var e=t.get("slug"),n=t.get("public_slug"),r=a.status===Ze.PENDING,s=l.a.createElement(o.a,{name:"loading-16",size:16,fillClass:"dark-gray"});return n?l.a.createElement(S.HKButton,{type:"danger",className:"flex-none",async:r,title:"Disable Shareable Links",small:!0,onClick:function(){return a.trigger(Lc.PRIVATE,e)}},r?s:"Disable"):l.a.createElement(S.HKButton,{type:"primary",className:"flex-none",async:r,title:"Enable Shareable Links",small:!0,onClick:function(){Le.a.track("Public Dataclip Share Created"),a.trigger(Lc.PUBLIC,e)}},r?s:"Enable")}()),i&&l.a.createElement("p",{className:"red"},"An error occurred. Please try again."),l.a.createElement("p",{className:"f5 dark-gray lh-copy"},d?"Generate a URL to share the results of this dataclip publicly.":"Public sharing of dataclips is disabled."),r&&l.a.createElement(l.a.Fragment,null,l.a.createElement(Hc,{className:"mb3",value:function(){var e=Object(Gc.a)(),a=t.get("public_slug");return"".concat(e.protocol,"//").concat(e.host,"/dataclips/").concat(a)}()}),l.a.createElement(Mc,{clipSlug:r,editable:s})))}))),Kc=function(e){var t=e.clip,a=e.onDismiss,n=e.show;return l.a.createElement(S.HKModal,{header:"Security, Sharing & Access",isFlyout:!0,show:n,onDismiss:a},l.a.createElement("div",{className:"overflow-y-scroll h-100"},l.a.createElement(zc,{clip:t}),l.a.createElement(Pc,{clip:t})))},Wc=a(252);var Jc=Object(vi.a)([function(e,t){return e.dataclips.find((function(e){return e.get("slug")===t}))}],(function(e){return e})),Yc=(Object(vi.a)([function(e){return e.user}],(function(e){return!!e.size&&e.get("email").endsWith("@heroku.com")})),g.a.mark(Vc));function Vc(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.id,a=e.values,n=Object(ve.a)({type:Tc.UPDATE_CLIP,id:t},a),r.next=4,ie(n);case 4:case"end":return r.stop()}}),Yc)}var Qc,Xc,Zc=Ie.a.duration(1,"minute").asMilliseconds(),el=Et({generator:Vc})(Object(m.g)((function(e){var t=e.history,a=e.operation,n=e.slug,r=e.location,s=void 0===r?{}:r,i=F.a.parse(s.search).sharing,c=void 0!==i&&i,o=Object(d.c)(),u=l.a.useCallback((function(){window.navigator.onLine?o({type:Tc.RUN_CLIP,clipSlug:n}):k.a.debug("Offline, not triggering clip execution")}),[n]);l.a.useEffect((function(){Le.a.page("Dataclip Details"),u()}),[]),function(e,t){var a=l.a.useRef();l.a.useEffect((function(){a.current=e}),[e]),l.a.useEffect((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){u()}),Zc);var p=l.a.useState(!1),h=Object(P.a)(p,2),f=h[0],g=h[1],v=l.a.useCallback((function(){t.replace({search:""})})),b=l.a.useCallback((function(){t.replace({search:"?sharing=true"})})),E=l.a.useCallback((function(){g(!0)})),y=l.a.useCallback((function(){g(!1)})),w=Object(d.d)((function(e){return Jc(e,n)})),C=Object(Wc.a)(w);if(!w&&C)return l.a.createElement(m.a,{to:"/dataclips"});var O=w.get("id"),N=w.get("title"),I=w.get("creator"),_=w.get("editable"),x=w.getIn(["datasource","attachment_id"]),T=w.get("created_at"),D=w.getIn(["versions",0],null),S={sql:D&&D.get("sql"),title:N,attachmentId:x};return l.a.createElement("div",{className:"outer-dc-grip-wrap"},l.a.createElement(di.a,{title:N,author:I,created:T,showShareButton:_,onShareClick:b}),l.a.createElement(kc,{clip:w,onDeleteClip:E,onCreateClip:function(){x&&(Le.a.track("New Dataclip from Datastore Button Clicked"),t.push({pathname:"/dataclips/create",search:"?attachmentId=".concat(x)}))},onSubmit:function(e){Le.a.track("Dataclip Updated"),a.trigger({id:O,values:e})},initialValues:S}),_&&l.a.createElement(Nc,{showModal:f,onCancel:y,id:O}),_&&l.a.createElement(Kc,{clip:w,show:!!c,onDismiss:v}))}))),tl=function(){return l.a.createElement(Sa,{title:"Dataclip not found"},l.a.createElement("div",{className:"flex flex-column items-center"},l.a.createElement(o.a,{name:"error-ring-28",size:48,fillClass:"fill-light-gray"}),l.a.createElement("p",{className:"mt3"},l.a.createElement(u.b,{to:"/dataclips",className:"link normal"},"Return to your Dataclips"))))},al=Et({generator:Ec})((function(e){var t=e.slug,a=e.operation,n=a.status,r=a.error;l.a.useEffect((function(){a.status||a.trigger(t)}),[]);var s=!n||n===Ze.PENDING,i=n===Ze.FULFILLED,c=n===Ze.REJECTED,o=r&&r.errors&&r.errors.some((function(e){return/^Clip \w+ not found$/.test(e.message)}));return l.a.createElement(l.a.Fragment,null,s&&l.a.createElement(di.a,{loading:!0}),i&&l.a.createElement(el,{slug:t}),c&&o&&l.a.createElement(tl,null),c&&!o&&l.a.createElement(gc,null))})),nl=a(57),rl=a(89),sl=a(256),il=a(127),cl=function(e){var t=e.slug;return l.a.createElement(nl.a,{promiseFn:sl.a,slug:t},l.a.createElement(nl.a.Loading,null,l.a.createElement(di.a,{loading:!0,isPublic:!0})),l.a.createElement(nl.a.Fulfilled,null,(function(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement(yc.a,{clip:e}))})),l.a.createElement(nl.a.Rejected,null,(function(e){return e.response&&404===e.response.status?l.a.createElement(il.a,null):l.a.createElement(rl.a,{errorMessage:"An unexpected error occurred"})})))},ll=Et({generator:fc})((function(e){var t=e.match,a=e.operation,n=t.params.slug,r=a.state,s=a.status,i=a.trigger;l.a.useEffect((function(){a.status||i(n)}),[]);var c=!s||s===Ze.PENDING,o=s===Ze.FULFILLED,d=s===Ze.REJECTED;return l.a.createElement(l.a.Fragment,null,c&&l.a.createElement(di.a,{loading:!0}),o&&r.slug&&l.a.createElement(al,{slug:r.slug}),o&&!r.slug&&r.public_slug&&l.a.createElement(cl,{slug:r.public_slug}),d&&l.a.createElement(gc,null))})),ol=function(e){var t=e.values,a=e.errors,n=e.handleChange,r=e.handleSubmit,s=e.isSubmitting,i="hk-input w-100 ".concat(a.code?"b--red":"");return l.a.createElement("form",{onSubmit:r},l.a.createElement("div",{className:"flex items-center"},l.a.createElement("input",{className:i,onChange:n,name:"code",value:t.code,disabled:s,placeholder:"One Time Password or YubiKey",autoFocus:!0})),l.a.createElement("div",{className:"pt2"},l.a.createElement("button",{className:"hk-button--primary",type:"submit",disabled:s},s?"Submitting":"Submit")),a.code&&l.a.createElement("p",{className:"f5 red mt2"},a.code))},dl=ti.a().shape({code:ti.b().required("You must enter a 2FA code")}),ul=Object(d.b)((function(e,t){return{showPrompt:e.twoFactor.get("show")}}))((function(e){var t=e.children,a=e.showPrompt,n=Object(c.useState)(!1),r=Object(P.a)(n,2),s=r[0],i=r[1],o=function(){var e=Object(v.a)(g.a.mark((function e(t,a){var n,r,s,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.setSubmitting,r=a.setFieldError,e.prev=1,e.next=4,ai.a.requestPreAuth(t.code);case 4:s=e.sent,c=s.data,xe.a.setSessionItem("hk-preauth-data",JSON.stringify({token:c.access_token.token,expires_in:c.access_token.expires_in})),i(!0),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r("code","An unknown error occurred. Please try again.");case 13:return e.prev=13,n(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t,a){return e.apply(this,arguments)}}();return a?s?l.a.createElement("div",{className:"center w-100 w-50-m w-40-l pt4 tc"},l.a.createElement("h1",{className:"f4 gray"},"Authorized"),l.a.createElement("p",{className:"lh-copy dark-gray"},"Your account is now pre-authorized for the next 15 minutes.",l.a.createElement("b",null,'No resources were modified, please click "Close" and try again.')),l.a.createElement("div",{className:"ml2"},l.a.createElement("button",{onClick:function(){return window.location.reload()},className:"hk-button--primary"},"Close"))):l.a.createElement("div",{className:"center w-100 w-50-m w-40-l pt4 tc"},l.a.createElement("h1",{className:"f4 gray"},"Authorization Needed"),l.a.createElement("p",{className:"lh-copy dark-gray"},"A second authentication factor or pre-authorization is required for this request. Your account has either two-factor or a YubiKey registered."),l.a.createElement(ei.a,{validateOnBlur:!1,validateOnChange:!1,validationSchema:dl,onSubmit:o,initialValues:{code:""},render:ol})):t})),ml=a(575),pl={SET_CHANGE:"SET_CHANGE",MERGE_CHANGE:"MERGE_CHANGE",DELETE_CHANGE:"DELETE_CHANGE"},hl=Object(le.a)((Qc={},Object($.a)(Qc,pl.SET_CHANGE,(function(e,t){return e.set(t.payload.id,U.a.fromJS(t.payload))})),Object($.a)(Qc,pl.MERGE_CHANGE,(function(e,t){return e.merge(U.a.fromJS(Object($.a)({},t.payload.id,t.payload)))})),Object($.a)(Qc,pl.DELETE_CHANGE,(function(e,t){return e.delete(t.payload.id)})),Qc),U.a.Map()),fl={UPDATE_USER:"UPDATE_USER",CLEAR_USER:"CLEAR_USER"},gl=kt(U.a.Map(),(Xc={},Object($.a)(Xc,fl.UPDATE_USER,(function(e,t){return e.merge(t.payload)})),Object($.a)(Xc,fl.CLEAR_USER,(function(e,t){return U.a.Map()})),Xc)),vl="APPS_SET",bl=Object(le.a)(Object($.a)({},vl,(function(e,t){return U.a.Map({loaded:!0,all:U.a.fromJS(t.payload)})})),U.a.Map({loaded:!1,all:U.a.List([])})),El="TEAMS_SET",yl=Object(le.a)(Object($.a)({},El,(function(e,t){return U.a.Map({loaded:!0,all:U.a.fromJS(t.payload)})})),U.a.Map({loaded:!1,all:U.a.List([])})),kl={SHOW_2FA_PROMPT:"SHOW_2FA_PROMPT"},wl=kt(U.a.Map({show:!1}),Object($.a)({},kl.SHOW_2FA_PROMPT,(function(e,t){return e.merge({show:!0})}))),Cl=Object(bn.c)({asyncUi:ke,changes:hl,datastores:xt,dataclips:ge,dataclipsUi:$i,user:gl,apps:bl,teams:yl,twoFactor:wl}),Ol=a(534),Nl={FETCH_APPS:"FETCH_APPS"},Il={FETCH_TEAMS:"FETCH_TEAMS"},_l=g.a.mark(Tl),xl=function(e){return e.user};function Tl(){var e,t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Ol.f)({type:Il.FETCH_TEAMS});case 2:return a.next=4,Object(Ol.f)({type:Nl.FETCH_APPS});case 4:return a.next=6,Object(Ol.f)({type:yt.FETCH_DATASTORES});case 6:return a.next=9,Object(Ol.g)(xl);case 9:if(!(e=a.sent).size){a.next=15;break}return e=e.toJS(),a.abrupt("break",19);case 15:return a.next=17,Object(Ol.b)(ml.b,500);case 17:a.next=6;break;case 19:t=Ie.a.duration(2,"minutes").asMilliseconds();case 20:if(!window.paused){a.next=25;break}k.a.debug("paused: not requesting sync"),a.next=37;break;case 25:return a.prev=25,a.next=28,Object(Ol.b)([Ce.a,Ce.a.post],"/sync");case 28:a.next=33;break;case 30:a.prev=30,a.t0=a.catch(25),k.a.debug("error requesting sync:",a.t0);case 33:return a.next=35,Object(Ol.f)({type:Il.FETCH_TEAMS});case 35:return a.next=37,Object(Ol.f)({type:Nl.FETCH_APPS});case 37:return a.next=39,Object(Ol.b)(ml.b,t);case 39:a.next=20;break;case 41:case"end":return a.stop()}}),_l,null,[[25,30]])}var Dl=g.a.mark(jl),Sl=new De;function jl(){var e,t,a,n,r,s=arguments;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:{},t=e.background,a=void 0!==t&&t,i.prev=1,i.next=4,Object(Ol.b)([Sl,Sl.listApps],a);case 4:return n=i.sent,r={type:vl,payload:n},i.next=8,Object(Ol.f)(r);case 8:i.next=13;break;case 10:i.prev=10,i.t0=i.catch(1),k.a.error("Unable to fetch apps",i.t0);case 13:case"end":return i.stop()}}),Dl,null,[[1,10]])}var Al=g.a.mark(Pl),Rl=new De;function Pl(){var e,t,a,n,r=arguments;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},t=e.background,a=void 0!==t&&t,s.prev=1,s.next=4,Object(Ol.b)([Rl,Rl.listTeams],a);case 4:return n=s.sent,s.next=7,Object(Ol.f)({type:El,payload:n});case 7:s.next=12;break;case 9:s.prev=9,s.t0=s.catch(1),k.a.error("Unable to fetch teams",s.t0);case 12:case"end":return s.stop()}}),Al,null,[[1,9]])}var Ll=g.a.mark(Bl),Ul=g.a.mark(zl),Hl=new De;function Fl(e,t,a){var n=t.find((function(t){return t.id===e}));if(!n)return"";var r=a.find((function(e){return e.id===n.owner_id}));return r?r.name:""}function Ml(e){return e.apps&&e.apps.get("all").toJS()}function Gl(e){return e.apps.get("loaded")}function $l(e){return e.teams&&e.teams.get("all").toJS()}function ql(e){return e.teams.get("loaded")}function Bl(){var e,t,n,r,s,i,c,l=arguments;return g.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return e=l.length>0&&void 0!==l[0]?l[0]:{},t=e.background,n=void 0!==t&&t,o.prev=1,o.next=4,Object(Ol.b)([Hl,Hl.userQuery],n);case 4:if(null!==(r=o.sent)){o.next=12;break}return o.next=8,Object(Ol.b)(ml.b,1e3);case 8:return o.next=10,Object(Ol.f)({type:yt.FETCH_DATASTORES});case 10:o.next=25;break;case 12:return o.next=14,zl();case 14:return o.next=16,Object(Ol.g)(Ml);case 16:return s=o.sent,o.next=19,Object(Ol.g)($l);case 19:return i=o.sent,c=r.addons.map((function(e){return e.team_name=Fl(e.app_uuid,s,i),e})),o.next=23,Object(Ol.f)({type:fl.UPDATE_USER,payload:{id:r.id,email:r.email,last_sync:r.last_sync,feature_flags:r.feature_flags}});case 23:return o.next=25,Object(Ol.f)({type:yt.SYNC_DATASTORES,payload:c});case 25:o.next=30;break;case 27:o.prev=27,o.t0=o.catch(1),k.a.error("Unable to fetch datastores: ".concat(a(544).inspect(o.t0)));case 30:case"end":return o.stop()}}),Ll,null,[[1,27]])}function zl(){var e;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],t.next=3,Object(Ol.g)(Gl);case 3:if(t.sent){t.next=5;break}e.push(Object(Ol.h)(vl));case 5:return t.next=7,Object(Ol.g)(ql);case 7:if(t.sent){t.next=9;break}e.push(Object(Ol.h)(El));case 9:return t.next=11,Object(Ol.a)(e);case 11:case"end":return t.stop()}}),Ul)}var Kl=g.a.mark(Jl),Wl=function(e){return function(e){return/A second authentication factor|two_factor/.test(e.message)}(e)||function(e){return e.extensions&&"two_factor"==e.extensions.code}(e)};function Jl(e){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),!(a=t.t0,a.response&&a.response.data&&a.response.data.errors?a.response.data.errors:a.errors||[]).some(Wl)){t.next=12;break}return t.next=11,Object(Ol.f)({type:kl.SHOW_2FA_PROMPT});case 11:return t.abrupt("return",t.sent);case 12:throw t.t0;case 13:case"end":return t.stop()}var a}),Kl,null,[[0,6]])}var Yl=g.a.mark(Ql),Vl=new De;function Ql(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.id,a=e.service,n=e.background,r=void 0!==n&&n,i.prev=1,i.next=4,Object(Ol.f)({type:Ot,payload:{id:t,details:{_change:{state:Ze.PENDING}}}});case 4:return i.delegateYield(Jl(Object(Ol.b)([Vl,Vl.fetchDatastoreDetails],t,a,r)),"t0",5);case 5:return s=i.t0,i.next=8,Object(Ol.f)({type:Ct,payload:{id:t,details:Object(ve.a)({_change:{state:Ze.FULFILLED}},s)}});case 8:i.next=14;break;case 10:return i.prev=10,i.t1=i.catch(1),i.next=14,Object(Ol.f)({type:Ot,payload:{id:t,details:{_change:{state:Ze.REJECTED,message:"An error was encountered when fetching the datastore details."}}}});case 14:case"end":return i.stop()}}),Yl,null,[[1,10]])}var Xl=g.a.mark(eo),Zl=new De;function eo(e){var t,a,n,r,s,i,c,l,o,d,u;return g.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:return t=e.id,a=e.service,n=e.config,r=e.background,s=void 0!==r&&r,i=n.start,c=n.end,l=n.resolution,o=n.filter,d=n.postProcess,m.prev=2,m.next=5,Object(Ol.f)({type:Ot,payload:{id:t,metrics:{_change:{state:Ze.PENDING}}}});case 5:return m.next=7,Object(Ol.b)([Zl,Zl.fetchDatastoreMetrics],{addonUUID:t,service:a,start:i,end:c,resolution:l,filter:o},s);case 7:return u=m.sent,d&&(u=d(u)),m.next=11,Object(Ol.f)({type:Nt,payload:{id:t,metrics:{_change:{state:Ze.FULFILLED},start:i,end:c,resolution:l,data:u}}});case 11:m.next=17;break;case 13:return m.prev=13,m.t0=m.catch(2),m.next=17,Object(Ol.f)({type:Ot,payload:{id:t,metrics:{_change:{state:Ze.REJECTED,message:"An error was encountered when fetching the datastore metrics."}}}});case 17:case"end":return m.stop()}}),Xl,null,[[2,13]])}var to=g.a.mark(no),ao=new De;function no(){var e,t,a,n,r,s,i=arguments;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:{},t=e.slug,a=e.background,n=void 0!==a&&a,c.prev=1,c.next=4,Object(Ol.f)({type:de,payload:{slug:t,_change:{state:Ze.PENDING}}});case 4:return c.next=6,Object(Ol.b)([ao,ao.fetchDataclipDetails],t,n);case 6:return r=c.sent,s={type:de,payload:Object(ve.a)(Object(ve.a)({},r),{},{_change:{state:Ze.FULFILLED}})},c.next=10,Object(Ol.f)(s);case 10:c.next=16;break;case 12:return c.prev=12,c.t0=c.catch(1),c.next=16,Object(Ol.f)({type:de,payload:{slug:t,details:{_change:{state:Ze.REJECTED,message:"An error was encountered when fetching the dataclip details."}}}});case 16:case"end":return c.stop()}}),to,null,[[1,12]])}var ro=g.a.mark(so);function so(e){var t,a,n,r,s,i,c,l,o,d;return g.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.id,a=e.url,n=Ce.a.create(),u.prev=2,r={type:de,payload:{id:t,resultDataState:Ze.PENDING}},u.next=6,Object(Ol.f)(r);case 6:s={headers:{"X-Heroku-Data-Tab":sessionStorage.getItem("herokudataTabId")}},c=0;case 8:if(!(c<3)){u.next=28;break}return k.a.debug("======== fetchDataclip attempt ".concat(c," ========")),u.prev=10,u.next=13,Object(Ol.b)([n,n.get],a,s);case 13:return i=u.sent,u.abrupt("break",28);case 17:if(u.prev=17,u.t0=u.catch(10),!(c<2)){u.next=24;break}return u.next=22,Object(Ol.b)(ml.b,250);case 22:u.next=25;break;case 24:throw u.t0;case 25:c++,u.next=8;break;case 28:return l={type:de,payload:{id:t,resultDataState:Ze.FULFILLED,resultData:i}},u.next=31,Object(Ol.f)(l);case 31:u.next=39;break;case 33:return u.prev=33,u.t1=u.catch(2),u.t1.response?(o="An error was encountered when fetching the dataclip results.",k.a.error(o,u.t1.response.status,u.t1.response.headers,u.t1.response.data),window.Rollbar.error(o,{response:u.t1.response})):u.t1.request?(o="No response received when fetching the dataclip results.",k.a.error(o,u.t1.request),window.Rollbar.error(o,u.t1)):(o="An error was encountered when preparing a request for the dataclip results.",k.a.error(o,u.t1.message)),d={type:de,payload:{id:t,resultDataState:Ze.REJECTED,resultDataErrorMessage:o}},u.next=39,Object(Ol.f)(d);case 39:case"end":return u.stop()}}),ro,null,[[2,33],[10,17]])}var io=g.a.mark(lo),co=new De;function lo(e){var t,a,n,r,s,i,c,l,o;return g.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:return t=e.id,a=e.attachmentId,n=e.title,r=e.sql,s=e.changeId,d.prev=1,i={type:de,payload:{id:t,_change:{id:s,state:Ze.PENDING},resultDataState:void 0,resultData:void 0}},d.next=5,Object(Ol.f)(i);case 5:return d.next=7,Object(Ol.b)([co,co.updateDataclip],t,a,n,r);case 7:return c=d.sent,l={type:de,payload:Object(ve.a)({_change:{id:s,state:Ze.FULFILLED}},c)},d.next=11,Object(Ol.f)(l);case 11:d.next=19;break;case 13:return d.prev=13,d.t0=d.catch(1),k.a.error("Unable to update clip",d.t0),o={type:de,payload:{_change:{id:s,state:Ze.REJECTED,error:d.t0}}},d.next=19,Object(Ol.f)(o);case 19:case"end":return d.stop()}}),io,null,[[1,13]])}var oo,uo=a(1250),mo=a.n(uo),po=null;var ho=g.a.mark(fo);function fo(e){var t,a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.clipSlug,n.prev=1,a=po,n.next=5,Object(Ol.b)([a,"emit"],"runClip",{clipSlug:t});case 5:n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1),k.a.debug("error requesting run-clip:",n.t0);case 10:case"end":return n.stop()}}),ho,null,[[1,7]])}var go=g.a.mark(bo),vo=new De;function bo(e){var t,a,n,r,s,i,c;return g.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.clipId,a=e.email,n=e.changeId,l.prev=1,r={type:de,payload:{id:t,_change:{id:n,state:Ze.PENDING}}},l.next=5,Object(Ol.f)(r);case 5:return l.next=7,Object(Ol.b)([vo,vo.shareDataclipWithUser],t,a);case 7:return s=l.sent,i={type:pe,payload:{clipShare:s,shareType:"user"}},l.next=11,Object(Ol.f)(i);case 11:return l.next=13,Object(Ol.f)({type:de,payload:{id:t,_change:{id:n,state:Ze.FULFILLED}}});case 13:l.next=21;break;case 15:return l.prev=15,l.t0=l.catch(1),k.a.error("Unable to share dataclip ".concat(t," with ").concat(a),l.t0),c={type:de,payload:{_change:{id:n,state:Ze.REJECTED,error:l.t0}}},l.next=21,Object(Ol.f)(c);case 21:case"end":return l.stop()}}),go,null,[[1,15]])}var Eo=g.a.mark(ko),yo=new De;function ko(e){var t,a,n,r,s,i,c;return g.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.clipId,a=e.teamId,n=e.changeId,l.prev=1,r={type:de,payload:{id:t,_change:{id:n,state:Ze.PENDING}}},l.next=5,Object(Ol.f)(r);case 5:return l.next=7,Object(Ol.b)([yo,yo.shareDataclipWithTeam],t,a);case 7:return s=l.sent,i={type:pe,payload:{clipShare:s,shareType:"team"}},l.next=11,Object(Ol.f)(i);case 11:return l.next=13,Object(Ol.f)({type:de,payload:{id:t,_change:{id:n,state:Ze.FULFILLED}}});case 13:l.next=21;break;case 15:return l.prev=15,l.t0=l.catch(1),k.a.error("Unable to share dataclip ".concat(t," with ").concat(a),l.t0),c={type:de,payload:{_change:{id:n,state:Ze.REJECTED,error:l.t0}}},l.next=21,Object(Ol.f)(c);case 21:case"end":return l.stop()}}),Eo,null,[[1,15]])}var wo=g.a.mark(Oo),Co=new De;function Oo(e){var t,a,n,r,s,i;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.clipId,a=e.clipShareId,n=e.changeId,c.prev=1,r={type:de,payload:{id:t,_change:{id:n,state:Ze.PENDING}}},c.next=5,Object(Ol.f)(r);case 5:return c.next=7,Object(Ol.b)([Co,Co.unshareDataclipWithUser],t,a);case 7:return s={type:he,payload:{clipId:t,clipShareId:a,shareType:"user"}},c.next=10,Object(Ol.f)(s);case 10:return c.next=12,Object(Ol.f)({type:de,payload:{id:t,_change:{id:n,state:Ze.FULFILLED}}});case 12:c.next=20;break;case 14:return c.prev=14,c.t0=c.catch(1),k.a.error("Unable to unshare dataclip ".concat(t," with share id ").concat(a),c.t0),i={type:de,payload:{_change:{id:n,state:Ze.REJECTED,error:c.t0}}},c.next=20,Object(Ol.f)(i);case 20:case"end":return c.stop()}}),wo,null,[[1,14]])}var No=g.a.mark(_o),Io=new De;function _o(e){var t,a,n,r,s,i;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.clipId,a=e.clipShareId,n=e.changeId,c.prev=1,r={type:de,payload:{id:t,_change:{id:n,state:Ze.PENDING}}},c.next=5,Object(Ol.f)(r);case 5:return c.next=7,Object(Ol.b)([Io,Io.unshareDataclipWithTeam],t,a);case 7:return s={type:he,payload:{clipId:t,clipShareId:a,shareType:"team"}},c.next=10,Object(Ol.f)(s);case 10:return c.next=12,Object(Ol.f)({type:de,payload:{id:t,_change:{id:n,state:Ze.FULFILLED}}});case 12:c.next=20;break;case 14:return c.prev=14,c.t0=c.catch(1),k.a.error("Unable to unshare dataclip ".concat(t," with share id ").concat(a),c.t0),i={type:de,payload:{_change:{id:n,state:Ze.REJECTED,error:c.t0}}},c.next=20,Object(Ol.f)(i);case 20:case"end":return c.stop()}}),No,null,[[1,14]])}var xo=g.a.mark(Do),To=new De;function Do(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.name,n=e.changeId,r={datastoreId:t,changeId:n,type:Fa.ADD_CREDENTIAL},i.prev=2,i.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return i.next=7,Object(Ol.b)([To,To.createCredential],t,a);case 7:return i.next=9,Object(Ol.b)([To,To.fetchDatastoreDetails],t,window.service.postgres,!0);case 9:return s=i.sent,i.next=12,Object(Ol.f)({type:Ct,payload:{id:t,details:Object(ve.a)({_change:{state:Ze.FULFILLED}},s)}});case 12:return i.next=14,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 14:i.next=20;break;case 16:return i.prev=16,i.t0=i.catch(2),i.next=20,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 20:case"end":return i.stop()}}),xo,null,[[2,16]])}var So=g.a.mark(Ao),jo=new De;function Ao(e){var t,a,n,r,s,i,c;return g.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.addonId,a=e.name,n=e.changeId,r=e.forced,i={datastoreId:t,changeId:n,forced:s=void 0!==r&&r,type:Fa.ROTATE_CREDENTIAL},l.prev=2,l.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},i),{},{state:Ze.PENDING})});case 5:return l.next=7,Object(Ol.b)([jo,jo.rotateCredential],t,a,s);case 7:return l.next=9,Object(Ol.b)([jo,jo.fetchDatastoreDetails],t,window.service.postgres,!0);case 9:return c=l.sent,l.next=12,Object(Ol.f)({type:Ct,payload:{id:t,details:Object(ve.a)({_change:{state:Ze.FULFILLED}},c)}});case 12:return l.next=14,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},i),{},{state:Ze.FULFILLED})});case 14:l.next=20;break;case 16:return l.prev=16,l.t0=l.catch(2),l.next=20,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},i),{},{state:Ze.REJECTED})});case 20:case"end":return l.stop()}}),So,null,[[2,16]])}var Ro=g.a.mark(Lo),Po=new De;function Lo(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.name,n=e.changeId,r={datastoreId:t,changeId:n,type:Fa.DESTROY_CREDENTIAL},i.prev=2,i.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return i.next=7,Object(Ol.b)([Po,Po.destroyCredential],t,a);case 7:return i.next=9,Object(Ol.b)([Po,Po.fetchDatastoreDetails],t,window.service.postgres,!0);case 9:return s=i.sent,i.next=12,Object(Ol.f)({type:Ct,payload:{id:t,details:Object(ve.a)({_change:{state:Ze.FULFILLED}},s)}});case 12:return i.next=14,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 14:i.next=20;break;case 16:return i.prev=16,i.t0=i.catch(2),i.next=20,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 20:case"end":return i.stop()}}),Ro,null,[[2,16]])}var Uo=g.a.mark(Fo),Ho=new De;function Fo(e){var t,a,n,r,s,i;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.addonId,a=e.changeId,n=e.forced,s={datastoreId:t,changeId:a,forced:r=void 0!==n&&n,type:Fa.ROTATE_ALL_CREDENTIALS},c.prev=2,c.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.PENDING})});case 5:return c.next=7,Object(Ol.b)([Ho,Ho.rotateAllCredentials],t,r);case 7:return c.next=9,Object(Ol.b)([Ho,Ho.fetchDatastoreDetails],t,window.service.postgres,!0);case 9:return i=c.sent,c.next=12,Object(Ol.f)({type:Ct,payload:{id:t,details:Object(ve.a)({_change:{state:Ze.FULFILLED}},i)}});case 12:return c.next=14,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.FULFILLED})});case 14:c.next=20;break;case 16:return c.prev=16,c.t0=c.catch(2),c.next=20,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.REJECTED})});case 20:case"end":return c.stop()}}),Uo,null,[[2,16]])}var Mo=g.a.mark($o),Go=new De;function $o(e){var t,a,n,r,s,i,c;return g.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.addonId,a=e.name,n=e.appId,r=e.attachment,s=e.changeId,i={datastoreId:t,changeId:s,type:Fa.ATTACH_CREDENTIAL},l.prev=2,l.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},i),{},{state:Ze.PENDING})});case 5:return l.next=7,Object(Ol.b)([Go,Go.attachCredential],t,a,n,r);case 7:return c=l.sent,l.next=10,Object(Ol.f)({type:yt.ADD_DATASTORE_ATTACHMENT,payload:{datastoreId:t,attachment:c}});case 10:return l.next=12,Object(Ol.f)({type:yt.DELETE_DATASTORE_CHANGE,payload:i});case 12:l.next=18;break;case 14:return l.prev=14,l.t0=l.catch(2),l.next=18,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},i),{},{state:Ze.REJECTED,error:l.t0})});case 18:case"end":return l.stop()}}),Mo,null,[[2,14]])}var qo=g.a.mark(zo),Bo=new De;function zo(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.attachment,n=e.changeId,r={datastoreId:t,changeId:n,type:Fa.DETACH_CREDENTIAL},i.prev=2,i.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return i.next=7,Object(Ol.b)([Bo,Bo.detachCredential],a);case 7:return s=i.sent,i.next=10,Object(Ol.f)({type:yt.DELETE_DATASTORE_ATTACHMENT,payload:{datastoreId:t,attachmentId:s.id}});case 10:return i.next=12,Object(Ol.f)({type:yt.DELETE_DATASTORE_CHANGE,payload:r});case 12:i.next=18;break;case 14:return i.prev=14,i.t0=i.catch(2),i.next=18,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED,error:i.t0})});case 18:case"end":return i.stop()}}),qo,null,[[2,14]])}var Ko=g.a.mark(Jo),Wo=new De;function Jo(e){var t,a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.addonId,a=e.backupId,n.prev=1,n.next=4,Object(Ol.b)([Wo,Wo.deletePostgresBackup],t,a);case 4:return n.next=6,Object(Ol.f)({type:yt.DELETE_POSTGRES_BACKUP,payload:{datastoreId:t,backupId:a}});case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),k.a.error("Unable to delete postgres backup '".concat(t,"/").concat(a,"': ").concat(Object(Yn.inspect)(n.t0,{depth:null})));case 11:case"end":return n.stop()}}),Ko,null,[[1,8]])}var Yo=g.a.mark(Qo),Vo=new De;function Qo(e){var t;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.addonId,a.prev=1,a.next=4,Object(Ol.b)([Vo,Vo.createPostgresBackup],t);case 4:return a.next=6,Object(Ol.f)({type:yt.FETCH_DATASTORE_DETAILS,id:t,service:window.service.postgres});case 6:a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),k.a.error("Unable to create postgres backup for '".concat(t,"': ").concat(Object(Yn.inspect)(a.t0,{depth:null})));case 11:case"end":return a.stop()}}),Yo,null,[[1,8]])}var Xo=g.a.mark(ed),Zo=new De;function ed(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.addonId,a={datastoreId:t,changeId:Fa.DESTROY},r.prev=2,r.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},a),{},{state:Ze.PENDING})});case 5:return r.delegateYield(Jl(Object(Ol.b)([Zo,Zo.removePostgres],t)),"t0",6);case 6:return r.next=8,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},a),{},{state:Ze.FULFILLED})});case 8:r.next=15;break;case 10:return r.prev=10,r.t1=r.catch(2),k.a.error("Unable to destroy postgres database '".concat(t,"': ").concat(Object(Yn.inspect)(r.t1,{depth:null}))),r.next=15,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},a),{},{state:Ze.REJECTED,error:null===(n=r.t1.response)||void 0===n?void 0:n.data})});case 15:case"end":return r.stop()}}),Xo,null,[[2,10]])}var td=g.a.mark(nd),ad=new De;function nd(e){var t,a,n,r,s,i;return g.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.addonId,a=e.plan,n=e.to,r=e.region,s={datastoreId:t,changeId:Fa.ROLLBACK},c.prev=2,c.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.PENDING})});case 5:return c.next=7,Object(Ol.b)([ad,ad.rollbackPostgres],t,a,n,r);case 7:return i=c.sent,c.next=10,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)(Object(ve.a)({},s),i),{},{to:n,state:Ze.FULFILLED})});case 10:c.next=17;break;case 12:return c.prev=12,c.t0=c.catch(2),k.a.error("Unable to rollback postgres database '".concat(t,"': ").concat(Object(Yn.inspect)(c.t0,{depth:null}))),c.next=17,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.REJECTED})});case 17:case"end":return c.stop()}}),td,null,[[2,12]])}var rd=g.a.mark(id),sd=new De;function id(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.plan,n=e.region,r={datastoreId:t,changeId:Fa.FORK},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([sd,sd.forkPostgres],t,a,n);case 7:return s.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 9:s.next=16;break;case 11:return s.prev=11,s.t0=s.catch(2),k.a.error("Unable to fork postgres database '".concat(t,"': ").concat(Object(Yn.inspect)(s.t0,{depth:null}))),s.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 16:case"end":return s.stop()}}),rd,null,[[2,11]])}var cd=g.a.mark(od),ld=new De;function od(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.plan,n=e.region,r={datastoreId:t,changeId:Fa.ADD_FOLLOWER},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([ld,ld.addPostgresFollower],t,a,n);case 7:return s.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 9:s.next=16;break;case 11:return s.prev=11,s.t0=s.catch(2),k.a.error("Unable to follow postgres database '".concat(t,"': ").concat(Object(Yn.inspect)(s.t0,{depth:null}))),s.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 16:return s.next=18,Object(Ol.f)({type:yt.FETCH_DATASTORE_DETAILS,id:t,service:window.service.postgres});case 18:case"end":return s.stop()}}),cd,null,[[2,11]])}var dd=g.a.mark(md),ud=new De;function md(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.addonId,a=e.followerId,n={datastoreId:t,changeId:Fa.REMOVE_FOLLOWER},r.prev=2,r.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.PENDING})});case 5:return r.next=7,Object(Ol.b)([ud,ud.removePostgres],a);case 7:return r.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.FULFILLED})});case 9:r.next=16;break;case 11:return r.prev=11,r.t0=r.catch(2),k.a.error("Unable to remove postgres follower '".concat(a,"': ").concat(Object(Yn.inspect)(r.t0,{depth:null}))),r.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.REJECTED})});case 16:return r.next=18,Object(Ol.f)({type:yt.FETCH_DATASTORE_DETAILS,id:t,service:window.service.postgres});case 18:case"end":return r.stop()}}),dd,null,[[2,11]])}var pd=g.a.mark(fd),hd=new De;function fd(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.addonId,a=e.followerId,n={datastoreId:t,changeId:Fa.UNFOLLOW},r.prev=2,r.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.PENDING})});case 5:return r.next=7,Object(Ol.b)([hd,hd.unfollowPostgres],a);case 7:return r.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.FULFILLED})});case 9:r.next=16;break;case 11:return r.prev=11,r.t0=r.catch(2),k.a.error("Unable to unfollow postgres database '".concat(a,"': ").concat(Object(Yn.inspect)(r.t0,{depth:null}))),r.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},n),{},{state:Ze.REJECTED})});case 16:return r.next=18,Object(Ol.f)({type:yt.FETCH_DATASTORE_DETAILS,id:t,service:window.service.postgres});case 18:case"end":return r.stop()}}),pd,null,[[2,11]])}var gd=g.a.mark(bd),vd=new De;function bd(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.settings,n=e.changeId,r={datastoreId:t,changeId:n,type:Fa.CONFIGURE},i.prev=2,i.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return i.next=7,Object(Ol.b)([vd,vd.configurePostgres],t,a);case 7:return s=i.sent,i.next=10,Object(Ol.f)({type:yt.SET_DATASTORE_SETTINGS,payload:{datastoreId:t,settings:s}});case 10:return i.next=12,Object(Ol.f)({type:yt.DELETE_DATASTORE_CHANGE,payload:r});case 12:i.next=18;break;case 14:return i.prev=14,i.t0=i.catch(2),i.next=18,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED,error:i.t0})});case 18:case"end":return i.stop()}}),gd,null,[[2,14]])}var Ed=g.a.mark(kd),yd=new De;function kd(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.role,n=e.permissions,r=e.changeId,s={datastoreId:t,changeId:r,type:Fa.SET_PERMISSIONS},i.prev=2,i.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.PENDING})});case 5:return i.next=7,Object(Ol.b)([yd,yd.setPostgresPermissions],t,a,n);case 7:return i.next=9,Object(Ol.f)({type:yt.DELETE_DATASTORE_CHANGE,payload:s});case 9:i.next=15;break;case 11:return i.prev=11,i.t0=i.catch(2),i.next=15,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},s),{},{state:Ze.REJECTED,error:i.t0})});case 15:case"end":return i.stop()}}),Ed,null,[[2,11]])}var wd=g.a.mark(Od),Cd=g.a.mark(Nd);function Od(e){var t,a,n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=e.addonId,a=Ie.a.duration(3,"minutes").asMilliseconds(),n={type:Fa.FETCH_SCHEMA,addonId:t,background:!0},k.a.debug("watching schema for ".concat(t)),r.prev=4;case 5:if(!window.paused){r.next=10;break}k.a.debug("paused: not requesting sync"),r.next=12;break;case 10:return r.next=12,Object(Ol.f)(n);case 12:return r.next=14,Object(Ol.b)(ml.b,a);case 14:r.next=5;break;case 16:r.next=27;break;case 18:return r.prev=18,r.t0=r.catch(4),r.next=22,Object(Ol.d)();case 22:if(!r.sent){r.next=26;break}k.a.debug("done watching schema for ".concat(t)),r.next=27;break;case 26:throw r.t0;case 27:case"end":return r.stop()}}),wd,null,[[4,18]])}function Nd(){var e,t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e={},t={};case 2:return i.next=5,Object(Ol.h)([R.WATCH_POSTGRES_SCHEMA,R.UNWATCH_POSTGRES_SCHEMA]);case 5:a=i.sent,i.t0=a.type,i.next=i.t0===R.WATCH_POSTGRES_SCHEMA?9:i.t0===R.UNWATCH_POSTGRES_SCHEMA?19:33;break;case 9:if(!(a.addonId in t)){i.next=13;break}e[a.addonId]+=1,i.next=18;break;case 13:return e[a.addonId]=1,i.next=16,Object(Ol.e)(Od,{addonId:a.addonId});case 16:n=i.sent,t[a.addonId]=n;case 18:return i.abrupt("break",34);case 19:if(void 0!==(r=e[a.addonId])){i.next=23;break}i.next=32;break;case 23:if(1!==r){i.next=31;break}return s=t[a.addonId],i.next=27,Object(Ol.c)(s);case 27:delete e[a.addonId],delete t[a.addonId],i.next=32;break;case 31:e[a.addonId]-=1;case 32:return i.abrupt("break",34);case 33:throw new Error("unexpected task type: ".concat(a.type));case 34:i.next=2;break;case 36:case"end":return i.stop()}}),Cd)}function Id(e){switch(e.name){case"GraphQLError":return e.errors.map((function(e){return e.message})).toString();default:return e.message}}var _d=g.a.mark(Td),xd=new De;function Td(e){var t,a,n,r,s,i,c;return g.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(t=e.addonId,a=e.background,n=void 0!==a&&a,r=e.error,l.prev=1,!r){l.next=4;break}throw new Error(r);case 4:return l.next=6,Object(Ol.f)({type:Ot,payload:{id:t,schema:{_change:{state:Ze.PENDING}}}});case 6:return s=new Date,l.prev=7,l.next=10,Object(Ol.b)([xd,xd.fetchPostgresSchema],t,n);case 10:i=l.sent,l.next=22;break;case 13:if(l.prev=13,l.t0=l.catch(7),!l.t0.errors||!l.t0.errors.some((function(e){return"The specified key does not exist."===e.message}))){l.next=21;break}return l.next=18,Object(Ol.b)([xd,xd.refreshPostgresSchema],t,n);case 18:return l.abrupt("return");case 21:throw l.t0;case 22:if(c=parseInt(i.last_modified,10),isNaN(c)||Date.now()-c>3e5){l.next=29;break}return l.next=27,Object(Ol.f)({type:Ct,payload:{id:t,schema:Object(ve.a)({_change:{state:Ze.FULFILLED},refreshed_at:s},i)}});case 27:l.next=31;break;case 29:return l.next=31,Object(Ol.b)([xd,xd.refreshPostgresSchema],t,n);case 31:l.next=37;break;case 33:return l.prev=33,l.t1=l.catch(1),l.next=37,Object(Ol.f)({type:Ot,payload:{id:t,schema:{_change:{state:Ze.REJECTED,message:Id(l.t1)}}}});case 37:case"end":return l.stop()}}),_d,null,[[1,33],[7,13]])}var Dd=g.a.mark(jd),Sd=new De;function jd(e){var t,a,n,r,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.addonId,a=e.background,n=void 0!==a&&a,i.prev=1,i.next=4,Object(Ol.f)({type:Ot,payload:{id:t,diagnose:{_change:{state:Ze.PENDING}}}});case 4:return r=new Date,i.next=7,Object(Ol.b)([Sd,Sd.diagnosePostgres],t,n);case 7:return s=i.sent,i.next=10,Object(Ol.f)({type:Ct,payload:{id:t,diagnose:{_change:{state:Ze.FULFILLED},refreshed_at:r,result:s}}});case 10:i.next=16;break;case 12:return i.prev=12,i.t0=i.catch(1),i.next=16,Object(Ol.f)({type:Ot,payload:{id:t,diagnose:{_change:{state:Ze.REJECTED,message:"An error was encountered while running diagnostics."}}}});case 16:case"end":return i.stop()}}),Dd,null,[[1,12]])}var Ad=g.a.mark(Pd),Rd=new De;function Pd(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.pid,n=e.changeId,r={datastoreId:t,changeId:n,type:Fa.TERMINATE_CONNECTION},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([Rd,Rd.terminatePostgresConnection],t,a);case 7:return s.next=9,Object(Ol.f)({type:Fa.DIAGNOSE,addonId:t,background:!0});case 9:return s.next=11,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 11:s.next=17;break;case 13:return s.prev=13,s.t0=s.catch(2),s.next=17,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 17:case"end":return s.stop()}}),Ad,null,[[2,13]])}var Ld=g.a.mark(Hd),Ud=new De;function Hd(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.topic,n=e.changeId,r={datastoreId:t,changeId:n,type:oa.ADD_TOPIC},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([Ud,Ud.createKafkaTopic],t,a);case 7:return s.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 9:s.next=16;break;case 11:return s.prev=11,s.t0=s.catch(2),k.a.error("Unable to create kafka topic '".concat(t,"/").concat(a.name,"': ").concat(Object(Yn.inspect)(s.t0,{depth:null}))),s.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 16:case"end":return s.stop()}}),Ld,null,[[2,11]])}var Fd=g.a.mark(Gd),Md=new De;function Gd(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.topicName,n=e.changeId,r={datastoreId:t,changeId:n,type:oa.DELETE_TOPIC},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([Md,Md.deleteKafkaTopic],t,a);case 7:return s.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 9:s.next=16;break;case 11:return s.prev=11,s.t0=s.catch(2),k.a.error("Unable to delete kafka topic '".concat(t,"/").concat(a,"': ").concat(Object(Yn.inspect)(s.t0,{depth:null}))),s.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 16:case"end":return s.stop()}}),Fd,null,[[2,11]])}var $d=g.a.mark(Bd),qd=new De;function Bd(e){var t,a,n,r;return g.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.addonId,a=e.topic,n=e.changeId,r={datastoreId:t,changeId:n,type:oa.UPDATE_TOPIC},s.prev=2,s.next=5,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.PENDING})});case 5:return s.next=7,Object(Ol.b)([qd,qd.updateKafkaTopic],t,a);case 7:return s.next=9,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.FULFILLED})});case 9:s.next=16;break;case 11:return s.prev=11,s.t0=s.catch(2),k.a.error("Unable to update kafka topic '".concat(t,"/").concat(a.name,"': ").concat(Object(Yn.inspect)(s.t0,{depth:null}))),s.next=16,Object(Ol.f)({type:yt.SET_DATASTORE_CHANGE,payload:Object(ve.a)(Object(ve.a)({},r),{},{state:Ze.REJECTED})});case 16:case"end":return s.stop()}}),$d,null,[[2,11]])}var zd=g.a.mark(Kd);function Kd(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ol.i)(R.WATCH_ALL,Tl);case 2:return e.next=4,Object(Ol.i)(R.WATCH_ALL_SCHEMAS,Nd);case 4:return e.next=6,Object(Ol.i)(Nl.FETCH_APPS,jl);case 6:return e.next=8,Object(Ol.i)(Il.FETCH_TEAMS,Pl);case 8:return e.next=10,Object(Ol.i)(yt.FETCH_DATASTORES,Bl);case 10:return e.next=12,Object(Ol.i)(yt.FETCH_DATASTORE_DETAILS,Ql);case 12:return e.next=14,Object(Ol.i)(yt.FETCH_DATASTORE_METRICS,eo);case 14:return e.next=16,Object(Ol.i)(Tc.FETCH_CLIP_DETAILS,no);case 16:return e.next=18,Object(Ol.i)(Tc.FETCH_CLIP_RESULT,so);case 18:return e.next=20,Object(Ol.i)(Tc.UPDATE_CLIP,lo);case 20:return e.next=22,Object(Ol.i)(Tc.RUN_CLIP,fo);case 22:return e.next=24,Object(Ol.i)(Tc.SHARE_CLIP_WITH_USER,bo);case 24:return e.next=26,Object(Ol.i)(Tc.SHARE_CLIP_WITH_TEAM,ko);case 26:return e.next=28,Object(Ol.i)(Tc.UNSHARE_CLIP_WITH_USER,Oo);case 28:return e.next=30,Object(Ol.i)(Tc.UNSHARE_CLIP_WITH_TEAM,_o);case 30:return e.next=32,Object(Ol.i)(Fa.ADD_CREDENTIAL,Do);case 32:return e.next=34,Object(Ol.i)(Fa.ROTATE_CREDENTIAL,Ao);case 34:return e.next=36,Object(Ol.i)(Fa.DESTROY_CREDENTIAL,Lo);case 36:return e.next=38,Object(Ol.i)(Fa.ROTATE_ALL_CREDENTIALS,Fo);case 38:return e.next=40,Object(Ol.i)(Fa.ATTACH_CREDENTIAL,$o);case 40:return e.next=42,Object(Ol.i)(Fa.DETACH_CREDENTIAL,zo);case 42:return e.next=44,Object(Ol.i)(Fa.DESTROY_BACKUP,Jo);case 44:return e.next=46,Object(Ol.i)(Fa.CREATE_BACKUP,Qo);case 46:return e.next=48,Object(Ol.i)(Fa.DESTROY,ed);case 48:return e.next=50,Object(Ol.i)(Fa.ROLLBACK,nd);case 50:return e.next=52,Object(Ol.i)(Fa.FORK,id);case 52:return e.next=54,Object(Ol.i)(Fa.ADD_FOLLOWER,od);case 54:return e.next=56,Object(Ol.i)(Fa.REMOVE_FOLLOWER,md);case 56:return e.next=58,Object(Ol.i)(Fa.UNFOLLOW,fd);case 58:return e.next=60,Object(Ol.i)(Fa.CONFIGURE,bd);case 60:return e.next=62,Object(Ol.i)(Fa.SET_PERMISSIONS,kd);case 62:return e.next=64,Object(Ol.i)(Fa.FETCH_SCHEMA,Td);case 64:return e.next=66,Object(Ol.i)(Fa.DIAGNOSE,jd);case 66:return e.next=68,Object(Ol.i)(Fa.TERMINATE_CONNECTION,Pd);case 68:return e.next=70,Object(Ol.i)(oa.ADD_TOPIC,Hd);case 70:return e.next=72,Object(Ol.i)(oa.DELETE_TOPIC,Gd);case 72:return e.next=74,Object(Ol.i)(oa.UPDATE_TOPIC,Bd);case 74:case"end":return e.stop()}}),zd)}var Wd=Object(ml.a)(),Jd=[Wd];var Yd=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e;e=this.props.store,po=mo()("".concat(xe.b.REACT_APP_HEROKUDATA_BACKEND),{transports:["websocket","polling"],upgrade:!1,query:{token:window.user.accessToken}}),oo=setInterval((function(){po.emit("heartbeat",{time:Date.now()})}),Ie.a.duration(15,"seconds").asMilliseconds()),po.on("debug",(function(e){k.a.debug(e)})),po.on("heartbeat",(function(e){e.time;var t=e.serverVersionHash;window.serverVersionHash=t})),po.on("syncComplete",(function(){window.paused?k.a.debug("paused: ignoring syncComplete!"):(k.a.debug("syncComplete triggered!"),e.dispatch({type:yt.FETCH_DATASTORES,background:!0}))})),po.on("clipResultReady",(function(t){var a=t.slug;t.clipVersionId,t.resultId,window.paused?k.a.debug("paused: ignoring clipResultReady!"):(k.a.debug("\ud83c\udf89  clipResultReady: slug=".concat(a)),e.dispatch({type:Tc.FETCH_CLIP_DETAILS,slug:a,background:!0}))})),po.on("schemaRefreshError",(function(t){var a=t.addonId,n=t.message;e.dispatch({type:Fa.FETCH_SCHEMA,addonId:a,background:!1,error:new Error(n)})})),po.on("schemaRefreshFinished",(function(t){var a=t.addonId,n=t.credential;window.paused?k.a.debug("paused: ignoring schemaRefreshFinished!"):(k.a.debug("schemaRefreshFinished: addon",a,", credential",n),e.dispatch({type:Fa.FETCH_SCHEMA,addonId:a,background:!0}))}))}},{key:"componentWillUnmount",value:function(){po&&(clearInterval(oo),oo=null,po.disconnect(),po=null)}},{key:"render",value:function(){return this.props.children}}]),a}(c.Component),Vd=!1,Qd=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).store=function(){var e=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||bn.d,t=Object(bn.e)(Cl,e(bn.a.apply(void 0,Jd)));return Wd.run(Kd),t}(),Vd||(Vd=!0,r.store.dispatch({type:R.WATCH_ALL}),r.store.dispatch({type:R.WATCH_ALL_SCHEMAS})),r}return Object(r.a)(a,[{key:"componentDidCatch",value:function(e,t){window.Rollbar.error(e,{stack:t.componentStack,message:"Error rendering Root"})}},{key:"render",value:function(){var e=this;return l.a.createElement(d.a,{store:this.store},l.a.createElement(I,{services:{dispatch:this.store.dispatch}},l.a.createElement(Yd,{store:this.store},l.a.createElement(c.Fragment,null,l.a.createElement(o.b,null),l.a.createElement(o.b,{set:"marketing"}),l.a.createElement(A,null),l.a.createElement(ul,null,l.a.createElement(h.a,{title:"Heroku Data"},l.a.createElement(u.a,null,l.a.createElement(m.d,null,l.a.createElement(T,{layout:Zs,exact:!0,path:"/",component:Vs}),l.a.createElement(m.a,{from:"/datastore/:id",to:"/datastores/:id"}),l.a.createElement(m.b,{path:"/datastores/:id",component:Hs}),l.a.createElement(m.b,{path:"/dataclips/:slug(\\w{28})",component:oi(ll,"dataclip-detail-v2")}),l.a.createElement(m.b,{path:"/dataclips/create",component:oi(mc,"dataclip-detail-v2")}),l.a.createElement(T,{layout:Zs,path:"/dataclips/",component:He,exact:!0,strict:!1}),l.a.createElement(m.b,{exact:!0,path:"/release",component:ci}),l.a.createElement(m.b,{exact:!0,path:"/logout",component:ii}),l.a.createElement(m.b,{exact:!0,path:"/impersonate",render:function(t){return l.a.createElement(si,Object.assign({user:e.props.user},t))}}),l.a.createElement(m.b,{path:"*",component:D})),this.props.impersonatedUser&&l.a.createElement(li,{linkText:"Stop Assuming Identity"}),this.props.preauthData&&l.a.createElement(li,{linkText:"Release Preauth"}))))))))}}]),a}(c.Component);t.default=Qd},732:function(e,t){var a="fragment clipFragment on Clip {\n  id\n  created_at\n  creator {\n    id\n    email\n  }\n  edited_at\n  slug\n  title\n  user_shares {\n    id\n    clip_id\n    shared_by {\n      id\n      email\n    }\n    shared_with {\n      id\n      email\n    }\n  }\n  team_shares {\n    id\n    clip_id\n    shared_by {\n      id\n      email\n    }\n    shared_with {\n      id\n      name\n    }\n  }\n  team_id\n  public_slug\n  public_slug_by\n  detached\n  datasource {\n    id\n    addon_id\n    addon_name\n    attachment_id\n    attachment_name\n    app_id\n    app_name\n  }\n  versions(limit: 1) {\n    id\n    created_at\n    sql\n    url\n    latest_result_checksum\n    latest_result_at\n    latest_result_size\n    creator_id\n    creator {\n      email\n    }\n    result {\n      id\n      query_started_at\n      query_finished_at\n      error\n      completed_at\n      duration\n    }\n  }\n  editable\n}",n="fragment privatelinkFragment on Privatelink {\n  app_name\n  addon_name\n  addon_uuid\n  status\n  service_name\n  allowed_accounts {\n    arn\n    status\n  }\n  connections {\n    endpoint_id\n    hostname\n    owner_arn\n    status\n  }\n}";e.exports={fetchUser:"query FetchUser {\n      user {\n        id\n        email\n        last_sync\n        feature_flags\n\n        addons {\n          id\n          name\n          plan\n          service\n          app_uuid\n          app_name\n          web_url\n          role\n\n          attachments {\n            id\n            name\n            app_name\n            app_uuid\n            namespace\n          }\n        }\n      }\n    }",fetchKafkaDetails:"query FetchKafkaDetails($addonUUID: ID!) {\n      kafka (addon_uuid: $addonUUID) {\n        name\n        state {\n          message\n          waiting\n          healthy\n          degraded_topics\n          degraded_brokers\n          status\n        }\n        capabilities {\n          supports_mixed_cleanup_policy\n        }\n        shared_cluster\n        limits {\n          minimum_replication\n          maximum_replication\n          minimum_retention_ms\n          maximum_retention_ms\n          max_partition_replica_count\n          max_number_of_partitions_per_topic\n          max_number_of_topics,\n        }\n        defaults {\n          partition_count\n        }\n        messages_in_per_sec\n        bytes_in_per_sec\n        bytes_out_per_sec\n        data_size\n        topicnames\n        version\n        admin_topic_names\n        customer_encryption_key\n        topics {\n          topic\n          messages_in_per_second\n          bytes_in_per_second\n          bytes_out_per_second\n          data_size\n          partitions\n          replication_factor\n          retention_enabled\n          retention_time_ms\n          compaction_enabled\n          status\n          status_label\n        }\n        topic_prefix\n      }\n    }",fetchRedisDetails:"query FetchRedisDetails($addonUUID: ID!) {\n      redis (addon_uuid: $addonUUID) {\n        created_at\n        credentials {\n          hostname\n          password\n          port\n          user\n        }\n        customer_encryption_key\n        maintenance\n        maintenanceWindow\n        maxMemory\n        name\n        plan\n        port\n        resource_url\n        status\n        timeout\n        version\n      }\n    }",fetchPostgresqlDetails:"query FetchPostgresDetails($addonUUID: ID!) {\n      postgres (addon_uuid: $addonUUID) {\n        name\n        usesLegacyInfrastructure\n        addon_id\n        hobby\n        spaces\n        shielded\n        maintenance\n        maintenance_window\n        data_size\n        num_bytes\n        rows\n        rowsLimit\n        rowsLimitComplianceMessage\n        connections\n        tables\n        plan\n        region\n        pg_version\n        status\n        primary\n        role\n        created_at\n        rollback\n        rollbackDate\n        waiting\n        following\n        isAvailable\n        mutual_tls\n        customer_encryption_key\n        leader {\n          addon_id\n          name\n        }\n        credentials {\n          user\n          password\n          hostname\n          port\n          database\n        }\n        credentials_list {\n          uuid\n          name\n          state\n          database\n          host\n          port\n          credentials {\n            user\n            password\n            state\n          }\n        }\n        backups {\n          uuid\n          readable_name\n          addon_uuid\n          created_at\n          updated_at\n          started_at\n          finished_at\n          deleted_at\n          purged_at\n          canceled_at\n          num\n          succeeded\n          processed_bytes\n          source_bytes\n          from_name\n          from_type\n          to_name\n          to_type\n        }\n        followers {\n          name\n          addon_id\n          hobby\n          maintenance\n          maintenance_window\n          data_size\n          connections\n          tables\n          plan\n          pg_version\n          status\n          primary\n          role\n          created_at\n          rollback\n          isAvailable\n        }\n        expensiveQueries {\n          query_id\n          text\n          observations {\n            time\n            time_spent\n            calls\n            average_time\n            read_time\n            write_time\n          }\n        }\n        canManageAddons\n        settings {\n          name\n          value\n          default\n        }\n      }\n    }",fetchPostgresqlCredentialStates:"query FetchPostgresCredentialStates($addonUUID: ID!) {\n      postgres (addon_uuid: $addonUUID) {\n        credentials_list {\n          uuid\n          name\n          state\n        }\n      }\n    }",createKafkaTopic:"mutation CreateKafkaTopic($addonUUID: ID!, $topic: String!, $partitions: Int!, $rf: Int!, $compaction: Boolean!, $retentionTime: Float) {\n        createKafkaTopic (\n        addon_uuid: $addonUUID\n        topic: $topic\n        partitions: $partitions\n        replicationFactor: $rf\n        compaction: $compaction\n        retentionTime: $retentionTime\n      )\n    }",updateKafkaTopic:"mutation UpdateKafkaTopic($addonUUID: ID!, $topic: String!, $rf: Int!, $compaction: Boolean!, $retentionTime: Float) {\n      updateKafkaTopic (\n        addon_uuid: $addonUUID\n        topic: $topic\n        replicationFactor: $rf\n        compaction: $compaction\n        retentionTime: $retentionTime\n      )\n  }",deleteKafkaTopic:"mutation DeleteKafkaTopic($addonUUID: ID!, $topic: String!) {\n      deleteKafkaTopic (addon_uuid: $addonUUID, topic: $topic)\n    }",createPostgresBackup:"mutation CreatePostgresBackup($addonUUID: ID!) {\n      createPostgresBackup(addon_uuid: $addonUUID) {\n        uuid\n        readable_name\n        addon_uuid\n        created_at\n        updated_at\n        started_at\n        finished_at\n        deleted_at\n        purged_at\n        canceled_at\n        num\n        succeeded\n        processed_bytes\n        source_bytes\n        from_name\n        from_type\n        to_name\n        to_type\n      }\n    }",deletePostgresBackup:"mutation DeletePostgresBackup($addonUUID: ID!, $backupId: String!) {\n      deletePostgresBackup(addon_uuid: $addonUUID, backup_id: $backupId) {\n        uuid\n        readable_name\n        addon_uuid\n        created_at\n        updated_at\n        started_at\n        finished_at\n        deleted_at\n        purged_at\n        canceled_at\n        num\n        succeeded\n        processed_bytes\n        source_bytes\n        from_name\n        from_type\n        to_name\n        to_type\n      }\n    }",generatePostgresBackupUrl:"mutation GeneratePostgresBackupUrl($addonUUID: ID!, $backupId: String!) {\n      generatePostgresBackupUrl(addon_uuid: $addonUUID, backup_id: $backupId) {\n        url\n        expires_at\n      }\n    }",addPostgresFollower:"mutation AddPostgresFollower($addonUUID: ID!, $plan: String!, $region: String!) {\n      addPostgresFollower(\n        leader_uuid: $addonUUID\n        plan: $plan\n        region: $region\n      ) {\n        id\n        name\n      }\n    }",unfollowPostgres:"mutation UnfollowPostgres($addonUUID: ID!) {\n      unfollowPostgres(\n        addon_uuid: $addonUUID\n      )\n    }",removePostgres:"mutation RemovePostgres($addonUUID: ID!) {\n      removePostgres(\n        addon_uuid: $addonUUID\n      )\n    }",resetPostgres:"mutation ResetPostgres($addonUUID: ID!) {\n      resetPostgres(\n        addon_uuid: $addonUUID\n      )\n    }",rollbackPostgres:"mutation RollbackPostgres($addonUUID: ID!, $plan: String!, $to: String!, $region: String!) {\n    rollbackPostgres(\n      addon_uuid: $addonUUID\n      plan: $plan\n      to: $to\n      region: $region\n    ) {\n      id\n      name\n      plan\n    }\n  }",forkPostgres:"mutation CreatePostgresFork($addonUUID: ID!, $plan: String!, $region: String!) {\n    createPostgresFork(\n      addon_uuid: $addonUUID\n      plan: $plan\n      region: $region\n    )\n  }",fetchDatastoreMetrics:"query MetaasQuery($addonUUID: ID!, $service: String!, $start: String!, $end: String!, $resolution: String!, $filter: String) {\n    metaas(\n      addon_uuid: $addonUUID\n      service: $service\n      start: $start\n      end: $end\n      step: $resolution\n      filter: $filter\n    ) {\n      name\n      measurements\n    }\n  }",createDataclip:"mutation CreateDataclip($attachmentId: ID!, $title: String!, $sql: String!, $teamId: ID) {\n    createClip(attachmentId: $attachmentId, title: $title, sql: $sql, teamId: $teamId) {\n      ...clipFragment\n    }\n  }".concat(a),deleteDataclip:"mutation DeleteDataclip($clipId: ID!) {\n    deleteClip(clipId: $clipId)\n  }",updateDataclip:"mutation UpdateDataclip($clipId: ID!, $attachmentId: ID, $title: String, $sql: String) {\n    updateClip(clipId: $clipId, attachmentId: $attachmentId, title: $title, sql: $sql) {\n      ...clipFragment\n    }\n  }".concat(a),fetchClipDetails:"query FetchClipDetails($slug: ID!) {\n    clip(slug: $slug) {\n      ...clipFragment\n    }\n  }".concat(a),shareDataclipWithUser:"mutation ShareDataclipWithUser($clipId: ID!, $email: String!) {\n    shareClipWithUser(clipId: $clipId, email: $email) {\n      id\n      created_at\n      clip_id\n      shared_by {\n        id\n        email\n      }\n      shared_with {\n        id\n        email\n      }\n    }\n  }",shareDataclipWithTeam:"mutation ShareDataclipWithTeam($clipId: ID!, $teamId: ID!) {\n    shareClipWithTeam(clipId: $clipId, teamId: $teamId) {\n      id\n      created_at\n      clip_id\n      shared_by {\n        id\n        email\n      }\n      shared_with {\n        id\n        name\n      }\n    }\n  }",unshareDataclipWithUser:"mutation UnshareDataclipWithUser($clipId: ID!, $clipShareId: ID!) {\n    unshareClipWithUser(clipId: $clipId, clipShareId: $clipShareId)\n  }",unshareDataclipWithTeam:"mutation UnshareDataclipWithTeam($clipId: ID!, $clipShareId: ID!) {\n    unshareClipWithTeam(clipId: $clipId, clipShareId: $clipShareId)\n  }",sharePublicDataclip:"mutation SharePublicDataclip($slug: ID!) {\n    togglePublicClipShare(slug: $slug, enabled: true) {\n      ...clipFragment\n    }\n  }".concat(a),unsharePublicDataclip:"mutation UnsharePublicDataclip($slug: ID!) {\n    togglePublicClipShare(slug: $slug, enabled: false) {\n      ...clipFragment\n    }\n  }".concat(a),listClips:"query ListClips {\n    listClips {\n      id\n      slug\n      title\n      creator {\n        id\n        email\n      }\n      created_at\n      edited_at\n      datasource {\n        addon_name\n        attachment_id\n      }\n      detached\n      editable\n    }\n  }",listApps:"query ListApps {\n    listApps {\n      id\n      name\n      owner_id\n    }\n  }",listTeams:"query ListTeams {\n    listTeams {\n      id\n      name\n      role\n      type\n      default\n      enterprise_account {\n        id\n        name\n      }\n    }\n  }",createCredential:"mutation CreateCredential($addonUUID: ID!, $name: String!) {\n    createCredential(\n      addon_uuid: $addonUUID\n      name: $name\n    )\n  }",rotateCredential:"mutation RotateCredential($addonUUID: ID!, $name: String!, $forced: Boolean!) {\n    rotateCredential(\n      addon_uuid: $addonUUID\n      name: $name\n      forced: $forced\n    )\n  }",destroyCredential:"mutation DestroyCredential($addonUUID: ID!, $name: String!) {\n    destroyCredential(\n      addon_uuid: $addonUUID\n      name: $name\n    )\n  }",rotateAllCredentials:"mutation RotateCredential($addonUUID: ID!, $forced: Boolean!) {\n    rotateAllCredentials(\n      addon_uuid: $addonUUID\n      forced: $forced\n    )\n  }",attachCredential:"mutation AttachCredential($addonUUID: ID!, $credential: String!, $appID: ID!, $attachment: String!) {\n    attachCredential(\n      addon_uuid: $addonUUID\n      credential: $credential\n      app_id: $appID\n      attachment: $attachment\n    ) {\n      id, name, app_name, app_uuid, namespace\n    }\n  }",detachCredential:"mutation DetachCredential($attachmentID: ID!) {\n    detachCredential(attachment_id: $attachmentID) {\n      id\n    }\n  }",configurePostgres:"mutation ConfigurePostgres($addonUUID: ID!, $settings: JSON!) {\n    configurePostgres(\n      addon_uuid: $addonUUID\n      settings: $settings\n    ) {\n      name, value, default\n    }\n  }",refreshPostgresSchema:"mutation RefreshPostgresSchema($addonUUID: ID!) {\n    refreshSchema(addonUUID: $addonUUID) {\n      addonUUID\n    }\n  }",fetchPostgresSchema:"query FetchSchema($addonUUID: ID!) {\n    postgresSchema(addon_uuid: $addonUUID) {\n      name\n      owner\n      search_path\n      last_modified\n      acls {...ACLFragment}\n      default_acls {...DefaultACLFragment}\n      roles {\n        name\n        memberships\n        superuser\n      }\n      schemas {\n        oid\n        name\n        owner\n        acls {...ACLFragment}\n        default_acls {...DefaultACLFragment}\n        relations {\n          oid\n          name\n          owner\n          acls {...ACLFragment}\n          kind\n          columns {\n            name\n            number\n            type_oid\n            nullable\n            default\n          }\n          indexes {\n            oid\n            name\n            primary_key\n            columns\n          }\n          dependencies\n        }\n        sequences {\n          oid\n          name\n          owner\n          acls {...ACLFragment}\n        }\n        types {\n          oid\n          name\n          owner\n        }\n      }\n    }\n  }\n  fragment ACLFragment on PostgresSchemaACL {\n    role\n    privileges\n  }\n  fragment DefaultACLFragment on PostgresSchemaDefaultACL {\n    creator\n    object_type\n    role\n    privileges\n  }",diagnosePostgres:"query PostgresDiagnose($addonUUID: ID!) {\n  postgresDiagnose(addon_uuid: $addonUUID) {\n    name\n    status\n    details\n  }\n}\n",terminatePostgresConnection:"mutation TerminatePostgresConnection($addonUUID: ID!, $pid: ID!) {\n    terminatePostgresConnection(\n      addon_uuid: $addonUUID\n      pid: $pid\n    )\n  }",setPostgresPermissions:"mutation SetPostgresPermissions($addonUUID: ID!, $role: String!, $acls: [PostgresACLInput]!) {\n    setPostgresPermissions(\n      addon_uuid: $addonUUID\n      role: $role\n      acls: $acls\n    )\n  }",fetchPrivatelink:"query FetchPrivatelink($addonUUID: ID!) {\n    privatelink(addonUUID: $addonUUID) {\n      ...privatelinkFragment\n    }\n  }".concat(n),createPrivatelink:"mutation CreatePrivatelink($addonUUID: ID!, $allowedAccounts: [String]!) {\n    createPrivatelink (addonUUID: $addonUUID, allowedAccounts: $allowedAccounts) {\n      ...privatelinkFragment\n    }\n  }".concat(n),destroyPrivatelink:"mutation DestroyPrivatelink($addonUUID: ID!) {\n    destroyPrivatelink (addonUUID: $addonUUID)\n  }",addPrivatelinkAllowed:"mutation AddPrivatelinkAllowed($addonUUID: ID!, $allowedAccounts: [String]!) {\n    addPrivatelinkAllowed (addonUUID: $addonUUID, allowedAccounts: $allowedAccounts) {\n      ...privatelinkFragment\n    }\n  }".concat(n),removePrivatelinkAllowed:"mutation RemovePrivatelinkAllowed($addonUUID: ID!, $allowedAccounts: [String]!) {\n    removePrivatelinkAllowed (addonUUID: $addonUUID, allowedAccounts: $allowedAccounts) {\n      ...privatelinkFragment\n    }\n  }".concat(n),getMTLS:"query GetMTLS ($addonUUID: ID!) {\n    mtls(addonUUID: $addonUUID) {\n      addon\n      app\n      status\n      ipRules {\n        status\n        id\n        cidr\n        description\n        created_at\n      }\n      certificates {\n        id\n        status\n        created_at\n        expires_at\n      }\n    }\n  }\n  ",enableMTLS:"mutation EnableMTLS($addonUUID: ID!) {\n    enableMTLS(addonUUID: $addonUUID) {\n      addon\n      status\n    }\n  }\n  ",deleteMTLS:"mutation DeleteMTLS($addonUUID: ID!) {\n    deleteMTLS(addonUUID: $addonUUID) {\n      id\n    }\n  }\n  ",createMTLSIPRule:"mutation CreateMTLSIPRule($addonUUID: ID!, $cidr: String!, $description: String!) {\n    createMTLSIpRule(addonUUID: $addonUUID, cidr: $cidr, description: $description) {\n      id\n      cidr\n      description\n      status\n      created_at\n    }\n  }",deleteMTLSIPRule:"mutation DeleteMTLSIPRule($addonUUID: ID!, $id: ID!) {\n    deleteMTLSIpRule(addonUUID: $addonUUID, id: $id) {\n      id\n    }\n  }",createMTLSCertificate:"mutation CreateMTLSCertificate($addonUUID: ID!) {\n    createMTLSCert(addonUUID: $addonUUID) {\n      id\n      status\n      created_at\n      expires_at\n    }\n  }",deleteMTLSCertificate:"mutation DeleteMTLSCertificate($addonUUID: ID!, $id: ID!) {\n    deleteMTLSCert(addonUUID: $addonUUID, id: $id) {\n      id\n    }\n  }"}},733:function(e,t,a){},734:function(e,t,a){},735:function(e,t,a){},746:function(e,t,a){},747:function(e,t,a){}}]);
//# sourceMappingURL=4.e9f0fe6b.chunk.js.map